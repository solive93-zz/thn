window.fbFrontVersion="1.143.1",function($,_){var logsBuffer=[];$.extend(window.$fb,{_config:{maxPackages:3,maxRates:3,debug:!1,syncRetryLimit:2,quotationCurrency:"EUR",quotationExpireTime:3e5,errorsMapping:{"booking-save":{"error-cc-invalid":[181],"error-price-changed-text":[350,351,353,354],"error-unavailable-text":[/2\d\d/],"error-date-past":[125,135],"error-date-mismatch":[126,136],"error-server-maintenance":[202],"error-unexpected":[]},"booking-cancel":{"cancel-error-booking-not-found":[1100],"cancel-error-email-different":[1150],"cancel-error-not-confirmed":[1200],"cancel-error-not-cancellable":[1201,1202],"cancel-error-other-problem":[]}}},_state:{url:"https://www.book-secure.com",api_url:"https://www.book-secure.com/api.php",isMobile:!1,showNonRomanWarning:!1,googleMapLoaded:!1,unsupportedParameters:{},p:{},app:{previousStep:"none",step:"results",stepId:0,currency:"EUR",mode:"single",integration:"standalone",lockedRate:null,loading:{},saving:{},modules:["header","group","favicon","quicksearch","results","extras","basket","localize","recap","datacollect","guarantee","paymenttypes","confirmbutton","confirmrecap","hoteldetails","roomdetails","footer","cancel","loyalties","loyaltyteasing","ghs","prince","emarsys","fujitakanko"],data:{properties:{},groups:{},quotation:{},alterquotation:{},rates:{},services:{},accommodations:{},salesterms:{},bookings:{},countries:{},campaigns:{},languages:{}},booking:{},firePageview:255},quicksearch:{configuration:{needChildrenAges:!1,childrenMaxAge:-1,maxAdults:100,maxChildren:100},occupancy:[{nbAdults:1,nbChildren:0,childrenAges:[]}]},timing:{requests:{},durations:{}},lastTrackStep:-1,trackFrom:null,ready:!1},_stepModules:{results:["hoteldetails","roomdetails","localize","basket","loyalties","loyaltyteasing","results","quicksearch","header","footer","group","favicon","loyaltycontroller","loyaltyform"],extras:["hoteldetails","roomdetails","localize","loyalties","loyaltyteasing","results","basket","extras","quicksearch","header","footer","favicon"],"validate-collect":["hoteldetails","roomdetails","localize","loyalties","loyaltyteasing","results","basket","recap","header","datacollect","guarantee","paymenttypes","confirmbutton","quicksearch","footer","favicon"],confirm:["hoteldetails","roomdetails","localize","quicksearch","loyalties","loyaltyteasing","confirmrecap","header","footer","favicon"],cancel:["hoteldetails","roomdetails","localize","cancel","header","footer"],group:["hoteldetails","roomdetails","localize","quicksearch","loyalties","loyaltyteasing","group","basket","results","header","footer","favicon"]},_initializedModules:[],_modals:["localize","hoteldetails","roomdetails","confirmbutton_terms","confirmbutton_privacy","cancel_modal"],console:function(status,messages){if(0!==arguments.length)if($fb._config.debug){if($.fb)for(var i in messages)$.fb("crs-log",{l:status,m:messages[i]});else if(window.console&&"function"==typeof window.console[status])for(var j in messages)console[status](">>",messages[j])}else logsBuffer.push(arguments)},log:function(){$fb.console("log",Array.prototype.slice.call(arguments,0))},info:function(){$fb.console("info",Array.prototype.slice.call(arguments,0))},warn:function(){$fb.console("warn",Array.prototype.slice.call(arguments,0))},error:function(){$fb.console("error",Array.prototype.slice.call(arguments,0))},notice:function(){$fb.console("notice",Array.prototype.slice.call(arguments,0))},reloadQuotation:function(doEmptySelection,changeToStepGroupOrResults,canFireFirst){if(doEmptySelection&&$fb._triggerEvent("fastbooking-crs-frontend-emptySelection"),canFireFirst||$fb.loader._state.quotationAlreadyFired){var doIt=function(){var scrollTop=$(window).scrollTop();$fb._triggerEvent("fastbooking-crs-frontend-basket-render"),"group"!==$fb._state.app.step&&("results"!==$fb._state.app.step&&changeToStepGroupOrResults&&($fb._ChangeAppStep("results"),$fb._addHistory(),$fb._checkStep()),$fb._triggerEvent("fastbooking-crs-frontend-load-quotation",{forceCall:!0}),$(window).one("fastbooking-crs-frontend-load-quotation-done",function(){$(window).scrollTop(scrollTop)})),_.size($fb._state.app.data.groups)&&$fb._triggerEvent("fastbooking-crs-frontend-group-quotation.group")};if($fb._state.app.loading.quotation)try{Object.values($fb._state._api).find(function(call){return"quotation"===call.apiCall.c}).call.abort(),doIt()}catch(e){$(window).one("fastbooking-crs-frontend-load-quotation-done",doIt)}else doIt()}},getUrlArgs:function(){return location.search.substr(1).split("&").map(function(e){var parts=e.split("=");return[parts.shift(),parts.join("=")]}).reduce(function(query,e){return query[e[0]]=decodeURIComponent(e[1]),query},{})},setUrlArgs:function(args){history.replaceState&&history.replaceState({},"book secure",$fb.formatUrl(args))},formatUrl:function(args){var newSearch="?"+Object.keys(args).map(function(key){return key+"="+encodeURIComponent(args[key])}).join("&");return location.href.replace(location.search,newSearch)},require:function(event){return $fb._checkEvent("app","require",event)?(function(modules){if("string"==typeof modules&&(modules=[modules]),$fb.log("require modules: "+JSON.stringify(modules)),!modules.length)return $fb._callback(event);!function loadModulesAsync(module){if(!module)return $fb._callback(event);if($fb[module])return $fb.log("Module "+module+" already defined."),loadModulesAsync(modules.shift());if(-1===$fb._state.app.modules.indexOf(module))return $fb.log("require - _registerDefaultHandler: "+module),$fb._registerDefaultHandler(module,loadModulesAsync.call(modules.shift()),function(){$fb._triggerEvent("fastbooking-crs-frontend-require-"+module+"-fail")});$fb._external("dist/modules/"+module+".min.js",function(){if($fb.log("modules successfuly loaded: "+module),!$fb[module])return $fb.error("could not load module "+module,"dist/modules/"+module+".js"),void $fb._triggerEvent("fastbooking-crs-frontend-message",{type:"failure",title:"Service unavailable",message:"failed loading module "+module});$fb.log("init: "+module),$fb._triggerEvent("fastbooking-crs-frontend-"+module+"-init",{},function(){$fb._initializedModules.push(module),loadModulesAsync(modules.shift())})},function(err){$fb.error("Error while external the module "+module,err)})}(modules.shift())}(event.args||{}),!0):$fb._callback(event)},debug:function(){$fb._config.debug=!0;var logConfig=$.fb("crs-utils-configure",{k:"log"});logConfig.level=8,$.fb("crs-utils-configure",{k:"log",v:logConfig}),logsBuffer.forEach(function(args){$fb.console.apply($fb,args)}),logsBuffer.splice(0,logsBuffer.length),$fb.storage&&$fb.storage.save("debug",!0)},init:function(context){$fb.storage&&$fb.storage.load("debug")&&$fb.debug(),$fb._state.$body=$("body"),$fb._state=$.extend(!0,$fb._state,context),$("#fb-main-container").length<=0?($fb._state.container=$('<div id="fb-main-container" class="container fb-container fb-light-bg fb-gray-bg" />'),$("body").append($fb._state.container)):$fb._state.container=$("#fb-main-container"),$.ajaxSetup({cache:!0}),$fb._state.v&&($fb._config.v=$fb._state.v),$fb._config.fbFrontVersion=window.fbFrontVersion;var navLang=window.navigator.language||window.navigator.userLanguage;switch(navLang.toLowerCase()){case"zh-tw":$fb._state.lang="zht";break;case"zh-cn":$fb._state.lang="zhs";break;default:$fb._state.lang=2<navLang.length?navLang.substring(0,2):navLang}$fb.events.init();var parsedUrl=$fb._parseCurrentUrl();void 0===$fb._state.app.locale&&($fb._state.app.locale=$fb.standardize.lang2locale($fb._state.lang)),$fb._state.isMobile=$fb._isMobile(),$fb._state.isMobile&&($fb._state.$body.addClass("mobile"),$("html").addClass("mobile")),$fb.cookies=Cookies.noConflict(),$fb._triggerEvent("$fb.fastbooking-crs-frontend-initializing");var utilsConfig={v:$fb._config.v,url:$fb._state.url,locale:$fb._state.app.locale,currency:$fb._state.app.currency,libraries:{api:{url:$fb._state.api_url,version:$fb._config.fbFrontVersion,originalReferer:$fb._state.originalReferer},helper:{cdn:$fb._state.mediastoreCdnUrl}}};void 0!==parsedUrl.property&&(utilsConfig.property=parsedUrl.property),void 0!==parsedUrl.group&&(utilsConfig.group=parsedUrl.group),$fb._state.app.sessid=Math.random().toString(36).substr(2,9),$fb._triggerEvent("fastbooking-crs-utils-init",utilsConfig,function(){$fb.log("Utils library loaded"),$fb._updateAppStateFromUrl(parsedUrl).then(function(){void 0===$fb._state.app.stid?$fb._state.app.stid=Math.random().toString(36).substr(2,9):$fb._loadState();var propertyPromise=Promise.resolve();"group"!==$fb._state.app.step&&(propertyPromise=$fb.propertyService.get($fb._state.quicksearch.property).then(function(propertyData){"results"===$fb._state.app.step&&($fb._triggerEvent("fastbooking-crs-frontend-load-rates"),$fb._triggerEvent("fastbooking-crs-frontend-load-accommodations"),$fb.areAllPackagesSelected()||$fb._triggerEvent("fastbooking-crs-frontend-load-quotation")),setTimeout(function(){document.title=$.fb("crs-helper-translate",{key:$fb._state.quicksearch.property+":hoteltitle",fallback:propertyData.title||"Book secure"}).text()},500),$fb.bannerRenderer.setHeaderImage(propertyData)}));var configPromise=$fb.loadConfig().then(function(config){config.debugMode&&$fb.debug(),$fb._config=$.extend(!0,$fb._config,config),$fb.info("Loaded configuration: "+JSON.stringify(config)),$fb._config.services&&$fb._config.services["attraction-cdn"]&&($fb._state.cdn_url="//"+$fb._config.services["attraction-cdn"],$.fb("crs-utils-configure",{k:"url",v:$fb._state.cdn_url})),$.fb("crs-utils-load",{libraries:{tracking:$fb._config.tracking||{}}},function(){$fb.log("Additional external libraries loaded.")})}).catch(function(error){$fb._triggerEvent("fastbooking-crs-frontend-message",{type:"failure",message:error.message})});Promise.all([propertyPromise,configPromise]).then(function(){$fb._triggerEvent("fastbooking-crs-frontend-initialized")})})})},areAllPackagesSelected:function(){return $fb.selection.nbRooms()>=$fb._state.quicksearch.occupancy.length},loadConfig:function(){return new Promise(function(resolve,reject){$fb._api({c:"config"},function(json){return null==json?($fb.error("NULL Json returned during configuration call"),reject(new Error("configuration service unavailable"))):json.status?"success"===json.status&&json.data?resolve(json.data):($fb.error("config call error: ",json),$fb.error("error message:",json.message),reject(new Error("configuration load failure"))):($fb.error("Invalid json message",json),reject(new Error("configuration load failure")))})})},waitForAb:function(){$fb.loadingAbTesting?$fb.loadingAbTesting.catch(function(){}).then(function(){$fb._triggerEvent("fastbooking-ready-to-run")}):$fb._triggerEvent("fastbooking-ready-to-run")},run:function(){$fb.log("load app.js run"),$fb._state.ready=!0,$fb._updateHistory(),$fb._triggerEvent("fastbooking-crs-frontend-renderAll")},renderAll:function(event){if($fb._checkStep(),$fb._state.ready){var toRender=_.union($fb._initializedModules,$fb._stepModules[$fb._state.app.step]),modulesToLoad=$.extend(!0,[],$fb._stepModules[$fb._state.app.step]);$fb._triggerEvent("fastbooking-crs-frontend-require",modulesToLoad,function(){return 0===toRender.length||(_.each(toRender,function(moduleName){$fb._triggerEvent("fastbooking-crs-frontend-"+moduleName+"-render")}),$fb._triggerEvent("fastbooking-crs-frontend-ui-browser-compatibility")),$fb._callback(event)})}else $fb.log("Application is not ready for render yet...")},_trackStep:function(callback){if(void 0===$fb._state.app.step||$fb._state.app.step===$fb.storage.load("_statelastTrackStep")||$fb._state.app.step===$fb._statelastTrackStep)return $fb.warn("Step "+$fb._state.app.step+" already tracked."),void("function"==typeof callback&&callback());var stepId=1;switch($fb._state.app.step){case"results":stepId=1,$.fb("crs-tracking-send","/room-selection");break;case"extras":stepId=2;break;case"validate-collect":stepId=3,$.fb("crs-tracking-send","/basket-validated");break;case"confirm":stepId=4}$fb._statelastTrackStep=$fb._state.app.step,$fb.storage.save("_statelastTrackStep",$fb._statelastTrackStep),$.fb&&$.fb("crs-tracking-send","/Booking/Step/"+stepId),"function"==typeof callback&&callback()},_checkStep:function(track){switch($fb._state.app.step){case"results":if($fb._state.quicksearch.group&&void 0===$fb._state.quicksearch.property)return $fb.error("Invalid group property, switching back to group page"),$fb._ChangeAppStep("group"),$fb._updateHistory(),$fb._checkStep();break;case"confirm":break;case"extras":$fb.selection.isEmpty()&&($fb.error("Invalid extras data, switching back to results"),$fb._triggerEvent("fastbooking-crs-frontend-emptySelection",{},function(){return $fb._ChangeAppStep("results"),$fb._updateHistory(),$fb._checkStep()}));break;case"validate-collect":$fb.selection.isEmpty()&&($fb.error("Invalid validate data, switching back to results"),$fb._triggerEvent("fastbooking-crs-frontend-emptySelection",{},function(){return $fb._ChangeAppStep("results"),$fb._updateHistory(),$fb._checkStep()}))}return $fb._updateBodyStepClass($fb._state.app.step),$fb._state.app.data.confirmStepRedirectionUrl&&"confirm"===$fb._state.app.step?$fb._state.$body.addClass("hide"):$fb._state.$body.removeClass("hide"),void 0!==track&&!0!==track||$fb._trackStep(),!0},_updateBodyStepClass:function(currentStep){Object.keys($fb._stepModules).forEach(function(step){step===currentStep?$fb._state.$body.addClass(currentStep):$fb._state.$body.removeClass(step)})},_api:function(data,success,error){return $fb._triggerEvent("crs-api-call",{data:data,success:function(json){if(null==json)$fb.error(data.c+" api call : null json returned");else if(void 0===json.status)$fb.error(data.c+" api call : failure ",json);else if("error"==json.status){var code=json.infos&&json.infos.code?json.infos.code:"";$fb.error(data.c+" api call : error "+code,json),json.message&&$fb.error(data.c+" api call message : "+json.message)}else $fb._triggerEvent("fastbooking-crs-frontend-storage-save",{k:$fb._state.app.sessid+"-retry-"+data.c,v:""});"function"==typeof success&&success(json)},error:function(json){null==json?$fb.error(data.c+" api call : null json returned"):void 0===json.status?$fb.error(data.c+" api call : failure ",json):"abort"!==json.statusText&&($fb.error(data.c+" api call : error",json),json.message&&$fb.error(data.c+" api call message : "+json.message)),"function"==typeof error&&error(json)}})},_ChangeAppStep:function(step){switch($fb._state.app.previousStep=$fb._state.app.step,$fb._state.app.step=step){case"results":$fb._state.app.stepId=1;break;case"extras":$fb._state.app.stepId=2;break;case"validate-collect":$fb._state.app.stepId=3;break;case"confirm":$fb._state.app.stepId=4;break;case"cancel":$fb._state.app.stepId=5;break;case"group":$fb._state.app.stepId=6}$fb._state.app.step=step,$fb._state.app.firePageview|=1<<$fb._state.app.stepId},_FirePageView:function(){if("extras"!==$fb._state.app.step||$fb.extras){var eventToTrigger="fastbooking-crs-frontend-pageview-"+$fb._state.app.step,trigPageView=!0;$fb._config.tracking&&$fb._config.tracking.datalayer&&$fb._config.tracking.datalayer.activated&&$fb._config.tracking.datalayer.layer&&$fb._config.tracking.datalayer.layer.app&&$fb._config.tracking.datalayer.layer.app[eventToTrigger]&&$fb._config.tracking.datalayer.layer.app[eventToTrigger].data&&(-1===$fb._config.tracking.datalayer.layer.app[eventToTrigger].data.indexOf("selection")||$fb._state.app.data.rates[$fb._state.quicksearch.property]||(trigPageView=!1),-1===$fb._config.tracking.datalayer.layer.app[eventToTrigger].data.indexOf("property")||$fb._state.app.data.properties[$fb._state.quicksearch.property]||(trigPageView=!1),-1===$fb._config.tracking.datalayer.layer.app[eventToTrigger].data.indexOf("booking")||$fb._state.app.data.bookings[$fb._state.app.booking.confirmation]||(trigPageView=!1)),$.fb("crs-tracking-loaded")&&trigPageView&&$fb._state.app.firePageview&1<<$fb._state.app.stepId&&($fb._state.app.firePageview&=~(1<<$fb._state.app.stepId),$fb._triggerEvent("fastbooking-crs-frontend-pageview-"+$fb._state.app.step))}},_triggerEvent:function(t,p,c){return-1===["scroll","resize","fastbooking-crs-frontend-group-zoomorpan","fastbooking-crs-frontend-basket-checksize"].indexOf(t)&&$fb.log("trigger "+t),$.event.trigger({type:t,args:p,callback:c})},_external:function(src,callback,failure){if(!src.match(/^(https?)?\/\//)&&!src.match(/^\/\//)){"/"!=src[0]&&(src="/"+src);var baseUrl=$.fb("crs-utils-configure",{k:"url"});baseUrl||(baseUrl=$fb._state.cdn_url?$fb._state.cdn_url:$fb._state.url),src=baseUrl+src}var version="";switch($.ajaxSetup().cache&&$fb._config.v&&(version=$fb._config.v),!0){case null!==src.match(/\.css$/):version&&(src+="?_="+version),$('<link rel="stylesheet" type="text/css" href="'+src+'" />').appendTo("head"),"function"==typeof callback&&callback();break;case null!==src.match(/\.js$/):version&&(src+="?_="+version),$.getScript(src).done(function(){"function"==typeof callback&&callback()}).fail(function(a,b,err){if(!0===$fb._config.debug){var oScript=document.createElement("script");oScript.type="text/javascript",$(document.body).append(oScript),oScript.src=src}"function"==typeof failure&&failure(err)})}},_checkEvent:function(module,type,event){return event instanceof jQuery.Event?($fb.info(module+"."+type+" called by "+(event.type?event.type:"unknown")),!0):($fb.error("["+module+"]["+type+"] Trying to call module function without triggering event"),!1)},_checkContainer:function(target,empty,rootContainer){$fb.log("Checking container for id "+target,empty);var container=$("#fb-"+target).length?$("#fb-"+target):null;return rootContainer=rootContainer||$fb._state.container,empty=void 0===empty||empty,container||(container=$('<div id="fb-'+target+'" />'),"basket"===target&&$fb.selection.isEmpty()&&container.addClass("fb-basket-empty"),rootContainer.append(container)),empty&&container.empty(),container},_isMobile:function(){return-1!==navigator.userAgent.indexOf("Mobi")&&window.innerWidth<600},_checkNonRomanWarning:function(){var hid=$fb._state.quicksearch.property;hid&&$fb.propertyService.get(hid).then(function(property){var guestLocale=$fb._state.app.locale,propertyLocale=property.locale;guestLocale!==propertyLocale?$.fb("crs-api-call",{data:{c:"nonroman",locale:guestLocale},success:function(data){$fb._state.showNonRomanWarning=data.data.isNonRoman},error:function(){$fb.log("error checking if language is non Roman for selected locale : "+guestLocale)}}):$fb._state.showNonRomanWarning=!1})},_callback:function(event,params){return"function"!=typeof event.callback||event.callback(params)},_registerDefaultHandler:function(module,callback,notFoundCallback){-1<["header","quicksearch","results","extras","basket","recap","datacollect","guarantee","confirmrecap","localize","hoteldetails","roomdetails","cancel","group","footer","paymenttypes"].indexOf(module)?$(document).on("fastbooking-crs-frontend-"+module+"-render",function(event){return $fb._callback(event)}):notFoundCallback(),"function"==typeof callback&&callback()},_getCurrentDate:function(){var d=new Date;if(void 0!==$fb._state.quicksearch.property&&$fb._state.app.data.properties[$fb._state.quicksearch.property].location){var timeZone=$fb._state.app.data.properties[$fb._state.quicksearch.property].location.timezone||"UTC+00:00";if(timeZone&&"UTC"!==timeZone){var delta=60*parseInt(timeZone.substr(3,3))+parseInt(timeZone.substr(3,1)+timeZone.substr(7,2));d.setTime(d.getTime()+60*(d.getTimezoneOffset()+delta)*1e3)}}return d},_formatDateString:function(date){return moment(date).format("YYYY-MM-DD")},_hash:function(text){return new jsSHA(text,"TEXT").getHash("SHA-512","HEX")},_parseDate:function(input){if(input instanceof Date)return new Date(input.getTime());if(void 0===input.match||"function"!=typeof input.match)return new Date;var parts=input.match(/(\d+)/g);if(parts){var d=new Date(parts[0],parts[1]-1,parts[2]);return isNaN(d.getTime())?new Date:d}return new Date},_setAppCurrency:function(currency){$fb.log(">>> setting current currency "+currency),$fb._state.app.currency=currency,void 0!==$.fb&&$.fb("crs-helper-change",{key:"currency",value:currency}),$(document).trigger("fastbooking-crs-frontend-currency-changed"),$fb._updateHistory()},_getArrivalAndDepartureFromUrlParams:function(urlParams,curDate){var limitDateForArrival=moment().add(1,"year").endOf("year").format("YYYY-MM-DD"),limitDateForDeparture=moment(limitDateForArrival).add(1,"day").format("YYYY-MM-DD"),result={arrival:curDate};if(urlParams.arrival){var formattedArrival=$fb._formatDateString($fb._parseDate(urlParams.arrival));curDate<formattedArrival&&(result.arrival=formattedArrival)}if(urlParams.advance){var splittedAdvance=urlParams.advance.split("-"),shiftValue=parseInt(splittedAdvance[0]),shiftType=splittedAdvance[1],arrivalFromAdvance=moment();switch(shiftType){case"days":case"weeks":case"months":arrivalFromAdvance=arrivalFromAdvance.add(shiftValue,shiftType).format("YYYY-MM-DD")}arrivalFromAdvance>result.arrival&&(result.arrival=arrivalFromAdvance)}return result.arrival>limitDateForArrival&&(result.arrival=limitDateForArrival),urlParams.departure?result.departure=$fb._formatDateString($fb._parseDate(urlParams.departure)):urlParams.nbStay&&(result.departure=moment(result.arrival).add(urlParams.nbStay,"day").format("YYYY-MM-DD")),(void 0===result.departure||result.departure<=result.arrival)&&(result.departure=moment(result.arrival).add(1,"day").format("YYYY-MM-DD")),result.departure>limitDateForDeparture&&(result.departure=limitDateForDeparture),result},_buildCurrentUrl:function(){var query={s:$fb._state.app.step};$fb._state.quicksearch.group&&(query.group=$fb._state.quicksearch.group),"group"!==$fb._state.app.step&&(query.property=$fb._state.quicksearch.property),"cancel"!==$fb._state.app.step&&"confirmation"!==$fb._state.app.step&&(query.arrival=$fb._state.quicksearch.arrival,query.departure=$fb._state.quicksearch.departure,$fb._state.quicksearch.rate&&(query.rate=$fb._state.quicksearch.rate),$fb._state.quicksearch.accommodation&&(query.accommodation=$fb._state.quicksearch.accommodation),$fb._state.quicksearch.accesscode&&(query.code=$fb._state.quicksearch.accesscode),$fb._state.quicksearch.occupancy.forEach(function(room,index){var humanIndex=index+1;query["adults"+humanIndex]=room.nbAdults,query["children"+humanIndex]=room.nbChildren,room.childrenAges.some(function(age){return null!==age})&&(query["childrenAges"+humanIndex]=room.childrenAges.join(","))})),$.extend(query,{locale:$fb._state.app.locale,currency:$fb._state.app.currency,stid:$fb._state.app.stid}),$fb._state.app.booking.confirmation&&(query.confirmation=$fb._state.app.booking.confirmation),$fb._state.app.booking.totalRefundable&&(query.totalRefundable=$fb._state.app.booking.totalRefundable),$fb._state.app.booking.hash&&(query.bh=$fb._state.app.booking.hash),$fb._state.display&&(query._display=$fb._state.display),$fb._state.clickId&&(query.clickid=$fb._state.clickId),$fb._state.trackFrom&&(query._fbtl=$fb._state.trackFrom),$fb._config.debug&&$fb._state.test&&(query.test=$fb._state.test),$fb._state.app.booking.email&&(query.email=$fb._state.app.booking.email);var queryString=$.param(query);$fb._.hasFeature("support-any-url-parameters","activate",1)&&$.each($fb._state.unsupportedParameters,function(paramName,paramValue){void 0===query[paramName]&&(queryString+="&"+paramName+"="+paramValue)});var filters=$.fb("fastbooking-crs-frontend-group-consolidated-filters");return filters&&$.each(filters,function(i,o){queryString+="&filters["+i+"]="+o}),"index.php?"+queryString},_storeState:function(){if(void 0!==$fb._state.app.stid){var state={selection:$fb.selection.get(),comment:$fb.selection.getComment(),extras:$fb.selection.getAvailableServices(),nbRooms:$fb._state.quicksearch.occupancy.length};$fb.storage.save($fb._state.app.stid,JSON.stringify(state))}},_loadState:function(){if(void 0!==$fb._state.app.stid){var data=$fb.storage.load($fb._state.app.stid);if(data){var state=JSON.parse(data);$fb.info("Got data from storage:",state);var selection=state.selection;void 0!==selection&&void 0!==selection.packages[0]&&void 0!==selection.packages[0].package[0]&&$fb._state.quicksearch.property==selection.packages[0].package[0].property&&($fb.selection.set(selection),$fb._state.app.lockedRate=selection.packages[0].package[0].rate),void 0!==state.comment&&$fb.selection.setComment(state.comment),void 0!==state.extras&&$fb.selection.setAvailableServices(state.extras),state.nbRooms&&(state.nbRooms>$fb._state.quicksearch.occupancy.length?_.times(state.nbRooms-$fb._state.quicksearch.occupancy.length,function(){$fb._state.quicksearch.occupancy.push({nbAdults:1,nbChildren:0,childrenAges:[]})}):$fb._state.quicksearch.occupancy.length>state.nbRooms&&($fb._state.quicksearch.occupancy=_.first($fb._state.quicksearch.occupancy,state.nbRooms)))}}},_updateHistory:function(){$fb.isStandAlone()&&"function"==typeof history.replaceState&&history.replaceState({},"book secure",$fb._buildCurrentUrl()),$fb._triggerEvent("fastbooking-crs-frontend-history-change")},_addHistory:function(){$fb.isStandAlone()&&"function"==typeof history.pushState&&history.pushState({},"book secure",$fb._buildCurrentUrl()),$fb._triggerEvent("fastbooking-crs-frontend-history-change")},_popHistory:function(event){return $("#fb-hoteldetails").is(":visible")&&!$("#fb-hoteldetails").is(":empty")?($fb.log("hotel details is open, only close it"),event.preventDefault(),$fb._triggerEvent("fastbooking-crs-frontend-ui-hide-modal",{modal:"hoteldetails",modules:$fb._state.app.modules},function(){return $fb._callback(event)}),$fb._addHistory(),!1):$("#fb-localize").is(":visible")&&!$("#fb-localize").is(":empty")?($fb.log("Localization layer is open, only close it"),event.preventDefault(),$fb._triggerEvent("fastbooking-crs-frontend-ui-hide-modal",{modal:"hoteldetails",modules:$fb._state.app.modules},function(){return $fb._callback(event)}),$fb._addHistory(),!1):$("#fb-roomdetails").is(":visible")&&!$("#fb-roomdetails").is(":empty")?($fb.log("room details is open, only close it"),event.preventDefault(),$fb._triggerEvent("fastbooking-crs-frontend-ui-hide-modal",{modal:"roomdetails",modules:$fb._state.app.modules},function(){return $fb._callback(event)}),$fb._addHistory(),!1):$("#fb-confirmbutton_terms").is(":visible")&&!$("#fb-confirmbutton_terms").is(":empty")?($fb.log("terms is open, only close it"),event.preventDefault(),$fb._triggerEvent("fastbooking-crs-frontend-ui-hide-modal",{modal:"confirmbutton_terms",modules:$fb._state.app.modules},function(){return $fb._callback(event)}),$fb._addHistory(),!1):$("#fb-confirmbutton_privacy").is(":visible")&&!$("#fb-confirmbutton_privacy").is(":empty")?($fb.log("privacy policy is open, only close it"),event.preventDefault(),$fb._triggerEvent("fastbooking-crs-frontend-ui-hide-modal",{modal:"confirmbutton_privacy",modules:$fb._state.app.modules},function(){return $fb._callback(event)}),$fb._addHistory(),!1):$("#fb-cancel_modal").is(":visible")&&!$("#fb-cancel_modal").is(":empty")?($fb.log("cancel modal is open, only close it"),event.preventDefault(),$fb._triggerEvent("fastbooking-crs-frontend-ui-hide-modal",{modal:"cancel_modal",modules:$fb._state.app.modules},function(){return $fb._callback(event)}),$fb._addHistory(),!1):"group"===$fb.getUrlArgs().s&&"group"!==$fb._state.app.step?void window.location.reload():($fb._updateAppStateFromUrl().then(function(){$fb._triggerEvent("fastbooking-crs-frontend-renderAll")}),$fb._callback(event))},removePromoCodeFromAllState:function(){$fb.quicksearch.removePromoCode(),delete $fb._state.app.data.quotation.query.accessCode,delete $fb._state.quicksearch.accesscode,$fb._updateHistory()},getCurrentDayDate:function(){return"group"===$fb._state.app.step?Promise.resolve(moment().format("YYYY-MM-DD")):$fb.propertyService.get($fb._state.quicksearch.property).then(function(property){return($fb.propertyService.getLocalDateTime(property)||moment()).format("YYYY-MM-DD")})},_parseCurrentUrl:function(){var urlParams=$fb.getUrlArgs(),occupancyObjFromUrl=$fb.urlToOccupancy.getOccupancyFromUrl(urlParams),filters=_.chain(urlParams).pick(function(value,key){return 0===key.indexOf("filters[")}).reduce(function(filters,value,key){return filters[key.match(/^(?:[^[]+)\[([^\]]+)\]$/)[1]]=value,filters},{}).value(),handledKeys=["op","bh","_fbtl","confirmation","totalRefundable","_display","from","currency","s","property","group","locale","arrival","departure","advance","nbstay","nbStay","accommodation","rate","offers-top","code","stid","test","status","clickid","email"].concat(occupancyObjFromUrl.usedKeys).concat(Object.keys(filters)),unhandled=_.difference(Object.keys(urlParams),handledKeys).reduce(function(unhandled,key){return unhandled[key]=urlParams[key],unhandled},{}),offersTop=null;return void 0!==urlParams["offers-top"]&&(offersTop=-1===["","0","false",null].indexOf(urlParams["offers-top"])),{occupancy:occupancyObjFromUrl.occupancy,currency:urlParams.currency&&urlParams.currency.toUpperCase(),locale:urlParams.locale,step:urlParams.s,property:urlParams.property,group:urlParams.group,arrival:urlParams.arrival,departure:urlParams.departure,advance:urlParams.advance,nbStay:urlParams.nbstay||urlParams.nbStay,accommodation:urlParams.accommodation,rate:urlParams.rate,_display:urlParams._display,from:urlParams.from,totalRefundable:urlParams.totalRefundable,confirmation:urlParams.confirmation,_fbtl:urlParams._fbtl,bh:urlParams.bh,op:!!urlParams.op,offersTop:offersTop,filters:filters,unhandled:unhandled,accesscode:urlParams.code,stid:urlParams.stid,test:urlParams.test,status:urlParams.status,clickid:urlParams.clickid,email:urlParams.email}},_updateAppStateFromUrl:function(parsedUrl){return parsedUrl=parsedUrl||this._parseCurrentUrl(),$fb._state.quicksearch.occupancy=parsedUrl.occupancy,$fb._state.app.step=parsedUrl.step,$fb._state.quicksearch.property=parsedUrl.property,$fb._state.p.filters=parsedUrl.filters,$fb._state.quicksearch.group=parsedUrl.group,$fb._state.app.mode=parsedUrl.group?"group":"single",$fb._state.app.locale=parsedUrl.locale||$fb._state.app.locale,$fb._state.quicksearch.accommodation=parsedUrl.accommodation,$fb._state.quicksearch.rate=parsedUrl.rate,$fb._state.initialPutCampaignRatesTopOfRoom=parsedUrl.offersTop,!$fb._state.app.booking&&(parsedUrl.confirmation||parsedUrl.totalRefundable||parsedUrl.op||parsedUrl.bh||parsedUrl.status)&&($fb._state.app.booking={}),$fb._state.app.booking.confirmation=parsedUrl.confirmation,$fb._state.app.booking.email=parsedUrl.email,$fb._state.app.booking.totalRefundable=parsedUrl.totalRefundable,$fb._state.app.booking.hash=parsedUrl.bh,$fb._state.app.booking.onlinePayment=parsedUrl.op,$fb._state.quicksearch.accesscode=parsedUrl.accesscode,$fb._state.app.stid=parsedUrl.stid,$fb._state.test=parsedUrl.test,$fb._state.app.booking.paymentStatus=parsedUrl.status,$fb._state.trackFrom=parsedUrl.from||parsedUrl._fbtl,$fb._state.quicksearch.from=parsedUrl.from,$fb._state.quicksearch._fbtl=parsedUrl._fbtl,parsedUrl._display&&($fb._state.display=parsedUrl._display),parsedUrl.clickid&&($fb._state.clickId=parsedUrl.clickid),Object.assign($fb._state.unsupportedParameters,parsedUrl.unhandled),$fb.log("_updateAppStateFromUrl Most parameters updated in state from url"),Promise.all([$fb.getCurrentDayDate(),$fb.getCurrencies()]).then(function(result){$fb.log("_updateAppStateFromUrl Current date and currencies fetched for arrival and departure update");var curDate=result[0],currencies=result[1],arrivalAndDeparture=$fb._getArrivalAndDepartureFromUrlParams(parsedUrl,curDate);if($fb._state.quicksearch.arrival=arrivalAndDeparture.arrival,$fb._state.quicksearch.departure=arrivalAndDeparture.departure,!currencies[parsedUrl.currency])return"group"===$fb._state.app.step?$fb._defineCurrencyFromGroup($fb._state.quicksearch.group,currencies):$fb._defineCurrencyFromProperty($fb._state.quicksearch.property,currencies);$fb._state.app.currency=parsedUrl.currency}).then(function(){$fb.log("_updateAppStateFromUrl All parameters are set in state from url. Updating the currency in all the application"),$.fb("crs-helper-change",{key:"currency",value:$fb._state.app.currency}),$(document).trigger("fastbooking-crs-frontend-currency-changed"),$.fb("crs-helper-change",{key:"locale",value:$fb._state.app.locale})})},_defineCurrencyFromProperty:function(property,currencies){return $fb.propertyService.get(property).then(function(property){currencies[property.configuration.currency]?$fb._state.app.currency=property.configuration.currency:$fb._state.app.currency="EUR"})},_defineCurrencyFromGroup:function(group,currencies){return new Promise(function(resolve){if($fb._state.app.data.groups[group])return resolve($fb._state.app.data.groups[group]);$(document).one("fastbooking-crs-frontend-load-group-done",function(){resolve($fb._state.app.data.groups[group])}),$fb._triggerEvent("fastbooking-crs-frontend-load-group")}).then(function(group){currencies[group.parameters.CL_PRES_DEF_CURRENCY]?$fb._state.app.currency=group.parameters.CL_PRES_DEF_CURRENCY:$fb._state.app.currency="EUR"})},getCurrencies:function(){return $fb._state.app.data.currencies?Promise.resolve($fb._state.app.data.currencies):Promise.reject("Currencies not loaded")},findBestPriceInQuotationPackages:function(quotationPackages){if(_.isEmpty(quotationPackages))return null;var simplifiedPackages=$fb._getPackagesTotalPriceAndOfferType(quotationPackages),bestPricePackage=_.chain(simplifiedPackages).sortBy(function(pack){return pack.totalPrice}).first().value();return{price:$.fb("crs-helper-price",{price:bestPricePackage.totalPrice,getOnlyFloatValue:!0}),offerType:bestPricePackage.offerType,onlyPackagesInResults:_.every(simplifiedPackages,function(pack){return"Package"===pack.offerType}),currency:$fb._state.app.currency}},_getPackagesTotalPriceAndOfferType:function(quotationPackages){return _.map(quotationPackages,function(package){return{totalPrice:_.reduce(package,function(packagePrice,packContent){return packagePrice+(packContent.campaignId?packContent.pricesDiscounted.gross:packContent.prices.gross)},0),offerType:$fb._getOfferType(package)}})},_getOfferType:function(package){if(_.findWhere(package,{type:"service"}))return"Package";var mealPlanPackage=_.findWhere(package,{type:"meal"});if(!mealPlanPackage)return"RoomOnly";switch(mealPlanPackage.mealType){case"Breakfast":return"BreakfastIncluded";case"Half Board":return"HalfBoardIncluded";case"Full Board":return"FullBoardIncluded";case"Dinner":return"DinnerIncluded";case"All Inclusive":return"AllInclusive"}},get:function(parameter){switch(parameter){case"group-properties":var groupHids=null;return $fb._state.quicksearch.group&&(groupHids=$fb._state.app.data.groups&&$fb._state.app.data.groups[$fb._state.quicksearch.group]&&$fb._state.app.data.groups[$fb._state.quicksearch.group].properties?Object.keys($fb._state.app.data.groups[$fb._state.quicksearch.group].properties):[]),groupHids;case"group":return $fb._state.quicksearch.group||null;case"property":return $fb._state.quicksearch.property||null}return null},loader:{_state:{},currentEventId:"",genericLoad:function(event){var eventName=event.type.split("-").pop(),eventId=Math.random().toString(36).substr(2,9);if($fb.loader._state[eventId]={},$fb.log("load generic genericLoad",eventName),$fb.log("Loading "+eventName+" ("+eventId+")"),void 0===$fb.loader.configurations[eventName])return $fb.error("["+eventId+"] Unknown loading event"+eventName),delete $fb.loader._state[eventId],$fb._callback(event);var config=$fb.loader.configurations[eventName],id=eventName;if(void 0!==config.init&&"function"==typeof config.init&&!1===(id=config.init(eventId,event.args)))return delete $fb.loader._state[eventId],$fb._callback(event);$fb.loader._state[eventId].id=id;var doneEvent=$fb.loader._state[eventId].doneEvent||config.doneEvent,failEvent=$fb.loader._state[eventId].failEvent||config.failEvent||null;if(void 0!==config.preload&&"function"==typeof config.preload&&!1===config.preload(eventId))return delete $fb._state.app.loading[eventName],delete $fb.loader._state[eventId],$fb._callback(event);var checkLoad=function(eventId){return $fb._state.app.loading[eventName]&&id==$fb._state.app.loading[eventName]?($fb.warn("["+eventId+"] load-"+eventName+" already in progress..."),!1):($fb._state.app.loading[eventName]=id,!0)};void 0!==config.checkload&&"function"==typeof config.checkload&&(checkLoad=config.checkload);var notAlreadyRunning=!0;if(!1===!(!event.args||!event.args.forceCall)&&(notAlreadyRunning=checkLoad(eventId)),!1===notAlreadyRunning)return delete $fb.loader._state[eventId],$fb._callback(event);var cacheLoad=function(){return!$fb._state.app.data[config.dataKey]||!$fb._state.app.data[config.dataKey][id]};return void 0!==config.cacheload&&"function"==typeof config.cacheload&&(cacheLoad=config.cacheload),!1===cacheLoad(eventId)?($fb._triggerEvent(doneEvent,$fb.loader._state[eventId].doneParams||{}),delete $fb._state.app.loading[eventName],delete $fb.loader._state[eventId]):($fb.log("["+eventId+"] api call",$fb.loader._state[eventId].apiCall),$fb.loader.currentEventId=eventId,$fb._state._api=$fb._state._api||{},$fb._state._api[eventId]={apiCall:$fb.loader._state[eventId].apiCall},$fb._state.app.loading[eventName]=$fb.loader._state[eventId].apiCall,$fb._state._api[eventId].call=$fb._api($fb.loader._state[eventId].apiCall,function(json){if(delete $fb._state._api[eventId],json.status){if("success"==json.status)return void 0!==config.postload&&"function"==typeof config.postload&&config.postload(eventId,json.data),$fb.log("["+eventId+"] "+eventName+" data retrieved, triggering "+doneEvent),$fb._triggerEvent(doneEvent,$fb.loader._state[eventId].doneParams||{}),delete $fb._state.app.loading[eventName],delete $fb.loader._state[eventId],$fb.loader.currentEventId="",$fb._callback(event);if($fb.loader.currentEventId==eventId)return $fb._triggerEvent("fastbooking-crs-frontend-message",{type:"failure",title:"Service unavailable",message:"distant API failure for load "+eventName+":<br>"+json.message}),failEvent&&$fb._triggerEvent(failEvent,$fb.loader._state[eventId]||{}),delete $fb._state.app.loading[eventName],delete $fb.loader._state[eventId],$fb.loader.currentEventId="",$fb._callback(event)}else if($fb.loader.currentEventId==eventId)return $fb._triggerEvent("fastbooking-crs-frontend-message",{type:"failure",title:"Service unavailable",message:"distant API failure for load "+eventName+":<br>"+json.message}),failEvent&&$fb._triggerEvent(failEvent,$fb.loader._state[eventId]||{}),delete $fb._state.app.loading[eventName],delete $fb.loader._state[eventId],$fb.loader.currentEventId="",$fb._callback(event)})),$fb._callback(event)},configurations:{property:{dataKey:"properties",doneEvent:"fastbooking-crs-frontend-load-property-done",init:function(eventId,args){var property=$fb._state.quicksearch.property;return args&&args.property&&(property=args.property),void 0===property?($fb.log("No property selected for loadProperty, give up",args),!1):property},preload:function(eventId){return $fb.loader._state[eventId].doneParams={property:$fb.loader._state[eventId].id},$fb.loader._state[eventId].apiCall={c:"property",property:$fb.loader._state[eventId].id},$fb.log("Property generic load:"+$fb.loader._state[eventId].id),!0},cacheload:function(eventId){var property=$fb.loader._state[eventId].id;return $fb._state.app.data.properties&&$fb._state.app.data.properties[property]?($fb._triggerEvent($fb.loader.configurations.property.doneEvent),!1):!window["_property_"+property]||($fb._state.app.data.properties[property]=window["_property_"+property],$fb.loader._loadQuicksearchConfigurationFromProperty($fb._state.app.data.properties[property]),$fb._triggerEvent($fb.loader.configurations.property.doneEvent),!1)},postload:function(eventId,data){$fb._state.app.data.properties[data.property]=data,$fb.loader._loadQuicksearchConfigurationFromProperty(data)}},group:{dataKey:"groups",doneEvent:"fastbooking-crs-frontend-load-group-done",init:function(eventId,args){var group=$fb._state.quicksearch.group;return args&&args.group&&(group=args.group),void 0===group?($fb.log("No property selected for loadGroup, give up",args),!1):group},preload:function(eventId){return $fb.loader._state[eventId].apiCall={c:"group",group:$fb.loader._state[eventId].id},!0},cacheload:function(){var group=$fb._state.quicksearch.group;return(!$fb._state.app.data.groups||!$fb._state.app.data.groups[group])&&(!window["_group_"+group]||($fb._state.app.data.groups[group]=window["_group_"+group],$fb.loader._loadQuicksearchConfigurationFromGroup($fb._state.app.data.groups[group]),!1))},postload:function(eventId,data){$fb._state.app.data.groups[$fb.loader._state[eventId].id]=data,$fb.loader._loadQuicksearchConfigurationFromGroup(data)}},accommodations:{dataKey:"accommodations",doneEvent:"fastbooking-crs-frontend-load-accommodations-done",init:function(eventId,args){var property=$fb._state.quicksearch.property;return args&&args.property&&(property=args.property),void 0===property?($fb.log("No property selected for loadProperty, give up",args),!1):property},preload:function(eventId){return $fb.loader._state[eventId].apiCall={c:"accommodations",property:$fb.loader._state[eventId].id},!0},cacheload:function(){var property=$fb._state.quicksearch.property;return(!$fb._state.app.data.accommodations||!$fb._state.app.data.accommodations[property])&&(!window["_accommodations_"+property]||($fb._state.app.data.accommodations[property]||($fb._state.app.data.accommodations[property]={}),$.each(window["_accommodations_"+property],function(id,acc){$fb._state.app.data.accommodations[property][acc.name]=acc}),!1))},postload:function(eventId,data){void 0===$fb._state.app.data.accommodations&&($fb._state.app.data.accommodations={}),$fb._state.app.data.accommodations[$fb._state.quicksearch.property]={},$.each(data,function(id,acc){$fb._state.app.data.accommodations[$fb._state.quicksearch.property][acc.name]=acc})}},rates:{dataKey:"rates",doneEvent:"fastbooking-crs-frontend-load-rates-done",init:function(eventId,args){var property=$fb._state.quicksearch.property;return args&&args.property&&(property=args.property),void 0===property?($fb.log("No property selected for loadProperty, give up",args),!1):property},preload:function(eventId){return $fb.loader._state[eventId].apiCall={c:"rates",property:$fb.loader._state[eventId].id},!0},cacheload:function(){var property=$fb._state.quicksearch.property;return(!$fb._state.app.data.rates||!$fb._state.app.data.rates[property])&&(!window["_rates_"+property]||($fb._state.app.data.rates[property]={},$.each(window["_rates_"+property],function(id,rate){$fb._state.app.data.rates[$fb._state.quicksearch.property][rate.name]=rate}),!1))},postload:function(eventId,data){void 0===$fb._state.app.data.rates&&($fb._state.app.data.rates={}),$fb._state.app.data.rates[$fb._state.quicksearch.property]={},$.each(data,function(id,rate){$fb._state.app.data.rates[$fb._state.quicksearch.property][rate.name]=rate})}},services:{dataKey:"services",doneEvent:"fastbooking-crs-frontend-load-services-done",init:function(eventId,args){var property=$fb._state.quicksearch.property;return args&&args.property&&(property=args.property),void 0===property?($fb.log("No property selected for loadProperty, give up",args),!1):property},preload:function(eventId){return $fb.loader._state[eventId].apiCall={c:"services",property:$fb.loader._state[eventId].id},!0},cacheload:function(){var property=$fb._state.quicksearch.property;return(!$fb._state.app.data.services||!$fb._state.app.data.services[property])&&(!window["_services_"+property]||($fb._state.app.data.services[property]={},$.each(window["_services_"+property],function(id,service){var serv;serv=service,$fb._state.app.data.services[property][serv.name]=serv}),!1))},postload:function(eventId,data){void 0===$fb._state.app.data.services&&($fb._state.app.data.services={}),$fb._state.app.data.services[$fb._state.quicksearch.property]={},void 0!==data&&$.each(data,function(id,service){var serv;serv=service,$fb._state.app.data.services[$fb._state.quicksearch.property][serv.name]=serv})}},countries:{dataKey:"countries",doneEvent:"fastbooking-crs-frontend-load-countries-done",init:function(eventId,args){return args&&args.locale?args.locale:$fb._state.app.locale},preload:function(eventId){return $fb.loader._state[eventId].apiCall={c:"list",list:"countries",locale:$fb.loader._state[eventId].id},!0},cacheload:function(eventId){var locale=$fb.loader._state[eventId].apiCall.locale;return window["_countries_"+locale]&&($fb._state.app.data.countries[locale]=window["_countries_"+locale],delete window["_countries_"+locale]),!$fb._state.app.data.countries[locale]},postload:function(eventId,data){void 0===$fb._state.app.data.countries&&($fb._state.app.data.countries={}),$fb._state.app.data.countries[$fb.loader._state[eventId].apiCall.locale]=data.countries}},languages:{dataKey:"languages",doneEvent:"fastbooking-crs-frontend-load-languages-done",init:function(){return $fb._state.app.locale},preload:function(eventId){return $fb.loader._state[eventId].apiCall={c:"list",list:"languages",locale:$fb.loader._state[eventId].id},!0},cacheload:function(eventId){var locale=$fb.loader._state[eventId].apiCall.locale;return!$fb._state.app.data.languages[locale]&&(!window["_languages_"+locale]||($fb._state.app.data.languages[locale]=window["_languages_"+locale],!1))},postload:function(eventId,data){$fb._state.app.data.languages[$fb._state.app.locale]=data.languages}},phones:{dataKey:"phones",doneEvent:"fastbooking-crs-frontend-load-phones-done",init:function(){return"phones"},preload:function(eventId){return $fb.loader._state[eventId].apiCall={c:"list",list:"phonecodes"},!0},cacheload:function(){return window._phonecodes&&($fb._state.app.data.phones=window._phonecodes,delete window._phonecodes),!$fb._state.app.data.phones},postload:function(eventId,data){$fb._state.app.data.phones=data.phonecodes}},booking:{dataKey:"bookings",doneEvent:"fastbooking-crs-frontend-load-booking-done",init:function(){return $fb._state.app.booking.confirmation},preload:function(eventId){return $fb.loader._state[eventId].apiCall={c:"bookings",property:$fb._state.quicksearch.property,confirmation:$fb.loader._state[eventId].id,bh:$fb._state.app.booking.hash},!0},postload:function(eventId,data){void 0===$fb._state.app.data.bookings&&($fb._state.app.data.bookings={}),$fb._state.app.data.bookings[$fb.loader._state[eventId].id]=data}},quotation:{dataKey:"quotation",doneEvent:"fastbooking-crs-frontend-load-quotation-done",failEvent:"fastbooking-crs-frontend-load-quotation-fail",byPassCache:!0,init:function(eventId,args){return $fb.loader._state.quotationAlreadyFired=!0,args&&args.bestRate&&1==args.bestRate&&($fb.loader._state[eventId].doneEvent="fastbooking-crs-frontend-load-bestquotation-done",$fb.loader._state[eventId].failEvent="fastbooking-crs-frontend-load-bestquotation-fail",$fb.loader._state[eventId].bestRate=!0),$fb.log("load genericload quotation",$fb.loader._state[eventId]),args&&args.property&&($fb.loader._state[eventId].property=args.property,$fb.loader._state[eventId].doneParams={property:args.property}),"quotation"},preload:function(eventId){if($fb.occupancySelectionValidator.validate($fb._state.quicksearch.occupancy,$fb._state.quicksearch.configuration).hasError){var query=$fb.loader._state[eventId].apiCall;return setTimeout(function(){$fb._state.app.data.quotation={ts:(new Date).getTime(),query:query,packages:[],services:[],terms:[]},$(document).trigger("fastbooking-crs-frontend-load-quotation-done")},0),!1}var property,group,roomIndex=$fb.selection.nbRooms();roomIndex>=$fb._config.maxPackages&&(roomIndex=$fb._config.maxPackages-1),property=$fb.loader._state[eventId].property||$fb._state.quicksearch.property,group=$fb.loader._state[eventId].group||$fb._state.quicksearch.group,$fb._state.app.data.groups[group]&&($fb._state.app.data.mcm.enabled=$fb._state.app.data.groups[group].properties[property]&&$fb._state.app.data.groups[group].properties[property].configuration.useMcm),function(){var property=$fb.loader._state[eventId].property||$fb._state.quicksearch.property,group=$fb.loader._state[eventId].group||$fb._state.quicksearch.group;$fb._state.app.data.groups[group]&&$fb._state.app.data.groups[group].properties[property]&&($fb._state.app.data.onlyLatinChars=$fb._state.app.data.groups[group].properties[property].configuration.onlyLatinChars)}();var mcmEnable=$fb._state.app.data.mcm.enabled,currentLoyalty=$fb.loyalties&&$fb.loyalties.getCurrentLoyalty(),context={totalNbRoomsWanted:$fb._state.quicksearch.occupancy.length,relevantDataFromSelectedPackages:$fb.selection.getRelevantDataFromSelectedPackages()};context.totalNbRoomsWanted<=context.relevantDataFromSelectedPackages.length&&($fb.warn("context.totalNbRoomsWanted <= context.relevantDataFromSelectedPackages.length"),context.totalNbRoomsWanted=context.relevantDataFromSelectedPackages.length+1);var currentOccupancy=$fb._state.quicksearch.occupancy[roomIndex];return currentOccupancy||(currentOccupancy={nbAdults:1,nbChildren:0,childrenAges:[]}),$fb.loader._state[eventId].apiCall={c:"quotation",property:$fb.loader._state[eventId].property||$fb._state.quicksearch.property,arrival:$fb._state.quicksearch.arrival,departure:$fb._state.quicksearch.departure,adults:currentOccupancy.nbAdults,children:currentOccupancy.nbChildren,currency:$fb._config.quotationCurrency,bestRate:$fb.loader._state[eventId].bestRate||!1,mcmEnable:mcmEnable,isMobile:$fb._state.isMobile,loyaltyEnable:currentLoyalty&&currentLoyalty.isLogged()?currentLoyalty.getCode():void 0,loyaltyParams:currentLoyalty&&currentLoyalty.isLogged()?currentLoyalty.getQuotationParams():void 0,loyaltyToken:currentLoyalty&&currentLoyalty.isLogged()?currentLoyalty.getLoyaltyToken():void 0,loyaltyTeasing:!0,context:context},$fb._state.quicksearch.configuration.needChildrenAges&&($fb.loader._state[eventId].apiCall.childrenAges=currentOccupancy.childrenAges.join(",")),$fb._state.quicksearch.accesscode&&($fb.loader._state[eventId].apiCall.accessCode=$fb._state.quicksearch.accesscode),0===context.relevantDataFromSelectedPackages.length&&void 0!==$fb._state.quicksearch.rate&&null!==$fb._state.quicksearch.rate&&($fb.loader._state[eventId].apiCall.rate=$fb._state.quicksearch.rate),!0},checkload:function(eventId){var _signature=$fb._querySignature($fb.loader._state[eventId].apiCall);return $fb._state.app.loading.quotation&&_signature==$fb._querySignature($fb._state.app.loading.quotation)?($fb.warn("["+eventId+"] loadQuotation already in progress..."),!1):(void 0===$fb._state.app.data.quotations&&($fb._state.app.data.quotations={}),$fb._state.app.data.quotations[_signature]=null,$fb._state.app.booking={},$fb._state.app.data.alterquotation={},$fb._state.app.loading.quotation=$fb.loader._state[eventId].apiCall,$fb._state.app.loading.signature=_signature,!0)},cacheload:function(){return!0},postload:function(eventId,data){null!=typeof data.data&&$.each(data.data.packages,function(index){data.data.packages[index][0].terms=data.data.terms[index]}),$fb.loader._state[eventId].doneParams=$.extend($fb.loader._state[eventId].doneParams,data),$fb._state.app.data.quotation.ts=(new Date).getTime(),$fb._state.app.data.quotation.query=$fb.loader._state[eventId].apiCall,$fb._state.app.data.quotation.packages={},$fb._state.app.data.quotation.services={},$fb._state.app.data.quotation.terms={},$fb.loader._state[eventId].bestRate||($fb._state.app.data.quotation=$.extend(!0,$fb._state.app.data.quotation,data.data)),$fb._triggerEvent("fastbooking-crs-frontend-load-campaigns")}},campaigns:{dataKey:"campaigns",doneEvent:"fastbooking-crs-frontend-load-campaigns-done",init:function(){var campaignIds=[],packages=[];if(void 0===$fb._state.app.data.campaigns&&($fb._state.app.data.campaigns={}),$fb._state.app.data.quotation&&$fb._state.app.data.quotation.packages)packages=$fb._state.app.data.quotation.packages;else if($fb.selection.isEmpty()){if($fb._state.app.booking&&$fb._state.app.booking.confirmation&&$fb._state.app.data.bookings&&$fb._state.app.data.bookings[$fb._state.app.booking.confirmation]){var package=$fb._state.app.data.bookings[$fb._state.app.booking.confirmation].details.packages[0];package.property=$fb._state.app.data.bookings[$fb._state.app.booking.confirmation].property,packages=[[package]]}}else packages=[[$fb.selection.get().packages[0].package[0]]];return $.each(packages,function(index,package){0<package.length&&package[0].campaignId&&campaignIds.indexOf(package[0].campaignId)<0&&!$fb._state.app.data.campaigns[package[0].campaignId]&&campaignIds.push(package[0].campaignId),0<package.length&&package[0].campaignIdForMultiRoomLink&&campaignIds.indexOf(package[0].campaignIdForMultiRoomLink)<0&&!$fb._state.app.data.campaigns[package[0].campaignIdForMultiRoomLink]&&campaignIds.push(package[0].campaignIdForMultiRoomLink)}),campaignIds},preload:function(eventId){if(!$fb.loader._state[eventId].id.length)return!1;$fb.loader._state[eventId].apiCall={c:"campaigns",campaigns:$fb.loader._state[eventId].id,hid:$fb._state.quicksearch.property}},postload:function(eventId,campaigns){var translations=$.fb("crs-locale-configure",{k:"translations"}),locale=$.fb("crs-utils-configure",{k:"locale"});$.each(campaigns,function(index,campaign){$fb._state.app.data.campaigns[campaign.id]=campaign,$.isEmptyObject(campaign.commercialInfos)||$.each(campaign.commercialInfos,function(code){translations[code]||(translations[code]={}),translations[code]["campaign-"+campaign.id]=campaign.commercialInfos[code].name,translations[code]["campaignDesc-"+campaign.id]=campaign.commercialInfos[code].description}),translations.en_GB["campaign-"+campaign.id]||(translations.en_GB["campaign-"+campaign.id]=campaign.commercialName),translations.en_GB["campaignDesc-"+campaign.id]||(translations.en_GB["campaignDesc-"+campaign.id]=campaign.commercialDescription),$('.fb-translate[data-key="campaign-'+campaign.id+'"]').text(translations[locale]["campaign-"+campaign.id]||campaign.commercialName),$('.fb-translate[data-key="campaignDesc-'+campaign.id+'"]').html($.fb("crs-helper-translate",{key:"campaignDesc-"+campaign.id,fallback:"",disableHTMLClean:!0}).html())})}},nor1estandby:{dataKey:"nor1estandby",doneEvent:"fastbooking-crs-frontend-load-nor1estandby-done",init:function(){return"nor1estandby"},preload:function(eventId){return $fb._state.app.booking.confirmation&&$fb._state.app.data.bookings[$fb._state.app.booking.confirmation]&&($fb.loader._state[eventId].apiCall={c:"norlestandby",bookings:$fb._state.app.data.bookings[$fb._state.app.booking.confirmation],nor1estandby:$fb.loader._state[eventId].id}),!0},postload:function(eventId,data){$fb._state.app.data.nor1Estandby.tags=data.tags}},alterquotation:{dataKey:"alterquotation",doneEvent:"fastbooking-crs-frontend-load-alterquotation-done",byPassCache:!0,init:function(){return"alterquotation"},preload:function(eventId){var mcmEnable=$fb._state.app.data.mcm&&$fb._state.app.data.mcm.enabled,currentLoyalty=$fb.loyalties&&$fb.loyalties.getCurrentLoyalty();return $fb.loader._state[eventId].apiCall={c:"quotation",property:$fb._state.quicksearch.property,arrival:$fb._state.quicksearch.arrival,departure:$fb._state.quicksearch.departure,adults:1,children:0,currency:$fb._config.quotationCurrency,mcmEnable:mcmEnable,isMobile:$fb._state.isMobile,loyaltyEnable:currentLoyalty&&currentLoyalty.isLogged()?currentLoyalty.getCode():void 0,loyaltyParams:currentLoyalty&&currentLoyalty.isLogged()?currentLoyalty.getQuotationParams():void 0,loyaltyToken:currentLoyalty&&currentLoyalty.isLogged()?currentLoyalty.getLoyaltyToken():void 0},void 0!==$fb._state.app.lockedRate&&null!==$fb._state.app.lockedRate&&($fb.loader._state[eventId].apiCall.rate=$fb._state.app.lockedRate),!0},checkload:function(eventId){return $fb._state.app.loading.alterquotation?$fb.info("["+eventId+"] New query : ",JSON.stringify($fb.loader._state[eventId].apiCall),"Comparing to: ",JSON.stringify($fb._state.app.loading.quotation)):$fb.info("["+eventId+"] Query : ",JSON.stringify($fb.loader._state[eventId].apiCall)),$fb._state.app.loading.alterquotation&&JSON.stringify($fb.loader._state[eventId].apiCall)==JSON.stringify($fb._state.app.loading.alterquotation)?($fb.warn("["+eventId+"] loadQuotation already in progress..."),!1):($fb._state.app.loading.alterquotation=$fb.loader._state[eventId].apiCall,!0)},cacheload:function(){return!0},postload:function(eventId,data){null!=typeof data.data&&$.each(data.data.packages,function(index){data.data.packages[index][0].terms=data.data.terms[index]}),$fb._state.app.data.alterquotation.ts=(new Date).getTime(),$fb._state.app.data.alterquotation.query=$fb.loader._state[eventId].apiCall,$fb._state.app.data.alterquotation.packages={},$fb._state.app.data.alterquotation.services={},$fb._state.app.data.alterquotation=$.extend(!0,$fb._state.app.data.alterquotation,data.data)}},salesterms:{dataKey:"salesterms",doneEvent:"fastbooking-crs-frontend-load-salesterms-done",init:function(eventId,args){return!("object"!=typeof args||!args.terms)&&($fb.loader._state[eventId].terms=args.terms,"salesterms")},preload:function(eventId){return $fb.loader._state[eventId].apiCall={c:"salesterms",property:$fb._state.quicksearch.property,terms:$fb.loader._state[eventId].terms,locale:$fb._state.app.locale},!0},cacheload:function(eventId){var terms=$fb.loader._state[eventId].terms;return!($fb._state.app.data.salesterms[$fb._state.quicksearch.property]&&$fb._state.app.data.salesterms[$fb._state.quicksearch.property][terms]&&$fb._state.app.data.salesterms[$fb._state.quicksearch.property][terms][$fb._state.app.locale])||($fb.log("Salesterms data is there for current property and rate, no more query"),!1)},postload:function(eventId,data){void 0===$fb._state.app.data.salesterms[$fb._state.quicksearch.property]&&($fb._state.app.data.salesterms[$fb._state.quicksearch.property]={});var terms=$fb.loader._state[eventId].terms;void 0===$fb._state.app.data.salesterms[$fb._state.quicksearch.property][terms]&&($fb._state.app.data.salesterms[$fb._state.quicksearch.property][terms]={}),$fb._state.app.data.salesterms[$fb._state.quicksearch.property][terms][$fb._state.app.locale]=data}}},loadAccommodations:function(event){$fb._triggerEvent("fastbooking-crs-frontend-load-accommodations",{},function(){return $fb._callback(event)})},loadRates:function(event){$fb._triggerEvent("fastbooking-crs-frontend-load-rates",{},function(){return $fb._callback(event)})},loadServices:function(event){$fb._triggerEvent("fastbooking-crs-frontend-load-services",{},function(){return $fb._callback(event)})},_loadQuicksearchConfigurationFromProperty:function(property){var qsState=$fb._state.quicksearch;qsState.configuration={needChildrenAges:!1,childrenMaxAge:12,maxAdults:100,maxChildren:100,maxPersons:100},property.configuration&&(property.configuration.childrenCategories&&!_.isEmpty(property.configuration.childrenCategories)&&(qsState.configuration.needChildrenAges=!0),property.configuration.childrenMaxAge&&(qsState.configuration.childrenMaxAge=property.configuration.childrenMaxAge),property.configuration.maxAdults&&(qsState.configuration.maxAdults=property.configuration.maxAdults),void 0!==property.configuration.maxChildren&&(qsState.configuration.maxChildren=property.configuration.maxChildren),property.configuration.maxPersons&&(qsState.configuration.maxPersons=property.configuration.maxPersons))},_loadQuicksearchConfigurationFromGroup:function(data){"group"===$fb._state.app.step&&($fb._state.quicksearch.configuration={needChildrenAges:!1,childrenMaxAge:-1,maxAdults:-1,maxChildren:-1,maxPersons:-1},data.properties&&!$.isEmptyObject(data.properties)&&$.each(data.properties,function(id,property){property.configuration&&(property.configuration.childrenCategories&&!_.isEmpty(property.configuration.childrenCategories)&&($fb._state.quicksearch.configuration.needChildrenAges=!0),property.configuration.childrenMaxAge&&property.configuration.childrenMaxAge>$fb._state.quicksearch.configuration.childrenMaxAge&&($fb._state.quicksearch.configuration.childrenMaxAge=property.configuration.childrenMaxAge),property.configuration.maxAdults&&property.configuration.maxAdults>$fb._state.quicksearch.configuration.maxAdults&&($fb._state.quicksearch.configuration.maxAdults=property.configuration.maxAdults),void 0!==property.configuration.maxChildren&&property.configuration.maxChildren>$fb._state.quicksearch.configuration.maxChildren&&($fb._state.quicksearch.configuration.maxChildren=property.configuration.maxChildren),property.configuration.maxPersons&&property.configuration.maxPersons>$fb._state.quicksearch.configuration.maxPersons&&($fb._state.quicksearch.configuration.maxPersons=property.configuration.maxPersons))}),-1===$fb._state.quicksearch.configuration.childrenMaxAge&&($fb._state.quicksearch.configuration.childrenMaxAge=12),-1===$fb._state.quicksearch.configuration.maxAdults&&($fb._state.quicksearch.configuration.maxAdults=100),-1===$fb._state.quicksearch.configuration.maxChildren&&($fb._state.quicksearch.configuration.maxChildren=100),-1===$fb._state.quicksearch.configuration.maxPersons&&($fb._state.quicksearch.configuration.maxPersons=100))}},saver:{saveBooking:function(event){if(!$fb._checkEvent("app","saveBooking",event))return $fb._callback(event);if($fb._state.app.saving.booking)return $fb.warn("saveBooking already in progress..."),$fb._callback(event);if($fb._state.app.saving.booking=!0,!event.args||!event.args.gdata)return $fb.error("Missing guarantee data"),$fb._triggerEvent("fastbooking-crs-frontend-modal",{title:$.fb("crs-helper-translate",{key:"error-application-error"}).text(),message:$.fb("crs-helper-translate",{key:"error-application-error"}).text()}),delete $fb._state.app.saving.booking,$fb._callback(event,new Error("Missing guarantee data"));var apiConfig=$fb.bookingService.getApiCallPayload(event.args.gdata,event.args.collectEmailOptIn,event.args.pdata||{});$fb.log("Booking request",apiConfig.selection),$fb._api(apiConfig,function(json){if("success"!==json.status)return $fb.error("error in api call",json),$fb.bookingService.handleApiErrorOnCreation(json.message),$fb._triggerEvent("fastbooking-crs-frontend-store-confirmation-api-failed"),delete $fb._state.app.saving.booking,$fb._callback(event,new Error("error in api call"));$fb.info("booking call result: ",json);var confirmation=json.data.confirmation;if($fb.bookingService.updateStateOnBookingCreationSuccess($fb._state.quicksearch.property,confirmation,apiConfig.selection),$fb.bookingService.sendMailChimpInfos(),$fb.bookingService.sendTrackingDataOnCreationSuccess(confirmation,apiConfig.selection.buyer.email),json.data.callback){var redirectUrl=json.data.callback;if($fb._state.url){var cbu=$fb._state.url+"/index.php?s=confirm&property="+$fb._state.quicksearch.property;cbu+="&confirmation="+confirmation+"&op=1&bh="+$fb._state.app.booking.hash,cbu+="&locale="+$fb._state.app.locale+"&currency="+$fb._state.app.currency,redirectUrl+="&callback="+encodeURIComponent(cbu)}return $fb.log("Redirecting to online payment...",redirectUrl),$fb._triggerEvent("fastbooking-crs-frontend-modal",{title:"-",message:$.fb("crs-helper-translate",{key:"booking-payment-system"}).text()}),setTimeout(function(){window.location.href=redirectUrl},1e3),!1}return $fb.redirectHelper.redirectToStep("confirm"),delete $fb._state.app.saving.booking,$fb._callback(event)})},cancelBooking:function(confirmation,email,totalRefundable){return new Promise(function(resolve,reject){var apiConfig={c:"cancelbooking",property:$fb._state.quicksearch.property,confirmation:confirmation,email:email,totalRefundable:totalRefundable};$fb._api(apiConfig,function(json){if($fb.info("booking cancel result: ",json),!json.status)return $fb.error("an error occured when trying to cancel "+JSON.stringify(json)),reject(new Error);if("success"!==json.status){$fb.error("error in api call for booking cancel "+JSON.stringify(json));var error=new Error;if(json.message){var messageData=JSON.parse(json.message);messageData&&messageData.codes&&(error.codes=messageData.codes)}return reject(error)}resolve()},function(){$fb.error("an error occured when trying to cancel"),reject(new Error)})})}},isStandAlone:function(){return"standalone"===$fb._state.app.integration},_querySignature:function(query){return JSON.stringify(query)},loadingElement:function(destination,size){(void 0===size||0<=parseInt(size,10))&&(size=4),((size=parseInt(size,10))<2||5<size)&&(size=4);var sizeClass="fa-"+size+"x";$fb.results&&destination===$fb.results._container&&$fb.results._setAvailabilityStatus(null),destination instanceof jQuery&&($.fb?destination.append($('<div class="fb-loading" />').append('<i class="fa '+sizeClass+' fa-spinner fa-spin"></i><br/>').append($.fb("crs-helper-translate",{key:"please-wait"})).append("...")):destination.append('<div class="fb-loading"><i class="fa '+sizeClass+' fa-spinner fa-spin"></i></div>'))},_:{hasFeature:function(key,state,argument){return!!($fb._config&&$fb._config.features&&$fb._config.features[state]&&$fb._config.features[state][key]&&new RegExp($fb._config.features.activate[key]).test(void 0!==argument?argument:""))}},events:{init:function(){$(document).off("fastbooking-crs-frontend-require").on("fastbooking-crs-frontend-require",$fb.require),$(document).off("fastbooking-crs-frontend-initialized").on("fastbooking-crs-frontend-initialized",$fb.waitForAb),$(document).off("fastbooking-crs-frontend-run.app").on("fastbooking-crs-frontend-run.app",$fb.run),$(document).off("fastbooking-crs-frontend-renderAll").on("fastbooking-crs-frontend-renderAll",$fb.renderAll),$(document).on("fastbooking-crs-frontend-load-property",$fb.loader.genericLoad),$(document).on("fastbooking-crs-frontend-load-group",$fb.loader.genericLoad),$(document).on("fastbooking-crs-frontend-load-accommodations",$fb.loader.genericLoad),$(document).on("fastbooking-crs-frontend-load-rates",$fb.loader.genericLoad),$(document).on("fastbooking-crs-frontend-load-services",$fb.loader.genericLoad),$fb.isStandAlone()&&($(document).on("fastbooking-crs-frontend-load-property-done",$fb.loader.loadAccommodations),$(document).on("fastbooking-crs-frontend-load-property-done",$fb.loader.loadRates),$(document).on("fastbooking-crs-frontend-load-property-done",$fb.loader.loadServices)),$(document).on("fastbooking-crs-frontend-load-booking",$fb.loader.genericLoad),$(document).on("fastbooking-crs-frontend-load-quotation",$fb.loader.genericLoad),$(document).on("fastbooking-crs-frontend-load-alterquotation",$fb.loader.genericLoad),$(document).on("fastbooking-crs-frontend-load-phones",$fb.loader.genericLoad),$(document).on("fastbooking-crs-frontend-load-languages",$fb.loader.genericLoad),$(document).on("fastbooking-crs-frontend-load-countries",$fb.loader.genericLoad),$(document).on("fastbooking-crs-frontend-load-campaigns",$fb.loader.genericLoad),$(document).on("fastbooking-crs-frontend-load-nor1estandby",$fb.loader.genericLoad),$(document).on("fastbooking-crs-frontend-load-booking-done",function(){2===$fb._state.app.data.nor1Estandby.tagActivated&&$fb._triggerEvent("fastbooking-crs-frontend-load-nor1estandby")}),$(document).on("fastbooking-crs-frontend-load-salesterms",$fb.loader.genericLoad),$(document).on("fastbooking-crs-frontend-save-booking",$fb.saver.saveBooking),$(window).on("popstate",$fb._popHistory)}}})}(window.jQuery,window.$fb.underscore),function($){function AbTesting(session){this._session=session}AbTesting.prototype={getCurrentSession:function(){return this._session},isCurrentSession:function(test,allocation){return!!this.getCurrentSession()&&(this.getCurrentSession().test===test&&this.getCurrentSession().allocation===allocation)}},$(document).on("$fb.fastbooking-crs-frontend-initializing",function(){function createSession(){return $fb.callApi("generateAbSession",{data:(requestData={initialBookingStep:$fb._state.app.step,user:{countryCode:$fb._state.geolocationCountry,languageCode:$fb._state.app.locale},device:{type:$fb._state.isMobile?"mobile":"desktop"}},hotelData=$fb._state.abTesting&&$fb._state.abTesting.data&&$fb._state.abTesting.data.hotel,hotelData&&(requestData.hotel=hotelData),requestData)}).catch(function(e){return $fb.error(e),{test:null}}).then(function(session){var cookiesAttributes={};void 0!==session.persistence&&(cookiesAttributes.expires=new Date((new Date).getTime()+60*session.persistence*1e3),delete session.persistence),session.test||(session=null),$fb.cookies.set("a/b",JSON.stringify(session),cookiesAttributes),$fb.abTesting=new AbTesting(session)});var requestData,hotelData}$fb.loadingAbTesting=Promise.resolve().then(function(){if($fb._state.abTesting&&$fb._state.abTesting.allowStub&&-1!==Object.keys($fb.getUrlArgs()).indexOf("_abstub"))return function(stub){if(stub&&1!==stub.split(":").length){var values=stub.split(":"),test=values[0],allocation=values[1];$fb.abTesting=new AbTesting({test:test,allocation:allocation})}else $fb.abTesting=new AbTesting(null)}($fb.getUrlArgs()._abstub);if($fb._state.abTesting&&$fb._state.abTesting.enabled){var strExistingSession=$fb.cookies.get("a/b");if(!strExistingSession)return createSession();$fb.abTesting=new AbTesting(JSON.parse(strExistingSession))}else $fb.abTesting=new AbTesting(null)}).catch(function(e){$fb.error(e),$fb.abTesting=new AbTesting(null)})})}(window.jQuery),function(_){window.$fb.urlToOccupancy={getOccupancyFromUrl:function(urlParams){var nbRooms=1,maxPackages=$fb._config.maxPackages,usedKeys=[];if(urlParams.rooms){var numberOfRoomsInUrlParam=parseInt(urlParams.rooms,10);usedKeys.push("rooms"),Number.isFinite(numberOfRoomsInUrlParam)&&1<numberOfRoomsInUrlParam&&(nbRooms=Math.min(numberOfRoomsInUrlParam,maxPackages))}var occupancy=_.times(nbRooms,function(){return{nbAdults:1,nbChildren:0,childrenAges:[]}});return _.chain(urlParams).pick(function(value,key){return"adults"===key.substring(0,6)}).each(function(value,key){var index="adults"===key?0:parseInt(key.substring(6),10)-1;if(value=parseInt(value,10),usedKeys.push(key),!(!Number.isFinite(index)||!Number.isFinite(value)||index<0||value<1||maxPackages<index+1)){for(;void 0===occupancy[index];)occupancy.push({nbAdults:1,nbChildren:0,childrenAges:[]});occupancy[index].nbAdults=value}}),_.chain(urlParams).pick(function(value,key){return"children"===key.substring(0,8)&&!["childrenAges","childrenages"].includes(key.substring(0,12))}).each(function(value,key){var index="children"===key?0:parseInt(key.substring(8),10)-1;if(value=parseInt(value,10),usedKeys.push(key),!(!Number.isFinite(index)||!Number.isFinite(value)||index<0||value<0||maxPackages<index+1)){for(;void 0===occupancy[index];)occupancy.push({nbAdults:1,nbChildren:0,childrenAges:[]});occupancy[index].nbChildren=value,occupancy[index].childrenAges=_.times(value,function(){return null})}}),_.chain(urlParams).pick(function(value,key){return["childrenAges","childrenages"].includes(key.substring(0,12))}).each(function(value,key){var index=parseInt(key.substring(12),0)-1;if(usedKeys.push(key),!(!Number.isFinite(index)||index<0||maxPackages<index+1)&&occupancy[index]){var childrenAges=value.replace(/ /g,"").split(",").map(function(value){return parseInt(value,10)});childrenAges.length>occupancy[index].nbChildren&&(occupancy[index].nbChildren=childrenAges.length),occupancy[index].childrenAges=_.times(occupancy[index].nbChildren,function(i){return Number.isFinite(childrenAges[i])&&0<=childrenAges[i]?childrenAges[i]:null})}}),{occupancy:occupancy,usedKeys:usedKeys}}}}(window.$fb.underscore),function(){function OccupancySelectionValidator(){}OccupancySelectionValidator.prototype.validate=function(selection,configuration){var items=selection.map(function(room){var childrenAgesErrors=room.childrenAges.map(function(childrenAge){return configuration.needChildrenAges?null===childrenAge?"empty":childrenAge>configuration.childrenMaxAge?"childrenMaxAge":null:null}),childrenAgesHasError=childrenAgesErrors&&childrenAgesErrors.some(function(error){return error}),personsExceed=room.nbAdults+room.nbChildren>configuration.maxPersons,adultsHasError=personsExceed||room.nbAdults>configuration.maxAdults,childrenHasError=personsExceed||room.nbChildren>configuration.maxChildren;return{hasError:childrenAgesHasError||adultsHasError||childrenHasError,childrenAges:childrenAgesErrors?{hasError:childrenAgesHasError,items:childrenAgesErrors.map(function(error){return error?{hasError:!0,reason:error}:{hasError:!1}})}:null,nbAdults:adultsHasError?{hasError:!0,reason:personsExceed?"maxPersons":"maxAdults"}:{hasError:!1},nbChildren:childrenHasError?{hasError:!0,reason:personsExceed?"maxPersons":"maxChildren"}:{hasError:!1}}}.bind(this));return{hasError:items.some(function(room){return room.hasError}),items:items}},window.$fb.occupancySelectionValidator=new OccupancySelectionValidator}(),function($,_){function _apply(theme){if(function(){if(!$fb._state.themeStylesheet)return;$fb.log("Destroying theme"),$($fb._state.themeStylesheet).remove(),delete $fb._state.themeStylesheet}(),theme){$fb.log("Applying theme "+JSON.stringify(theme)),_insertRule(".theme-btn",{background:theme.btnBgColor+" !important",color:theme.btnTxtColor+" !important"}),_insertRule(".theme-btn-inverse",{background:theme.btnTxtColor+" !important",border:"2px solid "+theme.btnBgColor+" !important",color:theme.btnBgColor+" !important"}),_insertRule(".theme-link",{color:theme.linkColor+" !important"}),_insertRule(".theme-select",{"border-color":theme.btnBgColor+" !important"}),_insertRule(".theme-quicksearch-panel",{"border-top-color":theme.btnBgColor+" !important"}),_insertRule("#fb-quicksearch #fb-qs-summary>span>span:hover",{"border-bottom-color":theme.btnBgColor+" !important"}),_insertRule("#fb-quicksearch .fb-qs-summary-accesscode--container:hover",{"border-bottom-color":theme.btnBgColor+" !important"}),_insertRule("#fb-quicksearch .fb-qs-summary-accesscode--container.isActive input",{"border-bottom-color":theme.btnBgColor+" !important"}),_insertRule("#fb-quicksearch .fb-qs-summary-accesscode--container.isActive",{"border-bottom-color":theme.btnBgColor+" !important"}),_insertRule("#fb-quicksearch #fb-qs-summary>span>span::after",{color:theme.btnBgColor+" !important"}),_insertRule([".theme-calendar.daterangepicker td.today.active",".theme-calendar.daterangepicker td.active"],{background:theme.calendarColor+" !important"}),_insertRule([".theme-calendar.daterangepicker td.today.active",".theme-calendar.daterangepicker td.active"],{background:theme.calendarColor+" !important",color:theme.btnTxtColor+" !important"}),_insertRule(["body.theme-background:not(.mobile)","html.theme-background:not(.mobile)"],{"background-color":theme.backgroundColor});var checkBoxBgColor=theme.checkBoxBgColor||theme.btnBgColor;_insertRule(".theme-checkbox.fb-checked",{background:checkBoxBgColor+" !important",border:"2px solid "+checkBoxBgColor+" !important",color:(theme.checkBoxColor||theme.btnTxtColor)+" !important"})}}function _insertRule(selectors,rules){!function(){if(!$fb._state.themeStylesheet){var themeStylesheetElement=document.createElement("style");themeStylesheetElement.media="screen",themeStylesheetElement.appendChild(document.createTextNode("")),document.head.appendChild(themeStylesheetElement),$fb._state.themeStylesheet=themeStylesheetElement}}();var sheet=$fb._state.themeStylesheet.sheet;selectors="string"==typeof selectors?selectors:selectors.join(","),rules="string"==typeof rules?rules:_(rules).map(function(value,key){return key+":"+value}).join("; ")+";";var position=(sheet.rules||sheet.cssRules).length;if(sheet.addRule)return sheet.addRule(selectors,rules,position);sheet.insertRule(selectors+"{"+rules+"}",position)}function _renderGroup(){if($fb.log("Calculating and rendering group theme."),!$fb._state.app.data.groups[$fb._state.quicksearch.group])return $fb.log("Missing theme data ... awaiting"),void $(window).one("fastbooking-crs-frontend-load-group-done.group",_renderGroup);_apply(function(){var themes=_($fb._state.app.data.groups[$fb._state.quicksearch.group].properties).map(function(property){return property.bookingEngineFrontend.theme});if(themes.length){var mostThemeId=_.chain(themes).countBy(function(theme){return theme.id}).pairs().sortBy(function(pair){return pair[1]}).last().value()[0];return themes.find(function(theme){return theme.id===mostThemeId})}}())}function _renderSingle(){if($fb.log("Calculating and rendering single theme."),!$fb._state.app.data.properties[$fb._state.quicksearch.property])return $fb.log("Missing theme data ... awaiting"),void $(window).one("fastbooking-crs-frontend-load-property-done",_renderSingle);_apply($fb._state.app.data.properties[$fb._state.quicksearch.property].bookingEngineFrontend.theme)}function _onRenderPage(){$fb.log("Calculating and rendering theme."),"group"===$fb._state.app.step?_renderGroup():_renderSingle()}$(window).on("$fb.fastbooking-crs-frontend-initializing",function(){$fb.log("Boostraping theme"),$fb._state.app.data.theme&&"group"!==$fb._state.app.step&&($fb.log("Applying app.data.theme"),_apply($fb._state.app.data.theme));delete $fb._state.app.data.theme,$(window).on("fastbooking-crs-frontend-renderAll",_onRenderPage)}),$fb.theme={apply:_apply}}(window.jQuery,window.$fb.underscore),function($,_){var _allowedBackofficeOrigins,_backofficeOrigin;function _postEvent(eventName,backofficeOrigin,data){backofficeOrigin=backofficeOrigin||_backofficeOrigin,window.parent.postMessage({type:"event",eventName:eventName,eventData:data},backofficeOrigin)}function _onWindowMessage(event){if(-1===_allowedBackofficeOrigins.indexOf(event.origin))return _postEvent("forbidden",event.origin),void $fb.log("Invalid origin for backoffice communication "+event.origin);if(event.source!==window.parent)return _postEvent("forbidden",event.origin),void $fb.log("Invalid parent for backoffice communication");_backofficeOrigin=event.origin;var message=event.data;"method"===message.type&&"preview"===message.methodName&&function _preview(data){if(0===Object.keys($fb._state.app.data.properties).length)return void $(window).one("fastbooking-crs-frontend-load-property-done",function(){_preview(data)});if(0===Object.keys($fb._state.app.data.quotation).length)return void $(window).one("fastbooking-crs-frontend-load-quotation-done",function(){setTimeout(function(){_preview(data)},50)});var property=data.property;var currentProperty=$fb._state.app.data.properties[property.property];var diffKeys=Object.keys(property).filter(function(key){return JSON.stringify(currentProperty[key])!==JSON.stringify(property[key])});var quickPreviewForBackofficeColorAndText=!1;if(1===diffKeys.length&&"bookingEngineFrontend"===diffKeys[0]){var bookingEngineFrontendDiffKeys=Object.keys(property.bookingEngineFrontend).filter(function(key){return JSON.stringify(currentProperty.bookingEngineFrontend[key])!==JSON.stringify(property.bookingEngineFrontend[key])});1===bookingEngineFrontendDiffKeys.length&&"theme"===bookingEngineFrontendDiffKeys[0]&&(quickPreviewForBackofficeColorAndText=!0)}_.extend(currentProperty,property);$("html").addClass("preview");quickPreviewForBackofficeColorAndText?$fb.theme.apply(property.bookingEngineFrontend.theme):$fb._triggerEvent("fastbooking-crs-frontend-renderAll");_postEvent("preview.done",void 0,{height:$(document).height()})}(message.methodArgs)}$(window).on("fastbooking-crs-frontend-initialized",function(){if(!window.parent||window.parent===window||!window.parent.postMessage)return;_allowedBackofficeOrigins=$fb._state.backofficeOrigins,_postEvent("listen","*"),window.addEventListener("message",_onWindowMessage,!1)})}(window.jQuery,window.$fb.underscore),function($){$.extend(window.$fb,{header:{_container:null,_config:{},_state:{},init:function(event){return $fb._checkEvent("header","init",event),$fb._callback(event)},loadProperty:function(event){if(!$fb._checkEvent("header","loadProperty",event))return $fb._callback(event);if("group"!==$fb._state.app.step){var propertyData=$fb._state.app.data.properties[$fb._state.quicksearch.property];if(void 0===propertyData||void 0===propertyData.title)$fb._triggerEvent("fastbooking-crs-frontend-load-property");else{null==$fb.header._container&&($fb.header._container=$fb._checkContainer("header",!1));var output=$('<div class="fb-container" />');output.append($fb.header._renderToolBar()),output.append($fb.header._renderHotel()),-1==$.inArray($fb._state.app.step,["confirm","cancel"])&&$("#fb-header-breadcrumb").html($fb.header._renderBreadcrumb()),$fb.header._container.html(output),$fb._FirePageView()}}return $fb._callback(event)},loadGroup:function(event){if(!$fb._checkEvent("header","loadGroup",event))return $fb._callback(event);if("group"==$fb._state.app.step){var groupData=$fb._state.app.data.groups[$fb._state.quicksearch.group];if($.fb("crs-locale-load-group",{group:$fb._state.quicksearch.group},function(){$.fb("crs-helper-process","translate")}),void 0===groupData||void 0===groupData.name)$fb._triggerEvent("fastbooking-crs-frontend-load-group");else{null==$fb.header._container&&($fb.header._container=$fb._checkContainer("header",!1));var output=$('<div class="fb-container" />');output.append($fb.header._renderToolBar()),output.append($fb.header._renderGroup()),$fb.header._container.html(output)}}return $fb._callback(event)},render:function(event){if(!$fb._checkEvent("header","render",event))return $fb._callback(event);null==$fb.header._container&&($fb.header._container=$fb._checkContainer("header",!1));var output=$('<div class="fb-dark-bg" />');if(output.append($fb.header._renderToolBar()),output.append('<div id="fb-header-loyalty-container" class="container fb-container fb-light-bg"></div>'),$fb.header._state.loyaltyView&&output.find("#fb-header-loyalty-container").append($fb.header._state.loyaltyView),"group"==$fb._state.app.step)return $fb._state.app.data.groups&&void 0!==$fb._state.app.data.groups[$fb._state.quicksearch.group]?output.append($fb.header._renderGroup()):$fb._triggerEvent("fastbooking-crs-frontend-load-group"),$fb.header._container.html(output),$fb._triggerEvent("fastbooking-crs-frontend-header-render-after"),$fb._callback(event);if($fb._state.app.data.properties&&void 0!==$fb._state.app.data.properties[$fb._state.quicksearch.property]){var propertyData=$fb._state.app.data.properties[$fb._state.quicksearch.property];propertyData&&propertyData.images&&propertyData.images[0]&&output.removeClass("fb-dark-bg"),output.append($fb.header._renderHotel()),$fb.header._container.html(output),"confirm"!=$fb._state.app.step&&"cancel"!=$fb._state.app.step&&"group"!=$fb._state.app.step&&$("#fb-header-breadcrumb").html($fb.header._renderBreadcrumb()),$fb._FirePageView()}else $fb._triggerEvent("fastbooking-crs-frontend-load-property");return $fb._callback(event)},_renderToolBar:function(){var toolbarTheme="dark";if("group"!==$fb._state.app.step){var propertyData=$fb._state.app.data.properties[$fb._state.quicksearch.property];propertyData&&propertyData.bookingEngineFrontend&&(toolbarTheme=propertyData.bookingEngineFrontend.header.toolbar.theme)}var toolbar=$('<div id="fb-header-toolbar" class="col-xs-12 hidden-print theme-'+toolbarTheme+'" />');"cancel"!=$fb._state.app.step&&"group"!=$fb._state.app.step?toolbar.append($('<div id="fb-small-info" class="col-xs-2 hidden-sm hidden-md hidden-lg" />').append('<i class="fa fa-info-circle fb-header-info-icon"></i>').click(function(event){return event.preventDefault(),$fb._triggerEvent("fastbooking-crs-frontend-hoteldetails-open"),!1})):toolbar.append('<div id="fb-small-info" class="col-xs-6 col-sm-2 hidden-md hidden-lg" />');var locales=$.fb("crs-locale-configure",{k:"locales"}),chosenLanguage=locales[$fb._state.app.locale];chosenLanguage&&"string"==typeof chosenLanguage||(chosenLanguage="object"==typeof propertyData&&null!==propertyData&&"string"==typeof propertyData.locale&&"string"==typeof locales[propertyData.locale]?locales[propertyData.locale]:locales.en_GB);var currencyLabel=$fb.i18n.getCurrencySymbol()+" ("+$fb.i18n.getSelectedCurrency()+")",langCurrencyZoneTpl='<span id="fb-headbar"><span id="fb-headbar-block-language"><span class="fb-headbar-label hidden-xs hidden-sm"></span><span class="fb-headbar-value">'+chosenLanguage.toLowerCase()+'</span><span class="fb-headbar-caret fa fa-caret-down"></span></span><span id="fb-headbar-block-currency"><span class="fb-headbar-label hidden-xs hidden-sm"></span><span class="fb-headbar-value">'+currencyLabel+'</span><span class="fb-headbar-caret fa fa-caret-down"></span></span>',langCurrencyZone=$(langCurrencyZoneTpl).click(function(event){return event.preventDefault(),$fb._triggerEvent("fastbooking-crs-frontend-localize-open"),!1});return langCurrencyZone.find(".fb-headbar-label:eq(0)").append($.fb("crs-helper-translate",{key:"Languages"})),langCurrencyZone.find(".fb-headbar-label:eq(1)").append($.fb("crs-helper-translate",{key:"Currencies"})),toolbar.append($('<div id="fb-cur-lang"/>').append(langCurrencyZone)),toolbar},detachLoyaltyView:function(){$fb.header._state.loyaltyView=null,$("#fb-header").removeClass("has-loyalty-view"),$fb._triggerEvent("fastbooking-crs-frontend-header-render")},attachLoyaltyView:function($view){$fb.header._state.loyaltyView=$view,$("#fb-header").addClass("has-loyalty-view"),$fb._triggerEvent("fastbooking-crs-frontend-header-render")},_renderGroup:function(){var groupData=$fb._state.app.data.groups[$fb._state.quicksearch.group],groupName=$fb._state.quicksearch.group;groupData&&groupData.parameters&&groupData.parameters.GROUP_NAME&&(groupName=groupData.parameters.GROUP_NAME);var groupTitle=$.fb("crs-helper-translate",{key:$fb._state.quicksearch.group+":title",fallback:groupName});return $('<div id="fb-header-group" class="col-xs-12 fb-dark-bg text-center" />').append(groupTitle)},_renderHotel:function(){var propertyData=$fb._state.app.data.properties[$fb._state.quicksearch.property],branding=propertyData&&propertyData.bookingEngineFrontend&&propertyData.bookingEngineFrontend.header.branding||{displayMode:"title"},showHotelDetailsLink=propertyData&&propertyData.bookingEngineFrontend&&propertyData.bookingEngineFrontend.header.showHotelDetailsLink;void 0===showHotelDetailsLink&&(showHotelDetailsLink=!0),$("#fb-header").addClass("fb-dark-bg");var hotelContainer=$('<div id="fb-header-hotel" class="col-xs-12" />'),displayTitle=!0;if(branding.logo&&-1!==branding.displayMode.indexOf("logo")){var logo=$.fb("crs-helper-image",{src:branding.logo.url}),logoContainer=$("<div />").addClass("fb-hotel-logo").addClass("hidden-print");if(hotelContainer.append(logoContainer.append(logo)),branding.logo.hyperlink){var link=$("<a />",{href:branding.logo.hyperlink,target:"_blank"});logoContainer.append(link.append(logo))}"logo"===branding.displayMode&&(displayTitle=!1)}var titlefallback=$fb._state.quicksearch.property;propertyData&&(titlefallback=propertyData.title,propertyData.bookingEngineFrontend&&propertyData.bookingEngineFrontend.defaultTitle&&(titlefallback=propertyData.bookingEngineFrontend.defaultTitle));var translatedHotelTitle=$.fb("crs-helper-translate",{key:$fb._state.quicksearch.property+":be_title:hoteldesc",fallback:titlefallback}),hotelTitle=$('<div class="fb-hotel-title col-md-12 fb-font-light" />');if(displayTitle&&hotelTitle.append(translatedHotelTitle).append(" "),displayTitle&&propertyData&&parseInt(propertyData.stars,10)){for(var stars=parseInt(propertyData.stars,10),starContainer=$('<span class="fb-hotel-stars fb-font-thin nowrap"/>'),i=1;i<=stars;i++)starContainer.append('<span class="fa fa-star"></span>');hotelTitle.append(starContainer)}return showHotelDetailsLink&&"cancel"!=$fb._state.app.step&&"group"!=$fb._state.app.step&&hotelTitle.append($('<div class="hidden-xs hidden-print" />').append('<i class="fa fa-info-circle fb-header-hotel-details"></i> ').append($.fb("crs-helper-translate",{key:"header-"+propertyData.type.toLowerCase()+"-infos"}).addClass("fb-header-hotel-details")).click(function(event){return event.preventDefault(),$fb._triggerEvent("fastbooking-crs-frontend-hoteldetails-open"),!1})),$fb.bannerRenderer.setHeaderImage(propertyData),hotelContainer.append(hotelTitle),hotelContainer},_renderBreadcrumb:function(){var container=$('<div class="container fb-container" />'),step1=$('<div id="fb-header-breadcrumb-step-1" class="fb-step fb-left"/>'),step2=$('<div id="fb-header-breadcrumb-step-2" class="fb-step"/>'),step3=$('<div id="fb-header-breadcrumb-step-3" class="fb-step fb-right"/>');step1.append('<span class="fb-breadcrumb-nb fb-font-bold">1</span>').append($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"breadcrumb-room-choice"})}).addClass("fb-breadcrumb-text hidden-xs")).click(function(event){return event.preventDefault(),"results"===$fb._state.app.step||$fb._triggerEvent("crs-helper-modal-display",{template:"confirm",position:"center",body:$("<div />").append($("<p />").append($.fb("crs-helper-translate",{key:"breadcrumb-confirm-back-step1-label"}))),onConfirm:function(){$fb._triggerEvent("fastbooking-crs-frontend-emptySelection"),$fb._ChangeAppStep("results"),$fb._addHistory(),$fb._checkStep(),$fb._triggerEvent("fastbooking-crs-frontend-renderAll")}}),!1});var index=2;return!$fb.selection.hasAvailableServices()&&$fb._state.isMobile||(step2.append('<span class="fb-breadcrumb-nb fb-font-bold">2</span>').append($.fb("crs-helper-translate",{key:"breadcrumb-options-choice"}).addClass("fb-breadcrumb-text hidden-xs")).click(function(event){return event.preventDefault(),$fb.selection.hasAvailableServices()&&"extras"!==$fb._state.app.step&&($fb._ChangeAppStep("extras"),$fb._addHistory(),$fb._checkStep(),$fb._triggerEvent("fastbooking-crs-frontend-renderAll")),!1}),index=3),step3.append('<span class="fb-breadcrumb-nb fb-font-bold">'+index+"</span>").append($.fb("crs-helper-translate",{key:"breadcrumb-booking"}).addClass("fb-breadcrumb-text hidden-xs")).click(function(event){return event.preventDefault(),"validate-collect"!=$fb._state.app.step&&"confirm"!=$fb._state.app.step&&($fb._ChangeAppStep("validate-collect"),$fb._addHistory(),$fb._checkStep(),$fb._triggerEvent("fastbooking-crs-frontend-renderAll")),!1}),"results"===$fb._state.app.step&&step1.addClass("active"),"extras"===$fb._state.app.step&&step2.addClass("active"),"validate-collect"===$fb._state.app.step&&step3.addClass("active"),container.append(step1),container.append(step2),container.append(step3),container}}}),$(document).on("fastbooking-crs-frontend-header-init",$fb.header.init),$(document).on("fastbooking-crs-frontend-header-render",$fb.header.render),$(document).on("fastbooking-crs-frontend-load-property-done",$fb.header.loadProperty),$(document).on("fastbooking-crs-frontend-load-group-done",$fb.header.loadGroup),$(document).on("fastbooking-crs-frontend-currency-changed",$fb.header.render)}(window.jQuery),function($){$.extend(window.$fb,{footer:{_container:null,_config:{},_state:{},_preload:null,init:function(event){return $fb._checkEvent("footer","init",event),$fb._callback(event)},render:function(event){if(!$fb._checkEvent("footer","render",event))return $fb._callback(event);null==$fb.footer._container&&($fb.footer._container=$fb._checkContainer("footer")),$fb.footer._container.empty();var preload,propertyData=$fb._state.app.data.properties[$fb._state.quicksearch.property],bannerFooterData=propertyData&&propertyData.bookingEngineFrontend&&propertyData.bookingEngineFrontend.footer.banner||{useCustomImage:!1},customFooterBanner=bannerFooterData.useCustomImage&&bannerFooterData.image,links=propertyData?$fb.propertyService.getFooterLinksToShow(propertyData):[],hasLinks=!!links.length;return customFooterBanner?(preload=new Image,$fb.footer._container.css("background-color","transparent"),($fb.footer._preload=preload).onload=function(){if(preload===$fb.footer._preload){var newHeight=preload.naturalHeight,css={"background-image":'url("'+$.fb("crs-helper-image",{src:customFooterBanner.url,onlySrc:!0})+'")',height:newHeight+"px","background-attachment":"scroll, scroll","background-clip":"border-box, border-box","background-color":"rgba(0, 0, 0, 0)","background-origin":"padding-box, padding-box","background-position":"center, center","background-repeat":"no-repeat","max-width":"100%"},output=$('<div class="container text-center custom-banner" id="fb-app-footer" />').css(css);$("body").css("padding-bottom",newHeight),$fb._config.footerAdditionalContent&&$fb.footer._container.append($('<div class="container text-center" style="padding: 0;"/>').append($('<div class="col-xs-12 fb-dark-gray" />').append($fb._config.footerAdditionalContent))),hasLinks&&output.addClass("has-links").append($fb.footer.getLinksElements(links)),$fb.footer._container.append(output),$fb.footer._preload=null}},preload.src=customFooterBanner.url):function(){$("#fb-footer").css("background-color","");var output=$('<div class="container text-center original-banner" id="fb-app-footer" />'),propertyTitle="";propertyData&&(propertyTitle=$.fb("crs-helper-translate",{key:$fb._state.quicksearch.property+":hoteltitle"})),output.append($('<div class="fb-dark-gray" />').append("&copy; "+(new Date).getFullYear()+" ").append(propertyTitle)),$fb._config.footerAdditionalContent&&output.addClass("has-additional-content").append($('<div class="fb-dark-gray" />').append($fb._config.footerAdditionalContent)),hasLinks&&output.addClass("has-links").append($fb.footer.getLinksElements(links)),$fb.footer._container.append(output),$fb.footer._preload=null,$("body").css("padding-bottom",$fb.footer._container.height())}(),"group"==$fb._state.app.step?($fb.footer._container.css("margin-top","0px"),$fb.footer._container.css("position","fixed")):($fb.footer._container.css("margin-top",""),$fb.footer._container.css("position","")),$fb._callback(event)},getLinksElements:function(links){return links[0].hyperlink?$('<ul class="fb-dark-gray fb-footer-links" />').append(links.map(function(link){return $("<li />").append($("<a />",{target:"_blank",href:link.hyperlink}).append($.fb("crs-helper-translate",{key:$fb._state.quicksearch.property+":"+link.i18nKey,fallback:link.defaultText})))})):$('<ul class="fb-dark-gray fb-footer-links" />').append(links.map(function(link){var translatedLink=$.fb("crs-helper-translate",{key:$fb._state.quicksearch.property+":"+link.hyperlinkI18nKey+":hoteldesc",fallback:link.defaultHyperlink});return $("<li />").append($("<a />",{target:"_blank",href:translatedLink.text()}).append($.fb("crs-helper-translate",{key:$fb._state.quicksearch.property+":"+link.textI18nKey+":hoteldesc",fallback:link.defaultText})))}))},updateLinksWithLocalChange:function(){var existingLinks=$("#fb-app-footer .fb-footer-links");if(existingLinks.length){var propertyData=$fb._state.app.data.properties[$fb._state.quicksearch.property],links=propertyData?$fb.propertyService.getFooterLinksToShow(propertyData):[];links.length&&existingLinks.replaceWith($fb.footer.getLinksElements(links))}}}}),$(document).on("fastbooking-crs-frontend-footer-init",$fb.footer.init),$(document).on("fastbooking-crs-frontend-footer-render",$fb.footer.render),$(document).on("fastbooking-crs-frontend-load-property-done",$fb.footer.render),$(document).on("crs-locale-changed",$fb.footer.updateLinksWithLocalChange)}(window.jQuery),function($,_){$.extend(window.$fb,{localize:{_container:null,_config:{nbLocalesPerBlock:7,nbCurrenciesPerBlock:6},_state:{},_twelveHoursCountry:["en_GB","en_US","en_AU","en_CA","es_CO","es_MX","ar_EG","ar_SA","es_SV","es_HN","en_IN","hi_IN","en_IE","ar_JO","ms_MY","en_NZ","es_NI","bn_BD","ur_PK","en_PH"],init:function(event){return $fb._checkEvent("localize","init",event),$fb._callback(event)},render:function(event){return $fb._checkEvent("localize","render",event)&&($fb.localize._container=$fb._checkContainer("localize",!1,$fb._state.$body)),$fb._callback(event)},_renderLocales:function(){var output=$('<div class="container" />');return $fb._state.app.data.locales&&(output.append($('<div id="fb-localize-locales" class="col-xs-12 fb-localize-title" />').append($.fb("crs-helper-translate",{key:"Languages"}))),_.chain($fb._state.app.data.locales).keys().chunk($fb.localize._config.nbLocalesPerBlock).each(function(localesChunk,index){var major=0===index,currentContainer=$('<span class="col-xs-6 col-sm-3 col-md-2 fb-container fb-localize-block" />');_.each(localesChunk,function(locale){var localeSpan=$('<span class="col-xs-12 fb-localize-item" data-choice="'+locale+'" role="link" />');major?localeSpan.addClass("fb-localize-major"):localeSpan.addClass("fb-dark-gray"),locale===$fb._state.app.locale&&localeSpan.addClass("fb-localize-selected"),localeSpan.append($fb._state.app.data.locales[locale]),localeSpan.click(function(event){event.preventDefault();var chosenLocale=$(this).attr("data-choice");return $fb._state.app.locale=chosenLocale,$fb.info("new locale "+chosenLocale),$fb._checkNonRomanWarning(),$.fb("crs-helper-change",{key:"locale",value:$fb._state.app.locale},function(){$fb._state.quicksearch.property&&$fb._state.app.data.properties[$fb._state.quicksearch.property]?setTimeout(function(){document.title=$.fb("crs-helper-translate",{key:$fb._state.quicksearch.property+":hoteltitle",fallback:$fb._state.app.data.properties[$fb._state.quicksearch.property].title||"Book secure"}).text()},500):document.title="Book secure",$fb._triggerEvent("fastbooking-crs-frontend-locale-changed",{newLocale:$fb._state.app.locale}),$fb._triggerEvent("fastbooking-crs-frontend-header-render")}),$fb._triggerEvent("fastbooking-crs-frontend-load-countries"),$fb._triggerEvent("fastbooking-crs-frontend-load-languages"),$fb._updateHistory(),$fb.localize._close(),!1}),currentContainer.append(localeSpan)}),output.append(currentContainer)})),output},_renderCurrencies:function(){var output=$('<div class="container" />');if(!$fb._state.app.data.currencies)return output;output.append($('<div id="fb-localize-currencies" class="col-xs-12 fb-localize-title" />').append($.fb("crs-helper-translate",{key:"Currencies"})));var propertyData=$fb._state.app.data.properties[$fb._state.quicksearch.property];return propertyData&&propertyData.configuration&&propertyData.configuration.currency&&output.append($('<div id="fb-currency-notice" class="col-xs-12" />').append($.fb("crs-helper-translate",{key:"currency-change-notice",placeholders:[propertyData.configuration.currency]}))),_.chain($fb._state.app.data.currencies).keys().chunk($fb.localize._config.nbCurrenciesPerBlock).each(function(currenciesChunk,index){var major=0===index,currentCurrencyContainer=$('<span class="col-xs-6 col-sm-3 col-md-2 fb-container fb-localize-block" />');_.each(currenciesChunk,function(currency){var currencySpan=$('<span class="col-xs-12 fb-localize-item" data-choice="'+currency+'" role="link"/>');major?currencySpan.addClass("fb-localize-major"):currencySpan.addClass("fb-dark-gray"),currency==$fb._state.app.currency&&currencySpan.addClass("fb-localize-selected"),currencySpan.append($fb.i18n.getCurrencySymbol(currency)+" ("+currency+")"),currencySpan.click(function(event){return event.preventDefault(),$fb._setAppCurrency($(this).attr("data-choice")),$fb.localize._close(),!1}),currentCurrencyContainer.append(currencySpan)}),output.append(currentCurrencyContainer)}),output},getTimePickerFormat:function(){return 0<=$fb.localize._twelveHoursCountry.indexOf($fb._state.app.locale)?"h:i A":"H:i"},open:function(event){if(!$fb._checkEvent("localize","open",event))return $fb._callback(event);$fb.localize._container=$fb._checkContainer("localize",!1,$fb._state.$body),$fb.localize._container.empty(),$fb.localize._container.addClass("fb-modal-layer fb-dark-bg");var dialog=$('<div class="fb-modal-layer-inner" />');dialog.append('<div class="col-xs-12 text-right"><button class="btn fb-action fb-font-bold theme-btn btn-close">X</button></div>').click(function(event){return event.preventDefault(),$fb._triggerEvent("fastbooking-crs-frontend-ui-hide-modal",{modal:"localize",modules:$fb._state.app.modules},function(){return $fb._callback(event)}),!1}),(void 0===$fb._state.app.data.currencies||Object.keys($fb._state.app.data.currencies).length<=1)&&($fb._state.app.data.currencies=$.fb("crs-helper-configure",{k:"currencies"})),(void 0===$fb._state.app.data.locales||Object.keys($fb._state.app.data.locales).length<=1)&&($fb._state.app.data.locales=$.fb("crs-locale-configure",{k:"locales"})),$fb.info("Currencies: ",$fb._state.app.data.currencies,"Locales: ",$fb._state.app.data.locales),dialog.append($fb.localize._renderLocales()),dialog.append($fb.localize._renderCurrencies()),$fb.localize._container.append(dialog),$fb._triggerEvent("fastbooking-crs-frontend-ui-show-modal",{modal:"localize",modules:$fb._state.app.modules},function(){return $fb._callback(event)})},_close:function(){$fb._triggerEvent("fastbooking-crs-frontend-ui-hide-modal",{modal:"localize",modules:$fb._state.app.modules})}}}),$(document).on("fastbooking-crs-frontend-localize-init",$fb.localize.init),$(document).on("fastbooking-crs-frontend-localize-render",$fb.localize.render),$(document).on("fastbooking-crs-frontend-localize-open",$fb.localize.open)}(window.jQuery,window.$fb.underscore),function($,_){function showSlidingUp($node){$node.is(":visible")||$node.show().css({height:"0px",top:"100vh"}).find(".panel-content").css("overflow","hidden").end().animate({height:"100vh",top:"0px"},function(){$(this).find(".panel-content").css("overflow","")})}function hideSlidingDown($node){$node.is(":visible")&&$node.find(".panel-content").css("overflow","hidden").end().animate({height:"0px",top:"100vh"},function(){$(this).find(".panel-content").css("overflow",""),$(this).hide()})}$.extend(window.$fb,{quicksearch:{_container:null,_config:{maxRooms:3},_state:{arrival:" ",departure:" ",occupancy:[{nbAdults:1,nbChildren:0,childrenAges:[]}]},_stateBackup:{},init:function(event){if(!$fb._checkEvent("quicksearch","init",event))return $fb._callback(event);if($fb.quicksearch._config.maxRooms=$fb._config.maxPackages,$fb._state.quicksearch.group){if($fb._state.app.data.groups&&$fb._state.app.data.groups[$fb._state.quicksearch.group])return $fb._callback(event);$fb._triggerEvent("fastbooking-crs-frontend-load-group")}return $fb._callback(event)},render:function(event){if(!$fb._checkEvent("quicksearch","render",event))return $fb._callback(event);null==$fb.quicksearch._container&&($fb.quicksearch._container=$fb._checkContainer("quicksearch")),$fb.quicksearch._container.empty(),$fb.quicksearch._setStateFromAppState();var occupancySelection=$fb.quicksearch.occupancySelection=new $fb.OccupancySelection({maxRooms:$fb.quicksearch._config.maxRooms,showCancelLink:!$fb._state.isMobile,showApplyBtn:!$fb._state.isMobile});if(occupancySelection.on("apply",function(){$fb.quicksearch._applyCriteria(),$fb.quicksearch._updateSummaryRooms()}),occupancySelection.on("cancel",function(){$fb.quicksearch._closeAllPanelsBut(),$fb.quicksearch._updateIsActiveClass()}),occupancySelection.on("change",function(event){$fb.quicksearch._state.occupancy=event.selection}),$fb._state.isMobile||$fb.quicksearch.addClickListenersForClosingPanels(),-1!==$.inArray($fb._state.app.step,["confirm","cancel"]))return $fb._callback(event);$fb.quicksearch._getPropertyData($fb._state.quicksearch.property,$fb._state.quicksearch.group,function(){var themeClass=$fb._state.app.data.properties&&$fb.quicksearch._state.property&&$fb._state.app.data.properties[$fb.quicksearch._state.property]&&"dark"===$fb._state.app.data.properties[$fb.quicksearch._state.property].bookingEngineFrontend.header.toolbar.theme?"theme-dark":"";$fb.quicksearch._container.empty();var output=$('<div class="fb-container '+themeClass+'" />');return $fb._state.isMobile?output.append($fb.quicksearch._renderSummaryMobile()):output.append($fb.quicksearch._renderSummary()),$fb.quicksearch._container.append(output),$fb._callback(event)})},_renderSummaryMobile:function(){if("init"!==$fb._state.app.step){var output=$('<div id="fb-qs-summary" class="col-xs-12 fb-qs-summary-mobile" style="position:static" />'),container=$('<div id="fb-qs-mobile-summary" class="quicksearch-summary"/>'),containerInner=$('<div class="quicksearch-summary-mobile-inner"/>'),fakeBtn=$('<div class="fb-qs-fake-btn-mobile theme-btn"><i class="fa fa-caret-down" aria-hidden="true"></i></div>'),arrival=$('<span id="fb-qs-summary-dates-arrival">').append($.fb("crs-helper-date",{date:$fb.quicksearch._state.arrival,format:"short"})),departure=$('<span id="fb-qs-summary-dates-departure">').append($.fb("crs-helper-date",{date:$fb.quicksearch._state.departure,format:"short"}));container.append(containerInner).append(fakeBtn),containerInner.append(arrival).append("-").append(departure).append("&nbsp;&nbsp;"),containerInner.append($('<span id="fb-qs-summary-rooms" />').append($fb.quicksearch._updateMobileSummaryRooms())),$fb.quicksearch._state.accesscode&&containerInner.append("&nbsp;&nbsp;").append($('<span id="fb-qs-summary-accesscode"/>').append($fb.quicksearch._state.accesscode));var panelMenu=$fb.quicksearch._renderSummaryMobileMenu();return container.click(function(evt){evt.stopImmediatePropagation(),$fb.quicksearch._openMobileMainPanel()}),output.append(container),output.append(panelMenu),output.append($('<div id="fb-qs-mobile-summary-modal">')),output}},_renderSummaryMobileMenu:function(){var output=$('<div id="fb-qs-mobile-menu" />'),headerTitle=$('<span class="pull-left fb-qs-mobile-title fb-qs-mobile-title-general"></span>').append($.fb("crs-helper-translate",{key:"quicksearch-mobile-search-criteria"})),cancelButton=$('<span class="pull-right fb-qs-mobile-cancel" />').append($('<a href="#" />').append($.fb("crs-helper-translate",{key:"cancel-button-text"}))).click(function(evt){return evt.stopImmediatePropagation(),$fb.quicksearch._setStateFromAppState(),$fb.quicksearch._updateArrivalAndDepartureDateOnDateRangePicker($fb.quicksearch._state),$fb.quicksearch._enableScrolling(),$("#fb-qs-mobile-menu").slideUp(),$("#fb-qs-mobile-summary-modal").fadeOut(),$("#fb-quicksearch").removeClass("open"),!1}),header=$('<div class="col-xs-12" />').append(headerTitle).append(cancelButton),currItemList=[],currPanelList=[];if("group"!==$fb._state.app.step&&$fb._state.quicksearch.group&&$fb._state.app.data.groups[$fb._state.quicksearch.group]){var properties=$fb._state.app.data.groups[$fb._state.quicksearch.group].properties,currHotelTitle=$.fb("crs-helper-translate",{key:$fb.quicksearch._state.property+":hoteltitle",fallback:properties[$fb.quicksearch._state.property].title}),currHotel=$('<div id="qs-mobile-menu-item-hotel" class="qs-mobile-menu-item" />').append(currHotelTitle).click(function(evt){$fb.quicksearch._initMenuItemWhenClicked(evt),$("#qs-hotels-list div[data-hid]").each(function(){$(this).removeClass("isSelected")}),$('#qs-hotels-list div[data-hid="'+$fb.quicksearch._state.property+'"]').addClass("isSelected"),showSlidingUp($("#fb-qs-mobile-panel-hotels"))}),hotelsPanel=$fb.quicksearch._renderMobilePanelContainer("hotels");currItemList.push(currHotel),currPanelList.push(hotelsPanel)}var arrival=$('<span id="fb-qs-mobile-summary-dates-arrival">').append($.fb("crs-helper-date",{date:$fb.quicksearch._state.arrival,format:"short"})),departure=$('<span id="fb-qs-mobile-summary-dates-departure">').append($.fb("crs-helper-date",{date:$fb.quicksearch._state.departure,format:"short"})),currDates=$('<div id="qs-mobile-menu-item-dates" class="qs-mobile-menu-item" />').append(arrival).append("-").append(departure).click(function(evt){$fb.quicksearch._initMenuItemWhenClicked(evt),$("#fb-qs-mobile-panel-dates .panel-content").trigger("click"),showSlidingUp($("#fb-qs-mobile-panel-dates"))}),datesPanel=$fb.quicksearch._renderMobilePanelContainer("dates");currItemList.push(currDates),currPanelList.push(datesPanel);var currRooms=$('<div id="qs-mobile-menu-item-rooms" class="qs-mobile-menu-item" />');currRooms.click($fb.quicksearch._openMobileRoomPanel);var roomsPanel=$fb.quicksearch._renderMobilePanelContainer("rooms");currItemList.push(currRooms),currPanelList.push(roomsPanel);var currPromo=$('<form id="qs-mobile-menu-item-accesscode" class="qs-mobile-menu-item" />'),inputPromo=$('<input type="search" id="accesscode-input" />').val($fb.quicksearch._state.accesscode);currPromo.append(inputPromo);var scrollMax=function(){var panelContentMaxHeight=$(window).height()-82;$(".qs-mobile-menu-items").css("max-height",panelContentMaxHeight+"px"),$(".qs-mobile-menu-items").scrollTop(1e3)};inputPromo.on("focus",function(){$(window).on("resize",scrollMax)}),inputPromo.on("blur",function(){$(".qs-mobile-menu-items").css("max-height",""),$(window).off("resize",scrollMax)}),currPromo.on("submit",function(e){e.preventDefault(),applyBtn.click()}),currItemList.push(currPromo);var content=$('<div class="col-xs-12 qs-mobile-menu-items"/>');$.each(currItemList,function(){content.append(this)});var applyBtn=$('<div class="fb-qs-mobile-action-button fb-action fb-font-bold theme-btn" />').append($.fb("crs-helper-translate",{key:"quicksearch-apply-criterias"})).click(function(evt){$fb.quicksearch._state.accesscode=inputPromo.val().trim(),evt.stopImmediatePropagation(),$("#fb-qs-mobile-summary-modal").fadeOut(),$("#fb-qs-mobile-menu").slideUp($fb.quicksearch._applyCriteria),$("#fb-quicksearch").removeClass("open")});return output.append(header).append(content).append($('<div class="clearfix"/>')).append(applyBtn),$.each(currPanelList,function(){output.append(this)}),output.hide()},_renderMobilePanelContainer:function(type){var panelKeyTitle="",content=$('<div class="panel-content" />');switch(type){case"hotels":panelKeyTitle="quicksearch-mobile-panel-title-hotels",content.append($fb.quicksearch._renderHotelsPanel());break;case"dates":panelKeyTitle=null,content.css("margin","0"),$fb.quicksearch._renderDateRangePickerPanel(content);break;case"rooms":panelKeyTitle="quicksearch-mobile-panel-title-rooms";var innerPanel=$('<div id="fb-qs-rooms"/>');innerPanel.append($fb.quicksearch.occupancySelection.render()),content.append(innerPanel)}var title=$('<div class="pull-left fb-qs-mobile-title" />').append($.fb("crs-helper-translate",{key:panelKeyTitle})),cancelCross=$('<div id="fb-qs-cancel-'+type+'" class="pull-right" />').append('<img src="/images/pictos/icon-cross-close-white.png"/>');cancelCross.click(function(evt){evt.stopImmediatePropagation(),$fb.quicksearch._updateArrivalAndDepartureDateOnDateRangePicker($fb.quicksearch._stateBackup);var panelId=$(this)[0].id.slice(13);return hideSlidingDown($("#fb-qs-mobile-panel-"+panelId)),$fb.quicksearch._enableScrolling(),$fb.quicksearch._state=$.extend(!0,{},$fb.quicksearch._stateBackup),!($fb.quicksearch._stateBackup={})});var header=$('<div style="margin: 0px 10px"/>').append(title).append(cancelCross).append($('<div class="clearfix" />')),container=$("<div />",{class:-1!==["promocode","rooms"].indexOf(type)?"panel-with-ok-button":""}).append(header).append(content),output=$('<div id="fb-qs-mobile-panel-'+type+'"/>').append(container);return"hotels"!==type&&output.append($fb.quicksearch._renderValidateButton(type)),output.hide()},_updateMobileSummaryRooms:function(){var nbRooms=$fb.quicksearch._state.occupancy.length,summaryAdultsCount=$fb.quicksearch._state.occupancy.reduce(function(count,room){return count+room.nbAdults},0),summaryChildrenCount=$fb.quicksearch._state.occupancy.reduce(function(count,room){return count+room.nbChildren},0),output=$("<span />").append($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{key:"room"}),mode:nbRooms,placeholders:[nbRooms]})).append("&nbsp;").append($.fb("crs-helper-translate",{key:"adult",mode:summaryAdultsCount,placeholders:[summaryAdultsCount]}));return 0<summaryChildrenCount&&(output.append("&nbsp;"),output.append($.fb("crs-helper-translate",{key:"child",mode:summaryChildrenCount,placeholders:[summaryChildrenCount]}))),output},_renderValidateButton:function(type){var button=$('<div id="fb-qs-mobile-validate-button-'+type+'" class="fb-qs-button fb-action fb-font-bold fix-bottom theme-btn" />').append($.fb("crs-helper-translate",{key:"OK"}));return button.click(function(evt){evt.stopImmediatePropagation();var typeId=$(this)[0].id.slice(29);"rooms"!==type||$fb.quicksearch.occupancySelection.isSelectionValid()?$fb.quicksearch._applyMobileTempMenuValues(typeId):$fb.quicksearch.occupancySelection.showErrors()}),button},_closeHotelsMobilePanelAndUpdateMenu:function(){$fb.quicksearch._displayCurrentStateHotelOnMobileMenu(),$fb.quicksearch._enableScrolling(),hideSlidingDown($("#fb-qs-mobile-panel-hotels"))},_displayCurrentStateHotelOnMobileMenu:function(){var hid=$fb.quicksearch._state.property;if(void 0!==hid){var properties=$fb._state.app.data.groups[$fb._state.quicksearch.group].properties;$("#qs-mobile-menu-item-hotel").html($.fb("crs-helper-translate",{key:hid+":hoteltitle",fallback:properties[hid].title}))}else $("#qs-mobile-menu-item-hotel").html($.fb("crs-helper-translate",{key:"quicksearch-all"}))},_applyMobileTempMenuValues:function(type){switch(type){case"dates":$fb.quicksearch._state.isEndDatePending&&($fb.quicksearch._state.departure=moment($fb.quicksearch._state.arrival).add(1,"day").format("YYYY-MM-DD"),$fb.quicksearch._state.isEndDatePending=!1),$("#fb-qs-mobile-summary-dates-arrival").html($.fb("crs-helper-date",{date:$fb.quicksearch._state.arrival,format:"short"})),$("#fb-qs-mobile-summary-dates-departure").html($.fb("crs-helper-date",{date:$fb.quicksearch._state.departure,format:"short"}));break;case"rooms":$("#qs-mobile-menu-item-rooms").html($fb.quicksearch._updateMobileSummaryRooms(!0));break;case"promocode":if($fb.quicksearch._state.accesscode=$("#accesscode-input").val().trim(),0<$fb.quicksearch._state.accesscode.length)$("#qs-mobile-menu-item-accesscode input").val($fb.quicksearch._state.accesscode);else{var placeholder=$.fb("crs-helper-translate",{key:"quicksearch-input-label-promo-code"})[0].innerText;$("#qs-mobile-menu-item-accesscode input").attr("placeholder",placeholder)}}$fb.quicksearch._enableScrolling(),hideSlidingDown($("#fb-qs-mobile-panel-"+type))},_setStateFromAppState:function(){$fb.quicksearch._state=$.extend(!0,{},_.pick($fb._state.quicksearch,["occupancy","arrival","departure","accesscode","property"]))},_initMenuItemWhenClicked:function(evt){evt.stopImmediatePropagation(),$fb.quicksearch._stateBackup=$.extend(!0,{},$fb.quicksearch._state),$fb.quicksearch._disableScrolling()},_disableScrolling:function(){var current=$(window).scrollTop();$(window).scroll(function(){$(window).scrollTop(current)})},_enableScrolling:function(){$(window).off("scroll")},_renderSummary:function(){if("init"!==$fb._state.app.step){var summary=$('<div id="fb-qs-summary" class="col-xs-12" />');return"group"!==$fb._state.app.step&&$fb._state.quicksearch.group?(summary.append($fb.quicksearch._renderSummaryHotels()),$("#fb-quicksearch").addClass("quicksearch--with-hotel-selection")):$("#fb-quicksearch").removeClass("quicksearch--with-hotel-selection"),summary.append($fb.quicksearch._renderSummaryDates()),summary.append($fb.quicksearch._renderSummaryRooms()),summary.append($fb.quicksearch._renderSummaryPromocode()),$fb._state.quicksearch.property&&$fb._state.app.data.properties[$fb._state.quicksearch.property]&&$fb._state.app.data.properties[$fb._state.quicksearch.property].bookingEngineFrontend&&$fb._state.app.data.properties[$fb._state.quicksearch.property].bookingEngineFrontend.results.displayQuotationFilter&&summary.append($fb.quicksearch._renderFilters()),summary}},_renderSummaryHotels:function(){var output=$('<span class="fb-qs-summary-hotels-parent"/>');if(void 0===$fb._state.app.data.groups[$fb._state.quicksearch.group])return output;var properties=$fb._state.app.data.groups[$fb._state.quicksearch.group].properties,summary=$('<span id="fb-qs-summary-hotels" class="quicksearch-summary pull-left ellipsis" />');summary.append($('<i class="fa fa-home fb-quicksearch--icon theme-link" aria-hidden="true"></i>'));var currHotelTitle=$.fb("crs-helper-translate",{key:$fb.quicksearch._state.property+":hoteltitle",fallback:properties[$fb.quicksearch._state.property].title}).text();summary.append("<span>"+currHotelTitle+"</span>").append($('<span class="separator" />')).click(function(){$("#fb-qs-panel-hotels").is(":visible")?($fb.quicksearch._closeAllPanelsBut(),$fb.quicksearch._updateIsActiveClass()):($fb.quicksearch._closeAllPanelsBut("hotels"),$fb.quicksearch._updateIsActiveClass("hotels"),$("#fb-qs-panel-hotels").show())});var panel=$('<div id="fb-qs-panel-hotels" class="quicksearch-panel theme-quicksearch-panel" />').append($fb.quicksearch._renderHotelsPanel());return panel.hide(),output.append(summary).append(panel),output},_renderSummaryDates:function(){var output=$('<span class="fb-qs-summary-dates-parent"/>'),summary=$('<span id="fb-qs-summary-dates" class="quicksearch-summary ellipsis pull-left"/>'),arrival=$('<span id="fb-qs-summary-dates-arrival">').append($.fb("crs-helper-date",{date:$fb.quicksearch._state.arrival,format:"short"})),departure=$('<span id="fb-qs-summary-dates-departure">').append($.fb("crs-helper-date",{date:$fb.quicksearch._state.departure,format:"short"}));return summary.append($('<i class="fa fa-calendar fb-quicksearch--icon theme-link" aria-hidden="true"></i>')).append(arrival).append(" - ").append(departure).append($('<span class="separator" />')),summary.click(function(e){$(e.target).is(":visible")&&!$(e.target).parents(".daterangepicker").length&&($("#fb-qs-panel-dates").is(":visible")?($fb.quicksearch._closeAllPanelsBut(),$fb.quicksearch._updateIsActiveClass()):($fb.quicksearch._closeAllPanelsBut("dates"),$fb.quicksearch._updateIsActiveClass("dates")))}),output.append(summary),$fb.quicksearch._renderDateRangePickerPanel(summary),output},_getYearFormat:function(){return"ja_JP"===$fb._state.app.locale?"YYYY":"YYYY"},_getRevertHeader:function(){return"ja_JP"===$fb._state.app.locale},_renderDateRangePickerPanel:function(parent){var maxDate=moment().add(1,"year").endOf("year").add(1,"day"),translatedCalendar=$.fb("crs-locale-culture").calendar;parent.daterangepicker({parentEl:parent,enableOutsideClick:!$fb._state.isMobile,verticalScrolling:$fb._state.isMobile,monthHeaderYearFormat:$fb.quicksearch._getYearFormat(),monthHeaderRevert:$fb.quicksearch._getRevertHeader(),locale:{format:"YYYY-MM-DD",monthNames:translatedCalendar.months.names,daysOfWeek:translatedCalendar.days.namesShort,firstDay:translatedCalendar.firstDay},rightCalendarIsHidden:$fb._state.isMobile,autoApply:!1,minDate:moment().format("YYYY-MM-DD"),startDate:$fb.quicksearch._state.arrival?$fb.quicksearch._state.arrival:moment().format("YYYY-MM-DD"),endDate:$fb.quicksearch._state.departure?$fb.quicksearch._state.departure:moment().add(1,"days").format("YYYY-MM-DD"),maxDate:maxDate.format("YYYY-MM-DD"),opens:"right",additionalClassForInvalidDate:"unavailable-date",isInvalidDate:function(date){var isSelectingEndDate=!this.endDate;return!(isSelectingEndDate||!date.isSame(maxDate,"day"))||!(!isSelectingEndDate||!date.isSame($fb.quicksearch._state.arrival,"day"))},isCustomDate:function(date){if(!this.endDate&&this.startDate&&this.startDate.isSame(date.clone().subtract(1,"days"),"day"))return["day-after-arrival"]}}),parent.addClass("hasDateRangePicker"),parent.on("showCalendar.daterangepicker",function(){$fb._state.isMobile||$("#fb-quicksearch .daterangepicker").children(".fb-qs-datepicker-footer").remove().end().append($('<div class="fb-qs-datepicker-footer col-md-6 col-md-offset-6"></div>').append($fb.quicksearch._renderDatePickerCancelAndApplyButtons())),$fb.quicksearch._state&&$fb.quicksearch._state.arrival,$fb.quicksearch._updateNbNights($fb.quicksearch._state.arrival,$fb.quicksearch._state.departure),$fb.quicksearch._state.isEndDatePending=!1;var themeClass=$fb._state.app.data.properties&&$fb.quicksearch._state.property&&$fb._state.app.data.properties[$fb.quicksearch._state.property]&&"dark"===$fb._state.app.data.properties[$fb.quicksearch._state.property].bookingEngineFrontend.header.toolbar.theme?"theme-dark":"";$("#fb-quicksearch .daterangepicker").addClass("theme-quicksearch-panel").addClass(themeClass).addClass("theme-calendar")}).on("updateCalendars.daterangepicker",function(){$.each($("#fb-quicksearch .daterangepicker .calendar table tbody tr:first-child, #fb-quicksearch .daterangepicker .calendar table tbody tr:last-child"),function(){var rowShouldBeInvisible=!0;$(this).find("td").each(function(){if(!$(this).hasClass("day-of-other-month"))return rowShouldBeInvisible=!1}),rowShouldBeInvisible&&$(this).addClass("hide")})}).on("clickStartDate.daterangepicker",function(evt,startDate){$fb.quicksearch._state.isEndDatePending=!0,$fb.quicksearch._state.arrival=startDate.format("YYYY-MM-DD"),$fb._state.isMobile||$fb.quicksearch._updateSummaryDates($fb.quicksearch._state.arrival)}).on("clickEndDate.daterangepicker",function(evt,endDate){$fb.quicksearch._state.isEndDatePending=!1,$fb.quicksearch._state.departure=endDate.format("YYYY-MM-DD"),$fb.quicksearch._updateNbNights($fb.quicksearch._state.arrival,$fb.quicksearch._state.departure),$fb._state.isMobile||$fb.quicksearch._updateSummaryDates($fb.quicksearch._state.arrival,$fb.quicksearch._state.departure)}).on("hoverDate.daterangepicker",function(evt,date){$fb.quicksearch._state.isEndDatePending&&(moment(date).isAfter(moment($fb.quicksearch._state.arrival))||moment(date).isSame(moment($fb.quicksearch._state.arrival))?$fb.quicksearch._updateNbNights($fb.quicksearch._state.arrival,date):$fb.quicksearch._updateNbNights($fb.quicksearch._state.arrival,$fb.quicksearch._state.arrival))}).on("hide.daterangepicker",function(){$fb.quicksearch._state.isEndDatePending=!1,$fb.quicksearch._updateIsActiveClass(),$fb._state.isMobile||($fb.quicksearch._updateSummaryDates($fb.quicksearch._state.arrival,$fb.quicksearch._state.departure),$fb.quicksearch._updateArrivalAndDepartureDateOnDateRangePicker($fb.quicksearch._state))})},_updateSummaryDates:function(arrivalDate,departureDate){arrivalDate?departureDate?($("#fb-qs-summary-dates-arrival").html($.fb("crs-helper-date",{date:arrivalDate,format:"short"})),$("#fb-qs-summary-dates-departure").html($.fb("crs-helper-date",{date:departureDate,format:"short"})).removeClass("invisible")):($("#fb-qs-summary-dates-arrival").html($.fb("crs-helper-date",{date:arrivalDate,format:"short"})),$("#fb-qs-summary-dates-departure").addClass("invisible")):$("#fb-qs-summary-dates-departure").html($.fb("crs-helper-date",{date:departureDate,format:"short"})).removeClass("invisible")},_renderSummaryRooms:function(){var nbRooms=$fb.quicksearch._state.occupancy.length,summaryAdultsCount=$fb.quicksearch._state.occupancy.reduce(function(count,room){return count+room.nbAdults},0),summaryChildrenCount=$fb.quicksearch._state.occupancy.reduce(function(count,room){return count+room.nbChildren},0),output=$('<span class="fb-qs-summary-parent"/>'),summary=$('<span id="fb-qs-summary-rooms" class="quicksearch-summary ellipsis pull-left" />'),defKeyLabel=1<nbRooms?"room:several":"room:single";summary.append($('<i class="fa fa-users fb-quicksearch--icon theme-link" aria-hidden="true"></i>')).append($('<span id="fb-qs-summary-rooms-quantity"></span>').append($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{key:defKeyLabel}),placeholders:[nbRooms]}))).append(", ").append($('<span id="fb-qs-summary-rooms-adults"></span>').append($.fb("crs-helper-translate",{key:"adult",mode:summaryAdultsCount,placeholders:[summaryAdultsCount]}))),0<summaryChildrenCount&&summary.append($('<span id="fb-qs-summary-rooms-children"></span>').append(", ").append($.fb("crs-helper-translate",{key:"child",mode:summaryChildrenCount,placeholders:[summaryChildrenCount]}))),summary.append($('<span class="separator" />'));var panel=$fb.quicksearch._renderRoomsPanel();return panel.hide(),summary.click(function(){$("#fb-qs-panel-rooms").is(":visible")?($fb.quicksearch._closeAllPanelsBut(),$fb.quicksearch._updateIsActiveClass()):$fb.quicksearch.openRoomsPanel()}),output.append(summary),output.append(panel),output},_openMobileMainPanel:function(cb,speed){$("#accesscode-input").val($fb.quicksearch._state.accesscode),$fb.quicksearch._setStateFromAppState(),"group"!==$fb._state.app.step&&$fb._state.quicksearch.group&&$fb.quicksearch._displayCurrentStateHotelOnMobileMenu(),$fb.quicksearch._applyMobileTempMenuValues("dates"),$fb.quicksearch._applyMobileTempMenuValues("rooms"),$fb.quicksearch._applyMobileTempMenuValues("promocode"),$("#fb-qs-mobile-menu").slideDown(speed,cb),$("#fb-qs-mobile-summary-modal").fadeIn(),$("#fb-quicksearch").addClass("open")},_openMobileRoomPanel:function(evt){$fb.quicksearch._initMenuItemWhenClicked(evt),$("#fb-qs-rooms").html($fb.quicksearch._renderRooms()),showSlidingUp($("#fb-qs-mobile-panel-rooms"))},openRoomsPanel:function(){$fb._state.isMobile?$fb.quicksearch._openMobileMainPanel(function(){$fb.quicksearch._openMobileRoomPanel(new Event("click"))},200):($fb.quicksearch._closeAllPanelsBut("rooms"),$fb.quicksearch._updateIsActiveClass("rooms"),$("#fb-qs-rooms").html($fb.quicksearch._renderRooms()),$("#fb-qs-panel-rooms").show())},_updateSummaryRooms:function(){var nbRooms=$fb.quicksearch._state.occupancy.length,summaryAdultsCount=$fb.quicksearch._state.occupancy.reduce(function(count,room){return count+room.nbAdults},0),summaryChildrenCount=$fb.quicksearch._state.occupancy.reduce(function(count,room){return count+room.nbChildren},0);if($("#fb-qs-summary-rooms-quantity").html($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{key:"room"}),mode:nbRooms,placeholders:[nbRooms]})),$("#fb-qs-summary-rooms-adults").html($.fb("crs-helper-translate",{key:"adult",mode:summaryAdultsCount,placeholders:[summaryAdultsCount]})),0<summaryChildrenCount){var childrenData=$("<span/>").append(", ").append($.fb("crs-helper-translate",{key:"child",mode:summaryChildrenCount,placeholders:[summaryChildrenCount]}));$("#fb-qs-summary-rooms-children").html(childrenData)}},_renderSummaryPromocode:function(){var output=$('<span class="fb-qs-summary-accesscode--container" />'),content=$('<span id="fb-qs-summary-accesscode" class="quicksearch-summary pull-left" />');content.append($('<i class="fa fa-percent fb-quicksearch--icon theme-link" aria-hidden="true"></i>'));var label=$.fb("crs-helper-translate",{key:"quicksearch-input-label-promo-code"})[0].innerText;return content.append($('<input type="text" id="accesscode-input" placeholder="'+label+'" class="ellipsis" name="accesscode" />').val($fb.quicksearch._state.accesscode).focus(function(){$(this).context.placeholder="",$fb.quicksearch._closeAllPanelsBut("promo"),$fb.quicksearch._updateIsActiveClass("promo")}).blur(function(){$(this).context.placeholder=label,$fb.quicksearch._state.accesscode=$(this).val().trim(),$fb.quicksearch._updateIsActiveClass(),$fb.quicksearch._applyCriteria(!0)}).keydown(function(e){$(this).context.placeholder=label,$fb.quicksearch._state.accesscode=$(this).val().trim(),13===e.keyCode&&$fb.quicksearch._applyCriteria()})),content.append($('<span class="separator" />')),output.append(content),output.click(function(){$("#accesscode-input").focus()}),output},_translatePromocodePlaceholder:function(){$("#accesscode-input").prop("placeholder",$.fb("crs-helper-translate",{key:"quicksearch-input-label-promo-code"})[0].innerText)},_renderFilters:function(){var output=$('<span class="fb-qs-summary-filters--container" />'),content=$('<span id="fb-qs-summary-filters" class="quicksearch-summary ellipsis pull-left" />');content.append($('<i class="fa fa-sliders fb-quicksearch--icon theme-link" aria-hidden="true"></i>')),content.append($.fb("crs-helper-translate",{key:"group-filters"})),output.append(content);var panel=$fb.resultsFilter.render();return panel.addClass("quicksearch-panel theme-quicksearch-panel"),panel.hide(),output.append(panel),content.click(function(){$("#fb-results-filter-container").is(":visible")?($fb.quicksearch._closeAllPanelsBut(),$fb.quicksearch._updateIsActiveClass()):($("#fb-results-filter-container").css("display","block"),$fb.quicksearch._closeAllPanelsBut("filters"),$fb.quicksearch._updateIsActiveClass("filters"))}),output},closeAllPanels:function(){$fb.quicksearch._updateIsActiveClass(""),$fb.quicksearch._closeAllPanelsBut("")},_renderHotelsPanel:function(){var properties=$fb._state.app.data.groups[$fb._state.quicksearch.group].properties,hotels=$('<div id="qs-hotels-list"/>'),propLine=$("<div/>").append($.fb("crs-helper-translate",{key:"quicksearch-all"}));return propLine.click(function(evt){if(evt.stopImmediatePropagation(),$fb.quicksearch._state.property=void 0,!$fb._state.isMobile)return $fb.quicksearch._applyCriteria();$fb.quicksearch._closeHotelsMobilePanelAndUpdateMenu()}),hotels.append(propLine),$.each(properties,function(id,prop){if(!$fb._state.isMobile&&prop.property===$fb.quicksearch._state.property)return!0;var propLine=$('<div data-hid="'+prop.property+'"/>').append($.fb("crs-helper-translate",{key:prop.property+":hoteltitle",fallback:prop.title})[0]);propLine.click(function(evt){if(evt.stopImmediatePropagation(),$fb.quicksearch._state.property=$(this).data("hid"),!$fb._state.isMobile)return $fb.quicksearch._applyCriteria();$fb.quicksearch._closeHotelsMobilePanelAndUpdateMenu()}),hotels.append(propLine)}),hotels},getOccupancySelectionConfiguration:function(){return{maxAdults:$fb._state.quicksearch.configuration.maxAdults,maxChildren:$fb._state.quicksearch.configuration.maxChildren,maxPersons:$fb._state.quicksearch.configuration.maxPersons,childrenMaxAge:$fb._state.quicksearch.configuration.childrenMaxAge,needChildrenAges:$fb._state.quicksearch.configuration.needChildrenAges}},getOccupancySelectionSelection:function(){return this._getOccupancySelectionSelection()},setAccessCode:function(code){$fb.quicksearch._state.accesscode=code,this._applyCriteria()},setOccupancySelectionSelection:function(selection){$fb.quicksearch._state.occupancy=selection,this._applyCriteria()},_getOccupancySelectionSelection:function(){return $fb.quicksearch._state.occupancy},_renderRooms:function(){var selection=this._getOccupancySelectionSelection();$fb.quicksearch.occupancySelection.setConfiguration(this.getOccupancySelectionConfiguration()).setSelection(selection)},_renderRoomsPanel:function(){var panel=$('<div id="fb-qs-panel-rooms" class="quicksearch-panel theme-quicksearch-panel" style="width:100%; max-width:360px" />'),innerPanel=$('<div id="fb-qs-rooms"/>');return panel.append(innerPanel),innerPanel.append($fb.quicksearch.occupancySelection.render()),panel},_renderDatePickerCancelAndApplyButtons:function(){var container=$('<div class="fb-qs-apply-cancel-container" />'),applyButton=$('<div class="fb-qs-button fb-action fb-font-bold theme-btn fb-qs-apply" />').append($.fb("crs-helper-translate",{key:"quicksearch-apply-criterias"})),cancelButton=$('<a class="theme-link fb-qs-cancel" href="javascript:void(0)" />').append($.fb("crs-helper-translate",{key:"cancel-button-text"}));return applyButton.click(function(event){event.stopImmediatePropagation(),$fb.quicksearch._state.isEndDatePending&&($fb.quicksearch._state.departure=moment($fb.quicksearch._state.arrival).add(1,"day").format("YYYY-MM-DD"),$fb.quicksearch._state.isEndDatePending=!1),$("#fb-qs-panel-rooms").hide(),$fb.quicksearch._applyCriteria(),$fb.quicksearch._updateSummaryRooms(),$("#fb-qs-summary-dates").data("daterangepicker").hide()}),cancelButton.click(function(event){event.stopImmediatePropagation(),$fb.quicksearch._closeAllPanelsBut(),$fb.quicksearch._updateIsActiveClass(),$("#fb-qs-summary-dates").data("daterangepicker").hide()}),container.append($("<div></div>").append(cancelButton),$("<div></div>").append(applyButton))},removePromoCode:function(){delete $fb.quicksearch._state.accesscode,$("#accesscode-input").val("")},addClickListenersForClosingPanels:function(){$(document).mousedown(function(evt){$(evt.target).is(":visible")&&$(evt.target).closest("#fb-quicksearch .quicksearch-summary").length<1&&$(evt.target).closest("#fb-quicksearch .quicksearch-panel").length<1&&$(evt.target).closest("#fb-quicksearch .daterangepicker").length<1&&$(evt.target).closest("#fb-quicksearch .prev").length<1&&$(evt.target).closest("#fb-quicksearch .next").length<1&&$(evt.target).closest("#fb-quicksearch .ui-datepicker-prev").length<1&&$(evt.target).closest("#fb-quicksearch .ui-datepicker-next").length<1&&($fb._triggerEvent("quicksearch-close-all-panels"),$fb.quicksearch._closeAllPanelsBut(),$fb.quicksearch._updateIsActiveClass())})},_closeAllPanelsBut:function(currentPanelName){$fb.quicksearch._setStateFromAppState(),"hotels"!==currentPanelName&&$("#fb-qs-panel-hotels").hide(),"rooms"!==currentPanelName&&$("#fb-qs-panel-rooms").hide(),"promo"!==currentPanelName&&$("#fb-qs-summary-accesscode").trigger("blur"),"filters"!==currentPanelName&&$("#fb-results-filter-container").hide()},_updateIsActiveClass:function(currentPanelName){$(".quicksearch-summary").parent().removeClass("isActive"),$(".quicksearch-panel").parent().removeClass("isActive"),"hotels"===currentPanelName&&($("#fb-qs-summary-hotels").parent().addClass("isActive"),$("#fb-qs-panel-hotels").parent().addClass("isActive")),"dates"==currentPanelName&&($("#fb-qs-summary-dates").parent().addClass("isActive"),$("#fb-qs-panel-dates").parent().addClass("isActive")),"rooms"===currentPanelName&&($("#fb-qs-summary-rooms").parent().addClass("isActive"),$("#fb-qs-panel-rooms").parent().addClass("isActive")),"promo"===currentPanelName&&$("#fb-qs-summary-accesscode").parent().addClass("isActive"),"filters"===currentPanelName&&$("#fb-qs-summary-filters").parent().addClass("isActive")},_updateNbNights:function(arrival,departure){if(moment(arrival).isValid()&&moment(departure).isValid()){var arrivalMoment=moment(arrival),departureMoment=moment(departure),nbdays=Math.abs(departureMoment.diff(arrivalMoment,"days"));0===nbdays&&(nbdays=1),$("#nbnights").html($.fb("crs-helper-translate",{key:"night",mode:nbdays,placeholders:[nbdays]}).html())}},_changeStepAndReloadPage:function(step){$fb._ChangeAppStep(step),$fb._addHistory(),window.location.reload()},_applyCriteria:function(noNeedToRenderTheQuicksearch){var cleanCurrentState=$fb.quicksearch._getCleanedState(),propertyHasChanged=cleanCurrentState.property!==$fb._state.quicksearch.property;if(_.each(cleanCurrentState,function(value,key){$fb._state.quicksearch[key]=_.clone(value)}),$fb._storeState(),propertyHasChanged)return $fb.log("changed property selection "+$fb._state.quicksearch.property),$fb._triggerEvent("fastbooking-crs-frontend-emptySelection"),$fb.quicksearch._changeStepAndReloadPage($fb._state.quicksearch.property?"results":"group");if("group"===$fb._state.app.step)return $fb._triggerEvent("fastbooking-crs-frontend-quicksearch-update"),noNeedToRenderTheQuicksearch||$fb._triggerEvent("fastbooking-crs-frontend-quicksearch-render"),void $fb._addHistory();for(var i=$fb.selection.nbRooms()-1;i>=$fb._state.quicksearch.occupancy.length;i--)$fb.selection.removePackage(i);return $fb.selection.isCompatibleWithGivenState($fb._state.quicksearch)?["extras","validate-collect"].includes($fb._state.app.step)&&$fb._state.quicksearch.occupancy.length>$fb.selection.nbRooms()?($fb._ChangeAppStep("results"),$fb._updateHistory(),$fb._checkStep(),$fb._triggerEvent("fastbooking-crs-frontend-renderAll")):(noNeedToRenderTheQuicksearch||$fb._triggerEvent("fastbooking-crs-frontend-quicksearch-render"),$fb._triggerEvent("fastbooking-crs-frontend-results-render"),$fb._state.app.booking={},void $fb._addHistory()):$fb._triggerEvent("fastbooking-crs-frontend-emptySelection",{},function(){$fb._ChangeAppStep("results"),$fb._updateHistory(),$fb._checkStep(),$fb._triggerEvent("fastbooking-crs-frontend-renderAll")})},_getCleanedState:function(){var params={arrival:$fb.quicksearch._state.arrival,departure:$fb.quicksearch._state.departure,occupancy:$fb.quicksearch._state.occupancy,property:$fb.quicksearch._state.property,accesscode:$fb.quicksearch._state.accesscode};return $fb.log("collected form data:",params),params},_getPropertyData:function(property,group,callback){var apiConfig={};return group?"function"!=typeof callback||callback():property?(apiConfig.c="property",apiConfig.property=property,$fb._triggerEvent("crs-utils-configure",{k:"property",v:property}),"single"==$fb._state.app.mode&&$fb._state.app.data.properties&&$fb._state.app.data.properties[property]?"function"!=typeof callback||callback():($fb.log("property api call:",apiConfig),void $fb._triggerEvent("fastbooking-crs-frontend-load-property",{},callback))):($fb.error("properties call : no parameter"),"function"==typeof callback&&callback())},_updateArrivalAndDepartureDateOnDateRangePicker:function(state){var container=$fb._state.isMobile?$("#fb-qs-mobile-panel-dates .panel-content"):$("#fb-qs-summary-dates");container.data("daterangepicker").setStartDate(moment(state.arrival)),container.data("daterangepicker").setEndDate(moment(state.departure)),$fb.quicksearch._refreshDateRangePicker()},_refreshDateRangePicker:function(){$fb._state.isMobile?($("#fb-quicksearch .daterangepicker").trigger("hoverDate.daterangepicker"),$("#fb-qs-mobile-panel-dates .panel-content").data("daterangepicker")&&$("#fb-qs-mobile-panel-dates .panel-content").data("daterangepicker").updateCalendars()):($("#fb-qs-summary-dates").trigger("hoverDate.daterangepicker"),$("#fb-qs-summary-dates").data("daterangepicker")&&$("#fb-qs-summary-dates").data("daterangepicker").updateCalendars())}}}),$(document).on("fastbooking-crs-frontend-quicksearch-init",$fb.quicksearch.init),$(document).on("fastbooking-crs-close-results-filter",$fb.quicksearch.closeAllPanels),$(document).on("fastbooking-crs-frontend-quicksearch-render",$fb.quicksearch.render),$(document).on("fastbooking-crs-frontend-load-group-done",$fb.quicksearch.render),$(document).on("crs-locale-changed",function(){$fb.quicksearch._translatePromocodePlaceholder(),$(".hasDateRangePicker").length&&$fb.quicksearch._renderDateRangePickerPanel($(".hasDateRangePicker")),$("#fb-qs-summary-dates-arrival .fb-date").length&&$.fb("crs-helper-date",$("#fb-qs-summary-dates-arrival .fb-date")),$("#fb-qs-summary-dates-departure .fb-date").length&&$.fb("crs-helper-date",$("#fb-qs-summary-dates-departure .fb-date"))})}(window.jQuery,window.$fb.underscore),function(global){function EventEmitter(){}EventEmitter.prototype={_getEventDispatcher:function(){return this._$||(this._$=$(this)),this._$},on:function(eventName,handler){return this._getEventDispatcher().on(eventName,handler),this},off:function(eventName,handler){return this._getEventDispatcher().off(eventName,handler),this},one:function(eventName,handler){return this._getEventDispatcher().one(eventName,handler),this},trigger:function(eventName,extraParameters){return this._getEventDispatcher().trigger(eventName,extraParameters),this}},global.EventEmitter=EventEmitter}(window),function($,_){function PropertyService(){}PropertyService.prototype={get:function(hid){var propertyFromData=this._getPropertyFromAppData(hid);return propertyFromData?Promise.resolve(propertyFromData):this._loadProperty(hid)},getLocalDateTime:function(property){var offset=property.location.timezone;if(offset){var parsedOffset="UTC"===offset?null:offset.replace("UTC","").split(":").concat([0]).map(function(value){return parseInt(value,10)}),offsetInMinutes=parsedOffset?60*parsedOffset[0]+parsedOffset[0]:0;return moment().utcOffset(offsetInMinutes)}},getFooterLinksToShow:function(property){var config=property.bookingEngineFrontend.footer;return config.showLinks?config.links.filter(function(link){return link.defaultText&&(link.hyperlink||link.defaultHyperlink)}):[]},getNoteIfAvailable:function(property,arrivalDate,departureDate){var note=property.note||{enabled:!1};if(void 0===note.enabled||note.enabled){var noteFromDate=$.fb("crs-helper-parsedate",{date:note.from}),noteToDate=$.fb("crs-helper-parsedate",{date:note.to});if(arrivalDate=$.fb("crs-helper-parsedate",{date:arrivalDate}),departureDate=$.fb("crs-helper-parsedate",{date:departureDate}),noteFromDate<=arrivalDate&&departureDate<=noteToDate){var translateKey=property.property+":hotelnote";if($.fb("crs-helper-translate",{key:translateKey,fallback:note.message}).html()!==translateKey)return{message:note.message,i18nKey:translateKey}}}},_getPropertyFromAppData:function(hid){return _($fb._state.app.data.groups).map(function(group){return group.properties}).concat($fb._state.app.data.properties).reduce(function(list,items){return _.extend(list,items)},{})[hid]},_loadProperty:function(hid){var self=this;return new Promise(function(resolve){$(document).on("fastbooking-crs-frontend-load-property-done",function checkAndResolveProperty(){var property=self._getPropertyFromAppData(hid);if(!property)return;$(document).off("fastbooking-crs-frontend-load-property-done",checkAndResolveProperty);resolve(property)}),$.fb("fastbooking-crs-frontend-load-property",{property:hid})})}},window.$fb.propertyService=new PropertyService}(window.jQuery,window.$fb.underscore),function($){function BannerRenderer(){}BannerRenderer.prototype={getBannerBaseImage:function(propertyData){var propertyImages=propertyData.images||[],banner=propertyData.banner||{propertyImageIndex:0};return-1===banner.propertyImageIndex&&banner.image?banner.image:propertyImages[banner.propertyImageIndex]?propertyImages[banner.propertyImageIndex]:propertyImages[0]},setHeaderImage:function(propertyData){var $header=$("#fb-header");if(!$header.hasClass("background-set")){var coverBaseImg=this.getBannerBaseImage(propertyData);if(coverBaseImg){var _headerHeight=$header.height(),_headerWidth=$header.width(),_headerRatio=_headerWidth/_headerHeight;_headerRatio<6.4?_headerWidth=Math.round(_headerWidth/_headerRatio*6.4):_headerHeight=Math.round(_headerHeight/_headerRatio*6.4);var offsetx=propertyData.banner&&propertyData.banner.x?propertyData.banner.x:0,offsety=propertyData.banner&&propertyData.banner.y?propertyData.banner.y:0;propertyData.banner&&propertyData.banner.width&&(_headerWidth=Math.round(propertyData.banner.width),_headerHeight=Math.round(_headerWidth/6.4));var imageHelperOptions={src:coverBaseImg.url,width:_headerWidth,height:_headerHeight,offsetx:offsetx,offsety:offsety,onlySrc:!0};imageHelperOptions.width&&imageHelperOptions.height&&(imageHelperOptions.crop=!0);var coverImgUrl=$.fb("crs-helper-image",imageHelperOptions);$header.css("background-image","url("+coverImgUrl+")").css("background-repeat","no-repeat").addClass("background-set")}}}},window.$fb.bannerRenderer=new BannerRenderer}(window.jQuery),function($,_){function RedirectionService(){}RedirectionService.prototype={_getRedirectionBaseUrl:function(){var redirectionBaseUrl=$fb._config.redirection;return"//"===redirectionBaseUrl.substr(0,2)&&(redirectionBaseUrl=location.protocol+redirectionBaseUrl),redirectionBaseUrl=redirectionBaseUrl.replace(/\/?$/,"/dispoprice.phtml"),new URL(redirectionBaseUrl)},factoryUrl:function(redirectionParams){var redirectionUrl=this._getRedirectionBaseUrl();return _(redirectionParams).forEach(function(value,key){redirectionUrl.searchParams.set(key,value)}),redirectionUrl.toString()},factoryPropertyUrl:function(property,redirectionParams){return this.factoryUrl(_.extend({HotelName:property.propertyCodes.connectName},redirectionParams))}},window.$fb.redirectionService=new RedirectionService}(window.jQuery,window.$fb.underscore),function($,_){var containersMap={};function StorageContainer(key){if("string"!=typeof key)throw new Error("Expected string key");this._key=key,containersMap[key]||(containersMap[key]=[]),containersMap[key].push(this)}StorageContainer.prototype=_.extend({save:function(value){var previousValue=this.load();if(void 0===value?$fb.storage.remove(this._key):$fb.storage.save(this._key,JSON.stringify(value)),previousValue!==value){var event=$.Event("change");event.previousValue=previousValue,event.value=value,function(key,event){containersMap[key].forEach(function(container){container.trigger(event)})}(this._key,event)}},load:function(){var storage=$fb.storage.load(this._key);if(storage)return JSON.parse(storage)}},EventEmitter.prototype),window.$fb.StorageContainer=StorageContainer}(window.jQuery,window.$fb.underscore),function(){var loyaltyInterface=["on","off","one","constructor","destroy","getSteps","getBuyerFieldsToDisable","getCode","getQuotationParams","getWidgetQuotationParams","getView","isLogged","getBookingContext","getAlternateCurrency","getType","getMemberId","getMember","getLoyaltyToken","getDisplayProperties","clone"];window.$fb.checkLoyaltyInterface=function(loyalty){loyaltyInterface.forEach(function(expectedMethodName){"function"!=typeof loyalty[expectedMethodName]&&$fb.error("Expected loyalty method "+expectedMethodName)})}}(),function(_){var lastComponentId=-1;window.$fb.loyaltyController={create:function(loyaltyConfiguration,oneHid,storage,componentConfiguration){return new LoyaltyController(loyaltyConfiguration,oneHid,storage,componentConfiguration)}};function LoyaltyController(loyaltyConfiguration,oneHid,storage,componentConfiguration){this._id=++lastComponentId,this._loyaltyConfiguration=loyaltyConfiguration,this._componentConfiguration=componentConfiguration,this._oneHid=oneHid,this._storage=storage,this._view=$("<div/>",{class:"fb-loyalty-container"}),this._authorizationCode=null;var refreshTokenInterval=componentConfiguration.refreshTokenInterval||3e5,storageData=storage.load();this._accessKey=storageData&&storageData.accessKey,storageData||this._storage.save({}),this._refreshTokenIntervalId=setInterval(this._refreshToken.bind(this),refreshTokenInterval),this._refreshTokenEnabled=!1,this._bootstrap()}LoyaltyController.prototype=_.extend({getView:function(){return this._view},isLogged:function(){return!!this._getState().member},getSteps:function(){return["results","extras"]},getCode:function(){return this._loyaltyConfiguration.type.toUpperCase()},getType:function(){return this._loyaltyConfiguration.type.toLowerCase()},getMember:function(){return this._getState().member},getMemberId:function(){return this.isLogged()?this._getState().member.id:null},getQuotationParams:function(){return this.isLogged()?{loyaltyToken:this.getLoyaltyToken()}:null},getWidgetQuotationParams:function(){return this.isLogged()?{memberLevels:this._getState().member.level?[this._getState().member.level]:[]}:null},getAlternateCurrency:function(){return null},getBookingContext:function(){return null},getBuyerFieldsToDisable:function(){return this._getState().context.booking.disallowEditing||[]},getDisplayProperties:function(){return{displayOnlyMemberBadgeOnteasingMode:"glb"!==this.getType(),displayTotalDiscount:"glb"===this.getType()}},clone:function(){return new LoyaltyController(this._loyaltyConfiguration,this._oneHid,this._storage,this._componentConfiguration)},destroy:function(){this._view.remove(),this.off(),clearInterval(this._refreshTokenIntervalId)},getLoyaltyToken:function(){return this._getState().token},_bootstrap:function(){var initialState=this._getState(),self=this;this._storage.on("change",function(e){self._onStateChange(e.value,e.previousValue)});var contextCreationEventListener=self._trySsoLoginForNewContext.bind(self);if(self.one("context-created",contextCreationEventListener),!initialState.context||!initialState.token)return self._createContext();self._setTokenRequest(),self._refreshToken().then(function(){self.off("context-created",contextCreationEventListener);var paramsForSsoLogin=self._getPotentialSsoParams();return null===paramsForSsoLogin?self._view.empty().append(initialState.member?self._renderLoggedView():self._renderLoginView()):(paramsForSsoLogin.loyalty_authorization_code&&(this._accessKey=paramsForSsoLogin.loyalty_authorization_code,self._updateState({accessKey:this._accessKey})),initialState.member&&self._updateState({member:void 0}),self._login("sso",paramsForSsoLogin).catch(function(){self._view.empty().append(self._renderLoginView())}))}),self._refreshEvents()},_trySsoLoginForNewContext:function(){var paramsForSsoLogin=this._getPotentialSsoParams();if(null!==paramsForSsoLogin)return this._login("sso",paramsForSsoLogin).catch(function(){})},_getPotentialSsoParams:function(){var self=this,ssoDetails=this._getState().context.login.allowedMethods.find(function(method){return"sso"===method.type});if(!ssoDetails)return null;var appArgs=$fb.getUrlArgs(),urlHasChanged=!1,fetchedParams=ssoDetails.params.reduce(function(fetchedParams,paramToFetch){return"url"===paramToFetch.from&&appArgs[paramToFetch.name]?(fetchedParams[paramToFetch.name]=appArgs[paramToFetch.name],delete appArgs[paramToFetch.name],urlHasChanged=!0):"postMessage"===paramToFetch.from&&self._authorizationCode&&(fetchedParams[paramToFetch.name]=self._authorizationCode),fetchedParams},{});return urlHasChanged&&$fb.setUrlArgs(appArgs),_.size(fetchedParams)!==ssoDetails.params.length?null:fetchedParams},_onStateChange:function(currentState,previousState){currentState.member&&!previousState.member&&($fb.info("loyaltyController n "+this._id+" detects member set"),this.trigger("login"),this._view.empty().append(this._renderLoggedView())),!currentState.member&&previousState.member&&($fb.info("loyaltyController n "+this._id+" detects member unset"),this.trigger("logout"),this._view.empty().append(this._renderLoginView())),currentState.context&&!previousState.context&&($fb.info("loyaltyController n "+this._id+" detects context set"),this.trigger("context-created"),this._view.empty().append(this._renderLoginView()))},_getState:function(){return this._storage.load()},_setState:function(state){$fb.info("loyaltyController n "+this._id+" saves state "+JSON.stringify(state)),this._storage.save(state)},_updateState:function(update){this._setState(_.extend(this._getState(),update))},_createContext:function(){var self=this;return this._callApi("loyaltyCreateContext",{property:this._oneHid}).then(function(loyaltyContext){self._updateState({context:loyaltyContext})})},_refreshEvents:function(){var self=this;$(document).on("fastbooking-crs-frontend-loyalty-refresh-member",function(){if("MID"===self._loyaltyConfiguration.type)return self._fetchMember().then(function(){self._view.empty().append(self._renderLoggedView())})})},_fetchMember:function(){var self=this;return self._callApi("loyaltyGetMember").then(function(member){self._updateState({member:member})})},_login:function(type,body){var self=this;return $fb._state.needLockQuotation=!0,self._callApi("loyaltyLogin",{type:type,body:body}).then(function(){return $fb._state.needLockQuotation=!1,self._fetchMember()}).catch(function(e){throw $fb._state.needLockQuotation=!1,$fb.results.render(),e.response&&403!==e.response.status&&$fb.error("an unexpected error occured during loyalty login",e),e})},_renderLoginView:function(){var self=this,loginView=$fb.template.render('        <div class="loyalty-infos">            <span class= "fa fa-user"></span>            <span class="loyalty-member fb-translate" data-key="already-member"></span>        </div>        <div class="loyalty-action fb-font-bold">            <span class="loyalty-sign-in fb-action btn theme-btn fb-translate" data-key="sign-in"></span>        </div>'),context=self._getState().context,loginByFormDetails=context.login.allowedMethods.find(function(method){return"form"===method.type}),loginBySsoDetails=context.login.allowedMethods.find(function(method){return"sso"===method.type});return loginByFormDetails&&loginView.click(function(event){event.preventDefault(),($fb._state.isMobile||$(event.target).hasClass("loyalty-sign-in"))&&(self.loyaltyLoginForm=new $fb.loyaltyLoginForm(loginByFormDetails.params),self.loyaltyLoginForm.on("submit",function(event){self._login("form",event.fields).catch(function(){self.loyaltyLoginForm.showError()})}),self.loyaltyLoginForm.on("close",function(){self._view.empty().append(self._renderLoginView())}),self._view.empty().append(self.loyaltyLoginForm.render()))}),loginBySsoDetails&&this._loyaltyConfiguration.login_url&&loginView.click(function(event){event.preventDefault(),($fb._state.isMobile||$(event.target).hasClass("loyalty-sign-in"))&&self._openLoginModal()}),loginView},_openLoginModal:function(){var self=this,loyaltyLoginIframe=new $fb.LoyaltyLoginIframe(this._loyaltyConfiguration.login_url);return loyaltyLoginIframe.on("cancelled",function(){loyaltyLoginIframe.destroy(),$(".fb-loyalty-login-modal").modal("hide")}),loyaltyLoginIframe.on("logged",function(evt){self._authorizationCode=evt.authorizationCode,self._trySsoLoginForNewContext();var paramsForSsoLogin=self._getPotentialSsoParams();paramsForSsoLogin.loyalty_authorization_code&&(self._accessKey=paramsForSsoLogin.loyalty_authorization_code,self._updateState({accessKey:self._accessKey})),loyaltyLoginIframe.destroy(),$(".fb-loyalty-login-modal").modal("hide")}),$fb._triggerEvent("crs-helper-modal-display",{classes:"fb-loyalty-login-modal",template:"minimal",position:"center",body:$('<div style="height:360px"></div>').append(loyaltyLoginIframe.render())})},_renderLoggedView:function(){var self=this,loggedView=$fb.template.render('        <div class="loyalty-infos">            <span class= "fa fa-user"></span>            <span class="loyalty-member"></span>            <div class="fb-loyalty-member-infos">                <span class="fb-loyalty-member-points"></span>                &nbsp;|&nbsp;                <span class= "fb-loyalty-member-level"></span>                <span class="fb-loyalty-member-discount"></span>            </div>        </div>        <div class="loyalty-action fb-font-bold">            <span class="loyalty-sign-out fb-action btn theme-btn fb-translate" data-key="log-out"></span>        </div>'),member=this._getState().member,translatedHonorific=self._getTranslatedHonorific(member.honorific),memberFullName=self._getMemberFullName(member.firstName,member.lastName);if(loggedView.find(".loyalty-member").text(memberFullName).prop("title",memberFullName).prepend(translatedHonorific).end().find(".loyalty-sign-out").click(function(event){event.preventDefault(),self._logout()}).end(),"MID"===self._loyaltyConfiguration.type){var level=member.level,points=member.points,discount=member.discount;loggedView.find(".fb-loyalty-member-points").text(points+" points").end().find(".fb-loyalty-member-level").text(level).end().find(".fb-loyalty-member-infos").show(),discount.percent&&loggedView.find(".fb-loyalty-member-discount").html("&nbsp;(&nbsp;"+discount.percent+"&nbsp;%&nbsp;)").end()}return loggedView},_getMemberFullName:function(firstName,lastName){return _.filter([firstName,lastName]).join(" ")},_getTranslatedHonorific:function(memberHonorific){switch(memberHonorific){case"Mr.":return $.fb("crs-helper-translate",{key:"honorific-mr"}).addClass("loyalty-honorific");case"Ms.":return $.fb("crs-helper-translate",{key:"honorific-ms"}).addClass("loyalty-honorific");case"Mrs.":return $.fb("crs-helper-translate",{key:"honorific-mrs"}).addClass("loyalty-honorific");default:return""}},_logout:function(){var self=this;self._view.empty().append($('        <div>            <i class="fa fa-spinner fa-spin"></i>        </div>')),self._callApi("loyaltyLogout").then(function(){self._updateState({member:void 0})}).catch(function(e){$fb.error(e),self._setState({}),self._view.empty(),self._createContext()})},_refreshToken:function(){return!1===this._refreshTokenEnabled?(this._refreshTokenEnabled=!0,Promise.resolve()):this._getState().token?this._callApi("loyaltyRefreshToken").catch(function(e){$fb.error(["an error occured during the loyalty token refresh",e])}):Promise.resolve()},_setTokenRequest:function(){var self=this;$(document).ajaxSend(function(evt,request,settings){["quotation","booking"].forEach(function(item){settings.url.match(item)&&(self._refreshTokenEnabled=!1,request.complete(function(){self._refreshTokenEnabled=!0}))})})},_callApi:function(method,params){var self=this;return $fb.callApiV2({method:method,params:params,headers:{"x-loyalty-token":self._getState().token}}).catch(function(e){throw"invalid-token"===e.message&&(self._setState({}),self._view.empty(),self._createContext()),e}).then(function(response){return response.headers["x-loyalty-token"]&&self._updateState({token:response.headers["x-loyalty-token"]}),response.data})}},EventEmitter.prototype)}(window.$fb.underscore),function($,_){var nbComponentInstances=0;function LoyaltyLoginForm(fields){nbComponentInstances++,this._fields=fields,this._id="loyalty-login-form-"+nbComponentInstances,this._rootElement=this.initLoginForm()}(window.$fb.loyaltyLoginForm=LoyaltyLoginForm).prototype=_.extend({_renderFormField:function(field){return $('<div class="form-group container"/>').append($.fb("crs-helper-translate",$("<label>",{for:field.name,"data-key":"loyalty-login-"+field.name,class:"fb-translate"}))).append($("<input>",{type:"password"===field.type?"password":"text",name:field.name,required:!0,placeholder:"email"===field.type?"abc@xyz.com":"",class:"form-control"}))},getFieldsValues:function(){var self=this;return _.reduce(self._fields,function(result,field){return result[field.name]=self._rootElement.find("input[name="+field.name+"]").val(),result},{})},render:function(){return this._rootElement},initLoginForm:function(){var self=this,fullScreenDiv=$fb.template.render('<div class="fb-modal-layer fb-dark-bg loyalty-form">            <div class="text-right fb-dialog-close fb-container">                <button class="btn fb-action theme-btn fb-font-bold btn-close">X</button>            </div>            <div class="modal-form-container">                <div class="container">                    <span class="fb-translate loyalty-form-header" data-key="already-member"></span>                </div>                <div class="container">                    <span class="fb-translate loyalty-form-header exclusive-offers" data-key="loyaltyteasing-modal-title"></span>                </div>                <div class="container loyalty-login-error hide fb-error">                    <span class="fb-translate" data-key="loyalty-login-error"></span>                </div>                <div class="form-container">                    <form>                        <div class="form-input-container">                        </div>                        <div class="form-group container">                            <button class="theme-btn btn fb-action fb-font-bold col-xs-12">                                <span class="fb-translate" data-key="sign-in"></span>                            </button>                        </div>                    </form>                </div>            </div>        </div>'),form=fullScreenDiv.find("form");form.submit(function(event){return event.preventDefault(),fullScreenDiv.find(".loyalty-login-error").addClass("hide"),form.valid()&&self.trigger(new $.Event("submit",{fields:self.getFieldsValues()})),!1}),fullScreenDiv.find(".btn-close").click(function(){self.trigger(new $.Event("close"))});var inputFields=fullScreenDiv.find(".form-input-container");return _.each(self._fields,function(field){inputFields.append(self._renderFormField(field))}),fullScreenDiv},showError:function(){this._rootElement.find(".loyalty-login-error").removeClass("hide")}},EventEmitter.prototype)}(window.jQuery,window.$fb.underscore),function($,_){function Client(){}Client.prototype={_ensureCrsApiCallExists:function(){return $.fb.isLoaded?Promise.resolve():new Promise(function(resolve){$(document).one("fastbooking-crs-utils-init-done",function(){resolve()})})},callV2:function(request){return this._ensureCrsApiCallExists().then(function(){return new Promise(function(resolve,reject){$.fb("crs-api-call",{headers:request.headers||{},data:_.extend({},request.params||{},{c:request.method}),success:function(data,jqXHR){if("success"!==data.status)return reject(new Error(data.message));resolve({data:data.data,headers:jqXHR.getAllResponseHeaders().trim().split("\n").map(function(line){var split=line.split(":");return[split[0].trim().toLowerCase(),split.slice(1).join(":").trim()]}).reduce(function(headers,keyValue){return headers[keyValue[0]]=keyValue[1],headers},{})})},error:function(httpResponse){var error=new Error(httpResponse.responseJSON&&httpResponse.responseJSON.message||httpResponse.responseText);error.httpResponse=httpResponse,reject(error)}})})})},call:function(method,params){return this.callV2({method:method,params:params}).then(function(response){return response.data})}};var client=new Client;window.$fb.callApi=client.call.bind(client),window.$fb.callApiV2=client.callV2.bind(client)}(window.jQuery,window.$fb.underscore),function($){window.$fb.getModule=function(moduleName){return $fb[moduleName]?Promise.resolve($fb[moduleName]):new Promise(function(resolve,reject){function onSuccess(){$(document).off("fastbooking-crs-frontend-require-"+moduleName+"-fail",onError),resolve($fb[moduleName])}function onError(){$(document).off("fastbooking-crs-frontend-"+moduleName+"-init",onSuccess),reject(new Error("Unknown module "+moduleName))}$fb._triggerEvent("fastbooking-crs-frontend-require",moduleName),$(document).one("fastbooking-crs-frontend-"+moduleName+"-init",onSuccess),$(document).one("fastbooking-crs-frontend-require-"+moduleName+"-fail",onError)})}}(window.jQuery),function($,_){$fb.loyalties=_.extend({getCurrentLoyalty:getCurrentLoyalty,destroyCurrentLoyalty:destroyCurrentLoyalty},EventEmitter.prototype);var currentLoyaltyConfiguration=null,currentHid=null,currentLoyalty=null,currentPosition=null;function moveLoyaltyTo(newPosition){currentPosition!==newPosition&&(currentPosition&&("header"===currentPosition?$fb.header.detachLoyaltyView():getCurrentLoyalty().getView().detach(),currentPosition=null),newPosition&&function(newPosition){"header"===newPosition?$fb.header.attachLoyaltyView(getCurrentLoyalty().getView()):$("#fb-panel-loyalty-container").children().detach().end().append(getCurrentLoyalty().getView()),currentPosition=newPosition}(newPosition))}function ensureLoyaltyInGoodPlace(){if(getCurrentLoyalty()){var newPosition=null;-1!==getCurrentLoyalty().getSteps().indexOf($fb._state.app.step)&&(newPosition="group"===$fb._state.app.step?"header":"panel"),moveLoyaltyTo(newPosition)}}function getCurrentLoyalty(){return currentLoyalty}function uniformLoyaltyNameType(loyaltyType){return"glb"===loyaltyType.toLowerCase()||"mid"===loyaltyType.toLowerCase()?"loyaltyController":loyaltyType.toLowerCase().replace(/_/g,"")}function getCurrentPropertiesHids(){return"group"===$fb._state.app.step?$fb.get("group-properties"):[$fb.get("property")]}function analyzeAndRun(){var properties,propertiesHids=getCurrentPropertiesHids();Promise.all(propertiesHids.map($fb.propertyService.get.bind($fb.propertyService))).then(function(_properties){var loyaltyTypes=_(properties=_properties).chain().map(function(property){return property.configuration.loyalty}).map(function(loyaltyConfiguration){return loyaltyConfiguration&&loyaltyConfiguration.type}).uniq().value();return $fb.info("[Loyalties] Detected types "+loyaltyTypes.join(", ")),1===loyaltyTypes.length&&loyaltyTypes[0]?$fb.getModule(uniformLoyaltyNameType(loyaltyTypes[0])):null}).then(function(loyaltyModule){$fb.info("[Loyalties] Loaded Module "+loyaltyModule);var newLoyaltyConfiguration=null,newLoyaltyConfigurationKey=null,oneHid=propertiesHids[0];if(loyaltyModule){var loyaltyConfigurations=properties.map(function(property){return property.configuration.loyalty}).map(function(loyaltyConfiguration){return object=loyaltyConfiguration,Object.keys(object).sort().reduce(function(newObject,key){return newObject[key]=object[key],newObject},{});var object});$fb.info("[Loyalties] Loaded Module "+loyaltyModule);var areConfigurationsCompatible=1===loyaltyConfigurations.length||(loyaltyModule.getCompatibleConfiguration?($fb.info("[Loyalties] Call loyaltyModule getCompatibleConfiguration "),1===_(loyaltyConfigurations).chain().map(function(conf){return loyaltyModule.getCompatibleConfiguration(_.clone(conf))}).uniq(!1,JSON.stringify).value().length):1===_(loyaltyConfigurations).uniq(!1,JSON.stringify).length);$fb.info("[Loyalties] areConfigurationsCompatible "+JSON.stringify(areConfigurationsCompatible)),areConfigurationsCompatible&&(newLoyaltyConfiguration=loyaltyModule.mergeConfigurations&&2<=loyaltyConfigurations.length?loyaltyModule.mergeConfigurations(loyaltyConfigurations.map(_.clone)):loyaltyConfigurations[0])&&(newLoyaltyConfigurationKey=loyaltyModule.getCompatibleConfiguration?JSON.stringify(loyaltyModule.getCompatibleConfiguration(_.clone(loyaltyConfigurations[0]))):JSON.stringify(loyaltyConfigurations[0])),$fb.info("[Loyalties] newConfig "+JSON.stringify(newLoyaltyConfiguration)),$fb.info("[Loyalties] newKey "+JSON.stringify(newLoyaltyConfigurationKey))}JSON.stringify(newLoyaltyConfiguration)===JSON.stringify(currentLoyaltyConfiguration)&&currentHid===oneHid||function(loyaltyConfiguration,oneHid,newLoyaltyConfigurationKey){if(destroyCurrentLoyalty(),!loyaltyConfiguration)return;$fb.getModule(uniformLoyaltyNameType(loyaltyConfiguration.type)).then(function(loyaltyModule){currentLoyaltyConfiguration=loyaltyConfiguration,currentHid=oneHid,currentLoyalty=loyaltyModule.create(loyaltyConfiguration,oneHid,new $fb.StorageContainer("$fb.loyalties.loyalty-"+newLoyaltyConfigurationKey),$fb._config.loyaltyComponent||{}),$fb.loyalties.trigger("loyalty-created"),currentLoyalty.on("login logout",function(e){$fb.reloadQuotation(!0,!0,!0),$fb.loyalties.trigger("loyalty-"+e.type)}),currentLoyalty.on("login-link-click signup-link-click",function(e){$fb.loyalties.trigger("loyalty-"+e.type)}),currentLoyalty.isLogged()&&($fb.reloadQuotation(),$fb.loyalties.trigger("loyalty-login")),ensureLoyaltyInGoodPlace()}).catch($fb.error)}(newLoyaltyConfiguration,oneHid,newLoyaltyConfigurationKey)})}function destroyCurrentLoyalty(){currentLoyalty&&(moveLoyaltyTo(null),currentLoyalty.destroy(),$fb.loyalties.trigger("loyalty-logout"),$fb.loyalties.trigger("loyalty-destroy")),currentHid=currentLoyaltyConfiguration=currentLoyalty=null}$(document).one("fastbooking-crs-frontend-loyalties-init",function(event){$fb._callback(event)}),$(document).one("fastbooking-crs-frontend-loyalties-render",function(event){$(document).on("fastbooking-crs-frontend-renderAll",analyzeAndRun).on("fastbooking-crs-frontend-renderAll",ensureLoyaltyInGoodPlace),0===getCurrentPropertiesHids().length?"group"===$fb._state.app.step&&$(document).one("fastbooking-crs-frontend-load-group-done",analyzeAndRun):analyzeAndRun();$fb._callback(event)})}(window.jQuery,window.$fb.underscore),function($,_){var currentConfiguration;$fb.favicon={};var node=$('link[rel="shortcut icon"]'),defaultFaviconUrl=node.attr("href");function getCurrentPropertiesHids(){return"group"===$fb._state.app.step?$fb.get("group-properties"):[$fb.get("property")]}function analyzeAndRun(){var propertiesHids=getCurrentPropertiesHids();Promise.all(propertiesHids.map($fb.propertyService.get.bind($fb.propertyService))).then(function(properties){var uniqueFaviconConfigurations=_(properties).chain().map(function(property){return property.bookingEngineFrontend.favicon}).uniq(!1,JSON.stringify).value(),newFaviconConfiguration=1===uniqueFaviconConfigurations.length?uniqueFaviconConfigurations[0]:null;JSON.stringify(newFaviconConfiguration)!==JSON.stringify(currentConfiguration)&&run(newFaviconConfiguration)})}function run(configuration){if(destroyCurrent(),(currentConfiguration=configuration)&&configuration.enabled){var urlWithCdn=$.fb("crs-helper-image",{src:currentConfiguration.image.url,onlySrc:!0});node.attr("href",urlWithCdn)}}function destroyCurrent(){currentConfiguration&&(node.attr("href",defaultFaviconUrl),currentConfiguration=null)}$(document).one("fastbooking-crs-frontend-favicon-init",function(event){$fb._callback(event)}),$(document).one("fastbooking-crs-frontend-favicon-render",function(event){$(document).on("fastbooking-crs-frontend-renderAll",analyzeAndRun),0===getCurrentPropertiesHids().length?"group"===$fb._state.app.step&&$(document).one("fastbooking-crs-frontend-load-group-done",analyzeAndRun):analyzeAndRun();$fb._callback(event)}),$(document).one("$fb.fastbooking-crs-frontend-initializing",function(){$fb._state.app.data.favicon&&run($fb._state.app.data.favicon);delete $fb._state.app.data.favicon}),$(window).one("beforeunload",destroyCurrent)}(window.jQuery,window.$fb.underscore),function($){$(document).one("fastbooking-crs-frontend-loyaltyteasing-init",function(event){$fb._callback(event)}),$(document).one("fastbooking-crs-frontend-loyaltyteasing-render",function(event){$fb._callback(event);var package=packageContainer.load();package&&(!function(package){$fb.getModule("loyalties").then(function(loyalties){var onLoyaltyLogin=function(){loyalties.off("loyalty-login",onLoyaltyLogin),verifyPackageWithNewQuotationAndAdd(package)};loyalties.getCurrentLoyalty()&&loyalties.getCurrentLoyalty().isLogged()?onLoyaltyLogin():(loyalties.one("loyalty-login",onLoyaltyLogin),setTimeout(function(){loyalties.off("loyalty-login",onLoyaltyLogin)},1e3*waitForLoginSeconds))})}(package),packageContainer.save())}),$fb.loyaltyteasing={showTeaserForPackage:function(package){var loyalty=$fb.loyalties.getCurrentLoyalty().clone(),$modal=function(loyalty){return $fb._triggerEvent("crs-helper-modal-display",{classes:"fb-loyaltyteasing-modal",template:"minimal",position:"center",body:$("<div />").append($("<h2></h2>").append($.fb("crs-helper-translate",{key:"loyaltyteasing-modal-title"})),$('<div id="fb-loyaltyteasing-loyalty-container"></div>').append(loyalty.getView()))})}(loyalty);packageContainer.save(package),$modal.one("hidden.bs.modal",function(){packageContainer.save(),loyalty.destroy()}),loyalty.one("refuse",function(){$modal.modal("hide")}),loyalty.one("login",function(){$modal.modal("hide"),setTimeout(function(){verifyPackageWithNewQuotationAndAdd(package)},50)})}};var packageContainer=new $fb.StorageContainer("$fb.loyaltyteasing.package"),waitForLoginSeconds=10;function verifyPackageWithNewQuotationAndAdd(teasingPackage){($fb._state.app.loading.quotation?new Promise(function(resolve){$(window).one("fastbooking-crs-frontend-load-quotation-done",function(){resolve($fb._state.app.data.quotation)})}):Promise.resolve($fb._state.app.data.quotation)).then(function(quotation){if(quotation.query.loyaltyEnable){var packages,roomItem,foundPackageIdInQuotation=(packages=quotation.packages,roomItem=teasingPackage.find(function(item){return"accommodation"===item.type}),Object.keys(packages).find(function(packageId){var packageToCompare=packages[packageId],roomItemToCompare=packageToCompare.find(function(item){return"accommodation"===item.type}),sameCoupleRateRoom=roomItem.rate===roomItemToCompare.rate&&roomItem.product===roomItemToCompare.product,sameCampaign=roomItem.campaignId===roomItemToCompare.campaignId;return sameCoupleRateRoom&&sameCampaign}));foundPackageIdInQuotation?function(pack,packId,query){if($fb._state.app.loading.quotation)return $(window).one("fastbooking-crs-frontend-load-quotation-done",function(){setTimeout(function(){$fb.selection.addPackage(pack,packId,query)},50)});$fb.selection.addPackage(pack,packId,query)}(quotation.packages[foundPackageIdInQuotation],foundPackageIdInQuotation,$fb.quotationResultsHelper.formatBookingQueryFromQuotationQuery(quotation.query,quotation.packages[foundPackageIdInQuotation])):$fb.info("Loyalty Teasing : teasingPackage doesn't match any quotation package")}else $fb.error("Anormal Quotation Query for validating Teasing Package")})}}(window.jQuery),function($,_){$.extend(window.$fb,{group:{_container:null,_config:{resizeProcessingDelay:300,zoomOrPanProcessingDelay:450,quotation:{maxRequestsBySecond:50,maxSimultaneousRequests:2,maxQuotationsByRequest:5}},_containers:{$items:null,$list:null,$map:null,$loader:null,$filters:null,$badges:{}},_state:{data:{order:[],filters:null,tempFilters:{},properties:{},checkboxes:{},markers:{},infoWindows:{},filterGroups:{}},loading:null,map:null,view:"list",zoomOrPanProcessing:!1,zoomOrPanProcessingPending:!1,resizeProcessing:!1,resizeProcessingPending:!1,mapAlreadyRendered:!1,hideMap:!0,quotationService:null,sort:"name"},init:function(event){if(!$fb._checkEvent("group","init",event))return $fb._callback(event);$fb.log("group.js >> initialization"),$fb.group._.quotation.init(function(){return $fb._triggerEvent("fastbooking-crs-frontend-load-countries"),$fb._triggerEvent("fastbooking-crs-frontend-load-group"),$fb._callback(event)})},render:function(event){if(!$fb._checkEvent("group","_preRender",event))return $fb._callback(event);if(!$fb._config.services)return $fb._callback(event);if($fb.log("group.js >> render"),$fb.group._container&&$fb.group._containers.$items){if("group"!==$fb._state.app.step)return $fb.group._containers.$items.hide(),$fb._callback(event);$fb.group._containers.$items.show(function(){$fb.group._state.quotationService&&!$fb.group._state.loading&&$fb.group._.quotation.findAll()})}return"group"===$fb._state.app.step&&$fb.group._.checkContainers(),$fb._callback(event)},_:{checkContainers:function(){$fb.log("group.js >> checkContainers");var group=null;$fb._state.app.data.groups&&$fb._state.app.data.groups[$fb._state.quicksearch.group]&&(group=$fb._state.app.data.groups[$fb._state.quicksearch.group]),null===$fb.group._container&&($fb.group._container=$fb._checkContainer("group"),$("#fb-group").off("click.group").on("click.group",$fb.group._.events.click).off("change.group").on("change.group",$fb.group._.events.change),$fb.log("group.js >> bind resize event"),$(window).off("resize.group").on("resize.group",$fb.group._.events.resize)),$.fb("crs.assert",{c:$fb.group._container,m:"Group module container must exist"}),null===$fb.group._containers.$items&&($fb.group._containers.$items=$('<div id="group-items"/>'),$fb.group._container.append($fb.group._containers.$items)),$.fb("crs.assert",{c:$fb.group._containers.$items,m:"Group module $items container must exist"}),null===$fb.group._containers.$list&&group&&($fb.log("group.js >> ",group),$fb.group._containers.$list=$fb.group._.list.init(group),$fb.group._containers.$items.append($fb.group._containers.$list),$fb._triggerEvent("fastbooking-crs-frontend-group-list-rendered")),null===$fb.group._containers.$map&&group&&($fb._config.services.maps?($fb.group._containers.$map=$('<div id="fb-group-map"/>'),$fb.group._containers.$items.append($fb.group._containers.$map),$fb.group._.map.init(group)):$("body").addClass("no-google-maps")),null===$fb.group._containers.$loader&&($fb.group._containers.$loader=$fb.group._.loader.init(),$fb.group._containers.$progress=$(".progress-bar",$fb.group._containers.$loader),$fb.group._containers.$items.prepend($fb.group._containers.$loader))},list:{init:function(group){$fb.log("group.js >> list.init");var $list=$('<div id="fb-group-list" class="col-xs-12 col-md-6"></div>');return $list.append($fb.group._.list.getHead(group.properties)),$list.append($fb.group._.list.getPropertiesList(group.properties)),$fb.log("group.js >> $list",$list),$list},getHead:function(properties){$fb.log("group.js >> list.getHead");var $head=$('<div id="fb-group-list-head" class="col-xs-12 fb-container"></div>'),propertyType=function(properties,defaultPropertyType){var propertyType;return function(properties,defaultPropertyType){for(var property in propertyType=0===Object.keys(properties).length?defaultPropertyType:void 0,properties)if(propertyType){if(propertyType!==properties[property].type.toLowerCase()){propertyType=defaultPropertyType;break}}else propertyType=properties[property].type.toLowerCase()}(properties,defaultPropertyType),propertyType}(properties,"property");$head.append($('<div class="fb-group-header fb-container hidden-xs hidden-sm col-md-12" />').append($('<span class="col-xs-12 title1 fb-font-light" />').append($.fb("crs-helper-translate",{key:"group-choose-"+propertyType})).append($('<span id="fb-group-filters-caret">').append($.fb("crs-helper-translate",{key:"group-filters",fallback:"Filters"})).append(' <i class="fa fa-caret-right"></i><i class="fa fa-caret-down"></i></span>'))));var $filters=$fb.group._containers.$filters=$fb.group._.filters.init(properties);return $(".fb-filters-form",$filters).is(":not(:empty)")?$head.append($filters):$("#fb-group-filters-caret",$head).hide(),$head},getPropertiesList:function(properties){$fb.log("group.js >> list.getPropertiesList");var $properties=$('<div id="fb-group-list-properties" class="col-xs-12 fb-container"></div>');if($fb.log("group.js >> ",properties),properties){var _properties=$.map(properties,function(value){return[value]});_properties.sort(function(a,b){return a.title.localeCompare(b.title)}),$fb.log("group.js >> _properties: ",_properties);var loop=function(){var _property=_properties.shift();_property&&($properties.append($fb.group._.list.getPropertyBadge(_property)),loop())};loop()}return $fb.group._.list.sortList($fb.group._state.sort,$properties),$properties},getPropertyBadge:function(property){$fb.log("group.js >> list.getPropertyBadge");var $badge=$('<div id="group-item-'+property.property+'" data-id="'+property.property+'" class="col-xs-12 fb-group-item fb-light-bg">');return $badge.append($fb.group._.list.getPropertyBadgeTitle(property)),$badge.append($fb.group._.list.getPropertyBadgePhoto(property)),$badge.append($fb.group._.list.getPropertyBadgeDescription(property)),$badge.append($fb.group._.list.getPropertyBadgePricing()),$badge.append($fb.group._.list.getPropertyBadgeButton(property)),$fb.group._containers.$badges[property.property]=$badge},getPropertyBadgeTitle:function(property){var $title=$('<div class="fb-group-item-title fb-dark-bg col-xs-12"/>');if($title.append($.fb("crs-helper-translate",{key:property.property+":hoteltitle",fallback:property.title})),property.stars&&parseInt(property.stars,10)){for(var stars=parseInt(property.stars,10),$stars=$('<span class="fb-hotel-stars fb-font-thin nowrap"/>'),i=1;i<=stars;i++)$stars.append('<span class="fa fa-star"></span>');$title.append(" ").append($stars)}return $title},getPropertyBadgePhoto:function(property){var $photo=$('<div class="fb-group-item-photo col-xs-12 fb-carousel-image" style="background-repeat: no-repeat;"></div>');return function(){var coverImg=$fb.bannerRenderer.getBannerBaseImage(property);if(coverImg){var width=property.banner&&property.banner.width?property.banner.width:960,height=Math.round(width/6.4),offsetx=property.banner&&property.banner.x?Math.round(property.banner.x):0,offsety=property.banner&&property.banner.y?Math.round(property.banner.y):0;$fb.log("group.js >> getPropertyBadgePhoto"),$photo.css({"background-image":"url("+$.fb("crs-helper-image",{src:coverImg.url,width:width,height:height,offsetx:offsetx,offsety:offsety,crop:!0,onlySrc:!0})+")","background-repeat":"no-repeat","background-position":"center",height:150})}}(),$photo},getPropertyBadgeDescription:function(property){$fb.log("group.js >> getPropertyBadgeDescription");var $description=$('<div class="fb-group-item-desc col-xs-12 col-sm-8"/>'),$block=$('<div class="fb-group-hotel-desc"/>'),countries=null;$fb._state.app.data.countries&&$fb._state.app.data.countries[$fb._state.app.locale]&&(countries=$fb._state.app.data.countries[$fb._state.app.locale]),$block.append($('<div class="col-xs-12 " />').append($.fb("crs-helper-translate",{key:property.property+":hotelregion",fallback:property.location.region?property.location.region:" "})).append(", ").append($.fb("crs-helper-translate",{key:property.property+":hotelcity",fallback:property.location.city})).append(", ").append(countries&&countries[property.location.country]?countries[property.location.country]:property.location.country));var propertyType="group-hotel-details";property&&property.type.toLowerCase()&&(propertyType="group-"+property.type.toLowerCase()+"-details");var $hotelLayerLink=$('<a href="javascript:void(0);" data-ref="'+property.property+'" data-offset="group-item-'+property.property+'" class="theme-link fb-group-property-details" />').append($.fb("crs-helper-translate",{key:propertyType})).append(' <i class="fa fa-caret-right"></i>');return $block.append($('<div class="col-xs-12 " />').append($hotelLayerLink)),$description.append($block)},getPropertyBadgePricing:function(){return $('<div class="fb-group-item-pricing col-xs-12 col-sm-4"/>')},getPropertyBadgeButton:function(property){var $block=$('<div class="fb-group-item-button col-xs-12 col-sm-4"/>'),$select=$('<div class="fb-results-select">'),$button=$('<button class="btn btn-block fb-action fb-font-bold ellipsis fb-group-gotorooms theme-btn" data-ref="'+property.property+'" />');return $button.append($.fb("crs-helper-translate",{key:"group-see-rooms"})),$select.append($button),$block.append($select)},generateTooltipedMaxOccupancyIcon:function(){var icon=$('<i class="fa fa-info-circle max-occupancy-icon"></i>'),hideTooltip=function(){icon.tooltip("hide")};return icon.tooltip({html:!0,title:$.fb("crs-helper-translate",{key:"group-max-occupancy-recommendation-message"}),placement:"bottom",trigger:"click"}).on("shown.bs.tooltip",function(){$("body").click(hideTooltip)}).on("hide.bs.tooltip",function(){$("body").off("click",hideTooltip)}),icon},updatePropertyBadgeBadOccupancy:function(hid,propertySelectionValidation,propertySelectionValidationConfiguration){var $badge=$fb.group._containers.$badges[hid],$pricing=$(".fb-group-item-pricing",$badge),$price=$('<div class="col-xs-12 fb-results-price">'),self=this;if($badge.addClass("fb-group-unavailable"),propertySelectionValidation.items.some(function(room){return room.nbAdults.hasError||room.nbChildren.hasError})){var isPersonExceed=propertySelectionValidation.items.some(function(room){return"maxPersons"===room.nbAdults.reason}),isAdultExceed=propertySelectionValidation.items.some(function(room){return"maxAdults"===room.nbAdults.reason}),typeOccupancyReached=isPersonExceed?"person":isAdultExceed?"adult":"child",limit="person"===typeOccupancyReached?propertySelectionValidationConfiguration.maxPersons:"adult"===typeOccupancyReached?propertySelectionValidationConfiguration.maxAdults:propertySelectionValidationConfiguration.maxChildren;$price.append($.fb("crs-helper-translate",{key:"quicksearch-message-max-xxx-per-room",placeholders:[$.fb("crs-helper-translate",{key:typeOccupancyReached,placeholders:[limit],mode:limit}).get(0).outerHTML]})),$price.append("<br/>",this.generateTooltipedMaxOccupancyIcon())}else $price.append($.fb("crs-helper-translate",{key:"fb-results-occupancy-selection-fix-children-ages"}));return $pricing.on("cloned",function(){$(this).find(".tooltip").remove();var clonedIcon=$(this).find(".max-occupancy-icon"),newIcon=self.generateTooltipedMaxOccupancyIcon();clonedIcon.replaceWith(newIcon)}),$pricing.addClass("fb-property-price-limit-reached"),$(".fb-group-gotorooms",$badge).html($.fb("crs-helper-translate",{key:"group-ajust-room-selection"})),new Promise(function(resolve){$pricing.hide().html($price).fadeIn(200,resolve)})},updatePropertyBadgeNoAvailabilities:function(hid){var $badge=$fb.group._containers.$badges[hid],$pricing=$(".fb-group-item-pricing",$badge),$price=$('<div class="col-xs-12 fb-results-price">');return $badge.addClass("fb-group-unavailable"),$price.append($.fb("crs-helper-translate",{key:"property-unavailable"})),$pricing.addClass("fb-property-price-unavailable"),$(".fb-group-gotorooms",$badge).html($.fb("crs-helper-translate",{key:"group-other-availabilities"})),new Promise(function(resolve){$pricing.hide().html($price).fadeIn(200,resolve)})},updatePropertyBadgeWithResult:function(query,result){var stay=result.getStay(),$badge=$fb.group._containers.$badges[query.property],$pricing=$(".fb-group-item-pricing",$badge),$price=$('<div class="col-xs-12 fb-results-price">');$badge.removeClass("fb-group-unavailable");var $newAmount,$amountPrice=$.fb("crs-helper-price",{price:stay.getTotalOriginalPrice(),type:"total",ref:"group"});stay.getTotalOriginalPrice()!==stay.getTotalPrice()&&($newAmount=$('<span class="col-xs-12 fb-price-amount" />').append($.fb("crs-helper-price",{price:stay.getTotalPrice(),type:"total"}).css("float","right").addClass("price-new")),$amountPrice.addClass("campaign-price-barred"),$pricing.addClass("fb-group-item-pricing-campaign-applied"));var $amount=$('<span class="col-xs-12 fb-price-amount"/>').html($.fb("crs-helper-translate",{key:"group-price-starting",placeholders:[$amountPrice.get(0).outerHTML]}).css("float","right"));$newAmount&&($amount=$amount.add($newAmount));var $rule=$('<span class="col-xs-12 fb-price-params" />').append($.fb("crs-helper-translate",{key:"night",mode:query.nights,placeholders:[query.nights]})).append(", ").append($.fb("crs-helper-translate",{key:"person",mode:query.adults+query.children,placeholders:[query.adults+query.children]}));return $price.append($amount).append($rule).data("price",stay.getTotalPrice()).data("hasCampaign",!!stay.getCampaignApplied()),stay.getCampaignApplied()&&$("#fb-group-list-sort-mcm-top").parents(".form-group").removeClass("hide"),$pricing.removeClass("fb-property-price-unavailable fb-property-price-limit-reached"),$(".fb-group-gotorooms",$badge).html($.fb("crs-helper-translate",{key:"group-see-rooms"})),new Promise(function(resolve){$pricing.hide().html($price).fadeIn(200,resolve)})},filterProperties:function(hidsToShow){var hidList=Object.keys($fb._state.app.data.groups[$fb._state.quicksearch.group].properties);_.each(hidList,function(hid){var property=$("#group-item-"+hid);_.contains(hidsToShow,hid)?property.show():property.hide()})},scrollToPropertyBadge:function(property){var $badge=$("#group-item-"+property);if($badge.length){var scrolltop=$fb.group._containers.$list.scrollTop(),offset=$badge.position().top+$("#fb-group-list-properties").position().top;$fb.log("Div offset: "+offset+", list scrolltop: "+scrolltop),void 0!==offset&&$fb.group._containers.$list.animate({scrollTop:Math.max(0,scrolltop+offset)})}},sortList:function(r,$list){r=void 0!==r?r:$fb.group._state.sort,$list=void 0!==$list?$list:$fb.group._containers.$list;var campaignFirst=$("#fb-group-list-sort-mcm-top").is(":checked"),rule=function(r){switch($fb.log("Group sort callback: "+r),r){case"price":return function(a,b){var $a=$(a),$b=$(b),priceA=$a.find(".fb-results-price").data("price"),priceB=$b.find(".fb-results-price").data("price");return void 0!==priceA&&void 0!==priceB?priceA<priceB?-1:priceB<priceA?1:0:void 0!==priceA?-1:void 0!==priceB?1:rule("name")(a,b)};default:return function(a,b){var $a=$(a),$b=$(b);if(0==$a.find(".fb-price").length)return 1;if(0==$b.find(".fb-price").length)return-1;var titleA=$a.find(".fb-group-item-title .fb-translate").text(),titleB=$b.find(".fb-group-item-title .fb-translate").text();return titleA.localeCompare(titleB)}}},$wrapper=$("#fb-group-list-properties"),$items=$wrapper.find(".fb-group-item");if([].sort.call($items,rule(r)),campaignFirst){var $campaigns=$items.filter(function(){return!0===$(this).find(".fb-results-price").data("hasCampaign")}),$noCampaigns=$items.filter(function(){return!0!==$(this).find(".fb-results-price").data("hasCampaign")});$campaigns.each(function(){$wrapper.append(this)}),$noCampaigns.each(function(){$wrapper.append(this)})}else $items.each(function(){$wrapper.append(this)});return $list},fade:function(value,immediate){var $fade=$("#fb-group-list-fade-layer");0===$fade.length&&($fade=$('<div id="fb-group-list-fade-layer"/>'),$("#fb-group-list-properties").append($fade)),$fb.group._state.fadingTimeout&&clearTimeout($fb.group._state.fadingTimeout);var doIt=function(){var afterDone=function(){0==value&&$fade.hide().remove()};immediate&&($fade.show().css({opacity:value}),afterDone()),$fade.show().animate({opacity:value},afterDone)};if(immediate)return doIt();$fb.group._state.fadingTimeout=setTimeout(doIt,0==value?10:1e3)}},map:{init:function(group){if($fb.log("group.js >> Maps initialization"),group)if(group&&group.parameters&&"N"!==group.parameters.DISPLAY_MAP_ON_GROUP_PAGE){if("group"!=$fb._state.app.step||window.google&&window.google.maps)$fb.group._.map.loadedCallback();else if(!$fb._state.googleMapLoaded){var mapLang=$fb._state.lang||"en";$.getScript($fb._config.services.maps+"&signed_in=false&language="+mapLang+"&callback=$fb.group._.map.loadedCallback").fail(function(){$fb._triggerEvent("fastbooking-crs-frontend-group-map-loaded")}),$fb._state.googleMapLoaded=!0}}else $fb._triggerEvent("fastbooking-crs-frontend-group-map-loaded")},loadedCallback:function(){$fb.log("group.js >> Maps library initialized"),window.InfoBox?$fb._triggerEvent("fastbooking-crs-frontend-group-map-loaded"):$fb._external("dist/libs/maputils.min.js",function(){$fb._triggerEvent("fastbooking-crs-frontend-group-map-loaded")})},render:function(){if(null===$fb.group._state.map&&window.google&&window.google.maps){$fb.group._.events.resize();var mapOptions={zoom:5,minZoom:2,maxZoom:19,center:new google.maps.LatLng(0,0),mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:!1,panControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_TOP},scaleControl:!0,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_CENTER},streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},styles:[{featureType:"poi.business",elementType:"all",stylers:[{visibility:"off"}]}]};$fb.group._state.map=new google.maps.Map($fb.group._containers.$map[0],mapOptions),google.maps.visualRefresh=!0,google.maps.event.addListener($fb.group._state.map,"bounds_changed",$fb.group._.map.updatePropertiesList)}else $fb.group._containers.$map&&$fb.group._containers.$map.hide(),$fb.group._container.css("max-width","960px").css("margin","auto"),$fb.group._containers.$list&&$fb.group._containers.$list.attr("class","container fb-container").css("width","100%").css("height","auto");null===$fb.group._state.data.markers&&$fb.group._.map.updatePropertiesMarkers($fb._state.app.data.groups[$fb._state.quicksearch.group].properties),function(){if($fb._state.isMobile)return;$fb.info("#assertMapWellLoaded : configuring ...");var assertMapWellLoaded=setInterval(function(){$fb.info("#assertMapWellLoaded : Asserting if map is well loaded");var mapBounds=$fb.group._state.map.getBounds().toJSON(),isMapBoundsARectangle=(mapBounds.south-mapBounds.north)*(mapBounds.west-mapBounds.east)!=0;if(isMapBoundsARectangle)return $fb.info("#assertMapWellLoaded : Map is well loaded, exiting check interval"),void clearInterval(assertMapWellLoaded);$fb.info("#assertMapWellLoaded : Map is not well loaded, try to fix and check again"),google.maps.event.trigger($fb.group._state.map,"resize"),$fb.group._.map.zoomOnPins()},500)}()},getPropertiesMarkers:function(properties){var markers={};return $.each(properties,function(i,property){if(markers[i]={property:i,visible:!0,gm:null},property&&property.location&&property.location.wgs84&&window.google&&window.google.maps){var hotelCoordinates=property.location.wgs84.split(","),myLatlng=new google.maps.LatLng(hotelCoordinates[0],hotelCoordinates[1]);markers[i].gm=new google.maps.Marker({position:myLatlng,map:null,animation:google.maps.Animation.DROP})}}),markers},updateCurrentPropertyInfoWindow:function(){var me=$(".fb-group-infowindow"),hid=me.data("id");me.find(".fb-group-item-pricing").replaceWith(this.getPropertyInfoWindow(hid).find(".fb-group-item-pricing"))},getPropertyInfoWindow:function(property){var $info=$('<div class="fb-group-infowindow fb-container" />');$info.attr("data-id",property);var $reference=$("#group-item-"+property),$head=$('<div class="fb-group-item-title fb-dark-bg"/>');$head.html($(".fb-group-item-title",$reference).html()),$head.prepend('<span class="fa fa-times fb-group-infowindow-close"></span>'),$info.append($head);var $pricing=$(".fb-group-item-pricing",$reference).clone(!0);return $pricing.trigger("cloned"),$pricing.css("width","100%").css("min-height","50px").css("height","").css("bottom",""),$info.append($pricing),$info.append($(".fb-group-item-button",$reference).html()),$info},getPropertyInfoWindowHTML:function(property){return $("<div/>").append($fb.group._.map.getPropertyInfoWindow(property)).html()},updatePropertiesMarkers:function(properties){properties&&($fb.group._state.map&&$.each($fb.group._state.data.markers,function(i,o){o.added&&o.gm.setMap(null)}),$fb.group._state.data.markers=$fb.group._.map.getPropertiesMarkers(properties),$fb.group._state.map&&$.each($fb.group._state.data.markers,function(i,marker){marker.gm&&(marker.gm.setMap($fb.group._state.map),marker.gm.setVisible(!0),marker.added=!0,google.maps.event.addListener(marker.gm,"click",function(event){$fb.log("group.js >> map event marker",event),$fb.group._.map.clickOnMarker(i,marker)}))}),$fb.group._.map.zoomOnPins())},zoomOnPins:function(){if(window.google&&window.google.maps){var mapBounds=new google.maps.LatLngBounds;$.each($fb.group._state.data.markers,function(property,marker){marker&&marker.added&&1==marker.gm.visible&&mapBounds.extend(marker.gm.getPosition())}),$fb.group._state.map.fitBounds(mapBounds),$fb.group._state.map.panTo(mapBounds.getCenter())}},clickOnMarker:function(property,marker){property&&(void 0===marker&&$fb.group._state.data.markers[property]&&(marker=$fb.group._state.data.markers[property]),marker&&marker.added&&($fb.group._.map.showMarkerInfoWindow(marker),google.maps.event.addListenerOnce($fb.group._state.map,"idle",function(){$fb.group._.map.updateCurrentPropertyInfoWindow(),$fb.group._.list.scrollToPropertyBadge(property)})))},centerMapOnMarker:function(marker){if(marker.gm){var mapBounds=new google.maps.LatLngBounds;mapBounds.extend(marker.gm.getPosition()),$fb.group._state.map.panTo(mapBounds.getCenter())}},closeAllInfoWindows:function(){$.each($fb.group._state.data.markers,function(property,marker){marker&&marker._infoWindow&&marker._infoWindow.close()})},showMarkerInfoWindow:function(marker){$fb.group._.map.closeAllInfoWindows(),$fb.group._.map.centerMapOnMarker(marker),void 0!==InfoBox?($fb.log("BUILD InfoBox"),marker._infoWindow=new InfoBox({content:$fb.group._.map.getPropertyInfoWindowHTML(marker.property)})):($fb.log("BUILD InfoWindow"),marker._infoWindow=new google.maps.InfoWindow({content:$fb.group._.map.getPropertyInfoWindowHTML(marker.property),maxWidth:300})),marker._infoWindow.open($fb.group._state.map,marker.gm)},filterProperties:function(hids){($.each($fb.group._state.data.markers,function(property,marker){-1==$.inArray(marker.property,hids)?marker.visible=!1:marker.visible=!0,marker.added&&marker.gm.setVisible(marker.visible)}),$fb.group._state.map&&$fb.group._containers.$map.width())&&($fb.group._state.map.getBounds(),$fb.group._.map.zoomOnPins());$fb.group._.map.updatePropertiesList()},updatePropertiesList:function(){var map=$fb.group._state.map,bounds=null;map&&$fb.group._containers.$map.width()&&(bounds=map.getBounds()),$.each($fb.group._state.data.markers,function(property,marker){var $badge=$("#group-item-"+property);!0===marker.visible?bounds&&marker.added&&!bounds.contains(marker.gm.getPosition())?$badge.hide():$badge.show():$badge.hide()})}},loader:{init:function(){var $loader=$('<div id="fb-group-loader" class="progress hidden-xs"></div>'),$bar=$('<div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"/>');return $loader.append($bar)},show:function(){$fb.group._containers.$loader&&($fb.group._state.loading=!0,$fb.group._containers.$loader.fadeIn())},hide:function(){$fb.group._containers.$loader&&($fb.group._state.loading=!1,$fb.group._containers.$loader.fadeOut())},setValue:function(value){$fb.group._containers.$progress&&($fb.group._containers.$progress.css("width",value+"%").attr("aria-valuenow",value),100<=value&&($fb.group._.loader.hide(),$fb.group._.list.fade(0)))}},filters:{init:function(properties){var $filters=$('<div id="fb-group-filters" class="col-xs-12 fb-container fb-group-filters"/>');return $fb.log("group.js >> filters init",$filters,properties),$filters=$fb.group._.filters.displaySorting($filters,properties),$filters=$fb.group._.filters.displayFilters($filters,properties)},displaySorting:function($filters,properties){var $form=$('<div role="form" id="fb-group-sort-form" class="form-inline"></div>');$form.append($('<div class="form-group"/>').append($('<span class="sort-by-label"/>').append($.fb("crs-helper-translate",{key:"group-filters-sorting-label",fallback:"Sort by"})))),$.each(["name","price"],function(i,o){$form.append($('<div class="form-group">').append('<input type="radio" id="fb-group-list-sort-by-'+o+'" name="group-list-sort" '+(o==$fb.group._state.sort?' checked="checked"':"")+' value="'+o+'"/>').append($('<label for="fb-group-list-sort-by-'+o+'">').append($.fb("crs-helper-translate",{key:"group-filters-sort-by-"+o,fallback:o}))))});var campaignTopCheckboxChecked=!_.find(properties,function(property){return!1===property.bookingEngineFrontend.results.checkCheckboxOffersFirst}),$withCampaignTop=$('<div class="form-group hide" />').append($("<input />",{type:"checkbox",checked:campaignTopCheckboxChecked,id:"fb-group-list-sort-mcm-top"})).append($('<label for="fb-group-list-sort-mcm-top"></label>').append($.fb("crs-helper-translate",{key:"group-filters-sort-with-campaign-top"})));return $form.append($withCampaignTop.prepend('<span class="fb-group-sort-form-separator"></span>')),$filters.append($form),$filters},displayFilters:function($filters,properties){var filters=$fb.group._.filters.getFilters(properties);$fb.group._state.data.filters=filters;var $filtersContent=$('<div class="col-xs-12 fb-container fb-light-bg fb-filters-form hidden-xs">'),col=12/Object.keys(filters).length;return $.each(filters,function(i){var $filterBlock=$fb.group._.filters.getFilterGroup(i,filters);$filterBlock.addClass("col-xs-"+col),$filtersContent.append($filterBlock)}),$filters.append($('<div id="applied-filters-button" class="btn btn-link pull-right"/>').append($.fb("crs-helper-translate",{key:"group-filters-applied",fallback:"Filtering is on"})).append('<img id="reset-applied-filters-button" src="/images/pictos/icon-layer-close.png"/>')),$filters.append($filtersContent.hide())},getFilterGroup:function(filter,filters){$.fb("crs.assert",{c:filter,m:"Filter id must be given"}),$.fb("crs.assert",{c:filters,m:"Filters values must be given"});var $filterGroup=$('<div class="fb-container fb-filter" />'),$filterOptions=$('<div class="col-xs-12 fb-gray fb-group-filter-options" />'),label="group-filter-"+filter;switch(filter){case"country":$filterGroup.addClass("fb-filter-group-country"),label="quicksearch-country";break;case"region":label="quicksearch-region";break;case"city":label="group-filter-localization"}var values=filters[filter];if(values){var _values=Object.keys(values).sort();$.each(_values,function(i,value){var hids=values[value],hid=values[value].length?values[value][0]:"",valueLabel="",property=$fb._state.app.data.groups[$fb._state.quicksearch.group].properties[hid];switch(filter){case"country":var countries=null;$fb._state.app.data.countries&&$fb._state.app.data.countries[$fb._state.app.locale]&&(countries=$fb._state.app.data.countries[$fb._state.app.locale]),$fb.log("group.js >> country",value,countries),valueLabel=countries&&countries[value]?countries[value]:value;break;case"stars":valueLabel=$('<span class="fb-hotel-stars fb-font-thin nowrap"/>');for(var j=1;j<=value;j++)valueLabel.append('<span class="fa fa-star"></span>');break;case"region":valueLabel=$.fb("crs-helper-translate",{key:hid+":hotelregion",fallback:property.location.region?property.location.region:" "});break;case"city":valueLabel=$.fb("crs-helper-translate",{key:hid+":hotelcity",fallback:property.location.city?property.location.city:" "});break;default:valueLabel=value}$filterOptions.append($('<div class="checkbox" />').append($("<label />").append($('<input type="checkbox" value="'+value+'" class="fb-group-filter-check fb-group-filter-'+filter+'" data-group="'+filter+'" data-filter="'+hids.join(",")+'" />')).append(valueLabel)))})}return $filterGroup.append($('<div class="col-xs-12 fb-font-bold" />').append($.fb("crs-helper-translate",{key:label}))).append($filterOptions)},getFilters:function(properties){$.fb("crs.assert",{c:properties,m:"Properties list must be given"});var filters={};return $.each(["stars","country","region","city"],function(i,filter){filters[filter]=$fb.group._.filters.getFilterValues(filter,properties),Object.keys(filters[filter]).length<2&&delete filters[filter]}),filters},getFilterValues:function(filter,properties){$.fb("crs.assert",{c:filter,m:"Filter name must must defined"}),$.fb("crs.assert",{c:properties,m:"Properties list must be given"});var values={};return $.each(properties,function(i,property){var value=$fb.group._.filters.getFilterValue(filter,property);value&&(void 0===values[value]&&(values[value]=[]),values[value].push(i),values[value].sort())}),values},getFilterValue:function(filter,property){switch($.fb("crs.assert",{c:filter,m:"Filter name must must defined"}),$.fb("crs.assert",{c:property,m:"Property must be given"}),filter){case"stars":return property.stars;case"country":return property.location[filter].trim();case"region":case"city":var parts=property.location[filter].split(" "),plen=parts.length-1;for(var i in parts)""!==parts[i]&&(parts[i]=parts[i].charAt(0).toUpperCase()+parts[i].slice(1).toLowerCase()),i==plen&&(parts[i]=parts[i].trim());return parts.join(" ")}return null},getAppliedFilters:function(){var filters={},$filters=$fb.group._containers.$filters;return $filters&&$(".fb-group-filter-check",$filters).each(function(i,o){var $o=$(o);if($o.prop("checked")){var filter=$o.attr("data-group"),value=$o.attr("value");void 0===filters[filter]&&(filters[filter]={}),void 0===filters[filter][value]&&(filters[filter][value]=[]),filters[filter][value]=filters[filter][value].concat($o.attr("data-filter").split(","))}}),filters},getConsolidatedFilters:function(){var filters=$fb.group._.filters.getAppliedFilters();return $.each(filters,function(i,o){filters[i]=Object.keys(o).join(",")}),filters},getFilteredHids:function(filters){var hids=Object.keys($fb._state.app.data.groups[$fb._state.quicksearch.group].properties);return filters=void 0!==filters?filters:$fb.group._.filters.getAppliedFilters(),$.each(filters,function(i,o){var _hids=[];$.each(o,function(j,p){_hids=_hids.concat(p)}),hids=$fb.group._.intersect(hids,_hids)}),hids.sort(),hids},resetFilterValues:function(filter){var $filters=null;($filters=$(filter?'input[data-group="'+filter+'"]':"input[data-group]",$fb.group._containers.$filters)).length&&($filters.prop("checked",!1),$fb.group._.filters.applyFilters())},setFilterValues:function(filter,values){for(var i in"string"==typeof values&&(values=values.split(",")),$fb.log("group.js >> setFilterValues: "+filter,values),values)$fb.group._.filters.setFilterValue(filter,values[i]);$fb.group._.filters.applyFilters()},setFilterValue:function(filter,value,withApply){value=value.trim(),$fb.log("group.js >> setFilterValue: "+filter+" - "+value);var $filter=$('input[data-group="'+filter+'"][value="'+value+'"]',$fb.group._containers.$filters);$filter.length&&$filter.prop("checked",!0),!0===withApply&&$fb.group._.filters.applyFilters()},disableFilters:function(filters){var $filters=$fb.group._containers.$filters;return $filters&&($(".fb-group-filter-check",$filters).prop("disabled",!1),$.each(filters,function(i,o){var _hids=[];$.each(o,function(j,p){_hids=_hids.concat(p)}),_hids.sort();var _hidsPattern="^.*("+(_hids=_hids.join(",")).replace(/,/g,"|")+").*$";$(".fb-group-filter-check",$filters).each(function(j,p){var $p=$(p),group=$p.attr("data-group");i!==group&&($p.attr("data-filter").match(new RegExp(_hidsPattern))||$p.prop("disabled",!0))})})),!0},applyFilters:function(){var filters=$fb.group._.filters.getAppliedFilters(),hids=$fb.group._.filters.getFilteredHids(filters);_.isEmpty($fb.group._state.data.markers)?$fb.group._.list.filterProperties(hids):$fb.group._.map.filterProperties(hids),$fb.group._.filters.disableFilters(filters),$fb._addHistory(),$("#applied-filters-button").css("visibility",Object.keys(filters).length?"visible":"hidden")}},quotation:{init:function(callback){return function(callback){var flowController=new FlowController($fb.group._config.quotation.maxRequestsBySecond,1e3),multiquotationRequester=new MultiquotationRequester,quotationLoader=new QuotationLoader(multiquotationRequester,flowController,$fb._config.quotationCurrency,$fb.group._config.quotation.maxSimultaneousRequests,$fb.group._config.quotation.maxQuotationsByRequest),promiseCache=new window.PromiseCache;$fb.group._state.promiseCache=promiseCache,$fb.group._state.quotationService=new QuotationService(quotationLoader,new QuotationFactory,promiseCache),callback()}(callback)},randomKey:function(){return Math.floor(1e6*Math.random())+""+(new Date).getTime()},findAll:function(){$fb._state.app.data.properties&&$fb._FirePageView(),$fb.group._.quotation.interrupt();var _current=$fb.group._.quotation._current=$fb.group._.quotation.randomKey();if($fb.log("group.js >> multiquotation findAll"),$fb._state.app.data.groups[$fb._state.quicksearch.group].properties){var properties=$fb._state.app.data.groups[$fb._state.quicksearch.group].properties,nights=Math.round(Math.abs(($.fb("crs-helper-parsedate",{date:$fb._state.quicksearch.arrival}).getTime()-$.fb("crs-helper-parsedate",{date:$fb._state.quicksearch.departure}).getTime())/864e5));$(".fb-group-item-pricing").empty(),$fb.group._.list.fade(.5),$fb.group._state.quotationTimeout=setTimeout(function(){$fb.group._.quotation.interrupt()},3e3*Object.keys(properties).length);var $items=$(".fb-group-item:visible").toArray(),requests=[],findForItem=function(){var $propertyItem=$items.shift();if($propertyItem){$propertyItem=$($propertyItem);try{var currentLoyalty=$fb.loyalties&&$fb.loyalties.getCurrentLoyalty(),query={arrival:$fb._state.quicksearch.arrival,departure:$fb._state.quicksearch.departure,nights:nights,adults:$fb._state.quicksearch.occupancy[0].nbAdults,children:$fb._state.quicksearch.occupancy[0].nbChildren,accessCode:$fb._state.quicksearch.accesscode,loyaltyEnable:currentLoyalty&&currentLoyalty.isLogged()?currentLoyalty.getCode():void 0,loyaltyParams:currentLoyalty&&currentLoyalty.isLogged()?currentLoyalty.getQuotationParams():void 0,loyaltyToken:currentLoyalty&&currentLoyalty.isLogged()?currentLoyalty.getLoyaltyToken():void 0,isMobile:$fb._state.isMobile};query.childrenAges=$fb._state.quicksearch.occupancy[0].childrenAges.join(","),requests.push($fb.group._.quotation.findTheBestRate($propertyItem.attr("data-id"),query))}catch(e){$fb.log("Error",e)}setTimeout(function(){_current==$fb.group._.quotation._current&&findForItem()},100)}else"results"===$fb._state.app.step&&Promise.all(requests).then(function(responses){var isThereAvailabilities=responses.reduce(function(isThere,response){return!(!response||!response.getStay())||isThere},!1);$fb.results._setAvailabilityStatus("unavailable-"+(isThereAvailabilities?"partial":"total"))})};findForItem()}},interrupt:function(){$fb.group._state.quotationService&&($fb.group._state.promiseCache.clear("new"),$fb.group._state.quotationService.cancelLoading()),$fb.group._state.quotationTimeout&&clearTimeout($fb.group._state.quotationTimeout),$fb.group._.list.fade(0),$fb.group._.loader.setValue(0),$fb.group._.loader.hide()},findTheBestRate:function(hid,query){var property,group,result;return query.group&&delete query.group,query.property=hid,property=hid,group=$fb._state.quicksearch.group,$fb._state.app.data.groups[group]&&($fb._state.app.data.mcm.enabled=$fb._state.app.data.groups[group].properties[property]&&$fb._state.app.data.groups[group].properties[property].configuration.useMcm),query.mcmEnable=$fb._state.app.data.mcm.enabled,query.property?($fb.log("group.js >> multiquotations",hid,query),$fb.group._.loader.show(),$fb.propertyService.get(hid).then(function(property){_.isEmpty(property.configuration.childrenCategories)&&delete query.childrenAges;var propertySelectionValidationConfiguration={maxAdults:property.configuration.maxAdults,maxChildren:property.configuration.maxChildren,maxPersons:property.configuration.maxPersons,childrenMaxAge:property.configuration.childrenMaxAge,needChildrenAges:!_.isEmpty(property.configuration.childrenCategories)},propertySelectionValidation=$fb.occupancySelectionValidator.validate($fb._state.quicksearch.occupancy,propertySelectionValidationConfiguration);return propertySelectionValidation.hasError?$fb.group._.list.updatePropertyBadgeBadOccupancy(hid,propertySelectionValidation,propertySelectionValidationConfiguration):$fb.group._state.quotationService.findTheBestRate(hid,query).then(function(_result){return(result=_result).getStay()?$fb.group._.list.updatePropertyBadgeWithResult(query,result):$fb.group._.list.updatePropertyBadgeNoAvailabilities(hid)})}).then(function(result){$(".fb-group-infowindow").data("id")===query.property&&$fb.group._.map.updateCurrentPropertyInfoWindow(),$fb.group._state.sorting&&clearTimeout($fb.group._state.sorting),$fb.group._state.sorting=setTimeout($fb.group._.list.sortList,500);var nbQuotationDone=$(".fb-group-item:visible .fb-group-item-pricing:empty").length;return $fb.group._.loader.setValue(100*(1-nbQuotationDone/$(".fb-group-item:visible .fb-group-item-pricing").length)),("results"===$fb._state.app.step||"name"===$fb.group._state.sort&&5<nbQuotationDone)&&$fb.group._.list.fade(0),result})):Promise.resolve()}},events:{change:function(event){if(!$fb._checkEvent("group","click",event))return $fb._callback(event);var $target=$(event.target);switch($fb.log("group.js >> clicked on ",$target),!0){case 0<$target.closest("#fb-group-sort-form").length:$fb.group._state.sort=$('input[name="group-list-sort"]:checked').val(),$fb.group._.list.sortList();break;case 0<$target.closest(".fb-group-filters").length:$fb.group._.filters.applyFilters()}},click:function(event){if(!$fb._checkEvent("group","click",event))return $fb._callback(event);var $target=$(event.target);switch($fb.log("group.js >> clicked on ",$target),!0){case"reset-applied-filters-button"==$target.attr("id"):case 0<$target.closest("#reset-applied-filters-button").length:return $fb.group._.filters.resetFilterValues(),event.stopPropagation(),!1;case 0<$target.closest("#applied-filters-button").length:case 0<$target.closest("#fb-group-filters-caret").length:case"fb-group-filters-caret"==$target.attr("id"):$target.parent().toggleClass("active"),$fb.group._containers.$filters.find(".fb-filters-form").slideToggle();break;case 0<$target.closest(".fb-group-gotorooms").length:$target=$target.closest(".fb-group-gotorooms");case $target.hasClass("fb-group-gotorooms"):$fb.log("click view rooms for "+$target.attr("data-ref")),$fb._triggerEvent("fastbooking-crs-frontend-emptySelection",{}),$fb.group._.gotorooms($target.attr("data-ref"));break;case 0<$target.closest(".fb-group-property-details").length:$target=$target.closest(".fb-group-property-details");case $target.hasClass("fb-group-property-details"):$fb.log("click hotel details for property"+$target.attr("data-ref")),$fb._triggerEvent("fastbooking-crs-frontend-hoteldetails-open",{property:$target.attr("data-ref"),offset:$("#"+$target.attr("data-offset")).offset().top});break;case 0<$target.closest(".fb-group-item").length:$target=$target.closest(".fb-group-item"),$fb.group._.map.clickOnMarker($target.attr("data-id"));break;case 0<$target.closest(".fb-group-infowindow-close").length:$fb.group._.map.closeAllInfoWindows()}return $fb._callback(event)},resize:function(event){if($fb.group._containers.$map){$fb.group._state.resizeTimeout&&clearTimeout($fb.group._state.resizeTimeout);var resizeCallback=function(){if($("#fb-quicksearch").length){var bottomOffset=window.innerWidth<610?0:2,height=$(window).height()-160-bottomOffset;$fb.log("group.js >> resize: 160 - "+bottomOffset+" - "+($(window).height()-160-bottomOffset)),$fb.group._containers.$map.css("position","absolute").css("top",160).css("height",height),$fb.group._containers.$list.css("height",height)}};return void 0!==event?$fb.group._state.resizeTimeout=setTimeout(resizeCallback,250):resizeCallback(),event instanceof jQuery.Event?(event.stopPropagation(),$fb._callback(event)):void 0}}},intersect:function(a,b){return $.grep(a,function(i){return-1<$.inArray(i,b)})},gotorooms:function(property){setTimeout(function(){$fb._state.quicksearch.property=property,$fb._ChangeAppStep("results"),$fb._addHistory(),window.location.reload()},200)}}}}),$(document).on("fastbooking-crs-frontend-group-init.group",$fb.group.init),$(document).on("fastbooking-crs-frontend-group-render.group",$fb.group.render),$(document).on("fastbooking-crs-frontend-load-group-done.group",$fb.group.render),$(document).on("fastbooking-crs-frontend-group-quotation.group",$fb.group._.quotation.findAll),$(document).on("fastbooking-crs-frontend-group-consolidated-filters.group",$fb.group._.filters.getConsolidatedFilters),$(document).off("fastbooking-crs-frontend-group-map-loaded.group").on("fastbooking-crs-frontend-group-map-loaded.group",$fb.group._.map.render),$(document).off("fastbooking-crs-frontend-quicksearch-update.group").on("fastbooking-crs-frontend-quicksearch-update.group",$fb.group.render),$(document).one("fastbooking-crs-frontend-group-list-rendered.group-first-run",$fb.group._.quotation.findAll),$(document).one("fastbooking-crs-frontend-group-map-loaded.group-first-run",function(){$fb.group._.map.updatePropertiesMarkers($fb._state.app.data.groups[$fb._state.quicksearch.group].properties),$fb._state.p&&$fb._state.p.filters&&setTimeout(function(){for(var filter in $fb._state.p.filters)$fb.log("group.js >> apply URL filter: "+filter+" - "+$fb._state.p.filters[filter]),$fb.group._.filters.setFilterValues(filter,$fb._state.p.filters[filter])},250)}),$(document).one("fastbooking-crs-frontend-run.group",function(){$.fb("fastbooking-crs-frontend-group-init")}),$(document).on("fastbooking-crs-frontend-load-countries-done",function(){if($(".fb-filter-group-country").length){var filters=$fb.group._state.data.filters,col=12/Object.keys(filters).length,countryFilterBlock=$fb.group._.filters.getFilterGroup("country",filters);countryFilterBlock.addClass("col-xs-"+col),$(".fb-filter-group-country").replaceWith(countryFilterBlock)}if($fb._state.app.data.groups[$fb._state.quicksearch.group]){var properties=$fb._state.app.data.groups[$fb._state.quicksearch.group].properties;_.each(properties,function(property,hid){var translatedAddress=$fb.group._.list.getPropertyBadgeDescription(property);$("#group-item-"+hid+" .fb-group-item-desc").replaceWith(translatedAddress)})}})}(window.jQuery,window.$fb.underscore),function($,_){$.extend(window.$fb,{results:_.extend({},EventEmitter.prototype,{_container:null,_config:{},_state:{initialized:!1,availabilityStatus:null,putCampaignRatesTopOfRoom:null,hasUserAlreadyRefusedUpsell:!1,areCampaignsFinishedBeingLoaded:!1,didPromoCodeUnlockCampaigns:!1,didPromoCodeUnlockRates:!1,needLockQuotation:!1},init:function(event){if($fb.results._state.initialized)return $fb._callback(event);void 0!==$fb._state.initialPutCampaignRatesTopOfRoom&&($fb.results._state.putCampaignRatesTopOfRoom=$fb._state.initialPutCampaignRatesTopOfRoom,delete $fb._state.initialPutCampaignRatesTopOfRoom);var property=$fb._state.app.data.properties[$fb._state.quicksearch.property];property&&null===$fb.results._state.putCampaignRatesTopOfRoom&&($fb.results._state.putCampaignRatesTopOfRoom=property.bookingEngineFrontend.results.checkCheckboxOffersFirst),window.dataLayerFB.push({consentManagementPlatform:property.configuration.consentManagementPlatform}),$fb.results._state.initialized=!0,$fb._callback(event)},getAvailabilityStatus:function(){if(this._state.availabilityStatus)return Promise.resolve(this._state.availabilityStatus);var self=this;return new Promise(function(resolve){var cb=function(){self._state.availabilityStatus&&(self.off("setAvailabilityStatus",cb),resolve(self._state.availabilityStatus))};self.on("setAvailabilityStatus",cb)})},_setAvailabilityStatus:function(value){this._state.availabilityStatus=value,this.trigger("setAvailabilityStatus")},_setLastModifiedPackage:function(packId){$fb._state.lastModifiedPackage={package:$fb._state.app.data.quotation.packages[packId]},$fb._state.app.data.quotation.terms&&($fb._state.lastModifiedPackage.terms=$fb._state.app.data.quotation.terms[packId]),$fb._state.lastModifiedPackage.package&&($fb._state.lastModifiedPackage.package[0].pack=packId)},_renderPropertyNote:function(strait){return $fb.propertyService.get($fb._state.quicksearch.property).then(function(property){return $fb.propertyService.getNoteIfAvailable(property,$fb._state.quicksearch.arrival,$fb._state.quicksearch.departure)}).then(function(noteIfAvailable){if(noteIfAvailable&&!document.querySelector(".fb-result-note-container"))return $('<div class="fb-container container"></div>').append($('<div class="fb-result-note-container container"></div>').append(new $fb.PropertyNote(noteIfAvailable).render().prepend('<i class="fa fa-exclamation-circle"></i>')).css(strait?{}:{paddingLeft:"0"}))})},render:function(event){if(null===$fb.results._container&&($fb.results._container=$fb._checkContainer("results")),"results"!==$fb._state.app.step)return $fb.results._container.empty(),$fb._callback(event);$fb._state.app.data.properties&&void 0!==$fb._state.app.data.properties[$fb._state.quicksearch.property]&&$fb._FirePageView();var occupancyValidation=$fb.occupancySelectionValidator.validate($fb._state.quicksearch.occupancy,$fb._state.quicksearch.configuration);return occupancyValidation.hasError?($fb.results._displayOccupancySelection(occupancyValidation),$fb._callback(event)):$fb.areAllPackagesSelected()?($fb._ChangeAppStep($fb.selection.hasAvailableServices()?"extras":"validate-collect"),$fb._addHistory(),$fb._checkStep(),$.fb("crs-helper-scrollTo",{id:"#fb-header"}),$fb._triggerEvent("fastbooking-crs-frontend-renderAll")):$fb.results._state.data&&$fb.results._state.data.accommodations&&Object.keys($fb.results._state.data.accommodations).length?$fb._state.needLockQuotation?$('<div id="results-items" class="container fb-container" />').append($.fb("crs-helper-translate",{key:"please-wait"}).append("...")):($fb.results._container.html($fb.results._renderResults($fb.results._state.data,!1,$fb._state.app.data.quotation.query)),$fb.results._renderPropertyNote(!0).then($fb.results._container.prepend.bind($fb.results._container)),$(window).scrollTop(0),void $fb.results._syncDataLayer()):$fb.selection.isEmpty()?$fb._callback(event):($fb.results._container.html($fb.results._renderNoMoreRoomForThisRate()),void $(window).scrollTop(0))},_renderNoMoreRoomForThisRate:function(){return $('<div id="results-items" class="container fb-container" />').append($('<div class="col-xs-12 fb-result-subheader"/>').append($.fb("crs-helper-translate",{key:"last-rate-room-booked-congrat"}).addClass("col-xs-12 fb-font-bold")).append($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"last-rate-room-booked"})}).addClass("col-xs-12")))},_syncDataLayer:function(){if(window.dataLayerFB){var dataLayerSystemResponse=window.dataLayerFB.filter(function(layer){return"System Response"===layer.event}).pop();if(dataLayerSystemResponse&&dataLayerSystemResponse.packages){var normalizePrice=function(price){return parseInt(100*price)},priceList=_.uniq($("span.fb-price").map(function(){return normalizePrice($(this).data("price"))}).get());dataLayerSystemResponse.packages.sort(function(package1,package2){var price1=normalizePrice(package1.price.gross),price2=normalizePrice(package2.price.gross),indexPrice1=priceList.indexOf(price1),indexPrice2=priceList.indexOf(price2);return-1===indexPrice1&&-1===indexPrice2?0:-1===indexPrice1?1:-1===indexPrice2?-1:indexPrice1-indexPrice2});for(var i=0;i<dataLayerSystemResponse.packages.length;i++)dataLayerSystemResponse.packages[i].position=i}}},_toggleIneffectivePromoCodeMessageIfReady:function(){if($fb._.hasFeature("ineffective-promocode-message","activate",$fb._state.quicksearch.property)&&$fb._state.areCampaignsFinishedBeingLoaded){var ineffectivePromoCodeDiv,displayMessage=!$fb._state.didPromoCodeUnlockCampaigns&&!$fb._state.didPromoCodeUnlockRates&&$fb._state.quicksearch.accesscode;if(0==$("#ineffective-promo-code").length){ineffectivePromoCodeDiv=$("<div id='ineffective-promo-code' />");var ineffectivePromoCodeExclamationMark=$("<span class = 'red-text exclamation-mark'>!</span>"),ineffectivePromoCodeCloseButton=$("<span id='ineffective-promo-code-close-button'>X</span>");ineffectivePromoCodeDiv.append(ineffectivePromoCodeExclamationMark).append($.fb("crs-helper-translate",{key:"promo-code-invalid",placeholders:[$fb._state.quicksearch.accesscode]}).addClass("ineffective-promo-code-message first-row red-text")).append(ineffectivePromoCodeCloseButton).append("<br/>").append($.fb("crs-helper-translate",{key:"promo-code-try-another"}).addClass("ineffective-promo-code-message second-row")),$fb.results._container.prepend(ineffectivePromoCodeDiv),ineffectivePromoCodeCloseButton.on("click",function(){ineffectivePromoCodeDiv.css("display","none")})}else ineffectivePromoCodeDiv=$("#ineffective-promo-code");displayMessage?(ineffectivePromoCodeDiv.css("display","block"),$fb.removePromoCodeFromAllState()):ineffectivePromoCodeDiv.css("display","none")}},_getTooManyFiltersOnInfo:function(){return $('<div class="col-xs-12 fb-result-subheader"/>').append($.fb("crs-helper-translate",{key:"no-rooms-maching-filters"}).addClass("col-xs-12 fb-font-bold")).append($.fb("crs-helper-translate",{key:"please-reset-filters"}))},_getResultsHeader:function(thereIsASelectedAccommodation){var resultHeader=$('<div id="fb-results-header" class="col-xs-12 fb-result-header" />'),bestRate=$.fb("crs-helper-getExclusiveBestRateMention");if(thereIsASelectedAccommodation)return resultHeader.append($('<span class="title1 fb-font-light" />').append($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"results-selected-room"})}))).append(bestRate);var i18nKey=["results-choose-first-room","results-choose-second-room","results-choose-third-room"][$fb.selection.nbRooms()];return resultHeader.append($('<span class="title1 fb-font-light" />').append($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:i18nKey})}))).append(bestRate)},_getResultsHeaderForAlternateResults:function(arrivalDate,departureDate){return $('<div id="fb-results-header" class="col-xs-12 fb-result-header" />').append($('<span class="title1 fb-font-light" />').append($.fb("crs-helper-translate",{key:"calendar-other-results"}))).append($('<span class="col-xs-12 fb-dark-gray" />').append($.fb("crs-helper-translate",{key:"date-from-to",placeholders:[$("<div/>").append($.fb("crs-helper-date",{date:arrivalDate})).html(),$("<div/>").append($.fb("crs-helper-date",{date:departureDate})).html()]})).append(", ").append($.fb("crs-helper-translate",{key:"adult",mode:1,placeholders:[1]})))},_renderResults:function(results,alternate,query){var $results=$('<div id="results-items" class="container fb-container" />');if(!$fb.resultsFilter.hasSomeFiltersSet()||(results=$fb.quotationResultsHelper.filterWithPredicate(results,function(rate,pack){return $fb.resultsFilter.isMatchingFilters(rate,pack)}),Object.keys(results.accommodations).length)){if(alternate?$results.append($fb.results._getResultsHeaderForAlternateResults(query.arrival,query.departure)):$results.append($fb.results._getResultsHeader($fb._state.quicksearch.accommodation&&results.accommodations[$fb._state.quicksearch.accommodation])),$fb._state.quicksearch.accommodation&&results.accommodations[$fb._state.quicksearch.accommodation]&&($results.append($fb.results._renderAccommodationAndRates(results.accommodations[$fb._state.quicksearch.accommodation],query)),2<=Object.keys(results.accommodations).length)){var subResultHeader=$('<div id="fb-results-subheader" class="col-xs-12 fb-result-header fb-result-subheader" />').css("padding-right","0").css("padding-bottom","0").append($('<span class="title1 fb-font-light" />').append($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"results-selected-room-others"})})));$results.append(subResultHeader)}var accommodationResults=_.chain(results.accommodations).filter(function(accommodation,accommodationName){return accommodationName!==$fb._state.quicksearch.accommodation}).map(function(accommodation){return $fb.results._renderAccommodationAndRates(accommodation,query)}).value();$fb.results._sortAccommodationsResults(accommodationResults),$results.append(accommodationResults);var campaignIds=_(results.accommodations).chain().map(function(accommodation){return accommodation.rates}).flatten().filter(function(rate){return void 0!==rate.campaign}).map(function(filteredRate){return filteredRate.campaign.id}).value();if(0<campaignIds.length)!function(){function updateCheckboxAndResults(){var checkbox=$("#results-opt-offers-top-for-each-room .fb-checkbox");checkbox.toggleClass("fb-unchecked fb-checked"),$fb.results._state.putCampaignRatesTopOfRoom=checkbox.hasClass("fb-checked"),$fb.results.render({})}var classes="theme-checkbox fb-checkbox fb-"+($fb.results._state.putCampaignRatesTopOfRoom?"":"un")+"checked",$putCampaignRatesTopOfRoomAction=$('<span class="'+classes+'"/>').append('<i class="fa fa-check"></i>').click(updateCheckboxAndResults),$putCampaignRatesTopOfRoomLabel=$("<label />").append($.fb("crs-helper-translate",{key:"results-offers-top-for-each-room"})).click(updateCheckboxAndResults),$putCampaignRatesTopOfRoomView=$("<span />",{class:"col-xs-12",id:"results-opt-offers-top-for-each-room"}).append($putCampaignRatesTopOfRoomAction,$putCampaignRatesTopOfRoomLabel);$results.find("#fb-results-header").append($putCampaignRatesTopOfRoomView)}(),_.some(campaignIds,function(campaignId){return!$fb._state.app.data.campaigns||!$fb._state.app.data.campaigns[campaignId]})?$(document).one("fastbooking-crs-frontend-load-campaigns-done",function(){$fb.results._checkIfPromoCodeUnlockedCampaigns(campaignIds)}):$fb.results._checkIfPromoCodeUnlockedCampaigns(campaignIds);else $fb._state.didPromoCodeUnlockCampaigns=!1,$fb._state.areCampaignsFinishedBeingLoaded=!0,$fb.results._toggleIneffectivePromoCodeMessageIfReady();return $results}$results.append($fb.results._getTooManyFiltersOnInfo())},_checkIfPromoCodeUnlockedCampaigns:function(campaignIdsToCheck){$fb._state.didPromoCodeUnlockCampaigns=_.some($fb._state.app.data.campaigns,function(campaign){return campaign.accessCode===$fb._state.quicksearch.accesscode&&"RESTRICTED"===campaign.audience&&-1!==campaignIdsToCheck.indexOf(campaign.id)}),$fb._state.areCampaignsFinishedBeingLoaded=!0,$fb.results._toggleIneffectivePromoCodeMessageIfReady()},_sortAccommodationsResults:function(accommodations){$fb.results._state.putCampaignRatesTopOfRoom?accommodations.sort($fb.results._.accommodationsSort.priceAndCampaign):accommodations.sort($fb.results._.accommodationsSort.priceOnly)},_renderAccommodationAndRates:function(accommodation,query){var rateOutput=$("<div/>"),extraRateOutput=null,accRateCount=0,maxRates=$fb._config.maxRates;if(_.some(accommodation.rates,function(rate){return rate.unlockedByAccessCode})&&($fb._state.didPromoCodeUnlockRates=!0),$fb.results._toggleIneffectivePromoCodeMessageIfReady(),accommodation.rates.sort(function(a,b){return a.price<b.price?-1:a.price>b.price?1:0}),$fb.results._state.putCampaignRatesTopOfRoom){var noPromotions=accommodation.rates.filter(function(rate){return!rate.campaign}),promotions=accommodation.rates.filter(function(rate){return!!rate.campaign});accommodation.rates=promotions.concat(noPromotions)}return $.each(accommodation.rates,function(id,rate){if(null===$fb._state.app.lockedRate||$fb._state.app.lockedRate==rate.rate){if(0<accRateCount&&accRateCount===maxRates){var $extraRateLink=$('<a href="#" class="theme-link" />').append($.fb("crs-helper-translate",{key:"results-more-offers"})).click(function(event){return event.preventDefault(),$(this).html($.fb("crs-helper-translate",{key:"please-wait"}).append("...")),$("#accommodation-"+accommodation.id+"-extrarates").slideDown("slow",function(){$("#accommodation-"+accommodation.id+"-extrarates-header").hide()}),$("#accommodation-"+accommodation.id+"-extrarates").children("div").each(function(){var accommodationId=$(this).attr("data-accommodation"),rateName=$(this).attr("data-rate"),packId=$(this).attr("data-pack"),that=$(this),compiledAccommodations=$fb.results._state.data.accommodations;compiledAccommodations[accommodationId]&&$.each(compiledAccommodations[accommodationId].rates,function(id,rate){rate.rate===rateName&&rate.packId===packId&&that.append($fb.results._renderRate(rate,compiledAccommodations[accommodationId].items[rate.packId],query))}),rateOutput.find(".mcm-dealOfTheDayBanner").slice(1).removeClass("mcm-dealOfTheDayBanner")}),!1});rateOutput.append($("<div>",{id:"accommodation-"+accommodation.id+"-extrarates-header",class:"col-xs-12 fb-light-bg fb-results-extrarates-header text-center"}).append($extraRateLink)),extraRateOutput=$('<div id="accommodation-'+accommodation.id+'-extrarates" class="fb-results-extrarates" />')}maxRates<=accRateCount?extraRateOutput.append($('<div data-rate="'+rate.rate+'" data-accommodation="'+accommodation.id+'" data-pack="'+rate.packId+'">')):rateOutput.append($fb.results._renderRate(rate,accommodation.items[rate.packId],query)),accRateCount++}}),null!==extraRateOutput&&rateOutput.append(extraRateOutput),rateOutput.find(".mcm-dealOfTheDayBanner").slice(1).removeClass("mcm-dealOfTheDayBanner"),accRateCount<=0?null:$fb.results._renderAccomodation(accommodation,rateOutput)},_renderRateDetails:function(rate){var ratekeyTitle=$fb._state.quicksearch.property+":promotiontitle:"+rate.rate,rateData=null;$fb._state.app.data.rates&&$fb._state.app.data.rates[$fb._state.quicksearch.property]&&$fb._state.app.data.rates[$fb._state.quicksearch.property][rate.rate]&&(rateData=$fb._state.app.data.rates[$fb._state.quicksearch.property][rate.rate]);var rateDesckey=$fb._state.quicksearch.property+":promotiondesc:"+rate.rate,rateDetails=$('<div id="fb-rate-details-'+rate.rate+"-"+rate.accommodation+"-"+rate.packId+'" class="col-xs-12 fb-results-rate-details fb-gray-bg fb-container"/>'),rateName=$("<div/>").append($("<span/>").append($.fb("crs-helper-translate",{key:ratekeyTitle,fallback:rateData?rateData.title:rate.rate})));if(rateDetails.append($('<div class="hidden-xs col-sm-9 fb-results-rate-details-head ellipsis">').append($.fb("crs-helper-translate",{key:"result-offer-details",placeholders:[rateName.html()]}))),rateDetails.append($('<div class="hidden-xs col-sm-3 fb-results-rate-details-head text-right">').append($('<a href="#" class="theme-link" />').append($.fb("crs-helper-translate",{key:"Close"}).addClass("detail-links")).click(function(event){event.preventDefault();var accommodationEscaped=rate.accommodation.replace(".","\\."),rateEscaped=rate.rate.replace(".","\\."),ratePackIdEscaped=rate.packId.replace(".","\\.");$("#fb-rate-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle();var rateDivId="#"+[rate.property,rate.packId,rateEscaped,accommodationEscaped].join("-");return $(rateDivId+" span.details a i.fa").toggleClass("fa-caret-right").toggleClass("fa-caret-down"),!1}))),rate.campaign){var campaignTitle=$.fb("crs-helper-translate",{key:"campaign-"+rate.campaign.id}).addClass("campaign-text-color block"),campaignDesc=$.fb("crs-helper-translate",{key:"campaignDesc-"+rate.campaign.id,fallback:"",disableHTMLClean:!0}).addClass("campaignDesc");rateDetails.append($('<div class="col-xs-12 fb-results-rate-details-body">').append(campaignTitle).append(campaignDesc))}var span=$.fb("crs-helper-translate",{key:rateDesckey,fallback:rateData?rateData.description:"",disableHTMLClean:!0});return rateData&&rateData.image&&rateData.image.url?(rateDetails.append($('<div class="col-xs-3 fb-results-rate-details-body-left">').append($("<img>",{src:$.fb("crs-helper-image",{src:rateData.image.url,width:132,scale:1}).attr("src"),border:"0",width:"100%"}))),rateDetails.append($('<div class="col-xs-9 fb-results-rate-details-body-right">').append(span))):rateDetails.append($('<div class="col-xs-12 fb-results-rate-details-body">').append(span)),rateDetails.append(this._renderTermsLink(rate)),rateDetails},_showTerms:function(rate){var $terms=$fb._checkContainer("results_terms"),dialog=$('<div class="fb-modal-layer-inner" />'),cancelData=$fb.standardize.cancellation.getFromTerms(rate.terms),paymentData=$fb.standardize.payment.getFromTerms(rate.terms),salesTermsName=rate.terms.conditions;$terms.empty().addClass("fb-modal-layer fb-dark-bg");var $btn=$('<button class="btn fb-action fb-font-bold theme-btn btn-close">X</button>');$btn.click(function(event){return event.preventDefault(),$fb._triggerEvent("fastbooking-crs-frontend-ui-hide-modal",{modal:"results_terms",modules:$fb._state.app.modules,offset:window.scrollY},function(){return $fb._callback(event)}),!1}),dialog.append($('<div class="col-xs-12 text-right"></div>').append($btn));var container=$('<div class="container"/>').append($('<div id="fb-confirmbutton_terms-top" class="col-xs-12 fb-localize-title fb-dialog-title fb-font-light" />').append($.fb("crs-helper-translate",{key:"booking-sales-conditions"}))).append($('<div class="col-xs-12 fb-font-light" style="margin-top: 40px;" />').append(paymentData.legalDesc)).append($('<div class="col-xs-12 fb-font-light"/>').append(cancelData.legalDesc)).append($('<div class="col-xs-12 fb-font-light" id="fb-st-container2"/>'));dialog.append(container),$terms.append(dialog),$fb._triggerEvent("fastbooking-crs-frontend-load-salesterms",{terms:salesTermsName},function(){if($fb._state.app.data.salesterms[$fb._state.quicksearch.property]&&$fb._state.app.data.salesterms[$fb._state.quicksearch.property][salesTermsName]&&$fb._state.app.data.salesterms[$fb._state.quicksearch.property][salesTermsName][$fb._state.app.locale]){var salesTerms=$fb._state.app.data.salesterms[$fb._state.quicksearch.property][salesTermsName][$fb._state.app.locale];$("#fb-st-container2").html(salesTerms)}$fb._triggerEvent("fastbooking-crs-frontend-ui-show-modal",{modal:"results_terms",modules:$fb._state.app.modules},function(){})})},_renderTermsLink:function(rate){var $link=$("<a>",{href:"javascript:void(0)",class:"termsLink theme-link"}).append($.fb("crs-helper-translate",{key:"booking-sales-conditions"}).addClass("detail-links")).click(function(){$fb.results._showTerms(rate)});return $("<div>",{class:"clearfix col-xs-12"}).append($("<p>",{class:"text-right"}).append($link))},_renderRateMealDetails:function(rate,mealData){var mealTitle,mealDesc,mealTitleTranslationKey=mealTitle=mealData.rateKeyDescTitle,mealDescriptionTranslationKey=mealDesc=mealData.rateKeyDesc;mealTitle&&(mealTitleTranslationKey=$fb._state.quicksearch.property+":mealtitle:"+mealData.rateKeyDescTitle,mealDescriptionTranslationKey=$fb._state.quicksearch.property+":mealdesc:"+mealData.rateKeyDescTitle);var mealDetails=$('<div id="fb-meal-details-'+rate.rate+"-"+rate.accommodation+"-"+rate.packId+'" class="col-xs-12 fb-results-rate-details fb-gray-bg fb-container"/>');return mealDetails.append($('<div class="hidden-xs col-sm-9 fb-results-rate-details-head fb-font-bold">').append($.fb("crs-helper-translate",{key:mealTitleTranslationKey,fallback:mealTitle}))),mealDetails.append($('<div class="hidden-xs col-sm-3 fb-results-rate-details-head text-right">').append($('<a href="#" class="theme-link" />').append($.fb("crs-helper-translate",{key:"Close"})).click(function(event){return event.preventDefault(),$("#fb-meal-details-"+rate.rate+"-"+rate.accommodation+"-"+rate.packId).slideToggle(),!1}))),mealData.rateKeyDescImage?(mealDetails.append($('<div class="col-xs-3 fb-results-rate-details-body-left">').append('<img src="'+$.fb("crs-helper-image",{src:mealData.rateKeyDescImage,width:132,scale:1}).attr("src")+'" border="0" width="100%" />')),mealDetails.append($('<div class="col-xs-9 fb-results-rate-details-body-right">').append($.fb("crs-helper-translate",{key:mealDescriptionTranslationKey,fallback:mealDesc,disableHTMLClean:!0})))):mealDetails.append($('<div class="col-xs-12 fb-results-rate-details-body">').append($.fb("crs-helper-translate",{key:mealDescriptionTranslationKey,fallback:mealDesc,disableHTMLClean:!0}))),mealDetails},_renderRateCancellationDetails:function(rate,cancelData){var cancelDetails=$('<div id="fb-cancel-details-'+rate.rate+"-"+rate.accommodation+"-"+rate.packId+'" class="col-xs-12 fb-results-rate-details fb-gray-bg fb-container"/>');return cancelDetails.append($('<div class="hidden-xs col-sm-9 fb-results-rate-details-head fb-font-bold">').append(cancelData.label.clone())),cancelDetails.append($('<div class="hidden-xs col-sm-3 fb-results-rate-details-head text-right">').append($('<a href="#" class="theme-link" />').append($.fb("crs-helper-translate",{key:"Close"})).click(function(event){return event.preventDefault(),$("#fb-cancel-details-"+rate.rate+"-"+rate.accommodation+"-"+rate.packId).slideToggle(),!1}))),cancelDetails.append($('<div class="col-xs-12 fb-results-rate-details-body">').append(cancelData.rateDesc)),cancelDetails.append(this._renderTermsLink(rate)),cancelDetails},_renderRatePaymentDetails:function(rate,paymentData){var paymentDetails=$('<div id="fb-payment-details-'+rate.rate+"-"+rate.accommodation+"-"+rate.packId+'" class="col-xs-12 fb-results-rate-details fb-gray-bg fb-container"/>');return paymentDetails.append($('<div class="hidden-xs col-sm-9 fb-results-rate-details-head fb-font-bold">').append(paymentData.rateLabel.clone())),paymentDetails.append($('<div class="hidden-xs col-sm-3 fb-results-rate-details-head text-right">').append($('<a href="#" class="theme-link" />').append($.fb("crs-helper-translate",{key:"Close"})).click(function(event){return event.preventDefault(),$("#fb-payment-details-"+rate.rate+"-"+rate.accommodation+"-"+rate.packId).slideToggle(),!1}))),paymentDetails.append($('<div class="col-xs-12 fb-results-rate-details-body">').append(paymentData.legalDesc)),paymentDetails.append(this._renderTermsLink(rate)),paymentDetails},_renderRateDetailsBtn:function(rate){var rateData=null;$fb._state.app.data.rates&&$fb._state.app.data.rates[$fb._state.quicksearch.property]&&$fb._state.app.data.rates[$fb._state.quicksearch.property][rate.rate]&&(rateData=$fb._state.app.data.rates[$fb._state.quicksearch.property][rate.rate]);var ratekeyTitle=$fb._state.quicksearch.property+":promotiontitle:"+rate.rate,rateDetailsBtn=$('<a href="#" data-key="Details" />').append('<i class="fa fa-caret-right"></i>').append($.fb("crs-helper-translate",{key:ratekeyTitle,fallback:rateData?rateData.title:rate.rate}).addClass("rate-title"));return rateDetailsBtn.click(function(event){event.preventDefault(),$(event.currentTarget.childNodes[0]).toggleClass("fa-caret-right").toggleClass("fa-caret-down"),$fb.results._setLastModifiedPackage(rate.packId);var accommodationEscaped=rate.accommodation.replace(".","\\."),rateEscaped=rate.rate.replace(".","\\."),ratePackIdEscaped=rate.packId.replace(".","\\."),alreadyOpenRates=$("div.fb-results-rate-details:not(#fb-rate-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped+")").filter(":visible");return 0<alreadyOpenRates.length?alreadyOpenRates.slideToggle(300,function(){alreadyOpenRates.parent().find(".fb-results-rate-title i.fa").toggleClass("fa-caret-down").toggleClass("fa-caret-right"),$("#fb-rate-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle()}):$("#fb-rate-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle(),!1}),rateDetailsBtn},_renderRateTitle:function(rate){var rateTitle=$('<div class="fb-results-rate-title"/>').append($('<span class="details" />').append($fb.results._renderRateDetailsBtn(rate)));if(!!rate.campaign){var applyTitle=function(){"DEAL"===$fb._state.app.data.campaigns[rate.campaign.id].websiteDisplayName&&rateTitle.find(".rate-title:first").replaceWith($.fb("crs-helper-translate",{key:"campaign-"+rate.campaign.id}))};rate.campaign&&$fb._state.app.data.campaigns[rate.campaign.id]?applyTitle():$(document).one("fastbooking-crs-frontend-load-campaigns-done",applyTitle)}return rateTitle},_renderRateStress:function(rate){var shouldDisplayRoomsLeft=!(!$fb._state.app.data.stressRoomsLeftDisplay||!0!==$fb._state.app.data.stressRoomsLeftDisplay.enabled),roomsLeftThreshold=$fb._state.app.data.stressRoomsLeftThreshold&&!isNaN($fb._state.app.data.stressRoomsLeftThreshold)?$fb._state.app.data.stressRoomsLeftThreshold:0;if(shouldDisplayRoomsLeft&&rate.minAvailability<roomsLeftThreshold)return $("<span />").append($.fb("crs-helper-translate",{key:1<rate.minAvailability?"Only-x-accommodations-left":"Only-x-accommodation-left",placeholders:[rate.minAvailability]})).css("font-size","13px").css("color","red")},_renderRate:function(rate,packages,contextQuery){var outputContainer=$("<div/>"),mealData=$fb.standardize.meal(rate.rate),cancelData=$fb.standardize.cancellation.getFromTerms(rate.terms),paymentData=$fb.standardize.payment.getFromTerms(rate.terms);return!0===(!!rate.campaign&&rate.campaign.isDealOfTheDay)&&(outputContainer.addClass("mcm-dealOfTheDayBanner"),outputContainer.append($fb.results._renderDealOfTheDay(rate.campaign))),outputContainer.append($fb.results._renderRateMainOutput(rate,mealData,packages,contextQuery,cancelData,paymentData)).append($fb.results._renderRateDetails(rate)).append($fb.results._renderRateMealDetails(rate,mealData)).append($fb.results._renderRateCancellationDetails(rate,cancelData)).append($fb.results._renderRatePaymentDetails(rate,paymentData)),outputContainer},_renderRateMainOutput:function(rate,mealData,packages,contextQuery,cancelData,paymentData){var outputId=[rate.property,rate.packId,rate.rate,rate.accommodation].join("-"),renderers={title:function(){return $fb.results._renderRateTitle(rate)},stress:function(){return $fb.results._renderRateStress(rate)},labels:function(){if(rate.campaign){var container=$('<div class="fb-results-rate-labels-container" />').append($fb.results._renderDealPromotionTag(rate,mealData.rateKeyDescTitle&&""!==mealData.rateKeyDescTitle)),addDealTitleIfNeeded=function(){"RATE+DEAL"===($fb._state.app.data.campaigns[rate.campaign.id].websiteDisplayName||"RATE+DEAL")&&container.append($.fb("crs-helper-translate",{key:"campaign-"+rate.campaign.id}).addClass("campaign-text-color campaign-title"))};return $fb._state.app.data.campaigns[rate.campaign.id]?addDealTitleIfNeeded():$(document).one("fastbooking-crs-frontend-load-campaigns-done",addDealTitleIfNeeded),container}},horizontalRatekeys:function(){return $fb.results._renderHorizontalRateKeys(rate,mealData,cancelData,paymentData)},verticalRatekeys:function(){return $fb.results._renderVerticalRateKeys(rate,mealData,cancelData,paymentData)},xNightsXPersons:function(){return $('<span class="fb-dark-gray fb-price-small-text" />').append($.fb("crs-helper-translate",{key:"night",mode:rate.nights,placeholders:[rate.nights]})).append('<span class="fb-price-params-separator">, </span>').append($.fb("crs-helper-translate",{key:"person",mode:rate.adults+rate.children,placeholders:[rate.adults+rate.children]}))},btnSelectTeasingMember:function(){if(rate.teasingMemberPrice||0<=rate.teasingMemberPoint){var teasingMemberPoint=rate.teasingMemberPoint?rate.teasingMemberPoint:null,button=$('<button class="btn btn--member-price btn--with-tooltip"/>').append('<i class="fa fa-lock"></i>').click(function(){$fb.results._onClickSelectBtn(contextQuery,rate,packages,void 0,!0)});if($fb._state.isMobile)button.append($.fb("crs-helper-translate",{key:"results-rate-choose-member"}).addClass("member-price-text"),$.fb("crs-helper-price",{price:rate.teasingMemberPrice,pricepoint:teasingMemberPoint}));else{var loyaltyDiscountPlaceholder=rate.teasingMemberDiscount+"%",tooltip=$('<span class="member-price--tooltip" />').append($.fb("crs-helper-translate",{key:"member-rate-signin-tooltip"}),"</br>",$.fb("crs-helper-translate",{key:"member-rate-discount-tooltip",placeholders:[loyaltyDiscountPlaceholder]}));button.append($.fb("crs-helper-price",{price:rate.teasingMemberPrice,pricepoint:teasingMemberPoint}),tooltip)}return button}},btnSelectNormal:function(){var button=$('<button class="btn theme-btn fb-action fb-font-bold btn--price-select" />').append($.fb("crs-helper-translate",{key:"results-rate-choose"}).css("text-transform","uppercase")).click(function(){var packagesToUse=packages;rate.teasingMemberPrice&&(packagesToUse=packages.map(function(item){return _.extend({},item)})).forEach(function(item){delete item.loyaltyDiscount,delete item.pricesLoyalty}),$fb.results._onClickSelectBtn(contextQuery,rate,packagesToUse)});if(rate.memberOnly&&$fb.loyalties.getCurrentLoyalty()&&!$fb.loyalties.getCurrentLoyalty().isLogged()){var tooltip=$('<span class="member-price--tooltip" />').append($.fb("crs-helper-translate",{key:"member-rate-signin-tooltip"}),"</br>",$.fb("crs-helper-translate",{key:"member-rate-unblocker-tooltip"}));button.addClass("btn--with-tooltip").append(tooltip)}return button},price:function(){var result=$('<div style="padding-right: 5px; padding-bottom: 5px;"/>'),displayOnlyMemberBadgeOnteasingMode=$fb.results._displayOnlyMemberBadgeOnteasingMode(rate);if(rate.originalPrice&&!displayOnlyMemberBadgeOnteasingMode){var originalNode=$.fb("crs-helper-price",{price:rate.originalPrice}).addClass("barred-price");if(result.append($("<div/>").append(originalNode)),rate.campaignPrice){originalNode.css("font-size","14px");var calculationStepCampaignNode=$.fb("crs-helper-price",{price:rate.campaignPrice}).addClass("barred-price last-barred-price");result.append($("<div/>").append(calculationStepCampaignNode))}else originalNode.addClass("last-barred-price")}if(_.each({unlockedByAccessCode:{class:"promo-code",icon:"percent",label:"quicksearch-input-label-promo-code"},memberOnly:{class:"member",icon:"lock",label:"member-only"}},function(badge,condition){rate[condition]&&result.append($('<div class="rate-badge-container"/>').append($('<span class="badge-tooltip rate-badge '+badge.class+'"/>').append('<i class="fa fa-'+badge.icon+'" aria-hidden="true"></i>',$.fb("crs-helper-translate",{key:badge.label,placeholders:badge.placeholders}))))}),displayOnlyMemberBadgeOnteasingMode)return result;var priceNode=$('<div class="new-price"/>').append($.fb("crs-helper-price",{price:rate.price}));rate.campaign&&rate.originalPrice&&priceNode.addClass("campaign-text-color"),result.append(priceNode);var alternate=rate.loyaltyAlternativeCurrencyRate?$fb.loyalties.getCurrentLoyalty().getAlternateCurrency(rate.loyaltyAlternativeCurrencyRate):null;if(alternate){var alternateNode=$.fb("crs-helper-price",{price:rate.price,alternate:alternate});rate.campaign&&rate.originalPrice&&alternateNode.addClass("campaign-text-color"),result.append($('<div style="font-size: 14px;"/>').append(alternateNode.addClass("fb-price-second-only")))}var pricepoint=rate.points?rate.points:null;if(pricepoint){var pricepointNode=$.fb("crs-helper-price",{price:rate.price,pricepoint:pricepoint});rate.campaign&&rate.originalPrice&&pricepointNode.addClass("campaign-text-color"),result.find("div.new-price").addClass("price-new").empty().append($(pricepointNode)),result.find("span.barred-price").remove()}return"with-net"==$fb._state.display&&result.append($.fb("crs-helper-translate",{key:"taxes-net-price",fallback:"Without taxes %1$s",placeholders:[$("<div/>").html($.fb("crs-helper-price",{price:rate.price-rate.includedTaxes,ref:"results"})).html()]}).css({display:"block",textAlign:"right",fontSize:"small",whiteSpace:"nowrap"})),result},iata:function(){return $fb.results._renderIataCommission(rate)},taxesInfos:function(){if(!!packages.find(function(package){return"accommodation"===package.type}).prices.taxes.types.find(function(tax){return tax.included&&"government-tax"===tax.label}))return $("<span />",{class:"fb-dark-gray fb-price-small-text"}).append($.fb("crs-helper-translate",{key:"government-tax-included"}))},multiroomsTeaser:function(){if(rate.campaignForMultiRoomLink){var $teaser=$('                            <div style="background: #fbd64a; display: inline-block; padding: 2px 21px;">                                <img src="/images/pictos/gift-picto.png" width="30" height="30" class="fa fa-gift" style="display: inline-block; vertical-align: middle;"></i>                                <p style="line-height: 20px; font-size: 13px; display:inline-block; margin-left: 10px; margin-bottom: 0; vertical-align: middle;">                                    <span class="teaser-commercial-name"></span><br/><span class="teaser-discount-sentence"></span>                                </p>                            </div>                        ').hide();return $fb._state.app.data.campaigns[rate.campaignForMultiRoomLink.id]?updateTeaserInformations():$(document).one("fastbooking-crs-frontend-load-campaigns-done",updateTeaserInformations),$teaser}function updateTeaserInformations(){var discount,campaign=$fb._state.app.data.campaigns[rate.campaignForMultiRoomLink.id],name=$.fb("crs-helper-translate",{key:"campaign-"+rate.campaignForMultiRoomLink.id});switch(!0){case"DISCOUNT"===campaign.promotionType&&"PERCENTAGE"===campaign.promotionDiscountType:discount=campaign.promotionPercent+"%";break;case"DISCOUNT"===campaign.promotionType&&"VALUE"===campaign.promotionDiscountType:discount=$.fb("crs-helper-price",{price:campaign.promotionValue,originCurrency:campaign.promotionValueCurrency}).get(0).outerHTML;break;case"FREE_NIGHTS"===campaign.promotionType&&!campaign.promotionNbNightsIsRecurring:var nbFreeNights=campaign.promotionNbNightsStayFor-campaign.promotionNbNightsPayFor;discount=$.fb("crs-helper-translate",{key:"mcm-results-free-night"+(1<nbFreeNights?"s":"")+"-type",placeholders:[nbFreeNights]}).get(0).outerHTML;break;case"FREE_NIGHTS"===campaign.promotionType&&campaign.promotionNbNightsIsRecurring:discount=$.fb("crs-helper-translate",{key:"mcm-results-recursive-free-nights",placeholders:[campaign.promotionNbNightsStayFor,campaign.promotionNbNightsPayFor]}).get(0).outerHTML;break;default:return void $fb.error("MCM teaser resolution failed")}$teaser.find(".teaser-commercial-name").append(name).end().find(".teaser-discount-sentence").append($.fb("crs-helper-translate",{key:"mcm-results-teaser-sentence",placeholders:["<strong>"+discount+"</strong>"]})).end().show()}}},layout='                    <div id="'+outputId+'" class="col-xs-12 fb-results-rate fb-light-bg" style="flex-wrap: wrap;">                        <div class="fb-results-rate--left">                            <div>                                <render name="title" />                                <div style="padding-left: 12px;"><render name="stress" /></div>                            </div>                            <render name="labels" />                            <div style="margin-top: auto;"><render name="horizontalRatekeys" /></div>                            <div style="margin-top: 10px; margin-left: -15px"><render name="multiroomsTeaser" /></div>                        </div>                        <div class="fb-results-rate--right">                            <div><render name="xNightsXPersons" /></div>                            <render name="price" />                            <render name="btnSelectTeasingMember" />                            <render name="btnSelectNormal" />                        </div>                        <render name="iata" />                        <div style="flex: 100%; text-align: right; margin-bottom: -10px; margin-top: 6px;">                            <render name="taxesInfos" />                        </div>                    </div>                ',mobileLayout='                    <div id="'+outputId+'" class="col-xs-12 fb-results-rate fb-light-bg">                        <div class="fb-results-rate--left">                            <div><render name="title" /></div>                            <div style="padding-left: 12px;">                                <div><render name="verticalRatekeys" /></div>                                <render name="stress" />                            </div>                            <render name="labels" />                            <div class="hide-empty" style="margin-top: 8px"><render name="multiroomsTeaser" /></div>                        </div>                        <div class="fb-results-rate--right">                            <div><render name="xNightsXPersons" /></div>                            <render name="price" />                            <render name="btnSelectTeasingMember" />                            <render name="btnSelectNormal" />                        </div>                        <render name="iata" />                        <div style="text-align: center; margin-bottom: -3px; margin-top: 3px;">                            <render name="taxesInfos" />                        </div>                    </div>                ';return $($fb._state.isMobile?mobileLayout:layout).find("render").each(function(){var name=$(this).attr("name");renderers[name]&&$(this).replaceWith(renderers[name]())}).end()},_renderIataCommission:function(rate){if($fb._.hasFeature("display-iata-commission","activate",1)){var accesscodeValid=/^[0-9]{7,8}$/.test($fb._state.quicksearch.accesscode);if(rate.iataCommission&&accesscodeValid){var commissionLabel=rate.iataCommission.label,commissionPercent=rate.iataCommission.percent,commissionDetails=$('<div class="col-xs-12" style="background-color: #f5f5f5; font-size: 10pt; padding:5px 0; margin-top: 15px;">');return commissionDetails.append($('<span class="col-xs-6">'+$("<div/>").append($.fb("crs-helper-translate",{key:"agency-commission"})).html()+': <span style="font-weight:bold">'+commissionPercent+"%</span></span>")),commissionDetails.append($('<span style="col-xs-6">'+commissionLabel+"</span>")),commissionDetails}}},_onClickSelectBtn:function(contextQuery,rate,pack,noUpselling,teasingPriceSelected){var query=$fb.quotationResultsHelper.formatBookingQueryFromQuotationQuery(contextQuery,pack);if($fb.loyalties.getCurrentLoyalty()&&$fb.loyalties.getCurrentLoyalty().isLogged()&&"mid"===$fb.loyalties.getCurrentLoyalty().getType()){var member=$fb.loyalties.getCurrentLoyalty().getMember(),basket=$fb.basket._getBasketData(),packDiv=$("#"+rate.property+"-"+rate.packId+"-"+rate.rate+"-"+rate.accommodation).find(".fb-results-rate--left");if(packDiv.find(".fb-error").remove(),member.points&&member.points<rate.points+basket.totalPoints){var errorMessage=$('<div class="fb-message fb-error" />').append($.fb("crs-helper-translate",{key:"loyalty-full-points-error"}));return $(errorMessage).delay(3e3).fadeOut(1e3),packDiv.append(errorMessage),!1}}if(rate.teasingMemberPrice&&teasingPriceSelected||rate.memberOnly&&!$fb.loyalties.getCurrentLoyalty().isLogged()){var hasTeasing=$fb._state.app.data.properties[query.property]&&$fb._state.app.data.properties[query.property].configuration.loyaltyTeasing;if("prince"!==$fb.loyalties.getCurrentLoyalty().getType()||hasTeasing)return void $fb.loyaltyteasing.showTeaserForPackage(pack);_.each(pack,function(subPack){delete subPack.loyalty})}if(!noUpselling&&!$fb._state.hasUserAlreadyRefusedUpsell&&!$fb._state.isMobile&&null!==$fb.upsellRoom.init(contextQuery,rate,pack)){var body=$fb.upsellRoom.getBody();return $fb.upsellRoom.display(body),!1}$fb.selection.addPackage(pack,rate.packId,query)},_renderDealOfTheDay:function(campaign){var $timeRemainingNode=$('<span class="mcm-dealOfTheDayBanner-timeRemaining" />');if(void 0!==campaign.dealOfTheDayEndDate)var dateEnd=moment(campaign.dealOfTheDayEndDate),intervalId=setInterval(function(){var dateNow=moment(),diff=moment.duration(dateEnd.diff(dateNow)),days=Math.floor(diff.asDays());if($timeRemainingNode.empty(),dateEnd<dateNow)return window.clearInterval(intervalId),void $timeRemainingNode.append($.fb("crs-helper-translate",{key:"deal-of-the-day-expired"}));if(!(3<days)){var hours=("0"+diff.hours()).substr(-2),minutes=("0"+diff.minutes()).substr(-2),seconds=("0"+diff.seconds()).substr(-2),dayLabel=$.fb("crs-helper-translate",{key:1<days?"days":"day"});dayLabel=days<1?"":days+" "+dayLabel.text()+" / ",$timeRemainingNode.append($.fb("crs-helper-translate",{key:"deal-of-the-day-time-remaining-label"})," ",dayLabel+hours+":"+minutes+":"+seconds)}},1e3);var dealLabel=$('<span class="mcm-dealOfTheDayBanner-text"/>').append($.fb("crs-helper-translate",{key:"deal-of-the-day-label"})),dealHeaderContent=$("<div></div>").append(dealLabel).append($timeRemainingNode);return $('<div class="col-xs-12 mcm-dealOfTheDayBanner-header" />').append(dealHeaderContent)},_renderVerticalRateKeys:function(rate,mealData,cancelData,paymentData){var ratekeys=$('<div class="fb-results-ratekeys fb-results-ratekeys-vertical fb-container" />');if(mealData.hasMeal){var mealKey=$('<div style="color: #3682E6;" />').append('<i class="fa fa-coffee"></i>'," ",$('<span class="fb-results-ratekey" />').append($.fb("crs-helper-translate",{key:mealData.i18nKey})));mealData.rateKeyDesc&&""!==mealData.rateKeyDesc&&(mealKey.addClass("fb-ratekey-clickable"),mealKey.click(function(event){event.preventDefault(),$fb.results._setLastModifiedPackage(rate.packId);var accommodationEscaped=rate.accommodation.replace(".","\\."),rateEscaped=rate.rate.replace(".","\\."),ratePackIdEscaped=rate.packId.replace(".","\\.");return 0<$("div.fb-results-rate-details:not(#fb-meal-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped+")").filter(":visible").length?$("div.fb-results-rate-details:not(#fb-meal-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped+")").filter(":visible").slideToggle(300,function(){$("#fb-meal-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle()}):$("#fb-meal-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle(),!1})),ratekeys.append(mealKey)}else ratekeys.append('<div class="fb-results-ratekey" style="display:none;"></div>');var cancelKey=$("<div />").append($('<span class="fb-results-ratekey" style="color: gray;" />').append(cancelData.label));cancelKey.addClass("fb-ratekey-clickable"),cancelKey.click(function(event){event.preventDefault(),$fb.results._setLastModifiedPackage(rate.packId);var accommodationEscaped=rate.accommodation.replace(".","\\."),rateEscaped=rate.rate.replace(".","\\."),ratePackIdEscaped=rate.packId.replace(".","\\.");return 0<$("div.fb-results-rate-details:not(#fb-cancel-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped+")").filter(":visible").length?$("div.fb-results-rate-details:not(#fb-cancel-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped+")").filter(":visible").slideToggle(300,function(){$("#fb-cancel-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle()}):$("#fb-cancel-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle(),!1}),ratekeys.append(cancelKey);var paymentKey=$("<div />").append($('<span class="fb-results-ratekey" style="color: gray;" />').append(paymentData.rateLabel));return""!==paymentData.legalDesc&&(paymentKey.addClass("fb-ratekey-clickable"),paymentKey.click(function(event){event.preventDefault(),$fb.results._setLastModifiedPackage(rate.packId);var accommodationEscaped=rate.accommodation.replace(".","\\."),rateEscaped=rate.rate.replace(".","\\."),ratePackIdEscaped=rate.packId.replace(".","\\.");return 0<$("div.fb-results-rate-details:not(#fb-payment-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped+")").filter(":visible").length?$("div.fb-results-rate-details:not(#fb-payment-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped+")").filter(":visible").slideToggle(300,function(){$("#fb-payment-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle()}):$("#fb-payment-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle(),!1})),ratekeys.append(paymentKey)},_renderHorizontalRateKeys:function(rate,mealData,cancelData,paymentData){var ratekeys=$('<div class="fb-results-ratekeys fb-container" />'),mealKey=$('<div class="col-xs-4 fb-dark-gray fb-container">').append('<div class="col-xs-12 col-sm-2 fb-container"><img src="'+mealData.rateKeyImage+'" border="0" /></div>').append($('<div class="col-xs-12 col-sm-10 fb-results-ratekey" />').append($.fb("crs-helper-translate",{key:mealData.i18nKey})));mealData.rateKeyDesc&&""!==mealData.rateKeyDesc&&(mealKey.addClass("fb-ratekey-clickable"),mealKey.click(function(event){event.preventDefault(),$fb.results._setLastModifiedPackage(rate.packId);var accommodationEscaped=rate.accommodation.replace(".","\\."),rateEscaped=rate.rate.replace(".","\\."),ratePackIdEscaped=rate.packId.replace(".","\\.");return 0<$("div.fb-results-rate-details:not(#fb-meal-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped+")").filter(":visible").length?$("div.fb-results-rate-details:not(#fb-meal-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped+")").filter(":visible").slideToggle(300,function(){$("#fb-meal-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle()}):$("#fb-meal-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle(),!1})),ratekeys.append(mealKey);var cancelKey=$('<div class="col-sm-4 fb-dark-gray fb-container">').append('<div class="col-xs-12 col-sm-1 fb-container"><img src="'+cancelData.image+'" border="0" /></div>').append($('<div class="col-xs-12 col-sm-11 fb-results-ratekey" />').append(cancelData.label));cancelKey.addClass("fb-ratekey-clickable"),cancelKey.click(function(event){event.preventDefault(),$fb.results._setLastModifiedPackage(rate.packId);var accommodationEscaped=rate.accommodation.replace(".","\\."),rateEscaped=rate.rate.replace(".","\\."),ratePackIdEscaped=rate.packId.replace(".","\\.");return 0<$("div.fb-results-rate-details:not(#fb-cancel-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped+")").filter(":visible").length?$("div.fb-results-rate-details:not(#fb-cancel-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped+")").filter(":visible").slideToggle(300,function(){$("#fb-cancel-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle()}):$("#fb-cancel-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle(),!1}),ratekeys.append(cancelKey);var paymentKey=$('<div class="col-sm-4 fb-dark-gray fb-container">').append('<div class="col-xs-12 col-sm-2 fb-container"><img src="'+paymentData.image+'" border="0" /></div>').append($('<div class="col-xs-12 col-sm-10 fb-results-ratekey" />').append(paymentData.rateLabel));return""!==paymentData.legalDesc&&(paymentKey.addClass("fb-ratekey-clickable"),paymentKey.click(function(event){event.preventDefault(),$fb.results._setLastModifiedPackage(rate.packId);var accommodationEscaped=rate.accommodation.replace(".","\\."),rateEscaped=rate.rate.replace(".","\\."),ratePackIdEscaped=rate.packId.replace(".","\\.");return 0<$("div.fb-results-rate-details:not(#fb-payment-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped+")").filter(":visible").length?$("div.fb-results-rate-details:not(#fb-payment-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped+")").filter(":visible").slideToggle(300,function(){$("#fb-payment-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle()}):$("#fb-payment-details-"+rateEscaped+"-"+accommodationEscaped+"-"+ratePackIdEscaped).slideToggle(),!1})),ratekeys.append(paymentKey)},_renderDealPromotionTag:function(rate,packageHasAMealplan){var discountTag;if("NONE"!==rate.campaign.promoType){if("FREE_NIGHTS"===rate.campaign.promoType)discountTag=!0===rate.campaign.freeNightIsRecurring?$('<span class="fb-discount-tag rate-badge-container"/>').append($('<span class="fb-discount-tag-price"/>').append($.fb("crs-helper-translate",{key:"mcm-freenights-payfor-x-stayfor-x",placeholders:[rate.campaign.freeNightPayFor,rate.campaign.freeNightStayFor]}))):$('<span class="fb-discount-tag rate-badge-container"/>').append($('<span class="fb-discount-tag-price"/>').append(rate.campaign.promoValue+" ").append($.fb("crs-helper-translate",{key:"mcm-results-free-night"+(1<rate.campaign.promoValue?"s":"")})));else if("VALUE"!==rate.campaign.promoDiscountType)discountTag=$('<span class="fb-discount-tag rate-badge-container" />').append($('<span class="fb-discount-tag-price"/>').append($.fb("crs-helper-translate",{key:"mcm-results-discount-value",placeholders:["-"+rate.campaign.promoValue+"%"]})));else{var realPromoValue=rate.originalPrice-rate.price;discountTag=$('<span class="fb-discount-tag rate-badge-container" />').append($('<span class="fb-discount-tag-price" style="white-space: nowrap;"/>').append($.fb("crs-helper-translate",{key:"mcm-results-discount-value",placeholders:["-"+$.fb("crs-helper-price",{price:realPromoValue}).get(0).outerHTML]})))}var isCampaignDiscountValue="VALUE"===rate.campaign.promoDiscountType&&"DISCOUNT"===rate.campaign.promoType;return!packageHasAMealplan||rate.campaign.offerMealPlan||isCampaignDiscountValue||discountTag.attr("title",$.fb("crs-helper-translate",{key:"meal-plan-not-discounted"}).text()),discountTag}},_renderAccomodation:function(accommodation,rateOutput){var roomData=null;$fb._state.app.data.accommodations&&$fb._state.app.data.accommodations[$fb._state.quicksearch.property]&&$fb._state.app.data.accommodations[$fb._state.quicksearch.property][accommodation.id]&&(roomData=$fb._state.app.data.accommodations[$fb._state.quicksearch.property][accommodation.id]);var openAccommodationInfos=function(event){return event.preventDefault(),$fb._state.lastInteractedAccomodationId=accommodation.id,$fb._triggerEvent("fastbooking-crs-frontend-roomdetails-open",{room:accommodation.id,offset:$("#accommodation-"+accommodation.id).offset().top}),!1},accommodationkey=$fb._state.quicksearch.property+":roomtitle:"+accommodation.id,output=$("<div>",{id:"accommodation-"+accommodation.id,class:"col-xs-12 fb-results-accommodation fb-gray-bg",data:{lowerrealprice:accommodation.bestPrice,hasCampaign:!!accommodation.rates[0].campaign}});output.append($('<div class="col-xs-12 fb-dark-bg fb-block-header fb-results-acc-title" />').append($.fb("crs-helper-translate",{key:accommodationkey,fallback:accommodation.id}),$('<a href="javascript:void(0)" class="hidden-md hidden-lg fb-results-room-details-mobile-link"><i class="fa fa-info-circle"></i></a>').click(openAccommodationInfos)));var size=$fb._state.app.data.properties&&$fb._state.app.data.properties[$fb._state.quicksearch.property]&&$fb._state.app.data.properties[$fb._state.quicksearch.property].configuration&&$fb._state.app.data.properties[$fb._state.quicksearch.property].configuration.roomLayer?$fb._state.app.data.properties[$fb._state.quicksearch.property].configuration.roomLayer:0,imageSize=[700,600,500],tabSize=["fb-large-layer-room","fb-medium-layer-room","fb-small-layer-room"],accomodationImages=$('<div class="col-xs-12 col-sm-12 col-md-'+["12","8","4"][size]+" fb-dark-bg fb-results-acc-photo "+tabSize[size]+'" />');if(roomData&&roomData.images&&roomData.images&&0<roomData.images.length){for(var accommodationCarousel=$('<div id="carousel-accommodation-'+accommodation.id+'" class="carousel slide '+tabSize[size]+'" data-ride="carousel" data-interval="false" />'),carousselIndic=$('<ol class="carousel-indicators hidden-xs hidden-sm" />').append('<li data-target="#carousel-accommodation-'+accommodation.id+'" data-slide-to="0" class="active"></li>'),carouselInner=$('<div class="carousel-inner">').append('<div class="item active fb-carousel-image '+tabSize[size]+'" style="background-image: url(\''+$.fb("crs-helper-image",{src:roomData.images[0].url,width:imageSize[size],scale:1}).attr("src")+"');\"></div>"),i=1,max=roomData.images.length;i<max;i++)roomData.images[i]&&roomData.images[i].url&&(carousselIndic.append('<li data-target="#carousel-accommodation-'+accommodation.id+'" data-slide-to="'+i+'"></li>'),carouselInner.append('<div class="item fb-carousel-image '+tabSize[size]+'" style="background-image: url(\''+$.fb("crs-helper-image",{src:roomData.images[i].url,width:imageSize[size],scale:1}).attr("src")+"');\"></div>"));if(1<roomData.images.length&&accommodationCarousel.append(carousselIndic),accommodationCarousel.append(carouselInner),1<roomData.images.length){var carouselControlPrev=$('<a class="left carousel-control" href="#carousel-accommodation-'+accommodation.id+'" data-slide="prev"><span class="fa fa-angle-left"></span></a>'),carouselControlNext=$('<a class="right carousel-control" href="#carousel-accommodation-'+accommodation.id+'" data-slide="next"><span class="fa fa-angle-right"></span></a>');accommodationCarousel.append(carouselControlPrev).append(carouselControlNext)}accomodationImages.append(accommodationCarousel)}output.append(accomodationImages);var roomSelects=$('<div class="col-xs-12 col-sm-'+["12","4","8"][size]+" fb-results-acc-selects hidden-xs hidden-sm "+tabSize[size]+'" />');if(roomData&&roomData.bedTypes){var bedTypesOptions=$('<select id="accommodation-'+accommodation.id+'-bed" name="accommodation-'+accommodation.id+'-bed" class="form-control" />');$.each(roomData.bedTypes,function(id,bedType){bedTypesOptions.append($('<option value="'+bedType+'" />').append($.fb("crs-helper-translate",{key:"__TypeOfBeds___"+bedType,fallback:bedType})))});var bedSelectionDiv=$('<div class="input-group fb-results-acc-group">'),bedIconSpan=$('<span class="input-group-addon fb-results-acc-icon"><img src="/images/pictos/icon-room-bed-large.png" border="0" /></span>');if(bedSelectionDiv.append(bedIconSpan).append(bedTypesOptions),1===roomData.bedTypes.length){bedTypesOptions.hide(),bedIconSpan.removeClass("input-group-addon");var translationOptions={key:"__TypeOfBeds___"+roomData.bedTypes[0],fallback:roomData.bedTypes[0]};bedSelectionDiv.append($.fb("crs-helper-translate",translationOptions).addClass("fb-room-single-bed-type"))}roomSelects.append($('<div class="col-xs-12 col-sm-'+["4","12","6"][size]+'"/>').append(bedSelectionDiv))}var occupancyValue=parseInt(roomData&&roomData.occupancy&&roomData.occupancy.maxPersons?roomData.occupancy.maxPersons:roomData&&roomData.occupancy&&roomData.occupancy.maxAdults?roomData.occupancy.maxAdults:0,10),occupancyIcon=occupancyValue<=1?"icon-room-occupancy-1":2<occupancyValue?"icon-room-occupancy-2-plus":"icon-room-occupancy-2";roomData&&roomData.occupancy&&roomData.occupancy.maxPersons&&roomData.occupancy.maxAdults&&roomData.occupancy.maxChildren?roomSelects.append($('<div class="col-xs-12 fb-room-occupancy '+tabSize[size]+'" />').append('<img src="/images/pictos/'+occupancyIcon+'.png" border="0" /> ').append($.fb("crs-helper-translate",{key:"person",mode:roomData.occupancy.maxPersons,placeholders:[roomData.occupancy.maxPersons]}))):roomData&&roomData.occupancy&&roomData.occupancy.maxAdults&&roomData.occupancy.maxChildren?roomSelects.append($('<div class="col-xs-12 fb-room-occupancy '+tabSize[size]+'" />').append('<img src="/images/pictos/'+occupancyIcon+'.png" border="0" /> ').append($.fb("crs-helper-translate",{key:"person",mode:roomData.occupancy.maxAdults,placeholders:[roomData.occupancy.maxAdults]}))):roomData&&roomData.occupancy&&roomData.occupancy.maxAdults&&roomSelects.append($('<div class="col-xs-12 fb-room-occupancy '+tabSize[size]+'" />').append('<img src="/images/pictos/'+occupancyIcon+'.png" border="0" /> ').append($.fb("crs-helper-translate",{key:"adult",mode:roomData.occupancy.maxAdults,placeholders:[roomData.occupancy.maxAdults]})));var accDetailsBtn=$('<a href="#" class="theme-link" />').append($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"results-room-details-pictures"})})).click(openAccommodationInfos);return roomSelects.append($('<div class="col-xs-12 col-sm-'+["8","11","10"][size]+' fb-room-details-link text-right" />').append(accDetailsBtn)),output.append(roomSelects),output.append(rateOutput),output},_quotation:function(event){return $fb._state.areCampaignsFinishedBeingLoaded=!1,$fb._state.didPromoCodeUnlockCampaigns=!1,$fb._state.didPromoCodeUnlockRates=!1,$fb.results._container.empty(),$fb.loadingElement($fb.results._container),$fb.results._state.data=$fb.quotationResultsHelper.getEmptyResults(),$fb.areAllPackagesSelected()?$fb.results.render({}):$fb._triggerEvent("fastbooking-crs-frontend-load-quotation"),$fb._callback(event)},_postAlterQuotation:function(event){if(!$fb._checkEvent("quicksearch","postAlterQuotation",event))return $fb._callback(event);var compiled=$fb.quotationResultsHelper.compileResults($fb._state.app.data.alterquotation);return null!==compiled?($fb.results._setAvailabilityStatus("unavailable-partial"),$fb.results._state.alterdata=compiled,$("#fb-results-alternate").html($fb.results._renderResults($fb.results._state.alterdata,!0,$fb._state.app.data.alterquotation.query))):$fb._state.quicksearch.group?$fb.results._.xsell.init():($fb.results._setAvailabilityStatus("unavailable-total"),$("#fb-results-alternate").empty()),$fb._callback(event)},_postQuotation:function(event){if($fb.log("load results postQuotation",new Date),!$fb._checkEvent("quicksearch","postQuotation",event))return $fb._callback(event);$fb.info("_postQuotation"),$fb._state.firstQuotation=!1,void 0===$fb.results._state.data&&($fb.results._state.data=$fb.quotationResultsHelper.getEmptyResults());var compiled=$fb.quotationResultsHelper.compileResults($fb._state.app.data.quotation);if(null!==compiled)return $fb._state.quicksearch.property&&$fb._state.app.data.properties[$fb._state.quicksearch.property]&&$fb._state.app.data.properties[$fb._state.quicksearch.property].bookingEngineFrontend&&$fb._state.app.data.properties[$fb._state.quicksearch.property].bookingEngineFrontend.results.displayQuotationFilter&&$fb.resultsFilter.initPriceFilterRanges(compiled.minPrice,compiled.maxPrice).resetActiveFiltersAndRefreshDisplay(),$fb.results._state.data=compiled,$fb.results._setAvailabilityStatus("available"),$fb.log("load results postQuotation checked",new Date,$fb.results._state.data),$fb._triggerEvent("fastbooking-crs-frontend-results-checked"),$fb._callback(event);var occupancyValidation=$fb.occupancySelectionValidator.validate($fb._state.quicksearch.occupancy,$fb._state.quicksearch.configuration);return occupancyValidation.hasError?($fb.results._displayOccupancySelection(occupancyValidation),$fb._callback(event)):$fb.selection.isEmpty()?$fb._state.needLockQuotation?$fb._callback(event):void $fb.results._displayCalendarWidget(function(){return $fb._callback(event)}):($fb.results._state.data=$fb.quotationResultsHelper.getEmptyResults(),$fb._triggerEvent("fastbooking-crs-frontend-results-checked"),$fb._callback(event))},_displayOccupancySelection:function(occupancyValidation){var redTitleLabel,redTitleExplanationLabel,output=$('<div id="results-items" class="container col-xs-12" />'),header=$("<div />").append($('<div id="fb-results-error-message-container" class="fb-message fb-error container" />').append($('<div id="fb-results-error-message-text" class="fb-message-inner col-xs-12 fb-container" />').append('<div class="fb-message-picto col-xs-2 col-sm-1 fb-font-bold">!</div>').append($('<div class="fb-message-text fb-error col-xs-offset-2 col-xs-10 col-sm-offset-1 col-sm-11" />').append($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"search-no-availability"})})))),$("<p />").append($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"search-no-availability-explain"})}))),whitePanel=$("<div />",{class:"fb-results-occupancy-selection-container"}),occupancySelector=new $fb.OccupancySelection(_.extend({},$fb.quicksearch.getOccupancySelectionConfiguration(),{maxRooms:$fb._config.maxPackages,showCancelLink:!1,showApplyBtn:!0,showOccupancyMessage:!1}),$fb.quicksearch.getOccupancySelectionSelection());occupancySelector.on("apply",function(event){$fb.quicksearch.setOccupancySelectionSelection(event.selection,occupancySelector.getConfiguration().needChildrenAges)});var configuration=$fb._state.quicksearch.configuration;if(occupancyValidation.items.some(function(room){return room.nbAdults.hasError||room.nbChildren.hasError})){var isPersonExceed=occupancyValidation.items.some(function(room){return"maxPersons"===room.nbAdults.reason}),isAdultExceed=occupancyValidation.items.some(function(room){return"maxAdults"===room.nbAdults.reason}),exceedOccupancy=isPersonExceed?{key:"person",max:configuration.maxPersons}:isAdultExceed?{key:"adult",max:configuration.maxAdults}:{key:"child",max:configuration.maxChildren};redTitleLabel=$.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"quicksearch-message-max-xxx-per-room"}),placeholders:[$.fb("crs-helper-translate",{key:exceedOccupancy.key,placeholders:[exceedOccupancy.max],mode:exceedOccupancy.max}).get(0).outerHTML]}),redTitleExplanationLabel=$.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"fb-results-occupancy-selection-explanation"})})}else redTitleLabel=$.fb("crs-helper-translate",{key:"fb-results-occupancy-selection-fix-children-ages"}),redTitleExplanationLabel=$.fb("crs-helper-translate",{key:"fb-results-occupancy-selection-fix-children-ages-explanation"});whitePanel.append($("<div />",{class:"fb-results-occupancy-selection-title fb-error"}).append('<i class="fa fa-exclamation" />',redTitleLabel),$("<div />",{class:"fb-results-occupancy-selection-explanation"}).append(redTitleExplanationLabel),occupancySelector.render()),$fb.results._container.html(output.append(header,whitePanel))},_displayCalendarWidget:function(callback){$fb.widgets.getToken($fb._state.quicksearch.property,function(err,widgetsToken){var output=$('<div id="results-items" class="container fb-container" />');$fb.results._container&&($fb.results._container.html(output),$fb.results._renderPropertyNote().then($fb.results._container.prepend.bind($fb.results._container)));var errorMessage=$('<div id="fb-results-error-message-container" class="fb-message container" />'),errorTranslationKey=$.fb("crs-helper-translateByAccommodationType",{defKey:"search-no-availability"});if(errorTranslationKey&&errorMessage.append($('<div id="fb-results-error-message-text" class="col-xs-12 fb-container" />').append('<div class="fb-message-picto col-xs-2 col-sm-1 fb-font-bold">!</div>').append($('<div class="fb-message-text col-xs-offset-2 col-xs-10 col-sm-offset-1 col-sm-11" />').append($.fb("crs-helper-translate",{key:errorTranslationKey})))),output.append(errorMessage),$fb.loadingElement($("#fb-results-alternate")),$fb._triggerEvent("fastbooking-crs-frontend-load-alterquotation"),null!=err)return callback();var calHeader=$('<div class="col-xs-12 fb-result-header" />');calHeader.append($('<span class="title1 fb-font-light" />').append($.fb("crs-helper-translate",{key:"calendar-other-date"}))),output.append(calHeader);var childrenMaxAge=12,mainColor="#b0a06c",themeDark=!1;if($fb._state.app.data.properties[$fb._state.quicksearch.property]){var prop=$fb._state.app.data.properties[$fb._state.quicksearch.property];prop.configuration&&prop.configuration.childrenMaxAge&&(childrenMaxAge=prop.configuration.childrenMaxAge),prop.bookingEngineFrontend&&(prop.bookingEngineFrontend.theme&&prop.bookingEngineFrontend.theme.btnBgColor&&(mainColor=prop.bookingEngineFrontend.theme.btnBgColor),prop.bookingEngineFrontend.header&&prop.bookingEngineFrontend.header.toolbar&&prop.bookingEngineFrontend.header.toolbar.theme&&(themeDark="dark"===prop.bookingEngineFrontend.header.toolbar.theme))}var currentLoyalty=$fb.loyalties&&$fb.loyalties.getCurrentLoyalty(),loyaltyRateType=currentLoyalty&&currentLoyalty.isLogged()?currentLoyalty.getCode():void 0,loyaltyParams=currentLoyalty&&currentLoyalty.isLogged()?currentLoyalty.getWidgetQuotationParams():void 0,showLastRoom=!(!$fb._state.app.data.stressRoomsLeftDisplay||!$fb._state.app.data.stressRoomsLeftDisplay.enabled),showLastRoomThreshold=$fb._state.app.data.stressRoomsLeftThreshold,widgetsParams={nbAdults:$fb._state.quicksearch.occupancy[0].nbAdults,nbChildren:$fb._state.quicksearch.occupancy[0].nbChildren,accessCode:$fb._state.quicksearch.accesscode,startingMonth:$fb._state.quicksearch.arrival.substring(0,7),locale:$fb._state.app.locale,currency:$fb._state.app.currency,childrenMaxAge:childrenMaxAge,mainColor:mainColor,themeDark:themeDark,loyaltyRateType:loyaltyRateType,loyaltyParams:loyaltyParams,showLastRoom:showLastRoom,showLastRoomThreshold:showLastRoomThreshold,groupName:$fb._state.quicksearch.group};return $fb._state.quicksearch.configuration.needChildrenAges&&(widgetsParams.childrenAgesList=$fb._state.quicksearch.occupancy[0].childrenAges),$fb._state.quicksearch.rate&&(widgetsParams.rateFilter=$fb._state.quicksearch.rate.split(","),widgetsParams.roomRateFiltering=1),$fb._state.quicksearch.accommodation&&(widgetsParams.roomFilter=[$fb._state.quicksearch.accommodation],widgetsParams.roomRateFiltering=widgetsParams.roomRateFiltering?3:2),output.append($fb.widgets.getJqueryElements(widgetsToken,widgetsParams)),output.append('<div id="fb-results-alternate"></div>'),$fb.results._checkErrorMessagePresence(),callback()}),$(document).on("crs-locale-changed fastbooking-crs-frontend-currency-changed",function(){if(0<$("#fb-widget-config").length){var wdata=JSON.parse($("#fb-widget-config").text());void 0!==wdata.params&&0<wdata.params.length&&(wdata.params[0].locale=$fb._state.app.locale,wdata.params[0].currency=$fb._state.app.currency,$("#fb-widget-config").text(JSON.stringify(wdata)),"function"==typeof window.loadFBWidgets&&window.loadFBWidgets())}})},_displayOnlyMemberBadgeOnteasingMode:function(rate){return!!$fb.loyalties.getCurrentLoyalty()&&(!!$fb.loyalties.getCurrentLoyalty().getDisplayProperties().displayOnlyMemberBadgeOnteasingMode&&0<=rate.teasingMemberPrice)},_preRender:function(event){return $fb.log("load results.js _preRender"),$fb._checkEvent("results","_preRender",event)?($fb.results.init({}),null===$fb.results._container&&($fb.results._container=$fb._checkContainer("results")),"validate-collect"!=$fb._state.app.step&&("confirm"!=$fb._state.app.step||void 0!==$fb._state.app.booking&&void 0!==$fb._state.app.booking.confirmation)||!$fb.selection.isEmpty()?"results"==$fb._state.app.step?(void 0!==$fb.confirmrecap&&$fb.confirmrecap._container.empty(),$fb._triggerEvent("fastbooking-crs-frontend-message-clear"),$fb._triggerEvent("fastbooking-crs-frontend-results-quotation")):$fb.results._container.empty():($fb._ChangeAppStep("results"),$fb._updateHistory(),$fb._triggerEvent("fastbooking-crs-frontend-renderAll")),$fb._callback(event)):$fb._callback(event)},_checkErrorMessagePresence:function(){var errorMessage=$("#fb-results-error-message-container");if(!$("#fb-results-error-message-text").length&&errorMessage.length){var errorTranslationKey=$.fb("crs-helper-translateByAccommodationType",{defKey:"search-no-availability"});errorTranslationKey&&errorMessage.append($('<div id="fb-results-error-message-text" class="col-xs-12 fb-container" />').append('<div class="fb-message-picto col-xs-2 col-sm-1 fb-font-bold">!</div>').append($('<div class="fb-message-text col-xs-offset-2 col-xs-10 col-sm-offset-1 col-sm-11 fb-font-bold" />').append($.fb("crs-helper-translate",{key:errorTranslationKey}))))}},events:{click:function(event){if(!$fb._checkEvent("results","click",event))return $fb._callback(event);var $target=$(event.target);return $fb.log("clicked on ",$target),0<$target.closest(".fb-group-property-details").length&&($target=$target.closest(".fb-group-property-details")),$target.hasClass("fb-group-property-details")&&($fb.log("click hotel details for property"+$target.attr("data-ref")),$fb._triggerEvent("fastbooking-crs-frontend-hoteldetails-open",{property:$target.attr("data-ref"),offset:$("#"+$target.attr("data-offset")).offset().top})),$fb._callback(event)}},_:{xsell:{init:function(){var propertyType="results-xsell-title-hotel";$fb._state.app.data.properties&&$fb._state.app.data.properties[$fb._state.quicksearch.property]&&$fb._state.app.data.properties[$fb._state.quicksearch.property].type.toLowerCase()&&(propertyType="results-xsell-title-"+$fb._state.app.data.properties[$fb._state.quicksearch.property].type.toLowerCase());var $alternate=$("#fb-results-alternate");$alternate.html($('<span class="fb-welcome fb-font-light col-xs-12" />').append($.fb("crs-helper-translate",{key:propertyType}))),$fb._state.app.data.alterquotation.query&&$("#fb-results-alternate").append($('<span class="col-xs-12 fb-dark-gray" />').append($.fb("crs-helper-translate",{key:"date-from-to",placeholders:[$("<div/>").append($.fb("crs-helper-date",{date:$fb._state.app.data.alterquotation.query.arrival})).html(),$("<div/>").append($.fb("crs-helper-date",{date:$fb._state.app.data.alterquotation.query.departure})).html()]})).append(", ").append($.fb("crs-helper-translate",{key:"adult",mode:1,placeholders:[1]})));var group=null;$fb._state.app.data.groups&&$fb._state.app.data.groups[$fb._state.quicksearch.group]&&(group=$fb._state.app.data.groups[$fb._state.quicksearch.group]);var $list=$fb.group._.list.init(group);$list.attr("id","fb-results-alternate-xsell").attr("class","col-xs-12"),$("#fb-group-list-head",$list).remove(),$alternate.append($list),$alternate.off("click.xsell").on("click.xsell",$fb.group._.events.click),$fb.group._.list.fade(.5,!0),$.fb("fastbooking-crs-frontend-group-quotation")}},accommodationsSort:{priceOnly:function(accommodation1,accommodation2){var lowerPrice1=$(accommodation1).data("lowerrealprice"),lowerPrice2=$(accommodation2).data("lowerrealprice");return lowerPrice1===lowerPrice2?0:lowerPrice1<lowerPrice2?-1:1},priceAndCampaign:function(accommodation1,accommodation2){var hasCampaign1=$(accommodation1).data("hasCampaign");if(hasCampaign1!==$(accommodation2).data("hasCampaign"))return hasCampaign1?-1:1;var lowerPrice1=$(accommodation1).data("lowerrealprice"),lowerPrice2=$(accommodation2).data("lowerrealprice");return lowerPrice1===lowerPrice2?0:lowerPrice1<lowerPrice2?-1:1}}}})}),$(document).off("fastbooking-crs-frontend-results-init.results").on("fastbooking-crs-frontend-results-init.results",$fb.results.init),$(document).on("fastbooking-crs-frontend-results-render.results",$fb.results._preRender),$(document).on("fastbooking-crs-frontend-results-quotation.results",$fb.results._quotation),$(document).on("fastbooking-crs-frontend-load-quotation-done.results",$fb.results._postQuotation),$(document).off("fastbooking-crs-frontend-results-checked.results").on("fastbooking-crs-frontend-results-checked.results",$fb.results.render),$(document).off("fastbooking-crs-frontend-load-accommodations-done.results").on("fastbooking-crs-frontend-load-accommodations-done.results",$fb.results.render),$(document).off("fastbooking-crs-frontend-load-rates-done.results").on("fastbooking-crs-frontend-load-rates-done.results",$fb.results.render),$(document).on("fastbooking-crs-frontend-load-alterquotation-done.results",$fb.results._postAlterQuotation)}(window.jQuery,window.$fb.underscore),function($){$.extend(window.$fb,{basket:{_container:null,_config:{scrollProcessingDelay:50},_state:{basketOpened:!1,data:{},scrollProcessing:!1,scrollProcessingPending:!1},init:function(event){return $fb._callback(event)},_isBasketOnDesktopView:function(){return!$("#fb-basket-sticky").is(":visible")&&$("#fb-basket-header-and-body").is(":visible")},desktopStickyRelocate:function(){if($fb.basket._isBasketOnDesktopView()){var windowTop=$(window).scrollTop();$("#fb-basket-anchor").offset().top-100<windowTop?($("#fb-basket").addClass("stick"),$("#fb-basket-anchor").height($("#fb-basket").outerHeight())):($("#fb-basket").removeClass("stick"),$("#fb-basket-anchor").height(0))}else $("#fb-basket-anchor").height(0)},checkSize:function(){var maxHeight;if($("#fb-basket-sticky").is(":visible")){var stickyHeight=$("#fb-basket-sticky").outerHeight();maxHeight=$(window).height()-stickyHeight,$("#fb-basket-header-and-body").css("max-height",maxHeight+"px").css("bottom",stickyHeight)}else maxHeight=$(window).height()-$("#fb-basket-header").outerHeight()-$("#fb-basket-checkout").outerHeight()-100,$("#fb-basket-body").css("max-height",maxHeight+"px").css("overflow-y","auto")},render:function(event){if(!$fb._checkEvent("basket","render",event))return $fb._callback(event);if(null==$fb.basket._container&&($fb.basket._container=$fb._checkContainer("basket",!1)),$fb.selection.isEmpty()?$fb.basket._container.addClass("fb-basket-empty"):$fb.basket._container.removeClass("fb-basket-empty"),$fb.basket._container.empty(),!($fb._state.app.data.rates&&$fb._state.app.data.rates[$fb._state.quicksearch.property]&&$fb._state.app.data.accommodations&&$fb._state.app.data.accommodations[$fb._state.quicksearch.property]&&$fb._state.app.data.services&&$fb._state.app.data.services[$fb._state.quicksearch.property]))return $fb._callback(event);if("results"!==$fb._state.app.step&&"extras"!==$fb._state.app.step)return $fb.basket.desktopStickyRelocate(),$fb._callback(event);$fb.basket._state.data=$fb.basket._getBasketData();var headerAndBodyContainer=$('<div id="fb-basket-header-and-body" class="container fb-container fb-light-bg hidden-xs hidden-sm" />'),displayPriceDetails=$.fb("crs-helper-displayPriceDetails");if(headerAndBodyContainer.append($fb.basket._renderHeader(displayPriceDetails)),displayPriceDetails&&headerAndBodyContainer.append($fb.basket._renderDetails()),$fb.basket._state.data.packages.some(function(pkg){return pkg.campaignId})){var totalDiscount=$fb.basket._renderTotalDiscount();null!==totalDiscount&&headerAndBodyContainer.append(totalDiscount)}return headerAndBodyContainer.append($fb.basket._renderBody()),$fb.basket._container.append(headerAndBodyContainer),$fb.basket._renderButton(),$fb.basket._renderSticky(),$fb._triggerEvent("fastbooking-crs-frontend-basket-checksize"),$fb.basket.desktopStickyRelocate(),$fb._callback(event)},_getBasketData:function(){var result={totalPrice:0,totalPoints:0,totalServices:0,nights:[],included:{},excluded:{},packages:[],services:[]};if($fb.selection.isEmpty())return result;var selection=$fb.selection.get();return $.each(selection.packages,function(id,item){var packageData={price:0,points:0,itemCount:0};$.each(item.package,function(packIndex,pack){"accommodation"===pack.type&&(packageData.rate=pack.rate,packageData.property=pack.property,packageData.accommodation=pack.product,packageData.currency=pack.currency,packageData.additional=item.additional[packIndex],packageData.adults=pack.adults,packageData.children=pack.children,void 0===result.currency&&(result.currency=pack.currency),pack.loyalty&&(packageData.loyalty=!0,pack.loyaltyMemberLevels&&(packageData.loyaltyMemberLevels=pack.loyaltyMemberLevels)));var breakdown=pack.loyaltyDiscount?pack.pricesLoyalty.breakdown:pack.campaignId&&pack.pricesDiscounted?pack.pricesDiscounted.breakdown:pack.prices.breakdown;pack.campaignId&&(packageData.campaignId=pack.campaignId,packageData.campaignPromoDiscountType=pack.campaignPromoDiscountType,packageData.campaignPromoType=pack.campaignPromoType,packageData.campaignPromoValue=pack.campaignPromoValue,packageData.pricesDiscounted=pack.pricesDiscounted,packageData.campaignFreeNightIndex=pack.campaignFreeNightIndex),pack.loyaltyDiscount&&(packageData.loyaltyDiscount=pack.loyaltyDiscount),breakdown.forEach(function(price,index){void 0===result.nights[index]&&(result.nights[index]={value:0,freeNight:!1}),pack.campaignId&&"FREE_NIGHTS"===pack.campaignPromoType&&0===price.gross&&-1<$.inArray(index,pack.campaignFreeNightIndex)?result.nights[index].freeNight=!0:result.nights[index].value+=price.gross});var price=pack.loyaltyDiscount?pack.pricesLoyalty.gross:pack.campaignId&&pack.pricesDiscounted?pack.pricesDiscounted.gross:pack.prices.gross,prices=pack.loyaltyDiscount?pack.pricesLoyalty:pack.campaignId&&pack.pricesDiscounted?pack.pricesDiscounted:pack.prices,points=pack.pricesLoyalty?pack.pricesLoyalty.points:0;$.each(prices.taxes.types,function(taxindex,taxData){1===taxData.included&&0<taxData.amount?(void 0===result.included[taxData.label]&&(result.included[taxData.label]=0),result.included[taxData.label]+=taxData.amount):0===taxData.included&&0<taxData.amount&&(void 0===result.excluded[taxData.label]&&(result.excluded[taxData.label]=0),result.excluded[taxData.label]+=taxData.amount)}),packageData.price+=price,packageData.points+=points,packageData.itemCount+=1,result.totalPrice+=parseFloat(price,10),result.totalPoints+=parseFloat(points,10)}),result.packages.push(packageData)}),selection.services.length<=0||$.each(selection.services,function(packId,service){$.each(service.service,function(id,svc){$.each(svc.prices.breakdown,function(nightIndex,nightPrice){void 0===result.nights[nightIndex]&&(result.nights[nightIndex]={value:0,freeNight:!1}),result.nights[nightIndex].value+=nightPrice.gross,$.each(nightPrice.taxes.types,function(taxindex,taxData){1===taxData.included&&0<taxData.amount?(void 0===result.included[taxData.label]&&(result.included[taxData.label]=0),result.included[taxData.label]+=taxData.amount):0===taxData.included&&0<taxData.amount&&(void 0===result.excluded[taxData.label]&&(result.excluded[taxData.label]=0),result.excluded[taxData.label]+=taxData.amount)})}),result.services.push(svc),result.totalPrice+=parseFloat(svc.prices.gross,10),result.totalServices+=parseFloat(svc.prices.gross,10)})}),result},_renderHeader:function(displayPriceDetails){var nbRooms=$fb.selection.nbRooms(),nbNights=$fb.selection.nbNights(),output=$('<div id="fb-basket-header" class="container fb-container fb-light-bg" />'),totalContainer=$('<div class="col-xs-4 fb-container"/>').append($.fb("crs-helper-translate",{key:"Total"}).addClass("col-xs-12 fb-basket-header-total"));if(displayPriceDetails){var basketHeaderLink=$('<div class="hidden-xs hidden-sm col-md-12 fb-basket-header-details nowrap" />');0<$fb.basket._state.data.totalPrice&&basketHeaderLink.append($('<a href="#" class="theme-link" />').append($.fb("crs-helper-translate",{key:"Details"})).append('&nbsp;<i class="fa fa-caret-right"></i>').click(function(event){return event.preventDefault(),0<$("#fb-basket-header-price-details").filter(":visible").length?$(this).html($.fb("crs-helper-translate",{key:"Details"})).append('&nbsp;<i class="fa fa-caret-right"></i>'):($(this).html($.fb("crs-helper-translate",{key:"Details"})).append('&nbsp;<i class="fa fa-caret-down"></i>'),$("#fb-basket-body").scrollTop(0)),$("#fb-basket-header-price-details").slideToggle(),!1})),totalContainer.append(basketHeaderLink)}return output.append(totalContainer),output.append($('<div class="col-xs-8 fb-container"/>').append($('<div class="col-xs-12 fb-price-amount" />').append($.fb("crs-helper-price",{price:$fb.basket._state.data.totalPrice,pricepoint:$fb.basket._state.data.totalPoints,type:"total",ref:"basket"}))).append(0<nbRooms?$('<span class="col-xs-12 fb-price-params" />').append($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"room"}),mode:nbRooms,placeholders:[nbRooms]})).append(", ").append($.fb("crs-helper-translate",{key:"night",mode:nbNights,placeholders:[nbNights]})):"")),output},_renderDetails:function(){var priceDetails=$('<div id="fb-basket-header-price-details" class="col-xs-12" />');if($fb.basket._state.data.nights&&0<$fb.basket._state.data.nights.length){var arrivalDate=$.fb("crs-helper-parsedate",{date:$fb._state.quicksearch.arrival});$.each($fb.basket._state.data.nights,function(nightIndex,nightPrice){if(priceDetails.append($('<div class="col-xs-6 fb-container fb-price-details-night fb-font-light" />').append($.fb("crs-helper-translate",{key:"night-number",placeholders:[nightIndex+1]}))),nightPrice.freeNight){var priceDiv=$('<div class="col-xs-6 fb-price-amount fb-price-per-night-amount fb-font-light" />');priceDetails.append(priceDiv.append($.fb("crs-helper-translate",{key:"free"}))),0!==nightPrice.value&&(priceDiv.append("<span>&nbsp;+&nbsp;</span>"),priceDiv.append($.fb("crs-helper-price",{price:nightPrice.value,type:"accommodation"})))}else priceDetails.append($('<div class="col-xs-5 fb-price-amount fb-price-per-night-amount fb-font-light" />').append($.fb("crs-helper-price",{price:nightPrice.value,type:"accommodation"})));arrivalDate.setDate(arrivalDate.getDate()+1)}),priceDetails.append($('<div class="fb-price-details-total fb-container col-xs-12" />').append($('<div class="col-xs-4 fb-font-bold fb-container fb-font-light" />').append($.fb("crs-helper-translate",{key:"Total"}))).append($('<div class="col-xs-8 fb-font-bold fb-price-amount fb-container fb-font-light" />').append($.fb("crs-helper-price",{price:$fb.basket._state.data.totalPrice,pricepoint:$fb.basket._state.data.totalPoints,type:"total",ref:"basket"})))),$fb.basket._state.data.included&&Object.keys($fb.basket._state.data.included).length&&(priceDetails.append($('<div class="col-xs-12 fb-container fb-dark-gray fb-price-tax-included" />').append($.fb("crs-helper-translate",{key:"price-included-title"}))),$.each($fb.basket._state.data.included,function(label,taxAmount){priceDetails.append($('<div class="col-xs-7 fb-container fb-dark-gray fb-font-light" />').append($.fb("crs-helper-translate",{key:label}))),priceDetails.append($('<div class="col-xs-5 fb-price-amount fb-container fb-dark-gray fb-font-light" />').append($.fb("crs-helper-price",{price:taxAmount,type:"tax",ref:"basket"})))})),$fb.basket._state.data.excluded&&Object.keys($fb.basket._state.data.excluded).length&&(priceDetails.append($('<div class="col-xs-12 fb-container fb-dark-gray fb-price-tax-notincluded" />').append($.fb("crs-helper-translate",{key:"price-not-included-title"}))),$.each($fb.basket._state.data.excluded,function(label,taxAmount){priceDetails.append($('<div class="col-xs-7 fb-container fb-dark-gray fb-font-light" />').append($.fb("crs-helper-translate",{key:label}))),priceDetails.append($('<div class="col-xs-5 fb-price-amount fb-container fb-dark-gray fb-font-light" />').append($.fb("crs-helper-price",{price:taxAmount,type:"tax",ref:"basket"})))}))}return priceDetails},_renderTotalDiscount:function(){var output=$('<div id="fb-total-discount" class="container fb-container fb-light-bg fb-basket-discount"/>'),normalAndDiscountTotal=$fb.selection.get().packages.reduce(function(sumTotal,packages){return packages.package.reduce(function(sum,pack){return sum.price+=pack.prices.gross,sum.discounted+=pack.pricesLoyalty?pack.pricesLoyalty.gross:pack.pricesDiscounted?pack.pricesDiscounted.gross:pack.prices.gross,sum},sumTotal)},{price:0,discounted:0}),totalDiscount=normalAndDiscountTotal.price-normalAndDiscountTotal.discounted;return output.append($('<div class="col-xs-6 fb-container mcm-discount-total"/>').append($.fb("crs-helper-translate",{key:"mcm-basket-total-discount"}).addClass("col-xs-12 fb-basket-header-total"))),totalDiscount?(output.append($('<div class="col-xs-6 fb-container"/>').append($('<div class="col-xs-12 fb-price-amount" />').append($.fb("crs-helper-price",{price:totalDiscount,type:"total"})))),output):null},_renderBody:function(){var output=$('<div id="fb-basket-body" class="container col-xs-12 fb-container fb-light-bg" />'),nbRooms=$fb.selection.nbRooms(),packages=$fb.basket._state.data.packages,services=$fb.basket._state.data.services,rateData=null,rate=$fb._state.app.lockedRate;if(rate&&$fb._state.app.data.rates[$fb._state.quicksearch.property]&&$fb._state.app.data.rates[$fb._state.quicksearch.property][rate]&&(rateData=$fb._state.app.data.rates[$fb._state.quicksearch.property][rate]),$.each(packages,function(id,packageData){var roomPrice,accommodationkey=$fb._state.quicksearch.property+":roomtitle:"+packageData.accommodation,ratekey=$fb._state.quicksearch.property+":promotiontitle:"+packageData.rate,roomContainer=$('<div class="container fb-container fb-basket-accommodation fb-light-bg nowrap" />');roomContainer.append($('<div class="col-xs-4 fb-font-bold fb-room-title"/>').append($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"room-number"}),placeholders:[id+1]}))),roomPrice=$.fb("crs-helper-price",{price:packageData.price,type:"accommodation",pricepoint:packageData.points}),packageData.campaignId&&packageData.pricesDiscounted&&roomPrice.css("float","right").addClass("price-new"),roomContainer.append($('<div class="col-xs-8 fb-price-amount"/>').append(roomPrice)),roomContainer.append($('<div class="col-xs-12 fb-price-params ellipsis"/>').append($.fb("crs-helper-translate",{key:accommodationkey,fallback:packageData.accommodation}))),roomContainer.append($('<div class="col-xs-12 fb-price-params ellipsis"/>').append($.fb("crs-helper-translate",{key:ratekey,fallback:rateData?rateData.title:rate})));var occupancyInfos=[$.fb("crs-helper-translate",{key:"adult",mode:packageData.adults,placeholders:[packageData.adults]})];if(packageData.children&&(occupancyInfos.push(", "),occupancyInfos.push($.fb("crs-helper-translate",{key:"child",mode:packageData.children,placeholders:[packageData.children]}))),roomContainer.append($('<div class="col-xs-12 fb-price-params ellipsis"/>').append(occupancyInfos)),packageData.loyalty&&roomContainer.append($('<div class="col-xs-12 fb-price-params ellipsis basket-badge-container"/>').append($('<span class="rate-badge-container"/>').append($('<span class="rate-badge member"/>').append($.fb("crs-helper-translate",{key:"member-only"}))))),id===packages.length-1){var removeElmt=$('<a href="#" class="theme-link" />').append($.fb("crs-helper-translate",{key:"basket-room-remove"})).click(function(){return $fb.selection.removePackage(id),!1});roomContainer.append($('<div class="fb-room-detail-element col-xs-12 fb-basket-room-remove"/>').append(removeElmt))}output.append(roomContainer)}),"results"===$fb._state.app.step)for(var i=nbRooms;i<$fb._state.quicksearch.occupancy.length;i++){var i18nKey=i===nbRooms?"basket-select-room-number":"room-number";i18nKey=$.fb("crs-helper-translateByAccommodationType",{defKey:i18nKey}),output.append($('<div class="col-xs-12 fb-basket-remain fb-gray"/>').append($.fb("crs-helper-translate",{key:i18nKey,placeholders:[i+1]})))}if(0<services.length){var serviceBlock=$('<div class="container fb-container fb-light-bg" id="fb-basket-services" />');serviceBlock.append($('<div class="col-xs-6 fb-font-bold fb-room-title"/>').append($.fb("crs-helper-translate",{key:"basket-options"}))),serviceBlock.append($('<div class="col-xs-6 fb-price-amount"/>').append($.fb("crs-helper-price",{price:$fb.basket._state.data.totalServices,type:"extra",ref:"basket"}))),serviceBlock.append($('<div class="col-xs-12 nowrap"/>').append($('<a href="#" class="theme-link" />').append($.fb("crs-helper-translate",{key:"Details"})).append('&nbsp;<i class="fa fa-caret-right"></i>').click(function(event){return event.preventDefault(),0<$("#fb-basket-services-details").filter(":visible").length?$(this).html($.fb("crs-helper-translate",{key:"Details"})).append('&nbsp;<i class="fa fa-caret-right"></i>'):$(this).html($.fb("crs-helper-translate",{key:"Details"})).append('&nbsp;<i class="fa fa-caret-down"></i>'),$("#fb-basket-services-details").slideToggle(),!1}))),output.append(serviceBlock);var serviceDetails=$('<div class="col-xs-12 fb-container fb-light-bg" id="fb-basket-services-details" />');$.each(services,function(id,svc){var serviceBlock=$('<div class="col-xs-12 fb-basket-service-details"/>');serviceBlock.append($('<div class="col-xs-8 ellipsis"/>').append($.fb("crs-helper-translate",{key:$fb._state.quicksearch.property+":optiontitle:"+svc.product,fallback:svc.product}))),serviceBlock.append($('<div class="col-xs-4 fb-price-amount"/>').append($.fb("crs-helper-price",{price:svc.prices.gross,type:"extra",ref:"basket"}))),serviceBlock.append($('<div class="col-xs-12" style="text-align: right;"/>').append($('<a href="#" class="theme-link" />').append($.fb("crs-helper-translate",{key:"basket-room-remove"})).click(function(){return $fb.selection.removeService(svc.product),$fb._triggerEvent("fastbooking-crs-frontend-extras-render"),$fb._triggerEvent("fastbooking-crs-frontend-basket-render"),!1}))),serviceDetails.append(serviceBlock)}),output.append(serviceDetails)}return output},_renderSticky:function(){$fb.basket._state.basketOpened&&$("#fb-basket-header-and-body").removeClass("hidden-xs hidden-sm");var nbRooms=$fb.selection.nbRooms(),nbdays=$fb.selection.nbNights(),output=$('<div id="fb-basket-sticky" class="container fb-dark-bg hidden-md hidden-lg" />'),info=$('<div class="col-xs-6 col-sm-7 hidden-md hidden-lg" />');function toggleBasket(){var elementToSlide=$("#fb-basket-header-and-body");$fb.basket._state.basketOpened?($("#fb-basket-sticky > div.fb-basket-sticky-toggle, #fb-basket-sticky span.fb-basket-sticky-toggle").html('<i class="fa fa-caret-down"></i>'),$fb.basket._state.basketOpened=!1,elementToSlide.slideToggle("slow",function(){elementToSlide.slideDown(0),elementToSlide.addClass("hidden-xs hidden-sm")})):($("#fb-basket-sticky > div.fb-basket-sticky-toggle, #fb-basket-sticky span.fb-basket-sticky-toggle").html('<i class="fa fa-caret-right"></i>'),$fb.basket._state.basketOpened=!0,elementToSlide.removeClass("hidden-xs hidden-sm"),elementToSlide.slideUp(0),elementToSlide.slideToggle("slow",function(){$fb._triggerEvent("fastbooking-crs-frontend-basket-checksize")}))}info.append($('<div class="visible-sm col-sm-6" />').append($.fb("crs-helper-translate",{key:"Total"}))),info.append($('<div class="col-xs-12 col-sm-6 hidden-md hidden-lg fb-price-amount" />').append($.fb("crs-helper-price",{price:$fb.basket._state.data.totalPrice,type:"total",ref:"basket"}))),info.append($('<div class="visible-sm col-sm-6"><a href="#" onClick="return false;">Details <span class="fb-basket-sticky-toggle"><i class="fa fa-caret-down"></i></a></div>')),info.append($('<div class="col-xs-12 col-sm-6 hidden-md hidden-lg fb-price-params" />').append(0<nbRooms?$.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"room"}),mode:nbRooms,placeholders:[nbRooms]}):"").append(0<nbdays?", ":"").append(0<nbdays?$.fb("crs-helper-translate",{key:"night",mode:nbdays,placeholders:[nbdays]}):"")),info.click(toggleBasket),output.append(info),output.append($('<div class="col-xs-2 visible-xs fb-basket-sticky-toggle"><i class="fa fa-caret-down"></i></div>').click(toggleBasket));var btnLabel=$.fb("crs-helper-translate",{key:"basket-validate"});"extras"==$fb._state.app.step&&(btnLabel=$.fb("crs-helper-translate",{key:"basket-book"}));var checkout=$('<div class="col-xs-4 col-sm-5 hidden-md hidden-lg fb-basket-sticky-checkout" />');checkout.append($('<button class="btn btn-block fb-action fb-action-flat fb-font-bold theme-btn" />').append(btnLabel).click(function(){"results"==$fb._state.app.step?($.fb("crs-tracking-send","/room-selected"),$fb._ChangeAppStep("extras")):"extras"==$fb._state.app.step&&$fb._ChangeAppStep("validate-collect"),$fb._addHistory(),$fb._checkStep(),$.fb("crs-helper-scrollTo",{id:"#fb-main-container",offset:50}),$fb._triggerEvent("fastbooking-crs-frontend-renderAll")})),output.append(checkout),$fb.basket._container.append(output)},_renderButton:function(){var btnLabel=$.fb("crs-helper-translate",{key:"basket-validate"});"extras"==$fb._state.app.step&&(btnLabel=$.fb("crs-helper-translate",{key:"basket-book"}));var btnConfirm=$('<button class="btn theme-btn fb-action fb-font-bold" />').append(btnLabel).click(function(){if("results"==$fb._state.app.step)$fb.selection.hasAvailableServices()?$fb._ChangeAppStep("extras"):$fb._ChangeAppStep("validate-collect"),$.fb("crs-tracking-send","/room-selected"),$fb._storeState();else if("extras"==$fb._state.app.step){if(!$("#extras-requests form textarea").valid())return;$fb._ChangeAppStep("validate-collect")}$fb._addHistory(),$fb._checkStep(),$.fb("crs-helper-scrollTo",{id:"#fb-header"}),$fb._triggerEvent("fastbooking-crs-frontend-renderAll")});$fb.selection.get().packages.length<=0&&btnConfirm.attr("disabled",!0);var output=$('<div id="fb-basket-checkout" class="hidden-xs hidden-sm" />').append(btnConfirm);if((!$fb.tripAdvisor||!1===$fb.tripAdvisor.isEnabled())&&$fb._.hasFeature("trust-you-seal","activate",$fb._state.quicksearch.property)){var hid=$fb._state.quicksearch.property;$fb._state.app.data.properties&&$fb._state.app.data.properties[hid]&&($fb._state.app.data.properties[hid].configuration&&$fb._state.app.data.properties[hid].configuration.trustYou&&$fb._state.app.data.properties[hid].configuration.trustYou.attractionWidgetEnable&&!$fb._state.app.data.properties[hid].configuration.trustYou.exclude?($fb._state.app.data.trustYou.enabled=!0,$fb._state.app.data.trustYou.threshold=$fb._state.app.data.properties[hid].configuration.trustYou.threshold||0):($fb._state.app.data.trustYou.enabled=!1,$fb._state.app.data.trustYou.threshold=0),$fb._state.app.data.trustYou.excluded=!1),$fb.trustyouSeal&&$fb.trustyouSeal.addSeal(output,hid,"hidden-xs hidden-sm trustyou-seal-basket","s")}output.append($('<div id="fb-widget-container" class="col-xs-12 col-sm-12 col-md-12 fb-container fb-light-bg" />')),$.fb("crs-log",{m:"TripAdvisor basket..."}),void 0!==$fb.tripAdvisor&&!0===$fb.tripAdvisor.isEnabled()&&($("#trustyou-seal").hide(),output.append($fb.tripAdvisor.buildFrame())),$fb.basket._container.append(output)}}}),$(document).on("fastbooking-crs-frontend-basket-init",$fb.basket.init),$(document).on("fastbooking-crs-frontend-basket-render",$fb.basket.render),$(document).on("fastbooking-crs-frontend-load-quotation-done",$fb.basket.render),$(document).on("fastbooking-crs-frontend-load-accommodations-done",$fb.basket.render),$(document).on("fastbooking-crs-frontend-load-rates-done",$fb.basket.render),$(document).on("fastbooking-crs-frontend-load-services-done",$fb.basket.render),$fb.isStandAlone&&$fb.isStandAlone()&&($(window).on("scroll.basket",$fb.basket.desktopStickyRelocate),$(window).on("fastbooking-crs-frontend-basket-checksize",$fb.basket.checkSize))}(window.jQuery);var base64={PADCHAR:"=",ALPHA:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",makeDOMException:function(){try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(tmp){var ex=new Error("DOM Exception 5");return ex.code=ex.number=5,ex.name=ex.description="INVALID_CHARACTER_ERR",ex.toString=function(){return"Error: "+ex.name+": "+ex.message},ex}},getbyte64:function(s,i){var idx=base64.ALPHA.indexOf(s.charAt(i));if(-1===idx)throw base64.makeDOMException();return idx},decode:function(s){s=""+s;var pads,i,b10,getbyte64=base64.getbyte64,imax=s.length;if(0===imax)return s;if(imax%4!=0)throw base64.makeDOMException();pads=0,s.charAt(imax-1)===base64.PADCHAR&&(pads=1,s.charAt(imax-2)===base64.PADCHAR&&(pads=2),imax-=4);var x=[];for(i=0;i<imax;i+=4)b10=getbyte64(s,i)<<18|getbyte64(s,i+1)<<12|getbyte64(s,i+2)<<6|getbyte64(s,i+3),x.push(String.fromCharCode(b10>>16,b10>>8&255,255&b10));switch(pads){case 1:b10=getbyte64(s,i)<<18|getbyte64(s,i+1)<<12|getbyte64(s,i+2)<<6,x.push(String.fromCharCode(b10>>16,b10>>8&255));break;case 2:b10=getbyte64(s,i)<<18|getbyte64(s,i+1)<<12,x.push(String.fromCharCode(b10>>16))}return x.join("")},getbyte:function(s,i){var x=s.charCodeAt(i);if(255<x)throw base64.makeDOMException();return x},encode:function(s){if(1!==arguments.length)throw new SyntaxError("Not enough arguments");var i,b10,padchar=base64.PADCHAR,alpha=base64.ALPHA,getbyte=base64.getbyte,x=[],imax=(s=""+s).length-s.length%3;if(0===s.length)return s;for(i=0;i<imax;i+=3)b10=getbyte(s,i)<<16|getbyte(s,i+1)<<8|getbyte(s,i+2),x.push(alpha.charAt(b10>>18)),x.push(alpha.charAt(b10>>12&63)),x.push(alpha.charAt(b10>>6&63)),x.push(alpha.charAt(63&b10));switch(s.length-imax){case 1:b10=getbyte(s,i)<<16,x.push(alpha.charAt(b10>>18)+alpha.charAt(b10>>12&63)+padchar+padchar);break;case 2:b10=getbyte(s,i)<<16|getbyte(s,i+1)<<8,x.push(alpha.charAt(b10>>18)+alpha.charAt(b10>>12&63)+alpha.charAt(b10>>6&63)+padchar)}return x.join("")}};(function($){$.extend(window.$fb,{checker:{_config:{},checkGuarantee:function(event){if(!$fb._checkEvent("checker","checkGuarantee",event))return $fb._callback(event);if($fb.log("checking guarantee data"),$("#fb-guarantee form.bound").each(function(i,o){$(o).valid()}),event.args&&event.args.guarantee){var $form=$("#fb-guarantee form.bound").show(),isValid=0===$form.length||$form.valid();if($form.hide(),!isValid)return $fb.log("PaymentFrameManager.validateChildForm()"),PaymentFrameManager.validateChildForm(),$fb.checker.scrollBackToForm($form,175),$fb._triggerEvent("fastbooking-crs-frontend-guarantee-check-failed"),!1}return $fb._callback(event)},validateAllForm:function(){for(var forms=["#fb-recap form.bound","#fb-datacollect form.bound","#fb-paymenttypes form.bound"],i=0;i<forms.length;i++)$(forms[i]).each(function(i,o){$(o).valid&&"function"==typeof $(o).valid&&$(o).valid()});PaymentFrameManager.validateChildForm()},checkRecap:function(event){return $fb.checker.validateAllForm(),0===$("#fb-recap form.bound").length||$("#fb-recap form.bound").valid()?$fb._callback(event):($fb._triggerEvent("fastbooking-crs-frontend-recap-check-failed"),$fb.checker.scrollBackToForm($("#fb-recap form.bound"),80),!1)},checkPaymentTypes:function(event){if(!$fb._checkEvent("checker","checkPaymentTypes",event))return $fb._callback(event);if($fb.log("checking checkPaymentTypes data"),$("#fb-paymenttypes form.bound").each(function(i,o){$(o).valid()}),event.args&&event.args.paymentTypes){$("#fb-paymenttypes form.bound input[type=radio]").show();var $form=$("#fb-paymenttypes form.bound"),isValid=0===$form.length||$form.valid();if($("#fb-paymenttypes form.bound input[type=radio]").hide(),!isValid)return $fb._triggerEvent("fastbooking-crs-frontend-paymenttypes-check-failed"),$fb.checker.scrollBackToForm($form,80),!1}return $fb._callback(event)},checkBuyer:function(event){if(!$fb._checkEvent("checker","checkBuyer",event))return $fb._callback(event);$fb.log("checking buyer data"),$("#fb-datacollect form.bound").each(function(i,o){$(o).valid&&"function"==typeof $(o).valid&&$(o).valid()});var $datacollectForm=$("#fb-datacollect form.bound");if($datacollectForm.length&&$datacollectForm.valid&&"function"==typeof $datacollectForm.valid&&!$datacollectForm.valid())return $fb._triggerEvent("fastbooking-crs-frontend-datacollect-check-failed"),$fb.checker.scrollBackToForm($datacollectForm,100),!1;var $confirmBtnForm=$("#fb-confirmbutton form");return $confirmBtnForm.length&&$confirmBtnForm.valid&&"function"==typeof $confirmBtnForm.valid&&!$confirmBtnForm.valid()?($fb._triggerEvent("fastbooking-crs-frontend-datacollect-check-failed"),$fb.checker.scrollBackToForm($confirmBtnForm,100),!1):$fb._callback(event)},checkCancel:function(event){if(!$fb._checkEvent("checker","checkCancel",event))return $fb._callback(event);if($("form.bound").each(function(i,o){$(o).valid&&"function"==typeof $(o).valid&&$(o).valid()}),event.args&&event.args.form){var $form=$("#"+event.args.form+" form.bound");if($form.length&&$form.valid&&"function"==typeof $form.valid&&!$form.valid())return $fb._triggerEvent("fastbooking-crs-frontend-check-cancel-failed"),$fb.checker.scrollBackToForm($form,100),!1}return $fb._callback(event)},scrollBackToForm:function(form,offset){$("html, body").animate({scrollTop:form.offset().top-offset},1e3)}}}),$(document).on("fastbooking-crs-frontend-check-guarantee",$fb.checker.checkGuarantee),$(document).on("fastbooking-crs-frontend-check-paymenttypes",$fb.checker.checkPaymentTypes),$(document).on("fastbooking-crs-frontend-check-buyer",$fb.checker.checkBuyer),$(document).on("fastbooking-crs-frontend-check-cancel",$fb.checker.checkCancel),$(document).on("fastbooking-crs-frontend-check-recap",$fb.checker.checkRecap)})(window.jQuery),function($){$.extend(window.$fb,{messaging:{_config:{defaultTarget:"messages",defaultType:"error",defaultTitle:"Application error",defaultMessage:"An unexpected error occured"},_getContainer:function(target){void 0===target&&(target="messages");var container=$fb._checkContainer(target,!1);return container.addClass("container"),container},_trigger:function(event){if(!$fb._checkEvent("messaging","trigger",event))return $fb._callback(event);var args=event.args||{},errorType=args.type||$fb.messaging._config.defaultType,errorTitle=args.title||$fb.messaging._config.defaultTitle,errorMessage=args.message||$fb.messaging._config.defaultMessage,errorTarget=args.target||$fb.messaging._config.defaultTarget;return $fb.messaging.message("<strong>"+errorTitle+"</strong> "+errorMessage,errorType,errorTarget),$fb._callback(event)},message:function(text,type,target){var container=$fb.messaging._getContainer(target),alertType="info";"error"!=type&&"failure"!=type||(alertType="danger"),"warning"!=type&&"notice"!=type||(alertType="warning"),"success"==type&&(alertType="success");var output=$('<div class="alert alert-'+alertType+" message message-"+type+' alert-dismissable" />');output.append('<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'),text=$.htmlClean(text,{allowedTags:["br","strong"]}),output.append($.htmlClean(text,{allowedTags:["br","strong"]})),container.append(output)},clear:function(event){if(!$fb._checkEvent("messaging","clear",event))return $fb._callback(event);var errorTarget=$fb.messaging._config.defaultTarget;return event.args&&event.args.target&&(errorTarget=event.args.target),$fb.messaging._getContainer(errorTarget).empty(),$fb._callback(event)},modal:function(event){if(!$fb._checkEvent("messaging","modal",event))return $fb._callback(event);var args=event.args||{};return args.classes="fb-modal-msg",args.header=args.title||$fb.messaging._config.defaultTitle,"Application error"===args.message?args.body=$.fb("crs-helper-translate",{key:"error-server-maintenance"}):args.body=args.message||$fb.messaging._config.defaultMessage,$.fb("crs-helper-modal-display",args),$fb._callback(event)}}}),$(document).on("fastbooking-crs-frontend-message",$fb.messaging._trigger),$(document).on("fastbooking-crs-frontend-message-clear",$fb.messaging.clear),$(document).on("fastbooking-crs-frontend-modal",$fb.messaging.modal)}(window.jQuery),function($){$.extend(window.$fb,{ui:{_config:{},_state:{},_showItem:function(name){0<$("#fb-"+name).length&&$("#fb-"+name+":not(:empty)").fadeIn()},_hideItem:function(name,cb){0<$("#fb-"+name).length&&$("#fb-"+name+":not(:empty)").fadeOut(cb)},showModal:function(event){return $fb._checkEvent("ui","showModal",event)&&(event.args&&event.args.modal&&(modal=event.args.modal),event.args&&event.args.modules&&(modules=event.args.modules),modal&&modules&&($fb.ui._state.offset=$(window).scrollTop(),$fb.ui._showItem(modal),$.each(modules,function(id,module){-1==$.inArray(module,$fb._modals)&&$fb.ui._hideItem(module)}),$fb._addHistory())),$fb._callback(event);var modal,modules},hideModal:function(event){return $fb._checkEvent("ui","hideModal",event)&&(event.args&&event.args.modal&&(modal=event.args.modal),event.args&&event.args.modules&&(modules=event.args.modules),event.args&&event.args.offset&&(offset=parseInt(event.args.offset,10)),null===offset&&$fb.ui._state.offset&&(offset=$fb.ui._state.offset),modal&&modules&&($.each(modules,function(id,module){-1==$.inArray(module,$fb._modals)&&$fb.ui._showItem(module),$("#fb-"+module+":not(:empty)").css("display","")}),$fb.ui._hideItem(modal,function(){$(window).scrollTop(Math.max(0,offset)),$(window).scroll()})),Stickyfill.refreshAll()),$fb._callback(event);var modal,modules,offset},browserCompatibilityPostRenderAll:function(){setTimeout(function(){try{var container=$fb._state.app.step;switch($fb._state.app.step){case"validate-collect":container="datacollect";break;case"confirm":container="confirmrecap"}$("#fb-"+container).length&&0==$("#fb-"+container+":visible").length&&$("#fb-main-container > *").appendTo("#fb-main-container")}catch(e){}},500)}}}),$(document).on("fastbooking-crs-frontend-ui-show-modal",$fb.ui.showModal),$(document).on("fastbooking-crs-frontend-ui-hide-modal",$fb.ui.hideModal),$(document).on("fastbooking-crs-frontend-ui-browser-compatibility",$fb.ui.browserCompatibilityPostRenderAll)}(window.jQuery),function(moment,$){var DateRangePicker=function(element,options,cb){if(this.parentEl="body",this.element=$(element),this.startDate=moment().startOf("day"),this.endDate=moment().endOf("day"),this.minDate=!1,this.maxDate=!1,this.dateLimit=!1,this.autoApply=!1,this.singleDatePicker=!1,this.showDropdowns=!1,this.verticalScrolling=!1,this.showWeekNumbers=!1,this.showISOWeekNumbers=!1,this.timePicker=!1,this.timePicker24Hour=!1,this.timePickerIncrement=1,this.timePickerSeconds=!1,this.linkedCalendars=!0,this.autoUpdateInput=!0,this.alwaysShowCalendars=!1,this.enableOutsideClick=!0,this.rightCalendarIsHidden=!1,this.opens="right",this.element.hasClass("pull-right")&&(this.opens="left"),this.drops="down",this.element.hasClass("dropup")&&(this.drops="up"),this.buttonClasses="btn btn-sm",this.applyClass="btn-success",this.cancelClass="btn-default",this.additionalClassForInvalidDate="",this.locale={direction:"ltr",format:moment.localeData().longDateFormat("L"),separator:" - ",applyLabel:"Apply",cancelLabel:"Cancel",weekLabel:"W",daysOfWeek:moment.weekdaysMin(),monthNames:moment.monthsShort(),firstDay:moment.localeData().firstDayOfWeek()},this.callback=function(){},this.isShowing=!1,this.leftCalendar={},this.rightCalendar={},"object"==typeof options&&null!==options||(options={}),"string"==typeof(options=$.extend(this.element.data(),options)).template||options.template instanceof $||(options.template='<div class="daterangepicker dropdown-menu"><div id="nbnights" class="qs-nbnights theme-link"></div><div class="calendar left"><div class="daterangepicker_input hide"><input class="input-mini form-control" type="text" name="daterangepicker_start" value="" /><i class="fa fa-calendar glyphicon glyphicon-calendar"></i><div class="calendar-time"><div></div><i class="fa fa-clock-o glyphicon glyphicon-time"></i></div></div><div class="calendar-table"></div></div><div class="calendar right"><div class="daterangepicker_input hide"><input class="input-mini form-control" type="text" name="daterangepicker_end" value="" /><i class="fa fa-calendar glyphicon glyphicon-calendar"></i><div class="calendar-time"><div></div><i class="fa fa-clock-o glyphicon glyphicon-time"></i></div></div><div class="calendar-table"></div></div></div>'),this.parentEl=options.parentEl&&$(options.parentEl).length?$(options.parentEl):$(this.parentEl),this.container=$(options.template).appendTo(this.parentEl),"object"==typeof options.locale&&("string"==typeof options.locale.direction&&(this.locale.direction=options.locale.direction),"string"==typeof options.locale.format&&(this.locale.format=options.locale.format),"string"==typeof options.locale.separator&&(this.locale.separator=options.locale.separator),"object"==typeof options.locale.daysOfWeek&&(this.locale.daysOfWeek=options.locale.daysOfWeek.slice()),"object"==typeof options.locale.monthNames&&(this.locale.monthNames=options.locale.monthNames.slice()),"number"==typeof options.locale.firstDay&&(this.locale.firstDay=options.locale.firstDay),"string"==typeof options.locale.applyLabel&&(this.locale.applyLabel=options.locale.applyLabel),"string"==typeof options.locale.cancelLabel&&(this.locale.cancelLabel=options.locale.cancelLabel),"string"==typeof options.locale.weekLabel&&(this.locale.weekLabel=options.locale.weekLabel)),this.container.addClass(this.locale.direction),"string"==typeof options.monthHeaderYearFormat&&(this.monthHeaderYearFormat=options.monthHeaderYearFormat),"boolean"==typeof options.monthHeaderRevert&&(this.monthHeaderRevert=options.monthHeaderRevert),"string"==typeof options.startDate&&(this.startDate=moment(options.startDate,this.locale.format)),"string"==typeof options.endDate&&(this.endDate=moment(options.endDate,this.locale.format)),"string"==typeof options.minDate&&(this.minDate=moment(options.minDate,this.locale.format)),"string"==typeof options.maxDate&&(this.maxDate=moment(options.maxDate,this.locale.format)),"object"==typeof options.startDate&&(this.startDate=moment(options.startDate)),"object"==typeof options.endDate&&(this.endDate=moment(options.endDate)),"object"==typeof options.minDate&&(this.minDate=moment(options.minDate)),"object"==typeof options.maxDate&&(this.maxDate=moment(options.maxDate)),this.minDate&&this.startDate.isBefore(this.minDate)&&(this.startDate=this.minDate.clone()),this.maxDate&&this.endDate.isAfter(this.maxDate)&&(this.endDate=this.maxDate.clone()),"string"==typeof options.applyClass&&(this.applyClass=options.applyClass),"string"==typeof options.cancelClass&&(this.cancelClass=options.cancelClass),"object"==typeof options.dateLimit&&(this.dateLimit=options.dateLimit),"string"==typeof options.opens&&(this.opens=options.opens),"string"==typeof options.drops&&(this.drops=options.drops),"boolean"==typeof options.showWeekNumbers&&(this.showWeekNumbers=options.showWeekNumbers),"boolean"==typeof options.showISOWeekNumbers&&(this.showISOWeekNumbers=options.showISOWeekNumbers),"string"==typeof options.buttonClasses&&(this.buttonClasses=options.buttonClasses),"object"==typeof options.buttonClasses&&(this.buttonClasses=options.buttonClasses.join(" ")),"boolean"==typeof options.showDropdowns&&(this.showDropdowns=options.showDropdowns),"boolean"==typeof options.verticalScrolling&&(this.verticalScrolling=options.verticalScrolling),"boolean"==typeof options.singleDatePicker&&(this.singleDatePicker=options.singleDatePicker,this.singleDatePicker&&(this.endDate=this.startDate.clone())),"boolean"==typeof options.timePicker&&(this.timePicker=options.timePicker),"boolean"==typeof options.timePickerSeconds&&(this.timePickerSeconds=options.timePickerSeconds),"number"==typeof options.timePickerIncrement&&(this.timePickerIncrement=options.timePickerIncrement),"boolean"==typeof options.timePicker24Hour&&(this.timePicker24Hour=options.timePicker24Hour),"boolean"==typeof options.autoApply&&(this.autoApply=options.autoApply),"boolean"==typeof options.autoUpdateInput&&(this.autoUpdateInput=options.autoUpdateInput),"boolean"==typeof options.linkedCalendars&&(this.linkedCalendars=options.linkedCalendars),"function"==typeof options.isInvalidDate&&(this.isInvalidDate=options.isInvalidDate),"string"==typeof options.additionalClassForInvalidDate&&(this.additionalClassForInvalidDate=options.additionalClassForInvalidDate),"function"==typeof options.isCustomDate&&(this.isCustomDate=options.isCustomDate),"boolean"==typeof options.alwaysShowCalendars&&(this.alwaysShowCalendars=options.alwaysShowCalendars),"boolean"==typeof options.enableOutsideClick&&(this.enableOutsideClick=options.enableOutsideClick),"boolean"==typeof options.rightCalendarIsHidden&&(this.rightCalendarIsHidden=options.rightCalendarIsHidden),0!=this.locale.firstDay)for(var iterator=this.locale.firstDay;0<iterator;)this.locale.daysOfWeek.push(this.locale.daysOfWeek.shift()),iterator--;var start,end;if(void 0===options.startDate&&void 0===options.endDate&&$(this.element).is("input[type=text]")){var val=$(this.element).val(),split=val.split(this.locale.separator);start=end=null,2==split.length?(start=moment(split[0],this.locale.format),end=moment(split[1],this.locale.format)):this.singleDatePicker&&""!==val&&(start=moment(val,this.locale.format),end=moment(val,this.locale.format)),null!==start&&null!==end&&(this.setStartDate(start),this.setEndDate(end))}"function"==typeof cb&&(this.callback=cb),this.timePicker||(this.startDate=this.startDate.startOf("day"),this.endDate=this.endDate.endOf("day"),this.container.find(".calendar-time").hide()),this.timePicker&&this.autoApply&&(this.autoApply=!1),this.autoApply&&this.container.find(".applyBtn, .cancelBtn").addClass("hide"),this.singleDatePicker&&(this.container.addClass("single"),this.container.find(".calendar.left").addClass("single"),this.container.find(".calendar.left").show(),this.container.find(".calendar.right").hide(),this.container.find(".daterangepicker_input input, .daterangepicker_input > i").hide()),this.singleDatePicker&&!this.alwaysShowCalendars||this.container.addClass("show-calendar"),this.container.addClass("opens"+this.opens),this.container.find(".applyBtn, .cancelBtn").addClass(this.buttonClasses),this.applyClass.length&&this.container.find(".applyBtn").addClass(this.applyClass),this.cancelClass.length&&this.container.find(".cancelBtn").addClass(this.cancelClass),this.container.find(".applyBtn").html(this.locale.applyLabel),this.container.find(".cancelBtn").html(this.locale.cancelLabel),this.container.find(".calendar").on("click.daterangepicker",".prev",$.proxy(this.clickPrev,this)).on("click.daterangepicker",".next",$.proxy(this.clickNext,this)).on("click.daterangepicker","tbody td.available",$.proxy(this.clickDate,this)).on("mouseenter.daterangepicker","tbody td.available",$.proxy(this.hoverDate,this)).on("mouseleave.daterangepicker","tbody td.available",$.proxy(this.updateFormInputs,this)).on("change.daterangepicker","select.yearselect",$.proxy(this.monthOrYearChanged,this)).on("change.daterangepicker","select.monthselect",$.proxy(this.monthOrYearChanged,this)).on("change.daterangepicker","select.hourselect,select.minuteselect,select.secondselect,select.ampmselect",$.proxy(this.timeChanged,this)).on("click.daterangepicker",".daterangepicker_input input",$.proxy(this.showCalendars,this)).on("focus.daterangepicker",".daterangepicker_input input",$.proxy(this.formInputsFocused,this)).on("blur.daterangepicker",".daterangepicker_input input",$.proxy(this.formInputsBlurred,this)).on("change.daterangepicker",".daterangepicker_input input",$.proxy(this.formInputsChanged,this)),this.element.is("input")||this.element.is("button")?this.element.on({"click.daterangepicker":$.proxy(this.show,this),"focus.daterangepicker":$.proxy(this.show,this),"keyup.daterangepicker":$.proxy(this.elementChanged,this),"keydown.daterangepicker":$.proxy(this.keydown,this)}):this.element.on("click.daterangepicker",$.proxy(this.toggle,this)),this.element.is("input")&&!this.singleDatePicker&&this.autoUpdateInput?(this.element.val(this.startDate.format(this.locale.format)+this.locale.separator+this.endDate.format(this.locale.format)),this.element.trigger("change")):this.element.is("input")&&this.autoUpdateInput&&(this.element.val(this.startDate.format(this.locale.format)),this.element.trigger("change"))};DateRangePicker.prototype={constructor:DateRangePicker,setStartDate:function(startDate){"string"==typeof startDate&&(this.startDate=moment(startDate,this.locale.format)),"object"==typeof startDate&&(this.startDate=moment(startDate)),this.timePicker||(this.startDate=this.startDate.startOf("day")),this.timePicker&&this.timePickerIncrement&&this.startDate.minute(Math.round(this.startDate.minute()/this.timePickerIncrement)*this.timePickerIncrement),this.minDate&&this.startDate.isBefore(this.minDate)&&(this.startDate=this.minDate.clone(),this.timePicker&&this.timePickerIncrement&&this.startDate.minute(Math.round(this.startDate.minute()/this.timePickerIncrement)*this.timePickerIncrement)),this.maxDate&&this.startDate.isAfter(this.maxDate)&&(this.startDate=this.maxDate.clone(),this.timePicker&&this.timePickerIncrement&&this.startDate.minute(Math.floor(this.startDate.minute()/this.timePickerIncrement)*this.timePickerIncrement)),this.isShowing||this.updateElement(),this.updateMonthsInView()},setEndDate:function(endDate){"string"==typeof endDate&&(this.endDate=moment(endDate,this.locale.format)),"object"==typeof endDate&&(this.endDate=moment(endDate)),this.timePicker||(this.endDate=this.endDate.endOf("day")),this.timePicker&&this.timePickerIncrement&&this.endDate.minute(Math.round(this.endDate.minute()/this.timePickerIncrement)*this.timePickerIncrement),this.endDate.isBefore(this.startDate)&&(this.endDate=this.startDate.clone()),this.maxDate&&this.endDate.isAfter(this.maxDate)&&(this.endDate=this.maxDate.clone()),this.dateLimit&&this.startDate.clone().add(this.dateLimit).isBefore(this.endDate)&&(this.endDate=this.startDate.clone().add(this.dateLimit)),this.previousRightTime=this.endDate.clone(),this.isShowing||this.updateElement(),this.updateMonthsInView(!0)},isInvalidDate:function(){return!1},isCustomDate:function(){return!1},updateView:function(endDateSelection){this.timePicker&&(this.renderTimePicker("left"),this.renderTimePicker("right"),this.endDate?this.container.find(".right .calendar-time select").removeAttr("disabled").removeClass("disabled"):this.container.find(".right .calendar-time select").attr("disabled","disabled").addClass("disabled")),this.endDate?(this.container.find('input[name="daterangepicker_end"]').removeClass("active"),this.container.find('input[name="daterangepicker_start"]').addClass("active")):(this.container.find('input[name="daterangepicker_end"]').addClass("active"),this.container.find('input[name="daterangepicker_start"]').removeClass("active")),this.updateMonthsInView(endDateSelection),this.updateCalendars(),this.updateFormInputs()},updateMonthsInView:function(endDateSelection){if(this.endDate){if(!this.singleDatePicker&&this.leftCalendar.month&&this.rightCalendar.month&&(this.startDate.format("YYYY-MM")==this.leftCalendar.month.format("YYYY-MM")||this.startDate.format("YYYY-MM")==this.rightCalendar.month.format("YYYY-MM"))&&(this.endDate.format("YYYY-MM")==this.leftCalendar.month.format("YYYY-MM")||this.endDate.format("YYYY-MM")==this.rightCalendar.month.format("YYYY-MM")))return;endDateSelection?(this.leftCalendar.month=this.lastLeftCalendarMonth.clone().date(2),this.rightCalendar.month=this.lastRightCalendarMonth.clone().date(2),!this.rightCalendarIsHidden&&this.startDate.clone().add(1,"month").isSame(this.endDate,"month")&&(this.leftCalendar.month=this.startDate.clone().date(2),this.rightCalendar.month=this.endDate.clone().date(2))):(this.leftCalendar.month=this.startDate.clone().date(2),this.linkedCalendars||this.endDate.month()==this.startDate.month()&&this.endDate.year()==this.startDate.year()?this.rightCalendar.month=this.startDate.clone().date(2).add(1,"month"):this.rightCalendar.month=this.endDate.clone().date(2))}else this.leftCalendar.month.format("YYYY-MM")!=this.startDate.format("YYYY-MM")&&this.rightCalendar.month.format("YYYY-MM")!=this.startDate.format("YYYY-MM")&&(this.leftCalendar.month=this.startDate.clone().date(2),this.rightCalendar.month=this.startDate.clone().date(2).add(1,"month"));this.maxDate&&this.linkedCalendars&&!this.singleDatePicker&&this.rightCalendar.month>this.maxDate&&(this.rightCalendar.month=this.maxDate.clone().date(2),this.leftCalendar.month=this.maxDate.clone().date(2).subtract(1,"month"))},updateCalendars:function(){var hour,minute,second,ampm;this.timePicker&&(this.endDate?(hour=parseInt(this.container.find(".left .hourselect").val(),10),minute=parseInt(this.container.find(".left .minuteselect").val(),10),second=this.timePickerSeconds?parseInt(this.container.find(".left .secondselect").val(),10):0,this.timePicker24Hour||("PM"===(ampm=this.container.find(".left .ampmselect").val())&&hour<12&&(hour+=12),"AM"===ampm&&12===hour&&(hour=0))):(hour=parseInt(this.container.find(".right .hourselect").val(),10),minute=parseInt(this.container.find(".right .minuteselect").val(),10),second=this.timePickerSeconds?parseInt(this.container.find(".right .secondselect").val(),10):0,this.timePicker24Hour||("PM"===(ampm=this.container.find(".right .ampmselect").val())&&hour<12&&(hour+=12),"AM"===ampm&&12===hour&&(hour=0))),this.leftCalendar.month.hour(hour).minute(minute).second(second),this.rightCalendar.month.hour(hour).minute(minute).second(second));this.renderCalendar("left"),this.renderCalendar("right"),this.lastLeftCalendarMonth=this.leftCalendar.month,this.lastRightCalendarMonth=this.rightCalendar.month,null!=this.endDate&&this.showCalendars(),this.element.trigger("updateCalendars.daterangepicker",this)},renderCalendar:function(side){var cal="left"==side?this.leftCalendar:this.rightCalendar,month=cal.month.month(),year=cal.month.year(),hour=cal.month.hour(),minute=cal.month.minute(),second=cal.month.second(),daysInMonth=moment([year,month]).daysInMonth(),firstDay=moment([year,month,1]),lastDay=moment([year,month,daysInMonth]),lastMonth=moment(firstDay).subtract(1,"month").month(),lastYear=moment(firstDay).subtract(1,"month").year(),daysInLastMonth=moment([lastYear,lastMonth]).daysInMonth(),dayOfWeek=firstDay.day(),calendar=[];calendar.firstDay=firstDay,calendar.lastDay=lastDay;for(var i=0;i<6;i++)calendar[i]=[];var startDay=daysInLastMonth-dayOfWeek+this.locale.firstDay+1;daysInLastMonth<startDay&&(startDay-=7),dayOfWeek==this.locale.firstDay&&(startDay=daysInLastMonth-6);var col,row,j,curDate=moment([lastYear,lastMonth,startDay,12,minute,second]);for(row=col=j=0;j<42;j++,col++,curDate=moment(curDate).add(24,"hour"))0<j&&col%7==0&&(col=0,row++),calendar[row][col]=curDate.clone().hour(hour).minute(minute).second(second),curDate.hour(12),this.minDate&&calendar[row][col].format("YYYY-MM-DD")==this.minDate.format("YYYY-MM-DD")&&calendar[row][col].isBefore(this.minDate)&&"left"==side&&(calendar[row][col]=this.minDate.clone()),this.maxDate&&calendar[row][col].format("YYYY-MM-DD")==this.maxDate.format("YYYY-MM-DD")&&calendar[row][col].isAfter(this.maxDate)&&"right"==side&&(calendar[row][col]=this.maxDate.clone());"left"==side?this.leftCalendar.calendar=calendar:this.rightCalendar.calendar=calendar;var dateHtml,minDate="left"==side?this.minDate:this.startDate,maxDate=this.maxDate,html='<table class="table-condensed'+(this.verticalScrolling?" daterangepicker-vertical-scrolling":"")+'">';if(this.verticalScrolling)html+="<thead>",html+="<tr>",minDate&&!minDate.isBefore(calendar.firstDay)||this.linkedCalendars&&"left"!=side||(html+='<th colspan="3"></th>',html+='<th class="prev available theme-link"><</th>',html+='<th colspan="3"></th>',html+="</tr>",html+="<tr>"),"left"==side&&($.each(this.locale.daysOfWeek,function(index,dayOfWeek){html+='<th class="weekday">'+dayOfWeek+"</th>"}),html+="</tr>",html+="<tr>"),dateHtml=this.monthHeaderRevert?calendar[1][1].format(this.monthHeaderYearFormat)+this.locale.monthNames[calendar[1][1].month()]:this.locale.monthNames[calendar[1][1].month()]+" "+calendar[1][1].format(this.monthHeaderYearFormat),html+='<th colspan="7" class="month">'+dateHtml+"</th>",html+="</tr>",html+="</thead>",maxDate&&!maxDate.isAfter(calendar.lastDay)||this.linkedCalendars&&"right"!=side&&!this.singleDatePicker||(html+="<tfoot>",html+='<td colspan="3"></td>',html+='<td class="next available theme-link">&gt;</td>',html+='<td colspan="3"></td>',html+="</tfoot>");else{if(html+="<thead>",html+="<tr>",(this.showWeekNumbers||this.showISOWeekNumbers)&&(html+="<th></th>"),minDate&&!minDate.isBefore(calendar.firstDay)||this.linkedCalendars&&"left"!=side?html+="<th></th>":html+='<th class="prev available theme-link"><</th>',dateHtml=this.monthHeaderRevert?calendar[1][1].format(this.monthHeaderYearFormat)+this.locale.monthNames[calendar[1][1].month()]:this.locale.monthNames[calendar[1][1].month()]+" "+calendar[1][1].format(this.monthHeaderYearFormat),this.showDropdowns){for(var currentMonth=calendar[1][1].month(),currentYear=calendar[1][1].year(),maxYear=maxDate&&maxDate.year()||currentYear+5,minYear=minDate&&minDate.year()||currentYear-50,inMinYear=currentYear==minYear,inMaxYear=currentYear==maxYear,monthHtml='<select class="monthselect">',m=0;m<12;m++)(!inMinYear||m>=minDate.month())&&(!inMaxYear||m<=maxDate.month())?monthHtml+="<option value='"+m+"'"+(m===currentMonth?" selected='selected'":"")+">"+this.locale.monthNames[m]+"</option>":monthHtml+="<option value='"+m+"'"+(m===currentMonth?" selected='selected'":"")+" disabled='disabled'>"+this.locale.monthNames[m]+"</option>";monthHtml+="</select>";for(var yearHtml='<select class="yearselect">',y=minYear;y<=maxYear;y++)yearHtml+='<option value="'+y+'"'+(y===currentYear?' selected="selected"':"")+">"+y+"</option>";dateHtml=monthHtml+(yearHtml+="</select>")}html+='<th colspan="5" class="month">'+dateHtml+"</th>",maxDate&&!maxDate.isAfter(calendar.lastDay)||this.linkedCalendars&&"right"!=side&&!this.singleDatePicker?html+="<th></th>":html+='<th class="next available theme-link">&gt;</th>',html+="</tr>",html+="<tr>",(this.showWeekNumbers||this.showISOWeekNumbers)&&(html+='<th class="week">'+this.locale.weekLabel+"</th>"),$.each(this.locale.daysOfWeek,function(index,dayOfWeek){html+="<th>"+dayOfWeek+"</th>"}),html+="</tr>",html+="</thead>"}if(html+="<tbody>",null==this.endDate&&this.dateLimit){var maxLimit=this.startDate.clone().add(this.dateLimit).endOf("day");maxDate&&!maxLimit.isBefore(maxDate)||(maxDate=maxLimit)}for(row=0;row<6;row++){for(html+="<tr>",this.showWeekNumbers?html+='<td class="week">'+calendar[row][0].week()+"</td>":this.showISOWeekNumbers&&(html+='<td class="week">'+calendar[row][0].isoWeek()+"</td>"),col=0;col<7;col++){var classes=[];calendar[row][col].isSame(new Date,"day")&&classes.push("today"),5<calendar[row][col].isoWeekday()&&classes.push("weekend"),calendar[row][col].month()!=calendar[1][1].month()&&classes.push("day-of-other-month"),this.minDate&&calendar[row][col].isBefore(this.minDate,"day")&&classes.push("off","disabled"),maxDate&&calendar[row][col].isAfter(maxDate,"day")&&classes.push("off","disabled"),this.isInvalidDate(calendar[row][col])&&classes.push("off","disabled",this.additionalClassForInvalidDate),calendar[row][col].format("YYYY-MM-DD")==this.startDate.format("YYYY-MM-DD")&&classes.push("active","start-date"),null!=this.endDate&&calendar[row][col].format("YYYY-MM-DD")==this.endDate.format("YYYY-MM-DD")&&classes.push("active","end-date"),null!=this.endDate&&calendar[row][col]>this.startDate&&calendar[row][col]<this.endDate&&classes.push("in-range");var isCustom=this.isCustomDate(calendar[row][col]);!1!==isCustom&&("string"==typeof isCustom?classes.push(isCustom):Array.prototype.push.apply(classes,isCustom));for(var cname="",disabled=!1,k=0;k<classes.length;k++)cname+=classes[k]+" ","disabled"==classes[k]&&(disabled=!0);disabled||(cname+="available"),html+='<td class="'+cname.replace(/^\s+|\s+$/g,"")+'" data-title="r'+row+"c"+col+'">'+calendar[row][col].date()+"</td>"}html+="</tr>"}html+="</tbody>",html+="</table>",this.container.find(".calendar."+side+" .calendar-table").html(html)},renderTimePicker:function(side){if("right"!=side||this.endDate){var html,selected,minDate,maxDate=this.maxDate;if(!this.dateLimit||this.maxDate&&!this.startDate.clone().add(this.dateLimit).isAfter(this.maxDate)||(maxDate=this.startDate.clone().add(this.dateLimit)),"left"==side)selected=this.startDate.clone(),minDate=this.minDate;else if("right"==side){selected=this.endDate.clone(),minDate=this.startDate;var timeSelector=this.container.find(".calendar.right .calendar-time div");if(""!=timeSelector.html()&&(selected.hour(timeSelector.find(".hourselect option:selected").val()||selected.hour()),selected.minute(timeSelector.find(".minuteselect option:selected").val()||selected.minute()),selected.second(timeSelector.find(".secondselect option:selected").val()||selected.second()),!this.timePicker24Hour)){var ampm=timeSelector.find(".ampmselect option:selected").val();"PM"===ampm&&selected.hour()<12&&selected.hour(selected.hour()+12),"AM"===ampm&&12===selected.hour()&&selected.hour(0)}selected.isBefore(this.startDate)&&(selected=this.startDate.clone()),maxDate&&selected.isAfter(maxDate)&&(selected=maxDate.clone())}html='<select class="hourselect">';var i,time,disabled,padded,start=this.timePicker24Hour?0:1,end=this.timePicker24Hour?23:12;for(i=start;i<=end;i++){var i_in_24=i;this.timePicker24Hour||(i_in_24=12<=selected.hour()?12==i?12:i+12:12==i?0:i),time=selected.clone().hour(i_in_24),disabled=!1,minDate&&time.minute(59).isBefore(minDate)&&(disabled=!0),maxDate&&time.minute(0).isAfter(maxDate)&&(disabled=!0),i_in_24!=selected.hour()||disabled?html+=disabled?'<option value="'+i+'" disabled="disabled" class="disabled">'+i+"</option>":'<option value="'+i+'">'+i+"</option>":html+='<option value="'+i+'" selected="selected">'+i+"</option>"}for(html+="</select> ",html+=': <select class="minuteselect">',i=0;i<60;i+=this.timePickerIncrement)padded=i<10?"0"+i:i,time=selected.clone().minute(i),disabled=!1,minDate&&time.second(59).isBefore(minDate)&&(disabled=!0),maxDate&&time.second(0).isAfter(maxDate)&&(disabled=!0),selected.minute()!=i||disabled?html+=disabled?'<option value="'+i+'" disabled="disabled" class="disabled">'+padded+"</option>":'<option value="'+i+'">'+padded+"</option>":html+='<option value="'+i+'" selected="selected">'+padded+"</option>";if(html+="</select> ",this.timePickerSeconds){for(html+=': <select class="secondselect">',i=0;i<60;i++)padded=i<10?"0"+i:i,time=selected.clone().second(i),disabled=!1,minDate&&time.isBefore(minDate)&&(disabled=!0),maxDate&&time.isAfter(maxDate)&&(disabled=!0),selected.second()!=i||disabled?html+=disabled?'<option value="'+i+'" disabled="disabled" class="disabled">'+padded+"</option>":'<option value="'+i+'">'+padded+"</option>":html+='<option value="'+i+'" selected="selected">'+padded+"</option>";html+="</select> "}if(!this.timePicker24Hour){html+='<select class="ampmselect">';var am_html="",pm_html="";minDate&&selected.clone().hour(12).minute(0).second(0).isBefore(minDate)&&(am_html=' disabled="disabled" class="disabled"'),maxDate&&selected.clone().hour(0).minute(0).second(0).isAfter(maxDate)&&(pm_html=' disabled="disabled" class="disabled"'),12<=selected.hour()?html+='<option value="AM"'+am_html+'>AM</option><option value="PM" selected="selected"'+pm_html+">PM</option>":html+='<option value="AM" selected="selected"'+am_html+'>AM</option><option value="PM"'+pm_html+">PM</option>",html+="</select>"}this.container.find(".calendar."+side+" .calendar-time div").html(html)}},updateFormInputs:function(){this.container.find("input[name=daterangepicker_start]").is(":focus")||this.container.find("input[name=daterangepicker_end]").is(":focus")||(this.container.find("input[name=daterangepicker_start]").val(this.startDate.format(this.locale.format)),this.endDate&&this.container.find("input[name=daterangepicker_end]").val(this.endDate.format(this.locale.format)),this.singleDatePicker||this.endDate&&(this.startDate.isBefore(this.endDate)||this.startDate.isSame(this.endDate))?this.container.find("button.applyBtn").removeAttr("disabled"):this.container.find("button.applyBtn").attr("disabled","disabled"))},move:function(){var containerTop,parentOffset={top:0,left:0},parentRightEdge=$(window).width();this.parentEl.is("body")||(parentOffset={top:this.parentEl.offset().top-this.parentEl.scrollTop(),left:this.parentEl.offset().left-this.parentEl.scrollLeft()},parentRightEdge=this.parentEl[0].clientWidth+this.parentEl.offset().left),containerTop="up"==this.drops?this.element.offset().top-this.container.outerHeight()-parentOffset.top:this.element.offset().top+this.element.outerHeight()-parentOffset.top,this.container["up"==this.drops?"addClass":"removeClass"]("dropup"),"left"==this.opens?(this.container.css({top:containerTop,right:parentRightEdge-this.element.offset().left-this.element.outerWidth(),left:"auto"}),this.container.offset().left<0&&this.container.css({right:"auto",left:9})):"center"==this.opens?(this.container.css({top:containerTop,left:this.element.offset().left-parentOffset.left+this.element.outerWidth()/2-this.container.outerWidth()/2,right:"auto"}),this.container.offset().left<0&&this.container.css({right:"auto",left:9})):(this.container.css({top:containerTop,left:this.element.offset().left-parentOffset.left,right:"auto"}),this.container.offset().left+this.container.outerWidth()>$(window).width()&&this.container.css({left:"auto",right:0}))},show:function(){this.isShowing||(this._outsideClickProxy=$.proxy(function(e){this.outsideClick(e)},this),$(document).on("mousedown.daterangepicker",this._outsideClickProxy).on("touchend.daterangepicker",this._outsideClickProxy).on("click.daterangepicker","[data-toggle=dropdown]",this._outsideClickProxy).on("focusin.daterangepicker",this._outsideClickProxy),$(window).on("resize.daterangepicker",$.proxy(function(e){this.move(e)},this)),this.oldStartDate=this.startDate.clone(),this.oldEndDate=this.endDate.clone(),this.previousRightTime=this.endDate.clone(),this.updateView(),this.container.show(),this.move(),this.element.trigger("show.daterangepicker",this),this.isShowing=!0)},hide:function(){this.isShowing&&(this.endDate||(this.startDate=this.oldStartDate.clone(),this.endDate=this.oldEndDate.clone()),this.updateElement(),$(document).off(".daterangepicker"),$(window).off(".daterangepicker"),this.container.hide(),this.element.trigger("hide.daterangepicker",this),this.isShowing=!1)},toggle:function(e){if(this.isShowing){if(0<$(e.target).closest(".daterangepicker").length||0<$(e.target).closest(".prev").length||0<$(e.target).closest(".next").length)return;this.enableOutsideClick&&this.hide()}else this.show()},outsideClick:function(e){var target=$(e.target);"focusin"==e.type||target.closest(this.element).length||target.closest(this.container).length||target.closest(".calendar-table").length||(this.enableOutsideClick&&this.hide(),this.element.trigger("outsideClick.daterangepicker",this))},showCalendars:function(){this.container.addClass("show-calendar"),this.move(),this.element.trigger("showCalendar.daterangepicker",this)},hideCalendars:function(){this.container.removeClass("show-calendar"),this.element.trigger("hideCalendar.daterangepicker",this)},clickPrev:function(e){$(e.target).parents(".calendar").hasClass("left")?(this.leftCalendar.month.subtract(1,"month"),this.linkedCalendars&&this.rightCalendar.month.subtract(1,"month")):this.rightCalendar.month.subtract(1,"month"),this.linkedCalendars&&this.element.trigger("clickPrevMonth.daterangepicker",this.leftCalendar.month.clone()),this.updateCalendars()},clickNext:function(e){$(e.target).parents(".calendar").hasClass("left")?this.leftCalendar.month.add(1,"month"):(this.rightCalendar.month.add(1,"month"),this.linkedCalendars&&this.leftCalendar.month.add(1,"month")),this.linkedCalendars&&this.element.trigger("clickNextMonth.daterangepicker",this.rightCalendar.month.clone()),this.updateCalendars()},hoverDate:function(e){if($(e.target).hasClass("available")){var title=$(e.target).attr("data-title"),row=title.substr(1,1),col=title.substr(3,1),date=$(e.target).parents(".calendar").hasClass("left")?this.leftCalendar.calendar[row][col]:this.rightCalendar.calendar[row][col];this.endDate&&!this.container.find("input[name=daterangepicker_start]").is(":focus")?this.container.find("input[name=daterangepicker_start]").val(date.format(this.locale.format)):this.endDate||this.container.find("input[name=daterangepicker_end]").is(":focus")||this.container.find("input[name=daterangepicker_end]").val(date.format(this.locale.format));var leftCalendar=this.leftCalendar,rightCalendar=this.rightCalendar,startDate=this.startDate;this.endDate||this.container.find(".calendar tbody td").each(function(index,el){if(!$(el).hasClass("week")){var title=$(el).attr("data-title"),row=title.substr(1,1),col=title.substr(3,1),dt=$(el).parents(".calendar").hasClass("left")?leftCalendar.calendar[row][col]:rightCalendar.calendar[row][col];dt.isAfter(startDate)&&dt.isBefore(date)||dt.isSame(date,"day")?$(el).addClass("in-range"):$(el).removeClass("in-range")}}),this.element.trigger("hoverDate.daterangepicker",date.format(this.locale.format))}},clickDate:function(e){if($(e.target).hasClass("available")){var hour,ampm,minute,second,title=$(e.target).attr("data-title"),row=title.substr(1,1),col=title.substr(3,1),date=$(e.target).parents(".calendar").hasClass("left")?this.leftCalendar.calendar[row][col]:this.rightCalendar.calendar[row][col],endDateSelection=!1;this.endDate||date.isBefore(this.startDate,"day")?(this.timePicker&&(hour=parseInt(this.container.find(".left .hourselect").val(),10),this.timePicker24Hour||("PM"===(ampm=this.container.find(".left .ampmselect").val())&&hour<12&&(hour+=12),"AM"===ampm&&12===hour&&(hour=0)),minute=parseInt(this.container.find(".left .minuteselect").val(),10),second=this.timePickerSeconds?parseInt(this.container.find(".left .secondselect").val(),10):0,date=date.clone().hour(hour).minute(minute).second(second)),this.endDate=null,this.setStartDate(date.clone()),this.element.trigger("clickStartDate.daterangepicker",date.clone())):!this.endDate&&date.isBefore(this.startDate)?this.setEndDate(this.startDate.clone()):(this.timePicker&&(hour=parseInt(this.container.find(".right .hourselect").val(),10),this.timePicker24Hour||("PM"===(ampm=this.container.find(".right .ampmselect").val())&&hour<12&&(hour+=12),"AM"===ampm&&12===hour&&(hour=0)),minute=parseInt(this.container.find(".right .minuteselect").val(),10),second=this.timePickerSeconds?parseInt(this.container.find(".right .secondselect").val(),10):0,date=date.clone().hour(hour).minute(minute).second(second)),this.setEndDate(date.clone()),endDateSelection=!0,this.element.trigger("clickEndDate.daterangepicker",date.clone()),this.autoApply&&(this.showCalendars(),this.clickApply())),this.singleDatePicker&&(this.setEndDate(this.startDate),this.timePicker||this.clickApply()),this.updateView(endDateSelection),this.element.trigger("clickdate.daterangepicker",this),e.stopPropagation(),e.preventDefault()}},clickApply:function(){this.hide(),this.element.trigger("apply.daterangepicker",this)},clickCancel:function(){this.startDate=this.oldStartDate,this.endDate=this.oldEndDate,this.hide(),this.element.trigger("cancel.daterangepicker",this)},monthOrYearChanged:function(e){var isLeft=$(e.target).closest(".calendar").hasClass("left"),leftOrRight=isLeft?"left":"right",cal=this.container.find(".calendar."+leftOrRight),month=parseInt(cal.find(".monthselect").val(),10),year=cal.find(".yearselect").val();isLeft||(year<this.startDate.year()||year==this.startDate.year()&&month<this.startDate.month())&&(month=this.startDate.month(),year=this.startDate.year()),this.minDate&&(year<this.minDate.year()||year==this.minDate.year()&&month<this.minDate.month())&&(month=this.minDate.month(),year=this.minDate.year()),this.maxDate&&(year>this.maxDate.year()||year==this.maxDate.year()&&month>this.maxDate.month())&&(month=this.maxDate.month(),year=this.maxDate.year()),isLeft?(this.leftCalendar.month.month(month).year(year),this.linkedCalendars&&(this.rightCalendar.month=this.leftCalendar.month.clone().add(1,"month"))):(this.rightCalendar.month.month(month).year(year),this.linkedCalendars&&(this.leftCalendar.month=this.rightCalendar.month.clone().subtract(1,"month"))),this.updateCalendars()},timeChanged:function(e){var cal=$(e.target).closest(".calendar"),isLeft=cal.hasClass("left"),hour=parseInt(cal.find(".hourselect").val(),10),minute=parseInt(cal.find(".minuteselect").val(),10),second=this.timePickerSeconds?parseInt(cal.find(".secondselect").val(),10):0;if(!this.timePicker24Hour){var ampm=cal.find(".ampmselect").val();"PM"===ampm&&hour<12&&(hour+=12),"AM"===ampm&&12===hour&&(hour=0)}if(isLeft){var start=this.startDate.clone();start.hour(hour),start.minute(minute),start.second(second),this.setStartDate(start),this.singleDatePicker?this.endDate=this.startDate.clone():this.endDate&&this.endDate.format("YYYY-MM-DD")==start.format("YYYY-MM-DD")&&this.endDate.isBefore(start)&&this.setEndDate(start.clone())}else if(this.endDate){var end=this.endDate.clone();end.hour(hour),end.minute(minute),end.second(second),this.setEndDate(end)}this.updateCalendars(),this.updateFormInputs(),this.renderTimePicker("left"),this.renderTimePicker("right")},formInputsChanged:function(e){var isRight=$(e.target).closest(".calendar").hasClass("right"),start=moment(this.container.find('input[name="daterangepicker_start"]').val(),this.locale.format),end=moment(this.container.find('input[name="daterangepicker_end"]').val(),this.locale.format);start.isValid()&&end.isValid()&&(isRight&&end.isBefore(start)&&(start=end.clone()),this.setStartDate(start),this.setEndDate(end),isRight?this.container.find('input[name="daterangepicker_start"]').val(this.startDate.format(this.locale.format)):this.container.find('input[name="daterangepicker_end"]').val(this.endDate.format(this.locale.format))),this.updateView()},formInputsFocused:function(e){this.container.find('input[name="daterangepicker_start"], input[name="daterangepicker_end"]').removeClass("active"),$(e.target).addClass("active"),$(e.target).closest(".calendar").hasClass("right")&&(this.endDate=null,this.setStartDate(this.startDate.clone()),this.updateView())},formInputsBlurred:function(){if(!this.endDate){var val=this.container.find('input[name="daterangepicker_end"]').val(),end=moment(val,this.locale.format);end.isValid()&&(this.setEndDate(end),this.updateView())}},elementChanged:function(){if(this.element.is("input")&&this.element.val().length&&!(this.element.val().length<this.locale.format.length)){var dateString=this.element.val().split(this.locale.separator),start=null,end=null;2===dateString.length&&(start=moment(dateString[0],this.locale.format),end=moment(dateString[1],this.locale.format)),(this.singleDatePicker||null===start||null===end)&&(end=start=moment(this.element.val(),this.locale.format)),start.isValid()&&end.isValid()&&(this.setStartDate(start),this.setEndDate(end),this.updateView())}},keydown:function(e){9!==e.keyCode&&13!==e.keyCode||this.hide()},updateElement:function(){this.element.is("input")&&!this.singleDatePicker&&this.autoUpdateInput?(this.element.val(this.startDate.format(this.locale.format)+this.locale.separator+this.endDate.format(this.locale.format)),this.element.trigger("change")):this.element.is("input")&&this.autoUpdateInput&&(this.element.val(this.startDate.format(this.locale.format)),this.element.trigger("change"))},remove:function(){this.container.remove(),this.element.off(".daterangepicker"),this.element.removeData()}},$.fn.daterangepicker=function(options,callback){return this.each(function(){var el=$(this);el.data("daterangepicker")&&el.data("daterangepicker").remove(),el.data("daterangepicker",new DateRangePicker(el,options,callback))}),this}}(window.moment,window.jQuery),function($){$.extend(window.$fb,{storage:{_config:{},_toBase64:function(str){return window.btoa(unescape(encodeURIComponent(str)))},_fromBase64:function(str){return decodeURIComponent(escape(window.atob(str)))},save:function(key,value){var newvalue;value&&(newvalue=$fb.storage._toBase64(value));try{void 0!==window.sessionStorage?null==newvalue?sessionStorage.removeItem(key):sessionStorage.setItem(key,newvalue):void 0!==window.localStorage&&(null==newvalue?localStorage.removeItem(key):localStorage.setItem(key,newvalue))}catch(e){$fb.log("catching session storage error "+e),window.sessionStorage.removeItem=function(){},window.sessionStorage.setItem=function(){}}},load:function(key){var value=null;return void 0!==window.sessionStorage?value=sessionStorage.getItem(key):void 0!==window.localStorage&&(value=localStorage.getItem(key)),value&&(value=$fb.storage._fromBase64(value)),value},remove:function(key){window.sessionStorage?sessionStorage.removeItem(key):window.localStorage&&localStorage.removeItem(key)},_save:function(event){if(!$fb._checkEvent("storage","save",event))return $fb._callback(event);var key=event.args.key||event.args.k||null,value=event.args.value||event.args.v||null;return key&&$fb.storage.save(key,value),$fb._callback(event)},_load:function(event){if(!$fb._checkEvent("storage","load",event))return $fb._callback(event);var key=event.args.key||event.args.k||null,value=null;return key&&(value=$fb.storage.load(key)),$fb._callback(event,value)}}}),$(document).on("fastbooking-crs-frontend-storage-save",$fb.storage._save),$(document).on("fastbooking-crs-frontend-storage-load",$fb.storage._load),window.btoa&&window.atob||(window.btoa=base64.encode,window.atob=base64.decode)}(window.jQuery),function(global,$,_){var PromiseCache=function(){this.cache={}};PromiseCache.prototype.proxyCache=function(key){var $dfd=new jQuery.Deferred;if(!this.isRegistered(key))throw"Object doesnt exist";switch(this.cache[key].status){case"resolved":$dfd.resolve(this.cache[key].value);break;case"rejected":$dfd.reject(this.cache[key].value);break;case"new":this.cache[key].dfds.push($dfd);break;default:throw"Something is strange ?!"}return $dfd.promise()},PromiseCache.prototype.isRegistered=function(key){return this.cache.hasOwnProperty(key)},PromiseCache.prototype.register=function(key){if(this.isRegistered(key))throw"key not available";return this.cache[key]={status:"new",value:void 0,dfds:[]},this},PromiseCache.prototype.resolve=function(key,value){if(!this.isRegistered(key)||"new"!==this.cache[key].status)throw"Object doesnt exist or resolved or rejected, no resolvable";return this.cache[key].value=value,this.cache[key].status="resolved",_.each(this.cache[key].dfds,function($dfd){$dfd.resolve(value)}),delete this.cache[key].dfds,this},PromiseCache.prototype.reject=function(key,value){if(!this.isRegistered(key)||"new"!==this.cache[key].status)throw"Object doesnt exist or resolved or rejected, no rejectable";return this.cache[key].value=value,this.cache[key].status="rejected",_.each(this.cache[key].dfds,function($dfd){$dfd.reject(value)}),delete this.cache[key].dfds,this},PromiseCache.prototype.remove=function(key){if(!this.isRegistered(key))throw"Object doesnt exist";return"new"===this.cache[key].status&&this.reject(key),delete this.cache[key],this},PromiseCache.prototype.clear=function(status){var self=this;_(this.cache).each(function(element,key){status&&element.status!==status||self.remove(key)})},global.PromiseCache=PromiseCache}(window,window.jQuery,window.$fb.underscore);var QuotationService,QuotationFactory,DaysPeriod,MultiquotationRequester=function(){};MultiquotationRequester.prototype.request=function(queries){var $dfd=new jQuery.Deferred;return $.fb("crs-api-call",{data:{c:"multiquotation",requests:queries},success:function(data){if("success"!==data.status)return $dfd.reject(data.message);$dfd.resolve(data.data)},error:function($jq){$dfd.reject($jq.statusText)}}),$dfd.promise()},function(global,$,_){var FlowController=function(nb,ms){this.history=[],this.config={nb:nb,ms:ms}};FlowController.prototype.stamp=function(){this.history.push((new Date).getTime())},FlowController.prototype.clear=function(){this.history=[]},FlowController.prototype._clean=function(){var currentTime=(new Date).getTime(),self=this;this.history=_(this.history).filter(function(time){return currentTime-self.config.ms<=time})},FlowController.prototype.getNbAvailables=function(){this._clean();var calcul=this.config.nb-_.size(this.history);return calcul<0?0:calcul};var QuotationLoader=function(multiquotationRequester,flowControler,quotationCurrency,maxSimultaneousRequests,maxSimultaneousMultiquotation){this.stack=[],this.flowControler=flowControler,this.quotationCurrency=quotationCurrency,this.requesting=[],this.askedUnstack=null,this.maxSimultaneousRequests=maxSimultaneousRequests,this.multiquotationRequester=multiquotationRequester,this.maxSimultaneousMultiquotation=maxSimultaneousMultiquotation};QuotationLoader.prototype.cancelLoading=function(){_.each(this.stack,function(stackElement){stackElement.$dfd.reject()}),this.stack=[]},QuotationLoader.prototype._askUnstack=function(){if(!this.askedUnstack){var self=this;this.askedUnstack=setTimeout(function(){self.askedUnstack=null,self._unstack()},50)}},QuotationLoader.prototype.prioritize=function(filterCallback){var toPriorize=_(this.stack).filter(function(stackElement){return filterCallback(stackElement.property,stackElement.query,stackElement.bestRate)});this.stack=_.union(toPriorize,_.difference(this.stack,toPriorize))},QuotationLoader.prototype.load=function(property,query,bestRate){var $dfd=new jQuery.Deferred,stackElement={$dfd:$dfd,property:property,query:query,bestRate:bestRate,groupableHash:1};return this.stack.push(stackElement),this._askUnstack(),$dfd.promise()},QuotationLoader.prototype._unstack=function(){var self=this;if(0!==_.size(this.stack)&&!(_.size(this.requesting)>=this.maxSimultaneousRequests)){var groupCapacity=this.flowControler.getNbAvailables();if(this.maxSimultaneousMultiquotation<groupCapacity&&(groupCapacity=this.maxSimultaneousMultiquotation),0==groupCapacity)return this._askUnstack();var firstStackElement=this.stack.shift(),othersGroupables=_.where(this.stack,{groupableHash:firstStackElement.groupableHash}).slice(0,this.maxSimultaneousMultiquotation-1);_(othersGroupables).each(function(stackElement){self.stack=_(self.stack).without(stackElement)});var elementsGroup=_.union([firstStackElement],othersGroupables),queries={},corres={};_(elementsGroup).each(function(element,i){queries["e"+i]=_.extend({},{property:element.property,bestRate:element.bestRate,currency:self.quotationCurrency},element.query),corres["e"+i]=element,self.flowControler.stamp()}),self.flowControler.stamp(),this.requesting.push(elementsGroup),this.multiquotationRequester.request(queries).done(function(data){_.each(data,function(data,key){if("success"!==data.status)return self._reject(corres[key],data.message);corres[key].$dfd.resolve(data.data)})}).fail(function(e){_.each(corres,function(element){return self._reject(element,e)})}).always(function(){self.requesting=_(self.requesting).without(elementsGroup),self._unstack()}),this._unstack()}},QuotationLoader.prototype._reject=function(stackElement,error){if(-1!==error.toString().indexOf("Too many calls from this user"))return this.stack.unshift(stackElement);stackElement.$dfd.reject(error)},global.FlowController=FlowController,global.QuotationLoader=QuotationLoader}(window,window.jQuery,window.$fb.underscore),function($,_){(QuotationService=function(quotationLoader,quotationFactory,promiseCache){this.quotationLoader=quotationLoader,this.quotationFactory=quotationFactory,this.promiseCache=promiseCache,this._now=moment()}).prototype.cancelLoading=function(){this.promiseCache.clear("new"),this.quotationLoader.cancelLoading()},QuotationService.prototype.findTheBestRate=function(property,criterias){$fb.loader._state.quotationAlreadyFired=!0;var what,query=(what={mcmEnable:!0},_(criterias).each(function(value,key){what[key]=value}),what),self=this,cacheId=$fb._hash(property+JSON.stringify(query)+"bestRate");return this.promiseCache.isRegistered(cacheId)||(this.promiseCache.register(cacheId),moment(query.arrival).isBefore(this._now,"day")?this.promiseCache.resolve(cacheId,new SingleQuotation(query,null)):$.when(this.quotationLoader.load(property,query,!0)).done(function(data){var quotation=self.quotationFactory.factory(data,!0);self.promiseCache.isRegistered(cacheId)&&self.promiseCache.resolve(cacheId,quotation)}).fail(function(){self.promiseCache.isRegistered(cacheId)&&self.promiseCache.reject(cacheId)})),this.promiseCache.proxyCache(cacheId)},(QuotationFactory=function(){}).prototype.factory=function(data,bestRate){var packages=_(data.data.packages).toArray(),self=this,stays=_.map(packages,function(package){return self._factoryStay(moment(data.query.arrival?data.query.arrival:data.query.arrivalDate),moment(data.query.departure?data.query.departure:data.query.departureDate),package)});return bestRate?new SingleQuotation(data.query,_.size(stays)?stays[0]:null):new Quotation(data.query,stays)},QuotationFactory.prototype._factoryStay=function(arrivalDate,departureDate,package){var self=this,elements=_(package).map(function(element){return self._factoryElement(element)}),campaignReference=_(elements).first(),campaign=campaignReference.data.campaignId?this._factoryCampaign(campaignReference.data):null;return new Stay(new DaysPeriod(arrivalDate,departureDate,!0),elements,campaign)},QuotationFactory.prototype._factoryElement=function(data){return new StayElement(data)},QuotationFactory.prototype._factoryCampaign=function(data){return new Campaign(data.campaignId,data.campaignPromoType,data.campaignPromoValue,data.campaignFreeNightPayFor,data.campaignFreeNightStayFor,"PERCENTAGE"===data.campaignPromoDiscountType?"%":null)};var Campaign=function(id,type,value,unit){this.type=type,this.value=value,this.unit=unit};Campaign.prototype={isFreeNights:function(){return"FREE_NIGHTS"===this.type},isDiscount:function(){return"DISCOUNT"===this.type},getNbFreeNights:function(){return this.isFreeNights()?this.value:null},getDiscount:function(){return this.isDiscount()?{value:this.value,unit:this.unit}:null}};var SingleQuotation=function(query,stay){this.stay=stay,this.query=query};SingleQuotation.prototype.getStay=function(){return this.stay},SingleQuotation.prototype.getQuery=function(){return this.query};var Quotation=function(query,stays){this.stays=stays,this.query=query};Quotation.prototype.getStays=function(){return this.stays};var Stay=function(period,elements,campaign){this.period=period,this.elements=elements,this.campaign=campaign};Stay.prototype.getTotalPrice=function(){return _.reduce(this.elements,function(memo,element){return memo+element.getPrice()},0)},Stay.prototype.getTotalOriginalPrice=function(){return _.reduce(this.elements,function(memo,element){return memo+element.getOriginalPrice()},0)},Stay.prototype.hasCampaignApplied=function(){return!!this.campaign},Stay.prototype.getCampaignApplied=function(){return this.campaign},Stay.prototype.getCurrency=function(){var currencies=_.uniq(_.map(this.elements,function(element){return element.getCurrency()}));if(1<currencies.length)throw"Unexpected multi currencies";return _.first(currencies)},Stay.prototype.getElements=function(){return this.elements};var StayElement=function(data){this.data=data};StayElement.prototype={getPrice:function(){return this.data.pricesLoyalty?this.data.pricesLoyalty.gross:this.data.pricesDiscounted?this.data.pricesDiscounted.gross:this.getOriginalPrice()},getOriginalPrice:function(){return this.data.prices.gross},getCurrency:function(){return this.data.currency}}}(window.jQuery,window.$fb.underscore),function(_){(DaysPeriod=function(start,end,isExclusiveEnd){this.start=start,this.end=end,this.exclusiveEnd=void 0!==isExclusiveEnd&&isExclusiveEnd}).prototype.count=function(){return this.end.diff(this.start,"days")+(this.exclusiveEnd?0:1)},DaysPeriod.prototype.getRange=function(){var self=this;return _.times(this.count(),function(i){return self.start.clone().add(i,"day")})},DaysPeriod.prototype.contains=function(date){return!(date.isBefore(this.start,"day")||date.isAfter(this.end,"day")||this.exclusiveEnd&&date.isSame(this.end,"day"))},DaysPeriod.prototype.clone=function(){return new DaysPeriod(this.start.clone(),this.end.clone(),this.exclusiveEnd)},DaysPeriod.prototype.getStartDate=function(){return this.start},DaysPeriod.prototype.getInclusiveEndDate=function(){return this.end.clone().subtract(this.exclusiveEnd?1:0,"day")},DaysPeriod.prototype.getExclusiveEndDate=function(){return this.end.clone().add(this.exclusiveEnd?0:1,"day")}}(window.$fb.underscore),function($){$.extend(window.$fb,{trustyouSeal:{updateSeal:function(){if($fb._state.app.data.trustYou&&$fb._state.app.data.trustYou.enabled&&!$fb._state.app.data.trustYou.excluded){var classes=$fb.trustyouSeal.classes,size=$fb.trustyouSeal.size,hid=$fb.trustyouSeal.hid;hid&&$fb.trustyouSeal._getTrustYouSeal(hid,function(seal){Number((Number(seal.score)/20).toFixed(1))<$fb._state.app.data.trustYou.threshold||("xl"===$fb.trustyouSeal.size&&$fb.trustyouSeal._initTrustScore(),$(".trustscore").html("").append($fb.trustyouSeal._renderSeal(seal,classes,size)))})}},addSeal:function(element,hid,classes,size,position){$fb._state.app.data.trustYou&&$fb._state.app.data.trustYou.enabled&&($fb._state.app.data.trustYou.excluded||($fb.trustyouSeal.hid=hid,$fb.trustyouSeal.size=size,0===$(".trustscore").length&&$fb.trustyouSeal._getTrustYouSeal(hid,function(seal){if(!(Number((Number(seal.score)/20).toFixed(1))<$fb._state.app.data.trustYou.threshold)){var wrapper=$('<div id="trustyou-seal" class="hidden-print trustscore-wrapper '+classes+'">');wrapper.append($fb.trustyouSeal._renderSeal(seal,size)),"before"===position?element.prepend(wrapper):element.append(wrapper),"xl"===size&&$fb.trustyouSeal._initTrustScore()}})))},_initTrustScore:function(){$("#toggle-info-panel").click(function(){var $this=$(this);$this.find(".fa").toggleClass("fa-info-circle fa-times-circle"),$("#"+$this.data("target")).toggleClass("active")})},_getTrustYouSeal:function(hid,callback){$fb.trustyouSeal.locale=$fb._state.app.locale.substring(0,2)||"en",$fb.callApi("trustYouSeal",{locale:$fb.trustyouSeal.locale,hid:hid}).then(function(seal){if(seal.reviews_count){var reviews=seal.reviews_count.toString().split("").reverse().join("");reviews=(reviews=reviews.replace(/(.{3})/g,"$1 ")).split("").reverse().join(""),seal.reviews_count=reviews,callback(seal)}}).catch(function(error){$fb.notice("Unable to load Trust You, got error "+error.message)})},_renderSeal:function(seal,size){$fb.trustyouSeal.seal=seal;var tpl,starClass,tyReviews=$.fb("crs-helper-translate",{key:"trustyou-seal-reviews",placeholders:[seal.reviews_count]}).prop("outerHTML"),score=seal.score/20,displayScore=Math.round(10*score)/10,stars="";if(0<=score&&score<=5)for(var decimal=score-parseInt(score),fullStep=parseInt(score),i=0;i<5;i++)i<fullStep?starClass="is-full":0<decimal?(starClass="is-half",decimal<.25?starClass="":.75<=decimal&&(starClass="is-full"),decimal=0):starClass="",stars+='<span class="rating-unit '+starClass+'"></span>';switch(size){case"xl":case"l":tpl='<div class="trustscore size-'+size+' "><div class="title"><span>'+seal.score_description+'</span></div><div class="trustyou-ui rating"><div class="rating-score">'+displayScore+'</div><div class="rating-units">'+stars+'</div></div><div class="counter">'+tyReviews+'</div><div class="branding"><img src="../../images/trustyou-logo-sm.png" alt="TrustYou"></div></div>';break;case"xs":case"s":case"m":default:tpl='<div class="trustscore size-'+size+'"><div class="value">'+displayScore+'</div><div class="score-wrapper"><div class="score">'+seal.score_description+'</div><div class="badges"><i class="ty-icon ty-icon-badge neg"></i><i class="ty-icon ty-icon-badge neu"></i><i class="ty-icon ty-icon-badge pos"></i></div></div><div class="rating-wrapper"><div class="trustyou-ui rating"><div class="rating-units">'+stars+'</div></div><div class="counter">'+tyReviews+"</div></div></div>"}return tpl=$(tpl).click(function(e){e.preventDefault(),window.open("http://www.trustyou.com/meta-review-search/?ty_id="+seal.ty_id+"&amp;lang="+$fb.trustyouSeal.locale,"_blank")})}}})}(window.jQuery),function($){$.extend(window.$fb,{widgets:{_config:{localesMapping:{zh_Hans_CN:"zh_CN",zh_Hant_HK:"zh_HK"}},getToken:function(property,callback){$.fb("crs-api-call",{data:{c:"widgetsconfig",property:property},success:function(data){return"success"!==data.status?callback(new Error(data.message),void 0):callback(void 0,data.data)},error:function(){return callback(new Error("API ERROR"),void 0)}})},getJqueryElements:function(widgetsToken,args){var localesMapping=$fb.widgets._config.localesMapping,widgetParams={params:[{calendar:{firstDayOfWeek:1,nbMonths2display:2,title:"&nbsp;",showBestPrice:!0,showLastRoom:args.showLastRoom,showLastRoomThreshold:args.showLastRoomThreshold,showChildrenAges:!1,themeDark:args.themeDark,layoutNum:1,hideControls:!0,nbAdults:args.nbAdults,nbChildren:args.nbChildren,accessCode:args.accessCode,useLoyalty:!!args.loyaltyRateType,loyalty:args.loyaltyRateType,loyaltyParams:args.loyaltyParams,startingMonth:args.startingMonth},locale:localesMapping[args.locale]?localesMapping[args.locale]:args.locale,currency:args.currency,mainColor:args.mainColor,property:widgetsToken.property,childrenMaxAge:12,openFrontInNewTab:!1}],commonParams:{redirectUrl:$fb.redirectionService.factoryUrl(),showPropertiesList:!1},_authCode:widgetsToken._authCode,propertyIndex:0,version:"1.7.1",baseHost:widgetsToken.baseHost};args.childrenAgesList&&(widgetParams.params[0].calendar.childrenAgesList=args.childrenAgesList),args.rateFilter&&(widgetParams.params[0].calendar.rateFilter=args.rateFilter),args.roomFilter&&(widgetParams.params[0].calendar.roomFilter=args.roomFilter),args.roomRateFiltering&&(widgetParams.params[0].calendar.roomRateFiltering=args.roomRateFiltering),args.groupName&&(widgetParams.params[0].groupName=args.groupName);var jQueryElements=[];return jQueryElements.push($('<div id="fb-widget-1" data-fbWidget="Calendar" />')),jQueryElements.push($('<script type="text/json" id="fb-widget-config" />').append(JSON.stringify(widgetParams))),jQueryElements.push($('<link rel="stylesheet" property="stylesheet" href="//'+widgetsToken.baseHost+'/widgets/app.css">')),jQueryElements.push($('<script type="text/javascript" src="//'+widgetsToken.baseHost+'/widgets/app.js"><\/script>')),jQueryElements}}})}(window.jQuery),window.jQuery.extend(window.$fb,{dataCollectHelper:{_config:{},_state:{},isGuaranteeModuleRequired:function(guaranteeType){if(null===guaranteeType)return!1;if(0<$fb.selection.packages.map(function(package){return package.package[0]}).map(function(room){return room.pricesLoyalty&&room.pricesLoyalty.points||0}).reduce(function(totalPts,roomPts){return totalPts+roomPts},0))return!1;var currentLoyalty=$fb.loyalties&&$fb.loyalties.getCurrentLoyalty();return!(!currentLoyalty||!currentLoyalty.isLogged()||"ghs"!==currentLoyalty.getType())||("OnlinePayment"===guaranteeType?this.isPropertyUsingPaymentServices():"NoGuarantee"!==guaranteeType)},isPaymentTypesModuleRequired:function(guaranteeType){var currentLoyalty=$fb.loyalties&&$fb.loyalties.getCurrentLoyalty();return!(currentLoyalty&&currentLoyalty.isLogged()&&"ghs"===currentLoyalty.getType()||"OnlinePayment"!==guaranteeType||this.isPropertyUsingPaymentServices())},isPropertyUsingPaymentServices:function(){var enabled3dsParam=$fb._state.app.data.properties[$fb._state.quicksearch.property].settings.paymentSystem.hasOwnProperty("paymentServicesParams")?$fb._state.app.data.properties[$fb._state.quicksearch.property].settings.paymentSystem.paymentServicesParams.filter(function(param){return"enable3ds"==param.name&&"true"==param.value}):[];if($fb._.hasFeature("standalone-aps-online-payment","activate",$fb._state.quicksearch.property)||0<enabled3dsParam.length)return!1;if(!$fb._state.app.data.properties[$fb._state.quicksearch.property].settings||!$fb._state.app.data.properties[$fb._state.quicksearch.property].settings.paymentSystem||!$fb._state.app.data.properties[$fb._state.quicksearch.property].settings.paymentSystem.name)return!1;var pspName=$fb._state.app.data.properties[$fb._state.quicksearch.property].settings.paymentSystem.name;return!(!$fb._config.paymentServicesList||-1===$fb._config.paymentServicesList.indexOf(pspName))},getGuaranteeType:function(){if(!$fb._state.app.data.properties[$fb._state.quicksearch.property].configuration)return null;var propertyConf=$fb._state.app.data.properties[$fb._state.quicksearch.property].configuration,selectionTerms=$fb.selection.getTerms();if(!selectionTerms)return $fb.error("[dataCollectHelper] Trying to get guarantee type with not selection. You are doing something wrong!"),null;var guaranteeType=selectionTerms.guarantee;return guaranteeType?("ja_JP"===$fb._state.app.locale&&propertyConf.maskCreditCard&&("CreditCard"!==guaranteeType&&"CreditCardOrFax"!==guaranteeType||(guaranteeType="NoGuarantee")),guaranteeType):null}}}),function($,_){function RedirectHelper(){}function redirectToStep(step){$fb._ChangeAppStep(step),$fb._addHistory(),$fb._trackStep(function(){$fb._triggerEvent("fastbooking-crs-frontend-renderAll",{},function(){$fb._triggerEvent("fastbooking-crs-frontend-emptySelection")})})}function redirectToHotelWebsite(){$fb._state.app.data.properties[$fb._state.quicksearch.property]&&$fb._state.app.data.properties[$fb._state.quicksearch.property].contacts&&$fb._state.app.data.properties[$fb._state.quicksearch.property].contacts.url&&$fb._triggerEvent("fastbooking-crs-frontend-emptySelection",{},function(){window.location.href=$fb._state.app.data.properties[$fb._state.quicksearch.property].contacts.url})}RedirectHelper.prototype={getRedirectionFunction:function(redirectTo){switch(redirectTo){case"results":case"confirm":return function(){redirectToStep(redirectTo)};case"hotelWebsite":return redirectToHotelWebsite;default:return _.noop}},redirectToStep:redirectToStep},window.$fb.redirectHelper=new RedirectHelper}(window.jQuery,window.$fb.underscore),function($,_){function Selection(){this._comment="",this._smsWanted=!1,this.packages=[],this.services=[],this.buyer={},this.payer=null,this._checkinTime=null,this.availableServices=[]}function empty(event){return $("#fb-basket").addClass("fb-basket-empty"),this.packages=[],this.services=[],this.availableServices=[],$fb._state.app.lockedRate=null,$fb._storeState(),$fb._callback(event||{})}Selection.prototype={hasService:function(serviceName){return _.some(this.services,function(service){return service.service[0].product===serviceName})},get:function(){var selection={packages:this.packages,services:this.services,buyer:_.clone(this.buyer)};this.payer&&(selection.payer=_.clone(this.payer));return selection},set:function(selection){this.packages=selection.packages,this.services=selection.services,this.buyer=selection.buyer,selection.payer&&(this.payer=selection.payer)},nbRooms:function(){return this.packages.length},nbNights:function(){if(this.isEmpty())return 0;var arrivalDate=$.fb("crs-helper-parsedate",{date:this.packages[0].query.arrivalDate}),departureDate=$.fb("crs-helper-parsedate",{date:this.packages[0].query.departureDate});return Math.round(Math.abs(arrivalDate.getTime()-departureDate.getTime())/864e5)},totalPrice:function(){if(this.isEmpty())return 0;return this.totalPackagesPrice()+this.totalServicesPrice()},totalPackagesPrice:function(){return this.packages.reduce(function(totalPrice,package){return totalPrice+package.package.reduce(function(packagePrice,item){var price=item.pricesLoyalty?item.pricesLoyalty.gross:item.pricesDiscounted?item.pricesDiscounted.gross:item.prices.gross;return packagePrice+parseFloat(price,10)},0)},0)},totalServicesPrice:function(){if(this.services.length<=0)return 0;return this.services.reduce(function(totalPrice,service){return totalPrice+service.service.reduce(function(servicePrice,serviceItem){return servicePrice+parseFloat(serviceItem.prices.gross,10)},0)},0)},setCheckinTime:function(checkinTime){this._checkinTime=checkinTime},getCheckinTime:function(){return this._checkinTime||""},totalExcludedTaxes:function(){if(this.isEmpty())return 0;var totalExcludedTaxes=0;$.each(this.packages,function(id,item){$.each(item.package,function(packIndex,pack){var prices=pack.pricesLoyalty?pack.pricesLoyalty:void 0!==pack.pricesDiscounted?pack.pricesDiscounted:pack.prices;totalExcludedTaxes+=parseFloat(prices.taxes.totals.excluded)})}),0<this.services.length&&$.each(this.services,function(packId,service){$.each(service.service,function(id,svc){totalExcludedTaxes+=parseFloat(svc.prices.taxes.totals.excluded)})});return totalExcludedTaxes},getBuyer:function(){return _.clone(this.buyer)||{}},setBuyer:function(buyerObject){this.buyer=buyerObject,this.buyer.comment=this._comment,this.buyer.checkinTime=this._checkinTime,$fb._storeState()},getPayer:function(){return _.clone(this.payer)},setPayer:function(payerObject){this.payer=payerObject,$fb._storeState()},isEmpty:function(){return this.nbRooms()<=0},empty:empty,getTerms:function(){return this.isEmpty()?null:this.packages[0].terms},getEcommerceData:function(confirmation){if(this.isEmpty())return $.fb("crs-log",{l:"warn",m:"getEcommerceData - No package found in selection"}),!1;var data={id:confirmation,property:null,title:null,status:"NEW",checkin:null,checkout:null,grossPrice:0,netPrice:0,currency:$fb._config.quotationCurrency,details:[]},_details={category:null,product:null,quantity:null,sku:null,grossPrice:null,netPrice:null},addPackageSpecific=function(packages,query){for(var i in packages){var _package=packages[i],details=$.extend(!0,{},_details);switch(null===data.property&&(data.property=_package.property,$fb._state.app.data.properties[data.property]&&(data.title=$fb._state.app.data.properties[data.property].title)),details.category=_package.rate,details.product=_package.product,details.sku=[data.property,details.category,details.product].join("-"),details.grossPrice=_package.prices.gross,details.netPrice=_package.prices.net,data.grossPrice+=details.grossPrice,data.netPrice+=details.netPrice,_package.type){case"accommodation":details.quantity=_package.prices.breakdown.length,details.checkin=query.arrivalDate,details.checkout=query.departureDate,null===data.checkin&&(data.checkin=details.checkin,data.checkout=details.checkout);break;default:details.quantity=1}data.details.push(details)}};for(var i in this.packages)addPackageSpecific(this.packages[i].package,this.packages[i].query);for(var j in this.services)addPackageSpecific(this.services[j].service);return data},getRelevantDataFromSelectedPackages:function(){return this.packages.map(function(package){return{rate:package.package[0].rate,accommodation:package.package[0].product,campaignIdForMultiRoomLink:package.package[0].campaignIdForMultiRoomLink,terms:{name:package.terms.conditions,isStandardized:!!package.terms.isStandardized}}})},hasReachedPackageNbLimit:function(){return this.nbRooms()>=$fb._config.maxPackages},getComment:function(){return this._comment||""},setComment:function(comment){this._comment=comment},getAvailableServices:function(){return this.availableServices},setAvailableServices:function(availableServices){this.availableServices=availableServices},hasAvailableServices:function(){return 0<_.flatten(this.availableServices).length},getSmsWanted:function(){return this._smsWanted},setSmsWanted:function(smsWanted){this._smsWanted=smsWanted},isCompatibleWithGivenState:function(state){if(this.isEmpty())return!0;return!(!state||_.some(["property","arrival","departure","occupancy"],function(key){return void 0===state[key]}))&&_.every(this.packages,function(pack,index){if(!state.occupancy[index])return!1;var appQueryForComparison={property:state.property,arrival:state.arrival,departure:state.departure,adults:state.occupancy[index].nbAdults,children:state.occupancy[index].nbChildren,childrenAges:state.configuration.needChildrenAges?state.occupancy[index].childrenAges.join(","):void 0},packQueryForComparison={property:pack.query.property,arrival:pack.query.arrivalDate,departure:pack.query.departureDate,adults:pack.query.nbAdults,children:pack.query.nbChildren,childrenAges:pack.query.childrenAges};return $fb.log("[selection.isCompatibleWithGivenState] app Query "+JSON.stringify(appQueryForComparison)),$fb.log("[selection.isCompatibleWithGivenState] package Query "+JSON.stringify(packQueryForComparison)),JSON.stringify(appQueryForComparison)===JSON.stringify(packQueryForComparison)||($fb.log("Query parameters changed for room "+index+" selection is not compatible with app state anymore"),!1)})},removePackage:function(packageIndex){if(!Number.isInteger(packageIndex)||packageIndex>=$fb._config.maxPackages)throw new Error("[selection.removePackage] packageIndex should be between 0 and "+$fb._config.maxPackages-1);if(!this.packages[packageIndex])throw new Error("[selection.removePackage] unexisting package in selection: "+packageIndex);$fb._state.lastModifiedPackage=$.extend(!0,{},this.packages[packageIndex]),this.packages.splice(packageIndex,1),this.removeAvailableServices(packageIndex),$.each(this.packages,function(index,pack){pack.query.context.relevantDataFromSelectedPackages=this.packages.slice(0,index).map(function(pack){var roomItem=_.find(pack.package,function(item){return"accommodation"===item.type});return{accommodation:roomItem.product,campaignIdForMultiRoomLink:roomItem.campaignIdForMultiRoomLink,rate:roomItem.rate}})}.bind(this)),this.isEmpty()&&($("#fb-basket").addClass("fb-basket-empty"),$fb._state.app.lockedRate=null,$fb._checkStep());$fb._storeState(),$fb._triggerEvent("fastbooking-crs-frontend-renderAll")},addPackage:function(pack,packId,query){if(!pack||!query||!packId)throw new Error("Some arguments are missing for addPackage");$fb.log("Add package group id:"+packId,pack,"Query: ",query);var rateOfPack=pack[0].rate;if($fb._state.app.lockedRate){if($fb._state.app.lockedRate!==rateOfPack)return void $fb._triggerEvent("fastbooking-crs-frontend-modal",{title:$.fb("crs-helper-translate",{key:"error-invalid"}).text(),message:$.fb("crs-helper-translate",{key:"error-rate-locked"}).text()})}else $fb._state.app.lockedRate=rateOfPack;this.packages.push({query:query,package:pack.map(function(item){return _.extend({pack:packId},item)}),additional:pack.map(function(item){return"accommodation"!==item.type?{}:0<$("#accommodation-"+item.product+"-bed").length?{bedType:$("#accommodation-"+item.product+"-bed").val()}:1<$("#accommodation-"+item.product+"-bed").length?{bedType:$("#accommodation-"+item.product+"-bed").find(":selected").val()}:{}}),terms:pack[0].terms}),this.addAvailableServices(packId),$fb.info("App selection:",this.get()),$("#fb-basket").removeClass("fb-basket-empty"),$fb._storeState(),$fb._triggerEvent("fastbooking-crs-frontend-renderAll")},addAvailableServices:function(packId){if(!$fb._state.app.data.quotation||!$fb._state.app.data.quotation.services)return;this.availableServices.push($fb._state.app.data.quotation.services[packId]||[]),this.updateServicesOnAvailableServicesModification()},removeAvailableServices:function(roomIndex){$fb.log("Remove available extras for room #"+roomIndex),this.availableServices.splice(roomIndex,1),this.updateServicesOnAvailableServicesModification()},addService:function(service,query){if(!service||!query)throw new Error("Missing arguments for addService");if(_.some(this.services,function(service){return service.service[0].product===service.product}))throw new Error("Trying to add twice the same service in selection.");this.services.push({query:query,service:[service]}),$fb._state.lastModifiedService=$.extend(!0,{action:"Add"},service),$fb._storeState()},removeService:function(serviceName){if(!serviceName)throw new Error("Missing service name for service removal in selection");var indexToRemove=_.findIndex(this.services,function(service){return service.service[0].product===serviceName});if(-1===indexToRemove)throw new Error("Request service to remove from selection was not in the selection");$fb._state.lastModifiedService=$.extend(!0,{action:"Remove"},this.services[indexToRemove].service[0]),this.services.splice(indexToRemove,1),$fb._storeState()},updateServicesOnAvailableServicesModification:function(){if(0===this.availableServices.length)return void(this.services=[]);var newCompiledAvailableServices=$fb.extrasHelper.getCompiledExtrasFromExtrasPerRoom(this.availableServices);this.services.forEach(function(selectedService){selectedService.service[0]=newCompiledAvailableServices.find(function(availableService){return availableService.product===selectedService.service[0].product})})}},window.$fb.selection=new Selection,$(document).on("fastbooking-crs-frontend-emptySelection",empty.bind($fb.selection))}(window.jQuery,window.$fb.underscore),function(){function Standardize(){}function getMealTypeI18nKey(mealType){var mapping={breakfast:"results-rate-meal-type-breakfast",dinner:"results-rate-meal-type-dinner","half-board":"results-rate-meal-type-halfboard","full-board":"results-rate-meal-type-fullboard","all-inclusive":"results-rate-meal-type-allinclusive"};return void 0===mapping[mealType]?"results-rate-meal-type-none":mapping[mealType]}Standardize.prototype={lang2locale:function(lang){var locale=$fb._state.app.locale,langMapping={ar:"ar_SA",bg:"bg_BG",ca:"ca_ES",cs:"cs_CZ",da:"da_DK",de:"de_DE",el:"el_GR",en:"en_GB",es:"es_ES",fi:"fi_FI",fr:"fr_FR",he:"he_IL",hr:"hr_HR",hu:"hu_HU",id:"id_ID",is:"is_IS",it:"it_IT",ja:"ja_JP",ko:"ko_KR",nl:"nl_NL",nn:"nn_NO",pl:"pl_PL",pt:"pt_PT",ro:"ro_RO",ru:"ru_RU",sk:"sk_SK",sl:"sl_SI",sr:"sr_RS",sv:"sv_SE",th:"th_TH",tr:"tr_TR",vi:"vi_VN",zh:"zh_Hant_HK",zhs:"zh_Hans_CN",zht:"zh_Hant_HK",ir:"fa_IR"};langMapping[lang]&&(locale=langMapping[lang]);return locale},meal:function(rate){var rateData=null,mealData={rateKeyImage:"/images/pictos/icon-package-salesterms-cross.png",i18nKey:"results-rate-meal-type-none",hasMeal:!1};$fb._state.app.data.rates&&$fb._state.app.data.rates[$fb._state.quicksearch.property]&&$fb._state.app.data.rates[$fb._state.quicksearch.property][rate]&&(rateData=$fb._state.app.data.rates[$fb._state.quicksearch.property][rate]);if(rateData&&rateData.meal&&rateData.meal.mealType)switch(mealData.hasMeal=!0,rateData.meal.name&&(mealData.rateKeyDescTitle=rateData.meal.name),rateData.meal.description&&(mealData.rateKeyDesc=rateData.meal.description),rateData.meal.image&&rateData.meal.image.url&&(mealData.rateKeyDescImage=rateData.meal.image.url),mealData.i18nKey=getMealTypeI18nKey(rateData.meal.mealType),rateData.meal.mealType){case"breakfast":mealData.rateKeyImage="/images/pictos/icon-package-mealplan-breakfast.png";break;case"dinner":case"half-board":mealData.rateKeyImage="/images/pictos/icon-package-mealplan-lunch.png";break;case"full-board":case"all-inclusive":mealData.rateKeyImage="/images/pictos/icon-package-mealplan-all-inclusive.png"}return mealData},getMealTypeI18nKey:getMealTypeI18nKey,mealTypeFromQuotationMealType:function(mealTypeFromQuotation){return{Breakfast:"breakfast",Dinner:"dinner","Half Board":"half-board","Full Board":"full-board","All Inclusive":"all-inclusive"}[mealTypeFromQuotation]},service:function(service){if($fb._state.app.data.services&&$fb._state.app.data.services[$fb._state.quicksearch.property]&&$fb._state.app.data.services[$fb._state.quicksearch.property][service])return $fb._state.app.data.services[$fb._state.quicksearch.property][service];return null}},window.$fb.standardize=new Standardize}(),function($,_){function StandardizePayment(){}function getForFullPrepayment(){return{image:"/images/pictos/icon-package-salesterms-payment-online.png",rateLabel:$.fb("crs-helper-translate",{key:"results-rate-payment-internet"}),legalDesc:$.fb("crs-helper-translate",{key:"rate-payment-prepaid"}),recapLabel:$.fb("crs-helper-translate",{key:"results-rate-payment-internet"}),confirmrecapLabel:$.fb("crs-helper-translate",{key:"warrant-pay-deposit-payment-information"}),recapDesc:$.fb("crs-helper-translate",{key:"warrant-prepaid-notice"}),confirmrecapDesc:$.fb("crs-helper-translate",{key:"warrant-fullpayment-notice-completed"}),guaranteeLabel1:$.fb("crs-helper-translate",{key:"guarantee-full-payment"}),guaranteeLabel2:$.fb("crs-helper-translate",{key:"guarantee-secured"}),guaranteeLabel3:"",guaranteeLabel4:""}}function getForNoPayment(){var propertyType="";return $fb._state.app.data.properties[$fb._state.quicksearch.property]&&$fb._state.app.data.properties[$fb._state.quicksearch.property].type&&(propertyType="-"+$fb._state.app.data.properties[$fb._state.quicksearch.property].type.toLowerCase()),{image:"/images/pictos/icon-package-salesterms-payment-checkout.png",rateLabel:$.fb("crs-helper-translate",{key:"results-rate-payment-hotel"}),legalDesc:$.fb("crs-helper-translate",{key:"warrant-pay-later-desc"+propertyType}),recapLabel:$.fb("crs-helper-translate",{key:"warrant-pay-later"}),confirmrecapLabel:$.fb("crs-helper-translate",{key:"warrant-pay-later"}),recapDesc:$.fb("crs-helper-translate",{key:"warrant-pay-later-text"+propertyType}),confirmrecapDesc:$.fb("crs-helper-translate",{key:"warrant-pay-later-text"+propertyType}),guaranteeLabel1:$.fb("crs-helper-translate",{key:"guarantee-no-payment"}),guaranteeLabel2:$.fb("crs-helper-translate",{key:"guarantee-only-guarantee"}),guaranteeLabel3:$.fb("crs-helper-translate",{key:"guarantee-payment"+propertyType}),guaranteeLabel4:$.fb("crs-helper-translate",{key:"guarantee-secured"})}}function getFromDepositDetails(depositDetails,fuzzyDeposit){var paymentData={image:"/images/pictos/icon-package-salesterms-payment-online.png",recapLabel:$.fb("crs-helper-translate",{key:"warrant-pay-deposit"}),confirmrecapLabel:$.fb("crs-helper-translate",{key:"warrant-pay-deposit-payment-information"}),guaranteeLabel3:$.fb("crs-helper-translate",{key:"guarantee-secured"}),guaranteeLabel4:""};return paymentData.confirmrecapDesc=fuzzyDeposit?(paymentData.legalDesc=$("<div/>").append($.fb("crs-helper-translate",{key:"rate-payment-deposit-fuzzy",placeholders:[depositDetails.label]})).append(" ").append($.fb("crs-helper-translate",{key:"rate-payment-deposit-note-fuzzy"})),paymentData.guaranteeLabel1=$.fb("crs-helper-translate",{key:"guarantee-deposit-payment-fuzzy",placeholders:[depositDetails.amount]}),paymentData.guaranteeLabel2=$.fb("crs-helper-translate",{key:"rate-payment-deposit-note-fuzzy"}),paymentData.recapDesc=$.fb("crs-helper-translate",{key:"warrant-deposit-notice-fuzzy",placeholders:[depositDetails.label,depositDetails.amount]}),paymentData.recapDesc.clone()):(paymentData.legalDesc=$("<div/>").append($.fb("crs-helper-translate",{key:"rate-payment-deposit",placeholders:[depositDetails.label]})).append(" ").append($.fb("crs-helper-translate",{key:"rate-payment-deposit-note"})),paymentData.guaranteeLabel1=$.fb("crs-helper-translate",{key:"guarantee-deposit-payment",placeholders:[depositDetails.amount]}),paymentData.guaranteeLabel2=$.fb("crs-helper-translate",{key:"rate-payment-deposit-note"}),paymentData.recapDesc=$.fb("crs-helper-translate",{key:"warrant-deposit-notice",placeholders:[depositDetails.label,depositDetails.amount]}),$.fb("crs-helper-translate",{key:"warrant-deposit-notice-completed",placeholders:[depositDetails.amount]})),paymentData}function getDepositAmountAsHtml(amount,originCurrency){return $("<div/>").append($.fb("crs-helper-price",{price:amount,type:"deposit",originCurrency:originCurrency||"EUR"})).html()}StandardizePayment.prototype={getFromTerms:function(terms){var keysToReturn=["image","rateLabel","legalDesc"];if(!terms||!terms.payment||!terms.payment.type||"deposit"!==terms.payment.type&&"full"!==terms.payment.type)return _.pick(getForNoPayment(),keysToReturn);if("full"===terms.payment.type)return _.pick(getForFullPrepayment(),keysToReturn);var label=function(terms){if(!terms.payment.deposit)return"";var depositData=terms.payment.deposit;if("percentage"!==depositData.type&&"value"!==depositData.type)return"";if("value"===depositData.type){var depositAmount=depositData.amount;return void 0===depositAmount&&(depositAmount=depositData.value?parseInt(depositData.value,10):0),getDepositAmountAsHtml(depositAmount)}if("stay"!==depositData.applyTo&&"nights"!==depositData.applyTo)return"";var percentage=depositData.value?parseInt(depositData.value,10):0;if("stay"===depositData.applyTo)return $("<div/>").append($.fb("crs-helper-translate",{key:"rate-deposit-percent-stay",placeholders:[percentage]})).html();if(!depositData.applyValue)return"";var nbNights=parseInt(depositData.applyValue,10),nightLabel=$("<div/>").append($.fb("crs-helper-translate",{key:"night",mode:nbNights,placeholders:[nbNights]})).html();return $("<div/>").append($.fb("crs-helper-translate",{key:"rate-deposit-percent-nights",placeholders:[percentage,nightLabel]})).html()}(terms),i18nKeySuffix=terms.payment.deposit&&1===terms.payment.deposit.fuzzy?"-fuzzy":"";return{image:"/images/pictos/icon-package-salesterms-payment-online.png",rateLabel:$.fb("crs-helper-translate",{key:"results-rate-payment-deposit"}),legalDesc:$("<div/>").append($.fb("crs-helper-translate",{key:"rate-payment-deposit"+i18nKeySuffix,placeholders:[label]})).append(" ").append($.fb("crs-helper-translate",{key:"rate-payment-deposit-note"+i18nKeySuffix}))}},getFromBooking:function(bookingData){var keysToReturn=["legalDesc","image","confirmrecapLabel","confirmrecapDesc"];if(!bookingData.details||!bookingData.details.packages||!bookingData.details.packages[0])return _.pick(getForNoPayment(),keysToReturn);var terms=bookingData.details.packages[0].terms;if(!terms||!terms.payment||!terms.payment.type||"deposit"!==terms.payment.type&&"full"!==terms.payment.type)return _.pick(getForNoPayment(),keysToReturn);if("full"===terms.payment.type)return _.pick(getForFullPrepayment(),keysToReturn);var depositDetails=function(bookingTerms,depositAmount,bookingCurrency){var result={label:"",amount:getDepositAmountAsHtml(depositAmount,bookingCurrency)};if(!bookingTerms.payment.deposit)return result;var depositData=bookingTerms.payment.deposit;if("percentage"!==depositData.type&&"value"!==depositData.type)return result;if("value"===depositData.type)return result.label=result.amount,result;var percentage=depositData.value?parseInt(depositData.value,10):0;if("stay"!==depositData.applyTo&&"nights"!==depositData.applyTo)return result;if("stay"===depositData.applyTo)return result.label=$("<div/>").append($.fb("crs-helper-translate",{key:"rate-deposit-percent-stay",placeholders:[percentage]})).html(),result;if(!depositData.applyValue)return result;var nbNights=parseInt(depositData.applyValue,10),nightLabel=$("<div/>").append($.fb("crs-helper-translate",{key:"night",mode:nbNights,placeholders:[nbNights]})).html();return result.label=$("<div/>").append($.fb("crs-helper-translate",{key:"rate-deposit-percent-nights",placeholders:[percentage,nightLabel]})).html(),result}(terms,bookingData.details.deposit,bookingData.currency),fuzzyDeposit=terms.payment.deposit&&1===terms.payment.deposit.fuzzy;return _.pick(getFromDepositDetails(depositDetails,fuzzyDeposit),keysToReturn)},getFromSelection:function(){var keysToReturn=["legalDesc","image","recapLabel","recapDesc","guaranteeLabel1","guaranteeLabel2","guaranteeLabel3","guaranteeLabel4"],selection=$fb.selection.get();if(!selection||!selection.packages||!selection.packages[0])return _.pick(getForNoPayment(),keysToReturn);var terms=selection.packages[0].terms;if(!terms||!terms.payment||!terms.payment.type||"deposit"!==terms.payment.type&&"full"!==terms.payment.type)return _.pick(getForNoPayment(),keysToReturn);if("full"===terms.payment.type)return _.pick(getForFullPrepayment(),keysToReturn);var depositDetails=function(terms,packages,services){var result={label:"",amount:getDepositAmountAsHtml(0)};if(!terms.payment.deposit)return result;var depositData=terms.payment.deposit;if("percentage"!==depositData.type&&"value"!==depositData.type)return result;var depositAmountOfAllPackages=0;if($.each(packages,function(key,pack){depositAmountOfAllPackages+=pack.terms.payment.deposit.amount}),"value"===depositData.type)return result.amount=getDepositAmountAsHtml(depositAmountOfAllPackages),result.label=result.amount,result;if("stay"!==depositData.applyTo&&"nights"!==depositData.applyTo)return result;var addExtras=!0;$fb._state.app.data.properties[$fb._state.quicksearch.property]&&$fb._state.app.data.properties[$fb._state.quicksearch.property].configuration&&(addExtras=!$fb._state.app.data.properties[$fb._state.quicksearch.property].configuration.noExtrasInSalestermsCalculation);var percentage=depositData.value?parseInt(depositData.value,10):0;if("stay"===depositData.applyTo)return addExtras&&(depositAmountOfAllPackages+=$fb.selection.totalServicesPrice()*(percentage/100)),result.amount=getDepositAmountAsHtml(depositAmountOfAllPackages),result.label=$("<div/>").append($.fb("crs-helper-translate",{key:"rate-deposit-percent-stay",placeholders:[percentage]})).html(),result;if(!depositData.applyValue)return result;var nbNights=parseInt(depositData.applyValue,10),nightLabel=$("<div/>").append($.fb("crs-helper-translate",{key:"night",mode:nbNights,placeholders:[nbNights]})).html();if(result.label=$("<div/>").append($.fb("crs-helper-translate",{key:"rate-deposit-percent-nights",placeholders:[percentage,nightLabel]})).html(),nbNights<=0)return result;addExtras&&$.each(services,function(id,item){item.service&&$.each(item.service,function(key,serv){if(serv.prices.breakdown)for(var t=0;t<nbNights;t++)serv.prices.breakdown[t]&&(depositAmountOfAllPackages+=serv.prices.breakdown[t].gross*percentage/100)})});return result.amount=getDepositAmountAsHtml(depositAmountOfAllPackages),result}(terms,selection.packages,selection.services),fuzzyDeposit=terms.payment.deposit&&1===terms.payment.deposit.fuzzy;return _.pick(getFromDepositDetails(depositDetails,fuzzyDeposit),keysToReturn)}},window.$fb.standardize.payment=new StandardizePayment}(window.jQuery,window.$fb.underscore),function($,_){function StandardizeCancellation(){}function getCancelTermsFromPackages(packages){var terms=packages[0].terms;if(terms&&terms.cancellation&&terms.cancellation.type){var cancelTerms=_.reduce(terms.cancellation,function(clone,val,key){return clone[key]=_.clone(val),clone},{});return cancelTerms.penalty&&(cancelTerms.penalty.amount=0),cancelTerms.noshow&&(cancelTerms.noshow.amount=0),$.each(packages,function(key,pack){pack.terms.cancellation.penalty&&pack.terms.cancellation.penalty.amount&&(cancelTerms.penalty.amount+=pack.terms.cancellation.penalty.amount),pack.terms.cancellation.noshow&&pack.terms.cancellation.noshow.amount&&(cancelTerms.noshow.amount+=pack.terms.cancellation.noshow.amount)}),cancelTerms}}function getForNotCancellable(fuzzy,noShowTerms,currency){var cancelData=getDefaultCancelData();return fuzzy?setFuzzyWithNanrMention(cancelData):addNoShowInformation(cancelData,noShowTerms,currency,!0)}function computeCancelDateForPotentiallyCancellable(cancelTerms,creationDate,arrivalDate){var timing=cancelTerms.timing?cancelTerms.timing:{hours:0,time:""};timing.hours&&void 0!==timing.hours||(timing.hours=0);var cancelDate,hoursDue=parseInt(timing.hours,10),hhmm=["0","0"];return timing.time&&(hhmm=timing.time.split(":")),"after-booking"===timing.type?cancelDate=creationDate:(cancelDate=arrivalDate,hoursDue=-hoursDue),cancelDate.setHours(parseInt(hhmm[0],10)),cancelDate.setMinutes(parseInt(hhmm[1],10)),cancelDate.setHours(cancelDate.getHours()+hoursDue),cancelDate}function getForPotentiallyCancellable(cancelTerms,currency,creationDate,arrivalDate){var cancelData=getDefaultCancelData(),cancelDate=computeCancelDateForPotentiallyCancellable(cancelTerms,creationDate,arrivalDate);if(cancelDate<$fb._getCurrentDate())return cancelTerms.fuzzy?setFuzzyWithNanrMention(cancelData):addNoShowInformation(cancelData,cancelTerms.noshow,currency,!0);if(cancelData.label=$.fb("crs-helper-translate",{key:"warrant-cancellable-amendable"}),cancelData.image="/images/pictos/icon-package-salesterms-check.png",cancelTerms.fuzzy)return setFuzzyImpact(cancelData);var timeZone="UTC+00:00";$fb._state.app.data.properties[$fb._state.quicksearch.property]&&$fb._state.app.data.properties[$fb._state.quicksearch.property].location&&$fb._state.app.data.properties[$fb._state.quicksearch.property].location.timezone&&(timeZone=$fb._state.app.data.properties[$fb._state.quicksearch.property].location.timezone);var timeData=cancelDate.toTimeString().substr(0,5)+" ("+timeZone+")",datePlaceholders=[$("<div/>").append($.fb("crs-helper-date",{date:cancelDate})).html(),timeData];cancelData.rateDesc=$("<div/>").append($.fb("crs-helper-translate",{key:"cancellable-amendable-date",placeholders:datePlaceholders})).append(" ").append($.fb("crs-helper-translate",{key:"rate-cancel-penalty"})).append(" "),cancelData.simplestDesc=$("<div/>").append($.fb("crs-helper-translate",{key:"cancellable-amendable-date",placeholders:datePlaceholders}));var toAppendToLegalDesc=function(penaltyDetails,currency){if(!penaltyDetails.value||-1===["value","percentage"].indexOf(penaltyDetails.type))return;var translationKey,placeholders=[penaltyDetails.value];if("value"===penaltyDetails.type)placeholders=[$("<div/>").append($("<span/>").append($.fb("crs-helper-price",{price:penaltyDetails.amount,type:"penalty",originCurrency:currency}))).html()],translationKey="email-not-cancellable-not-amendable-penalty";else{switch(penaltyDetails.applyTo){case"stay":translationKey="not-cancellable-not-amendable-penalty-percent-stay";break;case"first-last-nights":translationKey="not-cancellable-not-amendable-penalty-percent-firstlast";break;case"nights":translationKey="not-cancellable-not-amendable-penalty-percent-night",1<penaltyDetails.applyValue&&(translationKey+="s",placeholders.push(penaltyDetails.applyValue));break;default:return}placeholders.push($.fb("crs-helper-price",{price:penaltyDetails.amount,type:"penalty",originCurrency:currency}))}return $("<div>").append($.fb("crs-helper-translate",{key:translationKey,placeholders:placeholders}))}(cancelTerms.penalty?cancelTerms.penalty:{type:"%",value:100},currency);return cancelData.legalDesc=cancelData.simplestDesc.clone(),toAppendToLegalDesc&&cancelData.legalDesc.append(toAppendToLegalDesc),cancelData.preBookingNotice=cancelData.legalDesc.clone(),cancelData=addNoShowInformation(cancelData,cancelTerms.noshow,currency,!1)}function addNoShowInformation(cancelData,noShowTerms,currency,addNotCancellable){if(addNotCancellable&&cancelData.preBookingNotice.append($.fb("crs-helper-translate",{key:"not-cancellable-not-amendable-notice"})).append("<br/>"),!noShowTerms||!noShowTerms.type||!noShowTerms.value)return cancelData;var noShowPlaceholders,formatedAmount=$("<div/>").append($("<span/>").append($.fb("crs-helper-price",{price:noShowTerms.amount,type:"penalty",originCurrency:currency}))).html();return noShowPlaceholders="nights"===noShowTerms.type?[$("<div/>").append($("<span/>").append($.fb("crs-helper-translate",{key:"night",mode:noShowTerms.value,placeholders:[noShowTerms.value]}))).html(),formatedAmount]:"percentage"===noShowTerms.type?[noShowTerms.value+"%",formatedAmount]:[formatedAmount],cancelData.rateDesc.append($.fb("crs-helper-translate",{key:"rate-cancel-noshow",placeholders:noShowPlaceholders})),cancelData.legalDesc.append($("<div/>").append($.fb("crs-helper-translate",{key:"rate-cancel-noshow",placeholders:noShowPlaceholders}))),cancelData.preBookingNotice.append($.fb("crs-helper-translate",{key:"rate-cancel-noshow",placeholders:noShowPlaceholders})),cancelData}function setFuzzyWithNanrMention(cancelData){return(cancelData=setFuzzyImpact(cancelData)).preBookingNotice=$("<div/>").append($.fb("crs-helper-translate",{key:"not-cancellable-not-amendable-notice"})),cancelData.preBookingNotice.append($.fb("crs-helper-translate",{key:"rate-payment-deposit-note-fuzzy"})),cancelData}function setFuzzyImpact(cancelData){return cancelData.simplestDesc=$.fb("crs-helper-translate",{key:"rate-payment-deposit-note-fuzzy"}),cancelData.rateDesc=$("<div/>").append(cancelData.simplestDesc.clone()),cancelData.legalDesc=$("<div/>"),cancelData.preBookingNotice=null,cancelData}function getDefaultCancelData(){return{image:"/images/pictos/icon-package-salesterms-cross.png",label:$.fb("crs-helper-translate",{key:"warrant-cancellable-not-amendable"}),rateDesc:$("<div/>"),legalDesc:$.fb("crs-helper-translate",{key:"not-cancellable-not-amendable-notice"}).append(" "),simplestDesc:null,preBookingNotice:$("<div/>")}}StandardizeCancellation.prototype={getFromBooking:function(bookingData){var cancelTerms;if(bookingData.aggregatedTerms){if(!bookingData.aggregatedTerms.cancellation||!bookingData.aggregatedTerms.cancellation.type)return getDefaultCancelData();cancelTerms=bookingData.aggregatedTerms.cancellation}if(!cancelTerms){if(!bookingData.details||!bookingData.details.packages||!bookingData.details.packages[0])return getDefaultCancelData();if(!(cancelTerms=getCancelTermsFromPackages(bookingData.details.packages)))return getDefaultCancelData()}return"cancellable-modifiable"!==cancelTerms.type?getForNotCancellable(cancelTerms.fuzzy,cancelTerms.noshow,bookingData.currency):getForPotentiallyCancellable(cancelTerms,bookingData.currency,$.fb("crs-helper-parsedate",{date:bookingData.createdAt}),$.fb("crs-helper-parsedate",{date:bookingData.firstArrivalDate}))},getFromTerms:function(terms){if(!terms||!terms.cancellation||!terms.cancellation.type)return getDefaultCancelData();var cancelTerms=terms.cancellation;return"cancellable-modifiable"!==cancelTerms.type?getForNotCancellable(cancelTerms.fuzzy,cancelTerms.noshow,"EUR"):getForPotentiallyCancellable(cancelTerms,"EUR",$fb._getCurrentDate(),$.fb("crs-helper-parsedate",{date:$fb._state.quicksearch.arrival}))},getFromSelection:function(){var selection=$fb.selection.get();if(!selection||!selection.packages||!selection.packages[0])return getDefaultCancelData();var cancelTerms=getCancelTermsFromPackages(selection.packages);return cancelTerms?"cancellable-modifiable"!==cancelTerms.type?getForNotCancellable(cancelTerms.fuzzy,cancelTerms.noshow,"EUR"):getForPotentiallyCancellable(cancelTerms,"EUR",$fb._getCurrentDate(),$.fb("crs-helper-parsedate",{date:$fb._state.quicksearch.arrival})):getDefaultCancelData()},isCancellable:function(terms){if(!terms||!terms.cancellation||!terms.cancellation.type)return!1;var cancelTerms=terms.cancellation;if("cancellable-modifiable"===cancelTerms.type){var cancelDate=computeCancelDateForPotentiallyCancellable(cancelTerms,$fb._getCurrentDate(),$.fb("crs-helper-parsedate",{date:$fb._state.quicksearch.arrival}));if(cancelDate>$fb._getCurrentDate())return!0}return!1}},window.$fb.standardize.cancellation=new StandardizeCancellation}(window.jQuery,window.$fb.underscore),function($,_){function quotationResultsHelper(){}quotationResultsHelper.prototype={compileResults:function(quotationResults){var results={};if(void 0===quotationResults.packages||Object.keys(quotationResults.packages).length<=0)return null;$.each(quotationResults.packages,function(packId,package){var compiledPackage=function(package,packId){var accommodationItem=_.find(package,function(pack){return"accommodation"===pack.type});if(!accommodationItem)return;var packageData={price:accommodationItem.prices.gross,includedTaxes:accommodationItem.prices.gross-accommodationItem.prices.net,itemCount:1,packId:packId,rate:accommodationItem.rate,property:accommodationItem.property,accommodation:accommodationItem.product,currency:accommodationItem.currency,adults:accommodationItem.adults,children:accommodationItem.children,nights:accommodationItem.prices.breakdown.length,minAvailability:Math.min.apply(Math,accommodationItem.availability)};accommodationItem.campaignIdForMultiRoomLink&&(packageData.campaignForMultiRoomLink={id:accommodationItem.campaignIdForMultiRoomLink});accommodationItem.campaignId&&(packageData.campaign=(item=accommodationItem,(campaign=_.reduce({id:"campaignId",name:"campaignName",promoDiscountType:"campaignPromoDiscountType",promoType:"campaignPromoType",promoValue:"campaignPromoValue",freeNightIndex:"campaignFreeNightIndex",freeNightPayFor:"campaignFreeNightPayFor",freeNightStayFor:"campaignFreeNightStayFor",freeNightIsRecurring:"campaignFreeNightIsRecurring",dealOfTheDayEndDate:"campaignDealOfTheDayEndDate",isDealOfTheDay:"campaignIsDealOfTheDay"},function(campaign,sourceKey,targetKey){return item[sourceKey]&&(campaign[targetKey]=item[sourceKey]),campaign},{})).offerMealPlan=!!item.offerMealPlan,campaign));var item,campaign;var keyForPriceToUse,currentLoyalty=$fb.loyalties.getCurrentLoyalty(),isCurrentLoyaltyLogged=currentLoyalty&&currentLoyalty.isLogged();if(accommodationItem.loyalty&&(packageData.memberOnly=accommodationItem.loyalty,packageData.memberLevelOnly=null,isCurrentLoyaltyLogged)){var member=currentLoyalty.getMember();member.level&&(packageData.memberLevelOnly=member.level)}accommodationItem.unlockedByAccessCode&&(packageData.unlockedByAccessCode=accommodationItem.unlockedByAccessCode);(accommodationItem.loyaltyDiscount||accommodationItem.pricesLoyalty)&&isCurrentLoyaltyLogged?(keyForPriceToUse="pricesLoyalty",packageData.originalPrice=packageData.price,packageData.price=accommodationItem.pricesLoyalty.gross,packageData.loyaltyDiscount=accommodationItem.loyaltyDiscount,packageData.loyaltyAlternativeCurrencyRate=accommodationItem.loyaltyAlternativeCurrencyRate,packageData.campaign&&accommodationItem.pricesDiscounted&&(packageData.campaignPrice=accommodationItem.pricesDiscounted.gross),packageData.points=accommodationItem.pricesLoyalty?accommodationItem.pricesLoyalty.points:0):packageData.campaign&&accommodationItem.pricesDiscounted&&(keyForPriceToUse="pricesDiscounted",packageData.originalPrice=packageData.price,packageData.price=accommodationItem.pricesDiscounted.gross);!accommodationItem.loyaltyDiscount&&!accommodationItem.pricesLoyalty||isCurrentLoyaltyLogged||(packageData.teasingMemberDiscount=accommodationItem.loyaltyDiscount,packageData.teasingMemberPrice=accommodationItem.pricesLoyalty.gross,packageData.teasingMemberPoint=accommodationItem.pricesLoyalty.points?accommodationItem.pricesLoyalty.points:0);accommodationItem.commission&&(packageData.iataCommission=accommodationItem.commission);return $.each(package,function(id,packageItem){"accommodation"!==packageItem.type&&(keyForPriceToUse&&packageItem[keyForPriceToUse]?packageData.price+=packageItem[keyForPriceToUse].gross:packageData.price+=packageItem.prices.gross,packageData.originalPrice&&(packageData.originalPrice+=packageItem.prices.gross),packageData.campaignPrice&&(packageData.campaignPrice+=packageItem.pricesDiscounted?packageItem.pricesDiscounted.gross:packageItem.prices.gross),packageData.point&&(packageData.point+=packageItem.pricesLoyalty.points?packageItem.pricesLoyalty.points:0),packageData.teasingMemberPrice&&(packageData.teasingMemberPrice+=packageItem.pricesLoyalty?packageItem.pricesLoyalty.gross:packageItem.prices.gross),packageData.teasingMemberPoint&&(packageData.teasingMemberPoint+=packageItem.pricesLoyalty.points?packageItem.pricesLoyalty.points:0),packageData.includedTaxes+=packageItem.prices.gross-packageItem.prices.net,packageData.itemCount+=1)}),packageData}(package,packId);if(compiledPackage){quotationResults.terms[packId]&&(compiledPackage.terms=quotationResults.terms[packId]);var packageAccommodationName=compiledPackage.accommodation;void 0===results[packageAccommodationName]&&(results[packageAccommodationName]={id:packageAccommodationName,items:{},rates:[]}),results[packageAccommodationName].items[packId]=package,results[packageAccommodationName].rates.push(compiledPackage),(void 0===results[packageAccommodationName].bestPrice||compiledPackage.price<results[packageAccommodationName].bestPrice)&&(results[packageAccommodationName].bestPrice=compiledPackage.price),(void 0===results[packageAccommodationName].highestPrice||compiledPackage.price>results[packageAccommodationName].highestPrice)&&(results[packageAccommodationName].highestPrice=compiledPackage.price)}});var minPrice=_.chain(results).map(function(result){return result.bestPrice}).min().value(),maxPrice=_.chain(results).map(function(result){return result.highestPrice}).max().value();return{accommodations:results,minPrice:minPrice,maxPrice:maxPrice}},getEmptyResults:function(){return{accommodations:{},minPrice:0,maxPrice:0}},filterWithPredicate:function(compiledResults,predicate){return{accommodations:_.reduce(compiledResults.accommodations,function(filtered,accommodation,accName){var newAcc={bestPrice:null,id:accName,items:{},rates:[]};return newAcc.rates=accommodation.rates.filter(function(rate){return!!predicate(rate,accommodation.items[rate.packId])&&(newAcc.items[rate.packId]=accommodation.items[rate.packId],(null===newAcc.bestPrice||rate.price<newAcc.bestPrice)&&(newAcc.bestPrice=rate.price),!0)}),newAcc.rates.length&&(filtered[accName]=newAcc),filtered},{})}},formatBookingQueryFromQuotationQuery:function(contextQuery,package){var roomPack=_.find(package,function(pack){return"accommodation"===pack.type}),query={nbAdults:parseInt(contextQuery.adults,10),nbChildren:contextQuery.children?parseInt(contextQuery.children,10):0,childrenAges:contextQuery.childrenAges,arrivalDate:contextQuery.arrival,departureDate:contextQuery.departure,property:contextQuery.property,isMobile:Boolean(contextQuery.isMobile),offer:roomPack.rate};contextQuery.mcmEnable&&!0===contextQuery.mcmEnable&&(query.mcmEnable=!0);isNaN(query.nbAdults)&&(query.nbAdults=1);isNaN(query.nbChildren)&&(query.nbChildren=0);void 0!==contextQuery.accessCode&&""!==contextQuery.accessCode&&(query.accessCode=contextQuery.accessCode);contextQuery.loyaltyEnable&&(query.loyaltyEnable=contextQuery.loyaltyEnable);contextQuery.loyaltyParams&&(query.loyaltyParams=contextQuery.loyaltyParams);contextQuery.context&&(query.context=contextQuery.context);return query}},window.$fb.quotationResultsHelper=new quotationResultsHelper}(window.jQuery,window.$fb.underscore),function($,_){var availableCheckboxBasedFilters=[{id:"bookingSalesConditions",titleKey:"booking-sales-conditions",filters:[{labelKey:"results-rate-flexibility-amend-cancel",id:!0},{labelKey:"results-rate-flexibility-noamend-nocancel",id:!1}]},{id:"mealplans",titleKey:"meal-types",filters:[{labelKey:"meal-type-breakfast",id:"breakfast"},{labelKey:"meal-type-dinner",id:"dinner"},{labelKey:"meal-type-fullboard",id:"full board"},{labelKey:"meal-type-halfboard",id:"half board"},{labelKey:"meal-type-allinclusive",id:"all inclusive"}]},{id:"paymentConditions",titleKey:"payment-conditions",filters:[{labelKey:"results-rate-payment-hotel",id:"none"},{labelKey:"results-rate-payment-internet",id:"full"}]},{id:"bedTypes",titleKey:"room-bed-types",filters:[{labelKey:"__TypeOfBeds___Twin",id:"twin"},{labelKey:"__TypeOfBeds___Double",id:"double"},{labelKey:"__TypeOfBeds___King",id:"king"}]}];function resultsFilter(){this.activatedFilters=this._getEmptyFilters(),this.activatedFiltersTempCopy=this._getEmptyFilters(),this.initialPriceRanges=null}resultsFilter.prototype={isMatchingFilters:function(rate,package){return!(this.activatedFilters.mealplans.length&&!function(package,acceptedMealplans){var mealPack=_.find(package,function(pack){return"meal"===pack.type});return!!mealPack&&_.contains(acceptedMealplans,mealPack.mealType.toLowerCase())}(package,this.activatedFilters.mealplans)||this.activatedFilters.paymentConditions.length&&!function(package,acceptedPaymentConditions){var paymentPack=_.find(package,function(pack){return pack.terms});return!!paymentPack&&_.contains(acceptedPaymentConditions,paymentPack.terms.payment.type)}(package,this.activatedFilters.paymentConditions)||this.activatedFilters.bookingSalesConditions.length&&!function(package,acceptedBookingSalesConditions){var bookingPack=_.find(package,function(pack){return pack.terms});return!!bookingPack&&_.contains(acceptedBookingSalesConditions,$fb.standardize.cancellation.isCancellable(bookingPack.terms))}(package,this.activatedFilters.bookingSalesConditions)||this.activatedFilters.bedTypes.length&&!function(package,acceptedBedTypes){var bedPack=_.find(package,function(pack){return"accommodation"===pack.type});return!!(bedPack&&bedPack.property&&bedPack.product&&$fb._state.app.data.accommodations&&$fb._state.app.data.accommodations[bedPack.property]&&$fb._state.app.data.accommodations[bedPack.property][bedPack.product])&&_.reduce(acceptedBedTypes,function(isMatching,bedTypeToMatch){return isMatching||_.some($fb._state.app.data.accommodations[bedPack.property][bedPack.product].bedTypes,function(roomBedType){return-1!==roomBedType.toLowerCase().indexOf(bedTypeToMatch)})},!1)}(package,this.activatedFilters.bedTypes)||this.activatedFilters.priceRanges&&!function(rate,priceRanges){return rate.price>=priceRanges.min&&rate.price<=priceRanges.max}(rate,this.activatedFilters.priceRanges))},hasSomeFiltersSet:function(){return 0<this.activatedFilters.mealplans.length||0<this.activatedFilters.paymentConditions.length||0<this.activatedFilters.bookingSalesConditions.length||0<this.activatedFilters.bedTypes.length||null!==this.activatedFilters.priceRanges},render:function(){var self=this,output=$('<div id="fb-results-filter-container">'),titleDiv=$('<div id="results-filter-title-div" class="results-filter-row">'),title=$('<div id="results-filter-title" class="quotation-inline-div">');title.append($.fb("crs-helper-translate",{key:"choose-your-filters"}));var closeButton=$('<div id="results-filter-close-button" class="quotation-inline-div"><span>x</span></div>');closeButton.click(function(){self._restoreAppliedFilters()._updateResetButton()._refreshCheckboxBasedFiltersDisplay()._refreshCurrentMinMaxPricesDisplay()._closeFilterPanel()}),titleDiv.append(title).append(closeButton),output.append(titleDiv);var priceRangeDiv=$('<div id="price-range-filter-container" class= "results-filter-row filter-price-range separator-line">');priceRangeDiv.hide(),output.append(priceRangeDiv),output.append(self._getAllCheckboxBasedFiltersRows());var filterActivationDiv=$('<div id="filter-activation-row" class="col-md-12">'),resetFiltersButton=$('<a id="filter-reset-btn" class="theme-link disabled"/>');resetFiltersButton.append($.fb("crs-helper-translate",{key:"reset-filters"}));var applyFiltersButton=$('<div class ="fb-action fb-font-bold theme-btn apply-filter-btn" />');return applyFiltersButton.append($.fb("crs-helper-translate",{key:"apply-filters"})).click(function(){self._applyFilters()._closeFilterPanel()}),resetFiltersButton.click(function(){self.hasSomeFiltersSet()&&self._resetFilters()._applyFilters()._closeFilterPanel()._updateResetButton()._refreshCheckboxBasedFiltersDisplay()._refreshPriceRangeFilterDisplay()}),filterActivationDiv.append(resetFiltersButton).append(applyFiltersButton),output.append(filterActivationDiv),output},initPriceFilterRanges:function(minPrice,maxPrice){return this.initialPriceRanges={min:Math.floor(minPrice),max:Math.ceil(maxPrice)},this},resetActiveFiltersAndRefreshDisplay:function(){return this._resetFilters()._refreshPriceRangeFilterDisplay()._refreshCheckboxBasedFiltersDisplay(),this},_getEmptyFilters:function(){return{mealplans:[],paymentConditions:[],bookingSalesConditions:[],bedTypes:[],priceRanges:null}},_setPriceRanges:function(minPrice,maxPrice){return this.activatedFilters.priceRanges={min:minPrice,max:maxPrice},this},_closeFilterPanel:function(){return $fb._triggerEvent("fastbooking-crs-close-results-filter"),this},_applyFilters:function(){return this.activatedFiltersTempCopy=JSON.parse(JSON.stringify(this.activatedFilters)),$fb.results.render({}),this},_resetFilters:function(){return this.activatedFilters=this._getEmptyFilters(),this.activatedFiltersTempCopy=this._getEmptyFilters(),this},_getAllCheckboxBasedFiltersRows:function(){var self=this,filtersByRow=_.chunk(availableCheckboxBasedFilters,3);return $('<div id="results-filter-rows-container">').append(filtersByRow.map(function(filtersRow){return $("<div class='results-filter-row feature-row separator-line'>").append(filtersRow.map(function(category){return $('<div class="quotation-inline-div results-filter-column">').css("width",100/3+"%").append($('<div class="results-filter-type-header">').append($.fb("crs-helper-translate",{key:category.titleKey})),category.filters.map(function(filter){var currentFilter=$('<div class= "quotation-individual-filter">'),currentFilterBackground=$('<span class="quotation-filter-background bs-checkbox"/>').append($.fb("crs-helper-translate",{key:filter.labelKey})),currentFilterCheckBox=$('<input type="checkbox" />').prop("checked",_.contains(self.activatedFilters[category.id],filter.id));return currentFilterBackground.append(currentFilterCheckBox),currentFilterBackground.bsCheckbox(),currentFilter.append(currentFilterBackground),currentFilterBackground.click(function(){currentFilterCheckBox.prop("checked")?_.contains(self.activatedFilters[category.id],filter.id)||self.activatedFilters[category.id].push(filter.id):self.activatedFilters[category.id]=_.without(self.activatedFilters[category.id],filter.id),self._updateResetButton()}),currentFilter}))}))}))},_getPriceFilterRow:function(){var self=this,priceRangeDiv=$('<div id="price-range-filter-container" class= "results-filter-row filter-price-range separator-line">'),priceRangeHeader=$('<div class="quotation-inline-div results-filter-type-header">');priceRangeHeader.append($.fb("crs-helper-translate",{key:"price-range"})),priceRangeDiv.append(priceRangeHeader);var priceSlider=$('<div id="filter-price-slider" class="nstSlider">'),datas={range_min:this.initialPriceRanges.min,range_max:this.initialPriceRanges.max,cur_min:this.activatedFilters.priceRanges?this.activatedFilters.priceRanges.min:this.initialPriceRanges.min,cur_max:this.activatedFilters.priceRanges?this.activatedFilters.priceRanges.max:this.initialPriceRanges.max};priceSlider.data(datas);var leftGrip=$('<div id="price-range-left-grip" class="fa left-grip price-slider-indicator theme-btn">'),leftGripValue=$('<span class="price-slider-value">');leftGrip.append(leftGripValue);var rightGrip=$('<div id="price-range-right-grip" class="fa right-grip price-slider-indicator theme-btn">'),rightGripValue=$('<span class="price-slider-value">');rightGrip.append(rightGripValue);var priceBar=$('<div class="filter-price-slider-bar">');if(priceSlider.append(leftGrip).append(rightGrip).append(priceBar),priceSlider.nstSlider({rounding:1,crossable_handles:!1,left_grip_selector:"#price-range-left-grip",right_grip_selector:"#price-range-right-grip",value_bar_selector:".filter-price-slider-bar",value_changed_callback:function(cause,minValue,maxValue){leftGripValue.empty(),leftGripValue.append($.fb("crs-helper-price",{price:minValue})),rightGripValue.empty(),rightGripValue.append($.fb("crs-helper-price",{price:maxValue}))},user_mouseup_callback:function(minValue,maxValue){self._setPriceRanges(minValue,maxValue),self._updateResetButton()}}),self.activatedFilters.priceRanges&&self.initialPriceRanges&&self.initialPriceRanges.max!==self.initialPriceRanges.min){var positionCoeffBase=self.initialPriceRanges.max-self.initialPriceRanges.min,rightGripPositionCoeff=(self.activatedFilters.priceRanges.max-self.initialPriceRanges.min)/positionCoeffBase,leftGripPositionCoeff=(self.activatedFilters.priceRanges.min-self.initialPriceRanges.min)/positionCoeffBase;rightGrip.css("left",300*rightGripPositionCoeff),leftGrip.css("left",300*leftGripPositionCoeff)}else rightGrip.css("left",300),leftGrip.css("left",0);return priceRangeDiv.append(priceSlider),priceRangeDiv},_updateResetButton:function(){this.hasSomeFiltersSet()?$("#filter-reset-btn").removeClass("disabled"):$("#filter-reset-btn").addClass("disabled");return this},_restoreAppliedFilters:function(){return this.activatedFilters=JSON.parse(JSON.stringify(this.activatedFiltersTempCopy)),this},_refreshCheckboxBasedFiltersDisplay:function(){return $("#results-filter-rows-container").replaceWith(this._getAllCheckboxBasedFiltersRows()),this},_refreshPriceRangeFilterDisplay:function(){return $("#price-range-filter-container").replaceWith(this._getPriceFilterRow()),this},_refreshCurrentMinMaxPricesDisplay:function(){$("#filter-price-slider").length&&(this.activatedFilters.priceRanges?$("#filter-price-slider").nstSlider("set_position",this.activatedFilters.priceRanges.min,this.activatedFilters.priceRanges.max):$("#filter-price-slider").nstSlider("set_position",this.initialPriceRanges.min,this.initialPriceRanges.max));return this}},window.$fb.resultsFilter=new resultsFilter,$(document).on("quicksearch-close-all-panels",function(){$fb._state.quicksearch.property&&$fb._state.app.data.properties[$fb._state.quicksearch.property]&&$fb._state.app.data.properties[$fb._state.quicksearch.property].bookingEngineFrontend&&$fb._state.app.data.properties[$fb._state.quicksearch.property].bookingEngineFrontend.results.displayQuotationFilter&&$fb.resultsFilter._restoreAppliedFilters()._updateResetButton()._refreshCurrentMinMaxPricesDisplay()._refreshCheckboxBasedFiltersDisplay()})}(window.jQuery,window.$fb.underscore),function($,_){$.extend(window.$fb,{template:{render:function(template,data){try{var rootNode=$(_.template(template)(data))}catch(e){throw new Error("Invalid template : "+e.message)}if(rootNode.selector)throw new Error("Expected template, no a selector");return rootNode.find(".fb-translate").each(function(i,elt){var $elt=$(elt);-1!==$elt.attr("data-key").indexOf("room")&&$elt.attr("data-key",$.fb("crs-helper-translateByAccommodationType",{defKey:$elt.attr("data-key")})),$.fb("crs-helper-translate",elt)}),rootNode.find(".fb-price").each(function(i,elt){$.fb("crs-helper-renderprice",{price:$(elt)})}),rootNode}}})}(window.jQuery,window.$fb.underscore),function($,_){$.extend(window.$fb,{extrasHelper:{getCompiledExtrasFromExtrasPerRoom:function(extrasPerRoom){var self=this;return _.chain(extrasPerRoom).flatten().reduce(function(compiledExtras,extra){return compiledExtras[extra.product]=self.merge2Extras(extra,compiledExtras[extra.product]),compiledExtras},{}).values().value()},merge2Extras:function(extra1,extra2){return this._recursive2ExtrasMerge(extra1,extra2,extra1.perBooking)},_recursive2ExtrasMerge:function(object1,object2,perBooking){if(void 0===object2)return object1;var extra={};for(var attr in object1)switch(typeof object1[attr]){case"object":extra[attr]=this._recursive2ExtrasMerge(object1[attr],object2[attr],perBooking);break;case"number":if(extra[attr]=parseFloat(object1[attr],10),"loyaltyAlternativeCurrencyRate"===attr)continue;object2[attr]&&(!perBooking||"net"!==attr&&"gross"!==attr&&"quantity"!==attr?extra[attr]+=parseFloat(object2[attr],10):extra[attr]=parseFloat(object2[attr],10));break;case"string":case"boolean":extra[attr]=object1[attr];break;default:$fb.err("a ... ? "+typeof object1[attr])}return extra}}})}(window.jQuery,window.$fb.underscore),function($){function CommentBlock(){}CommentBlock.prototype={render:function(){var currentComment=$fb.selection.getComment(),counter=$("<span />",{class:"fb-dark-gray",text:currentComment.length+"/500"}),elementName="fb-comment-block";$fb._state.app.data.onlyLatinChars&&(elementName+="-onlylatin");var commentBlock=$('<div class="fb-comment-block-container">'),extraRequestConfig=$fb._state.app.data.properties[$fb._state.quicksearch.property].bookingEngineFrontend.specialRequest;if(!extraRequestConfig||extraRequestConfig.useDefault)commentBlock.append($("<label>").append($.fb("crs-helper-translate",{key:"extras-request-placeholder"})));else{var customSpecialRequest=$.fb("crs-helper-translate",{key:$fb._state.quicksearch.property+":specialrequest:hoteldesc",fallback:extraRequestConfig.customDefaultText.replace(/\n/g,""),disableHTMLClean:!0});commentBlock.append($("<label>").append(customSpecialRequest))}return commentBlock.append($("<textarea />",{class:"form-control",rows:6,text:currentComment,name:elementName,maxlength:500}).change(function(event){return event.preventDefault(),$fb.selection.setComment($(this).val()),!1}).on("keyup blur",function(){var maxlength=$(this).attr("maxlength"),val=$(this).val();val.length>maxlength&&$(this).val(val.slice(0,maxlength))}).on("keyup",function(){counter.text($(this).val().length+"/500")})).append(counter),commentBlock}},window.$fb.CommentBlock=CommentBlock}(window.jQuery),function($){function PropertyNote(note){this._note=note}PropertyNote.prototype={render:function(){var noteNode=$.fb("crs-helper-translate",{key:this._note.i18nKey,fallback:this._note.message,disableHTMLClean:!0});return $('            <div class="container fb-light-bg property-note">                <div class="property-note-information fb-title">                </div>                <div class="property-note-content">                </div>            </div>        ').find(".property-note-information").append($.fb("crs-helper-translate",{key:"property-note-information"})).end().find(".property-note-content").append(noteNode).end()}},window.$fb.PropertyNote=PropertyNote}(window.jQuery),function($,_){var nbComponentInstances=0;function OccupancySelection(configuration,selection){nbComponentInstances++,this._autoDiggest=!1,selection=selection||[{nbAdults:1,nbChildren:0}],configuration=_.defaults(configuration,{maxRooms:1,maxAdults:1,showCancelLink:!1,showApplyBtn:!0,showOccupancyMessage:!0}),this.setConfiguration(configuration),this.setSelection(selection),this._showErrors=!0,this._id="fb-occupancy-selection"+nbComponentInstances,this._autoDiggest=!0,this._selectionValidation={hasError:!1},this._rootElement=$("<div />",{class:"fb-occupancy-selection"}),this._digest()}function cloneDeep(obj){return JSON.parse(JSON.stringify(obj))}function isCurrentBrowserSupportingChevronWithSelect(){if("Microsoft Internet Explorer"==navigator.appName&&(null!=navigator.userAgent.match(/MSIE ([0-9]{1,}[.0-9]{0,})/)&&parseFloat(RegExp.$1)<11))return!1;return!0}OccupancySelection.prototype=_.extend({render:function(){return this._rootElement},setConfiguration:function(configuration,noMerge){if((configuration=_.extend({},noMerge?{}:this._configuration,configuration)).needChildrenAges&&!configuration.childrenMaxAge)throw new Error("Invalid configuration needChildrenAges/childrenMaxAge");if(configuration.showCancelLink&&!configuration.showApplyBtn)throw new Error("showCancelLink true and showApplyBtn false = bad logic");return this._configuration=configuration,this._autoDiggest&&this._digest(),this},showErrors:function(){this._showErrors=!0,this._digest()},setSelection:function(selection){if(!selection.length)throw new Error("Invalid section : should not be empty");return this._selection=cloneDeep(selection),this._autoDiggest&&this._digest(),this},getConfiguration:function(){return cloneDeep(this._configuration)},getSelection:function(){return cloneDeep(this._selection)},_digest:function(){this._dataClean(),this._selectionValidation=$fb.occupancySelectionValidator.validate(this._selection,this._configuration),this._rootElement.empty().append(this._createNewView()),this._digestedSelection&&!_.isEqual(this._digestedSelection,this._selection)&&this.trigger(new $.Event("change",{selection:this.getSelection(),selectionValid:this.isSelectionValid()})),this.isSelectionValid()&&(this._showErrors=!1),this._digestedSelection=cloneDeep(this._selection)},_dataClean:function(){this._selection.forEach(function(room){room.childrenAges=_.times(room.nbChildren,function(index){return room.childrenAges&&void 0!==room.childrenAges[index]?null===room.childrenAges[index]?null:room.childrenAges[index]:null}.bind(this))}.bind(this))},isSelectionValid:function(){return!this._selectionValidation.hasError},_chroot:function(){return this._id+"-"+Array.prototype.slice.call(arguments).join("-")},_createNewView:function(){return $("<div />").append(this._createMaxOccupancyMessageView(),this._createNewRoomsView(),this._createNewAddRoomBtnView(),this._createNewFooterBtnsView())},_renderMaxOccupancyI18n:function(what,howMuch){return $.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"quicksearch-message-max-xxx-per-room"}),placeholders:[$.fb("crs-helper-translate",{key:what,placeholders:[howMuch],mode:howMuch}).get(0).outerHTML]})},_createMaxOccupancyMessageView:function(){if(this._configuration.showOccupancyMessage){var tooltipText=$("<span />").append(this._renderMaxOccupancyI18n("adult",this._configuration.maxAdults)),icon=$('<i class="fa fa-info-circle""></i>');this._configuration.maxChildren&&tooltipText.append("<br />",this._renderMaxOccupancyI18n("child",this._configuration.maxChildren));var hideTooltip=function(){icon.tooltip("hide")};return icon.tooltip({html:!0,title:tooltipText,placement:"bottom",trigger:"click"}).on("show.bs.tooltip",function(){setTimeout(function(){var tooltipArrowElement=icon.data("bs.tooltip").$arrow,iconOffset=icon.offset(),tooltipOffset=tooltipArrowElement.offset(),newOffset={left:iconOffset.left+3,top:tooltipOffset.top};tooltipArrowElement.offset(newOffset)},0)}).on("shown.bs.tooltip",function(){$("body").click(hideTooltip)}).on("hide.bs.tooltip",function(){$("body").off("click",hideTooltip)}),$("<div />",{class:"fb-occupancy-selection-max-occupancy-message"}).append(this._renderMaxOccupancyI18n("person",this._configuration.maxPersons),icon)}},_createNewRoomsView:function(){return $("<div />",{class:"fb-occupancy-selection-rooms"}).append(this._selection.map(function(room,index){return this._createNewRoomView(index)}.bind(this)))},_createNewRoomView:function(index){var room=this._selection[index],isTheFirstRoom=0===index,isRemovable=index===this._selection.length-1&&!isTheFirstRoom,roomValidation=this._selectionValidation.items[index],roomRootEl=$("<div />",{class:"fb-occupancy-selection-room "+(isRemovable?"fb-occupancy-selection-room-removable":"")}),headerEl=$("<div />",{class:"fb-occupancy-selection-room-header"});if(roomRootEl.append(headerEl),headerEl.append($("<div />",{class:"fb-occupancy-selection-room-title theme-link"}).append($.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"room-number"}),placeholders:[index+1]}))),isRemovable){var btnDelRoomEl=$("<a />",{href:"javascript:void(0)",class:"theme-link fb-occupancy-selection-room-remove"}).append($.fb("crs-helper-translate",{key:"quicksearch-remove-room"}));btnDelRoomEl.on("click",function(){this._selection.splice(index,1),this._digest()}.bind(this)),headerEl.append($("<div />",{class:"fb-occupancy-selection-room-remove-container"}).append(btnDelRoomEl))}var adultNotSelectableValue,adultsValues=_.times(this._configuration.maxAdults,function(index){return index+1});-1===adultsValues.indexOf(room.nbAdults)&&(adultNotSelectableValue=room.nbAdults,adultsValues.push(room.nbAdults));var adultSelectEl=$("<select />",{id:this._chroot("room",index,"adults")}).append(adultsValues.map(function(adultIndex){return $("<option />",{text:adultIndex,selected:room.nbAdults===adultIndex,class:adultNotSelectableValue===adultIndex?"fb-error":"",disabled:adultNotSelectableValue===adultIndex})})),adultIsError=this._showErrors&&roomValidation.nbAdults.hasError;return roomRootEl.append($("<div />",{class:"fb-occupancy-selection-room-adults"}).append($("<label />",{for:this._chroot("room",index,"adults")}).append($.fb("crs-helper-translate",{key:"fb-occupancy-selection-adult",mode:room.nbAdults})),$("<span />",{class:"fb-occupancy-selection-futurist-select theme-select "+(adultIsError?"fb-error":"")}).append(adultSelectEl,isCurrentBrowserSupportingChevronWithSelect()?$("<i />",{class:"fa fa-chevron-down theme-btn"}):void 0))),adultSelectEl.on("change",function(event){room.nbAdults=parseInt($(event.currentTarget).val(),10),this._digest()}.bind(this)),roomRootEl.append(this._createNewRoomChildrenView(index)),roomRootEl},_createNewRoomChildrenView:function(index){var room=this._selection[index],roomValidation=this._selectionValidation.items[index];if(this._configuration.maxChildren||roomValidation.nbChildren.hasError){var childrenNotSelectableValue,childrenRootEl=$("<div />",{class:"fb-occupancy-selection-room-children"}),childrenValues=_.times(this._configuration.maxChildren+1,function(i){return i});-1===childrenValues.indexOf(room.nbChildren)&&(childrenNotSelectableValue=room.nbChildren,childrenValues.push(room.nbChildren));var childrenSelectEl=$("<select />",{id:this._chroot("room",index,"children")}).append(childrenValues.map(function(childIndex){return $("<option />",{text:childIndex,selected:room.nbChildren===childIndex,class:childrenNotSelectableValue===childIndex?"fb-error":"",disabled:childrenNotSelectableValue===childIndex})})),childrenIsError=this._showErrors&&roomValidation.nbChildren.hasError;if(childrenRootEl.append($("<label />",{for:this._chroot("room",index,"children")}).append($.fb("crs-helper-translate",{key:"fb-occupancy-selection-child",mode:room.nbChildren}),this._configuration.childrenMaxAge?"<br />":void 0,this._configuration.childrenMaxAge?$("<span />",{class:"fb-occupancy-selection-room-children-max-age"}).append(" ",$.fb("crs-helper-translate",{key:"year-old",placeholders:[this._configuration.childrenMaxAge]})):void 0),$("<span />",{class:"fb-occupancy-selection-futurist-select theme-select "+(childrenIsError?"fb-error":"")}).append(childrenSelectEl,isCurrentBrowserSupportingChevronWithSelect()?$("<i />",{class:"fa fa-chevron-down theme-btn"}):void 0)),childrenSelectEl.on("change",function(event){room.nbChildren=parseInt($(event.currentTarget).val(),10),this._digest()}.bind(this)),!this._configuration.needChildrenAges||!room.nbChildren)return childrenRootEl;var childrenAgesEl=$("<div />",{class:"fb-occupancy-selection-room-children-ages"}),childrenAgesSelectors=$("<div />",{class:"fb-occupancy-selection-room-children-ages-selectors"});return childrenAgesSelectors.append(_.times(Math.min(room.nbChildren,this._configuration.maxChildren),function(childrenIndex){var childrenAgeNotSelectableValue,childrenAgeValues=_.times(this._configuration.childrenMaxAge+1,function(i){return i});null!==room.childrenAges[childrenIndex]&&-1===childrenAgeValues.indexOf(room.childrenAges[childrenIndex])&&(childrenAgeNotSelectableValue=room.childrenAges[childrenIndex],childrenAgeValues.push(room.childrenAges[childrenIndex]));var childrenAgeSelectEl=$("<select />").append(null===room.childrenAges[childrenIndex]?$("<option />",{text:"-"}):void 0,childrenAgeValues.map(function(childrenAge){return $("<option />",{text:childrenAge,selected:room.childrenAges[childrenIndex]===childrenAge,class:childrenAgeNotSelectableValue===childrenAge?"fb-error":"",disabled:childrenAgeNotSelectableValue===childrenAge})}.bind(this)));childrenAgeSelectEl.on("change",function(event){room.childrenAges[childrenIndex]=parseInt($(event.currentTarget).val(),10),this._digest()}.bind(this));var isError=roomValidation.childrenAges.items[childrenIndex].hasError&&this._showErrors;return $("<span />",{class:"fb-occupancy-selection-futurist-select theme-select "+(isError?"fb-error":"")}).append(childrenAgeSelectEl,isCurrentBrowserSupportingChevronWithSelect()?$("<i />",{class:"fa fa-chevron-down theme-btn"}):void 0)}.bind(this))),childrenAgesEl.append($("<div />",{class:"fb-occupancy-selection-room-children-ages-label"}).append($.fb("crs-helper-translate",{key:"fb-occupancy-selection-children-age",mode:room.nbChildren})),childrenAgesSelectors,roomValidation.childrenAges.hasError&&this._showErrors?$("<p />",{class:"fb-occupancy-selection-error-message fb-error"}).append($.fb("crs-helper-translate",{key:"error-select-age-child",mode:room.nbChildren,placeholders:[this._configuration.childrenMaxAge]})):void 0),childrenRootEl.append(childrenAgesEl),childrenRootEl}},_createNewAddRoomBtnView:function(){if(!(this._selection.length>=this._configuration.maxRooms)){var btnRootEl=$("<div />",{class:"fb-occupancy-selection-add-btn-container"}),btnEl=$("<button />",{class:"theme-btn-inverse fb-occupancy-selection-add-btn"}).append($("<span />",{text:"+ "}),$.fb("crs-helper-translate",{key:$.fb("crs-helper-translateByAccommodationType",{defKey:"quicksearch-add-room"})}));return btnRootEl.append(btnEl),btnEl.on("click",function(){this._selection.push({nbAdults:1,nbChildren:0,childrenAges:[]}),this._digest()}.bind(this)),btnRootEl}},_createNewFooterBtnsView:function(){var $footerRootEl=$("<div />",{class:"fb-occupancy-selection-footer"}),cancelLink=$("<a />",{class:"theme-link fb-occupancy-selection-footer-cancel",href:"javascript:void(0)"}).append($.fb("crs-helper-translate",{key:"cancel-button-text"})),applyButton=$("<button />",{class:"btn fb-action fb-font-bold theme-btn fb-occupancy-selection-footer-apply"}).append($.fb("crs-helper-translate",{key:"quicksearch-apply-criterias"}));return applyButton.on("click",function(){if(!this.isSelectionValid())return this._showErrors=!0,void this._digest();this.trigger(new $.Event("apply",{selection:this.getSelection()}))}.bind(this)),cancelLink.on("click",function(){this.trigger(new $.Event("cancel",{}))}.bind(this)),$footerRootEl.append(this._configuration.showCancelLink?cancelLink:void 0,this._configuration.showApplyBtn?applyButton:void 0),$footerRootEl}},EventEmitter.prototype),window.$fb.OccupancySelection=OccupancySelection}(window.jQuery,window.$fb.underscore),function($,$fb,_){function LoyaltyLoginIframe(iframeUrl){this._iframeUrl=iframeUrl,this._rootNode=null,this._messageHandler=_messageHandler.bind(this)}LoyaltyLoginIframe.prototype=_.extend({render:function(){this._rootNode||this._mount();return this._rootNode},destroy:function(){this._rootNode&&this._umount();Object.keys(LoyaltyLoginIframe.prototype).forEach(function(methodName){this[methodName]=function(){throw new Error("Object destroyed")}})},_mount:function(){window.addEventListener("message",this._messageHandler,!1),this._rootNode=$(template).children("iframe").attr("src",this._iframeUrl).end()},_umount:function(){this._rootNode.remove(),window.removeEventListener("message",this._messageHandler,!1),this.off("cancelled"),this.off("logged")},_messageHandler:_messageHandler},EventEmitter.prototype),$fb.LoyaltyLoginIframe=LoyaltyLoginIframe;var template='        <div class="container loyalty-login-iframe" style="width: 100%; height: 100%;">            <iframe style="border: none; width: 100%; height: 100%;"></iframe>        </div>    ';function _messageHandler(event){var isGoodOrigin=this._iframeUrl.match(/^https?:\/\/([^/]+)/)[0]===event.origin,isGoodIframe=this._rootNode.children("iframe").get(0).contentWindow===event.source;if(isGoodOrigin&&isGoodIframe){var data=event.data;if(null!==data&&"object"==typeof data&&data.event)switch(data.event){case"cancelled":this.trigger(new $.Event("cancelled"));break;case"logged":if(!data.authorization_code)return void $fb.warn('Received invalid event "logged" data message from my Iframe, skipped ; '+JSON.stringify(data));this.trigger(new $.Event("logged",{authorizationCode:data.authorization_code}));break;default:$fb.warn("Received invalid event data message from my Iframe, skipped ; "+JSON.stringify(data.event))}else $fb.warn("Received invalid data message from my Iframe, skipped ; "+JSON.stringify(data))}else $fb.notice("Received message not from my Iframe, skipped ; "+JSON.stringify({isGoodIframe:isGoodIframe,isGoodOrigin:isGoodOrigin}))}}(window.jQuery,window.$fb,window.$fb.underscore),function($,_){function BookingService(){}function getApiCallPayload(guaranteeData,collectEmailOptIn,paymentTypeData){var selectionData=$fb.selection.get(),buyer=$fb.selection.getBuyer();buyer.phone=buyer.phoneCode.toString()+buyer.phone.toString(),delete buyer.phoneCode;var selection={packages:selectionData.packages,services:selectionData.services,buyer:buyer,currency:selectionData.currency,locale:$fb._state.app.locale},currentLoyalty=$fb.loyalties&&$fb.loyalties.getCurrentLoyalty(),loyaltyToken=currentLoyalty&&currentLoyalty.isLogged()?currentLoyalty.getLoyaltyToken():null;loyaltyToken&&_.each(selection.packages,function(package){_.find(package.package,function(pack){return pack.loyalty})&&(package.query.loyaltyToken=loyaltyToken)});var campaignData=function(selection){var data={ids:[],names:[]};return _.each(selection.packages,function(package){_.each(package.package,function(pack){pack.campaignId&&(data.ids.push(pack.campaignId),pack.campaignName&&data.names.push(pack.campaignName))})}),0===data.ids.length?null:data}(selectionData);null!==campaignData&&(selection.campaignIds=campaignData.ids,selection.campaignNames=campaignData.names),paymentTypeData&&0<_.size(paymentTypeData)&&(selection.paymentType=paymentTypeData),selectionData.payer&&selectionData.payer.lastName&&selectionData.payer.firstName&&(selection.payer=selectionData.payer);var result={c:"booking",property:$fb._state.quicksearch.property,selection:selection,guarantee:guaranteeData,context:function(collectEmailOptIn,selectionHasACampaign){var context={cookies:function(str){str=str.split(";");var result={};try{for(var i=0;i<str.length;i++){var cur=str[i].split("=");result[cur[0].trim()]=cur[1].trim()}}catch(e){}return result}(document.cookie),currency:$fb._state.app.currency,tracking:{}};$fb.selection.getSmsWanted()&&(context.sms=!0);var mailChimp=$fb._state.app.data.properties[$fb._state.quicksearch.property].configuration.mailChimp;null!=mailChimp&&(context.mailChimp=mailChimp);void 0!==collectEmailOptIn&&(context.collectEmailOptIn=collectEmailOptIn);void 0!==$fb._state.clickId&&(context.tracking.ClickId=$fb._state.clickId);void 0!==$fb._state.quicksearch.accesscode&&""!==$fb._state.quicksearch.accesscode&&("CAMP-"!==$fb._state.quicksearch.accesscode.substr(0,5)||selectionHasACampaign)&&(context.accessCode=$fb._state.quicksearch.accesscode);return $.extend(!0,context,function(){var context={},currentLoyalty=$fb.loyalties&&$fb.loyalties.getCurrentLoyalty();if(currentLoyalty&&currentLoyalty.isLogged()){context.loyalty={type:currentLoyalty.getCode(),loyaltyToken:currentLoyalty.getLoyaltyToken(),member:currentLoyalty.getMember()};var bookingContext=currentLoyalty.getBookingContext();bookingContext&&(context[currentLoyalty.getType()]=bookingContext)}return context}()),context}(collectEmailOptIn,void 0!==selection.campaignIds)};return $fb._state.trackFrom&&(result.trackFrom=$fb._state.trackFrom),result}function sendMailChimpInfos(){var mailChimp=$fb._state.app.data.properties[$fb._state.quicksearch.property].configuration.mailChimp,selection=$fb.selection.get();if(selection.locale=$fb._state.app.locale,null!=mailChimp&&mailChimp.on){var apiConfig={c:"mailChimp",property:$fb._state.quicksearch.property,propertyTitle:$fb._state.app.data.properties[$fb._state.quicksearch.property].title,selection:selection,context:{mailChimp:mailChimp}};$fb._api(apiConfig,function(){})}}function buildBookingHash(hid,confirmation,email){return $fb._hash(hid+"_"+confirmation+"_"+email)}function updateStateOnBookingCreationSuccess(hid,confirmation,selection){$fb._state.app.booking.confirmation=confirmation,$fb._state.app.booking.selection=selection,$fb._state.app.booking.hash=buildBookingHash(hid,confirmation,selection.buyer.email)}function sendTrackingDataOnCreationSuccess(confirmation,email){$.fb("crs-tracking-send",["/Booking/Confirmation",confirmation]),$.fb("crs-tracking-ecommerce",{email:email,confirmation:confirmation}),$.fb("crs-tracking-send","/booking-confirmed")}BookingService.prototype={get:function(propertyId,bookingId,publicOnly,bhIfNotPublicOnly){return $fb.callApi("bookings",{property:propertyId,confirmation:bookingId,publicOnly:publicOnly,bh:bhIfNotPublicOnly})},getApiCallPayload:getApiCallPayload,handleApiErrorOnCreation:function(apiErrorMessage){try{var messageData=JSON.parse(apiErrorMessage)}catch(e){return $fb._state.lastAPIError="API unreachable",void $fb._triggerEvent("fastbooking-crs-frontend-modal",{title:$.fb("crs-helper-translate",{key:"error-application-error"}).text(),message:$.fb("crs-helper-translate",{key:"error-application-error"}).text()})}var errorMessage;if(messageData.codes)errorMessage=messageData.codes,$.fb("crs-error-display",{c:messageData.codes,ns:"booking-save",title:"errror-booking-title"});else if(messageData.i18nLabels){var modal={};messageData.i18nLabels.title&&(modal.title=$.fb("crs-helper-translate",{key:messageData.i18nLabels.title}).text()),messageData.i18nLabels.message&&(modal.message=$.fb("crs-helper-translate",{key:messageData.i18nLabels.message}).text()),messageData.redirectTo&&(modal.onClosed=$fb.redirectHelper.getRedirectionFunction(messageData.redirectTo)),errorMessage=modal.message||messageData.title||"API unreachable",$fb._triggerEvent("fastbooking-crs-frontend-modal",modal)}$fb._state.lastAPIError=errorMessage},sendTrackingDataOnCreationSuccess:sendTrackingDataOnCreationSuccess,updateStateOnBookingCreationSuccess:updateStateOnBookingCreationSuccess,buildBookingHash:buildBookingHash,createWithPaymentServices:function(guaranteeData,collectEmailOptIn){var apiConfig=getApiCallPayload({},collectEmailOptIn,{});return $fb.log("Booking request with payment services",apiConfig.selection),$fb.callApi(apiConfig.c,apiConfig).then(function(json){return $fb.info("booking call result: ",json),updateStateOnBookingCreationSuccess($fb._state.quicksearch.property,json.confirmation,apiConfig.selection),sendMailChimpInfos(),sendTrackingDataOnCreationSuccess(json.confirmation,apiConfig.selection.buyer.email),function(confirmation,guaranteeData){return $fb.callApi("avpPaymentServices",{property:$fb._state.quicksearch.property,confirmation:confirmation,guarantee:guaranteeData}).then(function(json){$fb.info("result of payment services request",json)})}(json.confirmation,guaranteeData)})},sendMailChimpInfos:sendMailChimpInfos},window.$fb.bookingService=new BookingService}(window.jQuery,window.$fb.underscore),function(root,factory){"function"==typeof define&&define.amd?define(factory):"object"==typeof module&&"object"==typeof module.exports?module.exports=factory():root.Cldr=factory()}(this,function(){var merge,arrayIsArray=Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},pathNormalize=function(path,attributes){if(arrayIsArray(path)&&(path=path.join("/")),"string"!=typeof path)throw new Error('invalid path "'+path+'"');return(path=(path=path.replace(/^\//,"").replace(/^cldr\//,"")).replace(/{[a-zA-Z]+}/g,function(name){return name=name.replace(/^{([^}]*)}$/,"$1"),attributes[name]})).split("/")},arraySome=function(array,callback){var i,length;if(array.some)return array.some(callback);for(i=0,length=array.length;i<length;i++)if(callback(array[i],i,array))return!0;return!1},coreLikelySubtags=function(Cldr,cldr,subtags,options){var match,language=subtags[0],script=subtags[1],sep=Cldr.localeSep,territory=subtags[2],variants=subtags.slice(3,4);return options=options||{},"und"!==language&&"Zzzz"!==script&&"ZZ"!==territory?[language,script,territory].concat(variants):void 0!==cldr.get("supplemental/likelySubtags")?arraySome([[language,script,territory],[language,territory],[language,script],[language],["und",script]],function(test){return match=!/\b(Zzzz|ZZ)\b/.test(test.join(sep))&&cldr.get(["supplemental/likelySubtags",test.join(sep)])})?(match=match.split(sep),["und"!==language?language:match[0],"Zzzz"!==script?script:match[1],"ZZ"!==territory?territory:match[2]].concat(variants)):options.force?cldr.get("supplemental/likelySubtags/und").split(sep):void 0:void 0},coreRemoveLikelySubtags=function(Cldr,cldr,maxLanguageId){var match,language=maxLanguageId[0],script=maxLanguageId[1],territory=maxLanguageId[2],variants=maxLanguageId[3];return arraySome([[[language,"Zzzz","ZZ"],[language]],[[language,"Zzzz",territory],[language,territory]],[[language,script,"ZZ"],[language,script]]],function(test){var result=coreLikelySubtags(Cldr,cldr,test[0]);return match=test[1],result&&result[0]===maxLanguageId[0]&&result[1]===maxLanguageId[1]&&result[2]===maxLanguageId[2]})?(variants&&match.push(variants),match):maxLanguageId},coreSubtags=function(locale){var aux,subtags=[];return(aux=(locale=locale.replace(/_/,"-")).split("-u-"))[1]&&(aux[1]=aux[1].split("-t-"),locale=aux[0]+(aux[1][1]?"-t-"+aux[1][1]:""),subtags[4]=aux[1][0]),null===(aux=locale.split("-t-")[0].match(/^(([a-z]{2,3})(-([A-Z][a-z]{3}))?(-([A-Z]{2}|[0-9]{3}))?)((-([a-zA-Z0-9]{5,8}|[0-9][a-zA-Z0-9]{3}))*)$|^(root)$/))?["und","Zzzz","ZZ"]:(subtags[0]=aux[10]||aux[2]||"und",subtags[1]=aux[4]||"Zzzz",subtags[2]=aux[6]||"ZZ",aux[7]&&aux[7].length&&(subtags[3]=aux[7].slice(1)),subtags)},arrayForEach=function(array,callback){var i,length;if(array.forEach)return array.forEach(callback);for(i=0,length=array.length;i<length;i++)callback(array[i],i,array)},createError=function(code,attributes){var error,message;return message=code+(attributes&&JSON?": "+JSON.stringify(attributes):""),(error=new Error(message)).code=code,arrayForEach(function(object){var i,result=[];if(Object.keys)return Object.keys(object);for(i in object)result.push(i);return result}(attributes),function(attribute){error[attribute]=attributes[attribute]}),error},validate=function(code,check,attributes){if(!check)throw createError(code,attributes)},validatePresence=function(value,name){validate("E_MISSING_PARAMETER",void 0!==value,{name:name})},validateType=function(value,name,check,expected){validate("E_INVALID_PAR_TYPE",check,{expected:expected,name:name,value:value})},validateTypePath=function(value,name){validateType(value,name,"string"==typeof value||arrayIsArray(value),"String or Array")},validateTypePlainObject=function(value,name){var obj;validateType(value,name,void 0===value||null!==(obj=value)&&""+obj=="[object Object]","Plain Object")},resourceGet=function(data,path){var i,node=data,length=path.length;for(i=0;i<length-1;i++)if(!(node=node[path[i]]))return;return node[path[i]]},coreSetAvailableBundles=function(Cldr,json){var bundle,availableBundleMapQueue=Cldr._availableBundleMapQueue,main=resourceGet(json,["main"]);if(main)for(bundle in main)main.hasOwnProperty(bundle)&&"root"!==bundle&&-1===availableBundleMapQueue.indexOf(bundle)&&availableBundleMapQueue.push(bundle)},alwaysArray=function(somethingOrArray){return arrayIsArray(somethingOrArray)?somethingOrArray:[somethingOrArray]},jsonMerge=merge=function(){var destination={},sources=[].slice.call(arguments,0);return arrayForEach(sources,function(source){var prop;for(prop in source)prop in destination&&"object"==typeof destination[prop]&&!arrayIsArray(destination[prop])?destination[prop]=merge(destination[prop],source[prop]):destination[prop]=source[prop]}),destination},coreLoad=function(Cldr,source,jsons){var i,j,json;for(validatePresence(jsons[0],"json"),i=0;i<jsons.length;i++)for(json=alwaysArray(jsons[i]),j=0;j<json.length;j++)validateTypePlainObject(json[j],"json"),source=jsonMerge(source,json[j]),coreSetAvailableBundles(Cldr,json[j]);return source},itemGetResolved=function(Cldr,path,attributes){var normalizedPath=pathNormalize(path,attributes);return resourceGet(Cldr._resolved,normalizedPath)},Cldr=function(locale){this.init(locale)};return Cldr._alwaysArray=alwaysArray,Cldr._coreLoad=coreLoad,Cldr._createError=createError,Cldr._itemGetResolved=itemGetResolved,Cldr._jsonMerge=jsonMerge,Cldr._pathNormalize=pathNormalize,Cldr._resourceGet=resourceGet,Cldr._validatePresence=validatePresence,Cldr._validateType=validateType,Cldr._validateTypePath=validateTypePath,Cldr._validateTypePlainObject=validateTypePlainObject,Cldr._availableBundleMap={},Cldr._availableBundleMapQueue=[],Cldr._resolved={},Cldr.localeSep="-",Cldr.load=function(){Cldr._resolved=coreLoad(Cldr,Cldr._resolved,arguments)},Cldr.prototype.init=function(locale){var attributes,language,maxLanguageId,minLanguageId,script,subtags,territory,unicodeLocaleExtensions,variant,value,sep=Cldr.localeSep,unicodeLocaleExtensionsRaw="";validatePresence(locale,"locale"),validateType(value=locale,"locale","string"==typeof value,"a string"),5===(subtags=coreSubtags(locale)).length&&(unicodeLocaleExtensionsRaw=sep+"u"+sep+(unicodeLocaleExtensions=subtags.pop()),subtags[3]||subtags.pop()),variant=subtags[3],language=(maxLanguageId=coreLikelySubtags(Cldr,this,subtags,{force:!0})||subtags)[0],script=maxLanguageId[1],territory=maxLanguageId[2],minLanguageId=coreRemoveLikelySubtags(Cldr,this,maxLanguageId).join(sep),this.attributes=attributes={bundle:function(Cldr,cldr,minLanguageId){var availableBundleMap=Cldr._availableBundleMap,availableBundleMapQueue=Cldr._availableBundleMapQueue;return availableBundleMapQueue.length&&(arrayForEach(availableBundleMapQueue,function(bundle){var existing,maxBundle,minBundle,subtags;subtags=coreSubtags(bundle),maxBundle=coreLikelySubtags(Cldr,cldr,subtags),minBundle=(minBundle=coreRemoveLikelySubtags(Cldr,cldr,maxBundle)).join(Cldr.localeSep),(existing=availableBundleMap[minBundle])&&existing.length<bundle.length||(availableBundleMap[minBundle]=bundle)}),Cldr._availableBundleMapQueue=[]),availableBundleMap[minLanguageId]||null}(Cldr,this,minLanguageId),minLanguageId:minLanguageId+unicodeLocaleExtensionsRaw,maxLanguageId:maxLanguageId.join(sep)+unicodeLocaleExtensionsRaw,language:language,script:script,territory:territory,region:territory,variant:variant},unicodeLocaleExtensions&&("-"+unicodeLocaleExtensions).replace(/-[a-z]{3,8}|(-[a-z]{2})-([a-z]{3,8})/g,function(attribute,key,type){key?attributes["u"+key]=type:attributes["u"+attribute]=!0}),this.locale=locale},Cldr.prototype.get=function(path){return validatePresence(path,"path"),validateTypePath(path,"path"),itemGetResolved(Cldr,path,this.attributes)},Cldr.prototype.main=function(path){return validatePresence(path,"path"),validateTypePath(path,"path"),validate("E_MISSING_BUNDLE",null!==this.attributes.bundle,{locale:this.locale}),path=alwaysArray(path),this.get(["main/{bundle}"].concat(path))},Cldr}),function(factory){"function"==typeof define&&define.amd?define(["../cldr"],factory):"object"==typeof module&&"object"==typeof module.exports?module.exports=factory(require("../cldr")):factory(Cldr)}(function(Cldr){var EventEmitter,pathNormalize=Cldr._pathNormalize,validatePresence=Cldr._validatePresence,validateType=Cldr._validateType;EventEmitter=function(){function EventEmitter(){}var proto=EventEmitter.prototype,exports={};function indexOfListener(listeners,listener){for(var i=listeners.length;i--;)if(listeners[i].listener===listener)return i;return-1}function alias(name){return function(){return this[name].apply(this,arguments)}}return proto.getListeners=function(evt){var response,key,events=this._getEvents();if(evt instanceof RegExp)for(key in response={},events)events.hasOwnProperty(key)&&evt.test(key)&&(response[key]=events[key]);else response=events[evt]||(events[evt]=[]);return response},proto.flattenListeners=function(listeners){var i,flatListeners=[];for(i=0;i<listeners.length;i+=1)flatListeners.push(listeners[i].listener);return flatListeners},proto.getListenersAsObject=function(evt){var response,listeners=this.getListeners(evt);return listeners instanceof Array&&((response={})[evt]=listeners),response||listeners},proto.addListener=function(evt,listener){var key,listeners=this.getListenersAsObject(evt),listenerIsWrapped="object"==typeof listener;for(key in listeners)listeners.hasOwnProperty(key)&&-1===indexOfListener(listeners[key],listener)&&listeners[key].push(listenerIsWrapped?listener:{listener:listener,once:!1});return this},proto.on=alias("addListener"),proto.addOnceListener=function(evt,listener){return this.addListener(evt,{listener:listener,once:!0})},proto.once=alias("addOnceListener"),proto.defineEvent=function(evt){return this.getListeners(evt),this},proto.defineEvents=function(evts){for(var i=0;i<evts.length;i+=1)this.defineEvent(evts[i]);return this},proto.removeListener=function(evt,listener){var index,key,listeners=this.getListenersAsObject(evt);for(key in listeners)listeners.hasOwnProperty(key)&&-1!==(index=indexOfListener(listeners[key],listener))&&listeners[key].splice(index,1);return this},proto.off=alias("removeListener"),proto.addListeners=function(evt,listeners){return this.manipulateListeners(!1,evt,listeners)},proto.removeListeners=function(evt,listeners){return this.manipulateListeners(!0,evt,listeners)},proto.manipulateListeners=function(remove,evt,listeners){var i,value,single=remove?this.removeListener:this.addListener,multiple=remove?this.removeListeners:this.addListeners;if("object"!=typeof evt||evt instanceof RegExp)for(i=listeners.length;i--;)single.call(this,evt,listeners[i]);else for(i in evt)evt.hasOwnProperty(i)&&(value=evt[i])&&("function"==typeof value?single.call(this,i,value):multiple.call(this,i,value));return this},proto.removeEvent=function(evt){var key,type=typeof evt,events=this._getEvents();if("string"===type)delete events[evt];else if(evt instanceof RegExp)for(key in events)events.hasOwnProperty(key)&&evt.test(key)&&delete events[key];else delete this._events;return this},proto.removeAllListeners=alias("removeEvent"),proto.emitEvent=function(evt,args){var listener,i,key,listeners=this.getListenersAsObject(evt);for(key in listeners)if(listeners.hasOwnProperty(key))for(i=listeners[key].length;i--;)!0===(listener=listeners[key][i]).once&&this.removeListener(evt,listener.listener),listener.listener.apply(this,args||[])===this._getOnceReturnValue()&&this.removeListener(evt,listener.listener);return this},proto.trigger=alias("emitEvent"),proto.emit=function(evt){var args=Array.prototype.slice.call(arguments,1);return this.emitEvent(evt,args)},proto.setOnceReturnValue=function(value){return this._onceReturnValue=value,this},proto._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},proto._getEvents=function(){return this._events||(this._events={})},EventEmitter.noConflict=function(){return exports.EventEmitter=originalGlobalValue,EventEmitter},EventEmitter}();var superGet,superInit,validateTypeFunction=function(value,name){validateType(value,name,void 0===value||"function"==typeof value,"Function")},globalEe=new EventEmitter;function validateThenCall(method,self){return function(event,listener){var value;return validatePresence(event,"event"),validateType(value=event,"event","string"==typeof value||value instanceof RegExp,"String or RegExp"),validatePresence(listener,"listener"),validateTypeFunction(listener,"listener"),self[method].apply(self,arguments)}}function off(self){return validateThenCall("off",self)}function on(self){return validateThenCall("on",self)}function once(self){return validateThenCall("once",self)}function getOverload(){superGet=Cldr.prototype.get,Cldr.prototype.get=function(path){var value=superGet.apply(this,arguments);return path=pathNormalize(path,this.attributes).join("/"),globalEe.trigger("get",[path,value]),this.ee.trigger("get",[path,value]),value}}return Cldr.off=off(globalEe),Cldr.on=on(globalEe),Cldr.once=once(globalEe),superInit=Cldr.prototype.init,Cldr.prototype.init=function(){var ee;this.ee=ee=new EventEmitter,this.off=off(ee),this.on=on(ee),this.once=once(ee),superInit.apply(this,arguments)},(Cldr._eventInit=getOverload)(),Cldr}),function(factory){"function"==typeof define&&define.amd?define(["../cldr"],factory):"object"==typeof module&&"object"==typeof module.exports?module.exports=factory(require("../cldr")):factory(Cldr)}(function(Cldr){var alwaysArray=Cldr._alwaysArray,initSuper=Cldr.prototype.init;return Cldr.prototype.init=function(){var cldr,prepend,supplemental;initSuper.apply(this,arguments),this.supplemental=(cldr=this,(supplemental=(prepend=function(prepend){return function(path){return path=alwaysArray(path),cldr.get([prepend].concat(path))}})("supplemental")).weekData=prepend("supplemental/weekData"),supplemental.weekData.firstDay=function(){return cldr.get("supplemental/weekData/firstDay/{territory}")||cldr.get("supplemental/weekData/firstDay/001")},supplemental.weekData.minDays=function(){var minDays=cldr.get("supplemental/weekData/minDays/{territory}")||cldr.get("supplemental/weekData/minDays/001");return parseInt(minDays,10)},supplemental.timeData=prepend("supplemental/timeData"),supplemental.timeData.allowed=function(){return cldr.get("supplemental/timeData/{territory}/_allowed")||cldr.get("supplemental/timeData/001/_allowed")},supplemental.timeData.preferred=function(){return cldr.get("supplemental/timeData/{territory}/_preferred")||cldr.get("supplemental/timeData/001/_preferred")},supplemental)},Cldr}),function(root,factory){"function"==typeof define&&define.amd?define(["cldr","cldr/event"],factory):"object"==typeof exports?module.exports=factory(require("cldrjs")):root.Globalize=factory(root.Cldr)}(this,function(Cldr){var formatMessage=function(message,data){return message=message.replace(/{[0-9a-zA-Z-_. ]+}/g,function(name){return name=name.replace(/^{([^}]*)}$/,"$1"),"string"==typeof(variable=data[name])?variable:"number"==typeof variable?""+variable:JSON.stringify(variable);var variable})},objectExtend=function(){var destination=arguments[0];return[].slice.call(arguments,1).forEach(function(source){var prop;for(prop in source)destination[prop]=source[prop]}),destination},createError=function(code,message,attributes){var error;return message=code+(message?": "+formatMessage(message,attributes):""),(error=new Error(message)).code=code,objectExtend(error,attributes),error},runtimeStringify=function(args){return JSON.stringify(args,function(key,value){return value&&value.runtimeKey?value.runtimeKey:value})},validate=function(code,message,check,attributes){if(!check)throw createError(code,message,attributes)},alwaysArray=function(stringOrArray){return Array.isArray(stringOrArray)?stringOrArray:stringOrArray?[stringOrArray]:[]},validateCldr=function(path,value,options){var skipBoolean;skipBoolean=alwaysArray((options=options||{}).skip).some(function(pathRe){return pathRe.test(path)}),validate("E_MISSING_CLDR","Missing required CLDR content `{path}`.",value||skipBoolean,{path:path})},validateParameterPresence=function(value,name){validate("E_MISSING_PARAMETER","Missing required parameter `{name}`.",void 0!==value,{name:name})},validateParameterType=function(value,name,check,expected){validate("E_INVALID_PAR_TYPE","Invalid `{name}` parameter ({value}). {expected} expected.",check,{expected:expected,name:name,value:value})},validateParameterTypeLocale=function(value,name){validateParameterType(value,name,void 0===value||"string"==typeof value||value instanceof Cldr,"String or Cldr instance")},isPlainObject=function(obj){return null!==obj&&""+obj=="[object Object]"},alwaysCldr=function(localeOrCldr){return localeOrCldr instanceof Cldr?localeOrCldr:new Cldr(localeOrCldr)};function validateLikelySubtags(cldr){cldr.once("get",validateCldr),cldr.get("supplemental/likelySubtags")}function Globalize(locale){if(!(this instanceof Globalize))return new Globalize(locale);validateParameterPresence(locale,"locale"),validateParameterTypeLocale(locale,"locale"),this.cldr=alwaysCldr(locale),validateLikelySubtags(this.cldr)}return Globalize.load=function(){Cldr.load.apply(Cldr,arguments)},Globalize.locale=function(locale){return validateParameterTypeLocale(locale,"locale"),arguments.length&&(this.cldr=alwaysCldr(locale),validateLikelySubtags(this.cldr)),this.cldr},Globalize._alwaysArray=alwaysArray,Globalize._createError=createError,Globalize._formatMessage=formatMessage,Globalize._isPlainObject=isPlainObject,Globalize._objectExtend=objectExtend,Globalize._regexpEscape=function(string){return string.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},Globalize._runtimeBind=function(args,cldr,fn,runtimeArgs){var argsStr=runtimeStringify(args),fnName=function(fn){if(void 0!==fn.name)return fn.name;var matches=/^function\s+([\w\$]+)\s*\(/.exec(fn.toString());return matches&&0<matches.length?matches[1]:void 0}(fn),locale=cldr.locale;return fnName&&(fn.runtimeKey=function(fnName,locale,args,argsStr){var hash,str;return argsStr=argsStr||runtimeStringify(args),str=fnName+locale+argsStr,0<(hash=[].reduce.call(str,function(hash,i){return 0|(hash=(hash<<5)-hash+i.charCodeAt(0))},0))?"a"+hash:"b"+Math.abs(hash)}(fnName,locale,null,argsStr),fn.generatorString=function(){return'Globalize("'+locale+'").'+fnName+"("+argsStr.slice(1,-1)+")"},fn.runtimeArgs=runtimeArgs),fn},Globalize._stringPad=function(str,count,right){var length;for("string"!=typeof str&&(str=String(str)),length=str.length;length<count;length+=1)str=right?str+"0":"0"+str;return str},Globalize._validate=validate,Globalize._validateCldr=validateCldr,Globalize._validateDefaultLocale=function(value){validate("E_DEFAULT_LOCALE_NOT_DEFINED","Default locale has not been defined.",void 0!==value,{})},Globalize._validateParameterPresence=validateParameterPresence,Globalize._validateParameterRange=function(value,name,minimum,maximum){validate("E_PAR_OUT_OF_RANGE","Parameter `{name}` has value `{value}` out of range [{minimum}, {maximum}].",void 0===value||minimum<=value&&value<=maximum,{maximum:maximum,minimum:minimum,name:name,value:value})},Globalize._validateParameterTypePlainObject=function(value,name){validateParameterType(value,name,void 0===value||isPlainObject(value),"Plain Object")},Globalize._validateParameterType=validateParameterType,Globalize}),function(root,factory){"function"==typeof define&&define.amd?define(["cldr","../globalize","cldr/event","cldr/supplemental"],factory):"object"==typeof exports?module.exports=factory(require("cldrjs"),require("../globalize")):factory(root.Cldr,root.Globalize)}(this,function(Cldr,Globalize){var createError=Globalize._createError,regexpEscape=Globalize._regexpEscape,runtimeBind=Globalize._runtimeBind,stringPad=Globalize._stringPad,validateCldr=Globalize._validateCldr,validateDefaultLocale=Globalize._validateDefaultLocale,validateParameterPresence=Globalize._validateParameterPresence,validateParameterRange=Globalize._validateParameterRange,validateParameterType=Globalize._validateParameterType,validateParameterTypePlainObject=Globalize._validateParameterTypePlainObject,createErrorUnsupportedFeature=function(feature){return createError("E_UNSUPPORTED","Unsupported {feature}.",{feature:feature})},validateParameterTypeNumber=function(value,name){validateParameterType(value,name,void 0===value||"number"==typeof value,"Number")},validateParameterTypeString=function(value,name){validateParameterType(value,name,void 0===value||"string"==typeof value,"a string")},numberCompactPatternRe=/^([^0]*)(0+)([^0]*)$/,numberToPrecision=function(number,precision,round){var roundOrder;return roundOrder=Math.ceil(Math.log(Math.abs(number))/Math.log(10)),round(number,{exponent:roundOrder-=precision})},numberPatternRe=/^(('([^']|'')*'|[^*#@0,.E])*)(\*.)?((([#,]*[0,]*0+)(\.0*[0-9]*#*)?)|([#,]*@+#*))(E\+?0+)?(('[^']+'|''|[^*#@0,.E])*)$/,removeLiteralQuotes=function(string){return string[0]+string[string.length-1]!=="''"?string:"''"===string?"":string.replace(/''/g,"'").slice(1,-1)},numberFormat=function(number,properties,pluralGenerator){var compactMap,infinitySymbol,maximumFractionDigits,maximumSignificantDigits,minimumFractionDigits,minimumIntegerDigits,minimumSignificantDigits,nanSymbol,nuDigitsMap,prefix,primaryGroupingSize,pattern,ret,round,roundIncrement,secondaryGroupingSize,suffix,symbolMap,compactPattern,compactProperties,divisor,numberExponent,pluralForm;return properties[1],minimumIntegerDigits=properties[2],minimumFractionDigits=properties[3],maximumFractionDigits=properties[4],minimumSignificantDigits=properties[5],maximumSignificantDigits=properties[6],roundIncrement=properties[7],primaryGroupingSize=properties[8],secondaryGroupingSize=properties[9],round=properties[15],infinitySymbol=properties[16],nanSymbol=properties[17],symbolMap=properties[18],nuDigitsMap=properties[19],compactMap=properties[20],isNaN(number)?nanSymbol:(suffix=number<0?(pattern=properties[12],prefix=properties[13],properties[14]):(pattern=properties[11],prefix=properties[0],properties[10]),isFinite(number)?(-1!==pattern.indexOf("%")?number*=100:-1!==pattern.indexOf("")&&(number*=1e3),compactMap&&(numberExponent=Math.abs(Math.floor(number)).toString().length-1,3<=(numberExponent=Math.min(numberExponent,compactMap.maxExponent))&&(compactPattern=compactMap[numberExponent]&&compactMap[numberExponent].other),"0"===compactPattern?compactPattern=null:compactPattern&&(divisor=numberExponent-(compactPattern.split("0").length-1-1),number/=Math.pow(10,divisor))),number=isNaN(minimumSignificantDigits*maximumSignificantDigits)?function(number,minimumIntegerDigits,minimumFractionDigits,maximumFractionDigits,round,roundIncrement){return number=maximumFractionDigits?round(number,roundIncrement||{exponent:-maximumFractionDigits}):round(number),number=String(number),maximumFractionDigits&&/e-/.test(number)&&(number=(+number).toFixed(maximumFractionDigits).replace(/0+$/,"").replace(/\.$/,"")),minimumFractionDigits&&((number=number.split("."))[1]=stringPad(number[1]||"",minimumFractionDigits,!0),number=number.join(".")),minimumIntegerDigits&&((number=number.split("."))[0]=stringPad(number[0],minimumIntegerDigits),number=number.join(".")),number}(number,minimumIntegerDigits,minimumFractionDigits,maximumFractionDigits,round,roundIncrement):function(number,minimumSignificantDigits,maximumSignificantDigits,round){var atMinimum,atMaximum;if(maximumSignificantDigits<minimumSignificantDigits&&(maximumSignificantDigits=minimumSignificantDigits),number=(+(number=+(atMinimum=numberToPrecision(number,minimumSignificantDigits,round))==+(atMaximum=numberToPrecision(number,maximumSignificantDigits,round))?atMinimum:atMaximum)).toString(10),/e/.test(number))throw createErrorUnsupportedFeature({feature:"integers out of (1e21, 1e-7)"});return 0<minimumSignificantDigits-number.replace(/^0+|\./g,"").length&&((number=number.split("."))[1]=stringPad(number[1]||"",minimumSignificantDigits-number[0].replace(/^0+/,"").length,!0),number=number.join(".")),number}(number,minimumSignificantDigits,maximumSignificantDigits,round),compactMap&&compactPattern&&(pluralForm=pluralGenerator?pluralGenerator(+number):"other",prefix+=(compactProperties=(compactPattern=compactMap[numberExponent][pluralForm]||compactPattern).match(numberCompactPatternRe))[1],suffix=compactProperties[3]+suffix),number=number.replace(/^-/,""),primaryGroupingSize&&(number=function(number,primaryGroupingSize,secondaryGroupingSize){var index,currentGroupingSize=primaryGroupingSize,ret="",switchToSecondary=!!secondaryGroupingSize;for(index=(number=String(number).split("."))[0].length;currentGroupingSize<index;)ret=number[0].slice(index-currentGroupingSize,index)+(ret.length?",":"")+ret,index-=currentGroupingSize,switchToSecondary&&(currentGroupingSize=secondaryGroupingSize,switchToSecondary=!1);return number[0]=number[0].slice(0,index)+(ret.length?",":"")+ret,number.join(".")}(number,primaryGroupingSize,secondaryGroupingSize)),ret=prefix,ret+=number,(ret+=suffix).replace(/('([^']|'')+'|'')|./g,function(character,literal){return literal?removeLiteralQuotes(literal):(character=character.replace(/[.,\-+E%\u2030]/,function(symbol){return symbolMap[symbol]}),nuDigitsMap&&(character=character.replace(/[0-9]/,function(digit){return nuDigitsMap[+digit]})),character)})):prefix+infinitySymbol+suffix)},numberNumberingSystem=function(cldr){var nu=cldr.attributes["u-nu"];return nu?("traditio"===nu&&(nu="traditional"),-1!==["native","traditional","finance"].indexOf(nu)?cldr.main(["numbers/otherNumberingSystems",nu]):nu):cldr.main("numbers/defaultNumberingSystem")},numberNumberingSystemDigitsMap=function(cldr){var aux,nu=numberNumberingSystem(cldr);if("latn"!==nu){if("numeric"!==(aux=cldr.supplemental(["numberingSystems",nu]))._type)throw createErrorUnsupportedFeature("`"+aux._type+"` numbering system");return aux._digits}},numberPatternProperties=function(pattern){var aux1,aux2,fractionPattern,integerFractionOrSignificantPattern,integerPattern,maximumFractionDigits,maximumSignificantDigits,minimumFractionDigits,minimumIntegerDigits,minimumSignificantDigits,padding,prefix,primaryGroupingSize,roundIncrement,scientificNotation,secondaryGroupingSize,significantPattern,suffix;if(!(pattern=pattern.match(numberPatternRe)))throw new Error("Invalid pattern: "+pattern);if(prefix=pattern[1],padding=pattern[4],integerFractionOrSignificantPattern=pattern[5],significantPattern=pattern[9],scientificNotation=pattern[10],suffix=pattern[11],significantPattern?significantPattern.replace(/(@+)(#*)/,function(match,minimumSignificantDigitsMatch,maximumSignificantDigitsMatch){minimumSignificantDigits=minimumSignificantDigitsMatch.length,maximumSignificantDigits=minimumSignificantDigits+maximumSignificantDigitsMatch.length}):(fractionPattern=pattern[8],integerPattern=pattern[7],maximumFractionDigits=fractionPattern?(fractionPattern.replace(/[0-9]+/,function(match){minimumFractionDigits=match}),minimumFractionDigits=minimumFractionDigits?(roundIncrement=+("0."+minimumFractionDigits),minimumFractionDigits.length):0,fractionPattern.length-1):minimumFractionDigits=0,integerPattern.replace(/0+$/,function(match){minimumIntegerDigits=match.length})),scientificNotation)throw createErrorUnsupportedFeature({feature:"scientific notation (not implemented)"});if(padding)throw createErrorUnsupportedFeature({feature:"padding (not implemented)"});return-1!==(aux1=integerFractionOrSignificantPattern.lastIndexOf(","))&&(primaryGroupingSize=(aux2=integerFractionOrSignificantPattern.split(".")[0]).length-aux1-1,-1!==(aux2=integerFractionOrSignificantPattern.lastIndexOf(",",aux1-1))&&(secondaryGroupingSize=aux1-1-aux2)),[prefix,padding,minimumIntegerDigits,minimumFractionDigits,maximumFractionDigits,minimumSignificantDigits,maximumSignificantDigits,roundIncrement,primaryGroupingSize,secondaryGroupingSize,suffix]},numberSymbol=function(name,cldr){return cldr.main(["numbers/symbols-numberSystem-"+numberNumberingSystem(cldr),name])},numberSymbolName={".":"decimal",",":"group","%":"percentSign","+":"plusSign","-":"minusSign",E:"exponential","":"perMille"},numberTruncate=function(value){return isNaN(value)?NaN:Math[value<0?"ceil":"floor"](value)},numberFormatProperties=function(pattern,cldr,options){var negativePattern,negativePrefix,negativeProperties,negativeSuffix,positivePattern,roundFn,properties,method;function getOptions(attribute,propertyIndex){attribute in options&&(properties[propertyIndex]=options[attribute])}return options=options||{},positivePattern=(pattern=pattern.split(";"))[0],negativePattern=pattern[1]||"-"+positivePattern,negativePrefix=(negativeProperties=numberPatternProperties(negativePattern))[0],negativeSuffix=negativeProperties[10],method="truncate"===(method=(method=options.round)||"round")?numberTruncate:Math[method],(roundFn=function(value,incrementOrExp){var exp,increment;if(value=+value,isNaN(value))return NaN;if("object"==typeof incrementOrExp&&incrementOrExp.exponent){if(increment=1,0==(exp=+incrementOrExp.exponent))return method(value);if("number"!=typeof exp||exp%1!=0)return NaN}else{if(1===(increment=+incrementOrExp||1))return method(value);if(isNaN(increment))return NaN;exp=+(increment=increment.toExponential().split("e"))[1],increment=+increment[0]}return(value=value.toString().split("e"))[0]=+value[0]/increment,value[1]=value[1]?+value[1]-exp:-exp,(value=(value=method(+(value[0]+"e"+value[1]))).toString().split("e"))[0]=+value[0]*increment,value[1]=value[1]?+value[1]+exp:exp,+(value[0]+"e"+value[1])}).generatorString=function(){return"numberRound("+(options.round?'"'+options.round+'"':"")+")"},properties=numberPatternProperties(positivePattern).concat([positivePattern,negativePrefix+positivePattern+negativeSuffix,negativePrefix,negativeSuffix,roundFn,numberSymbol("infinity",cldr),numberSymbol("nan",cldr),function(cldr){var symbol,symbolMap={};for(symbol in numberSymbolName)symbolMap[symbol]=numberSymbol(numberSymbolName[symbol],cldr);return symbolMap}(cldr),numberNumberingSystemDigitsMap(cldr)]),options.compact&&(properties[2]=1,properties[3]=0,properties[4]=0,properties[5]=properties[6]=void 0,properties[20]=function(compactType,cldr){var maxExponent=0,object=cldr.main(["numbers/decimalFormats-numberSystem-"+numberNumberingSystem(cldr),compactType,"decimalFormat"]);return(object=Object.keys(object).reduce(function(newObject,compactKey){var numberExponent=compactKey.split("0").length-1,pluralForm=compactKey.split("-")[2];return newObject[numberExponent]=newObject[numberExponent]||{},newObject[numberExponent][pluralForm]=object[compactKey],maxExponent=Math.max(numberExponent,maxExponent),newObject},{})).maxExponent=maxExponent,object}(options.compact,cldr)),getOptions("minimumIntegerDigits",2),getOptions("minimumFractionDigits",3),getOptions("maximumFractionDigits",4),getOptions("minimumSignificantDigits",5),getOptions("maximumSignificantDigits",6),!1===options.useGrouping&&(properties[8]=null),"minimumFractionDigits"in options&&!("maximumFractionDigits"in options)?properties[4]=Math.max(properties[3],properties[4]):!("minimumFractionDigits"in options)&&"maximumFractionDigits"in options&&(properties[3]=Math.min(properties[3],properties[4])),properties},regexpCfG=/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804\uDCBD|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/g,regexpDashG=/[\-\u058A\u05BE\u1400\u1806\u2010-\u2015\u2E17\u2E1A\u2E3A\u2E3B\u2E40\u301C\u3030\u30A0\uFE31\uFE32\uFE58\uFE63\uFF0D\u2212]/g,regexpZsG=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/g,looseMatching=function(value){return value.replace(regexpCfG,"").replace(regexpDashG,"-").replace(regexpZsG," ")},numberParse=function(value,properties){var grammar,invertedNuDigitsMap,invertedSymbolMap,negative,number,prefix,prefixNSuffix,suffix,tokenizer;return grammar=[["nan"],["prefix","infinity","suffix"],["prefix","number","suffix"],["negativePrefix","infinity","negativeSuffix"],["negativePrefix","number","negativeSuffix"]],invertedSymbolMap=properties[0],invertedNuDigitsMap=properties[1]||{},tokenizer=properties[2],!function(_value,grammar){return grammar.some(function(statement){var value=_value;return statement.every(function(type){return null!==value.match(tokenizer[type])&&(value=value.replace(tokenizer[type],function(type){return function(lexeme){switch(lexeme=lexeme.split("").map(function(character){return invertedSymbolMap[character]||invertedNuDigitsMap[character]||character}).join(""),type){case"infinity":number=1/0;break;case"nan":number=NaN;break;case"number":lexeme=lexeme.replace(/,/g,""),number=+lexeme;break;case"prefix":case"negativePrefix":prefix=lexeme;break;case"suffix":suffix=lexeme;break;case"negativeSuffix":suffix=lexeme,negative=!0;break;default:throw new Error("Internal error")}return""}}(type)),!0)})&&!value.length})}(value=looseMatching(value),grammar)||isNaN(number)?NaN:(-1!==(prefixNSuffix=""+prefix+suffix).indexOf("%")?number/=100:-1!==prefixNSuffix.indexOf("")&&(number/=1e3),negative&&(number*=-1),number)},objectMap=function(object,fn){return Object.keys(object).map(function(key){return fn([key,object[key]])}).reduce(function(object,pair){return object[pair[0]]=pair[1],object},{})},numberParseProperties=function(pattern,cldr,options){var aux,decimalSymbolRe,digitsRe,groupingSeparatorRe,infinitySymbol,invertedNuDigitsMap,invertedSymbolMap,maximumFractionDigits,maximumSignificantDigits,minimumSignificantDigits,nanSymbol,negativePrefix,negativeSuffix,nuDigitsMap,numberTokenizer,prefix,primaryGroupingSize,secondaryGroupingSize,suffix,symbolMap,formatProperties=numberFormatProperties(pattern,cldr,options);return prefix=looseMatching(formatProperties[0]),maximumFractionDigits=formatProperties[4],minimumSignificantDigits=formatProperties[5],maximumSignificantDigits=formatProperties[6],primaryGroupingSize=formatProperties[8],secondaryGroupingSize=formatProperties[9],suffix=looseMatching(formatProperties[10]),negativePrefix=looseMatching(formatProperties[13]),negativeSuffix=looseMatching(formatProperties[14]),infinitySymbol=looseMatching(formatProperties[16]),nanSymbol=looseMatching(formatProperties[17]),symbolMap=objectMap(formatProperties[18],function(pair){return[pair[0],looseMatching(pair[1])]}),nuDigitsMap=formatProperties[19],invertedSymbolMap=objectMap(function(cldr){var symbol,symbolMap={};for(symbol in numberSymbolName)symbolMap[numberSymbol(numberSymbolName[symbol],cldr)]=symbol;return symbolMap}(cldr),function(pair){return[looseMatching(pair[0]),pair[1]]}),digitsRe=nuDigitsMap?"["+nuDigitsMap+"]":"\\d",groupingSeparatorRe=regexpEscape(symbolMap[","]),decimalSymbolRe=regexpEscape(symbolMap["."]),nuDigitsMap&&(invertedNuDigitsMap=nuDigitsMap.split("").reduce(function(object,localizedDigit,i){return object[localizedDigit]=String(i),object},{})),prefix=(aux=[prefix,suffix,negativePrefix,negativeSuffix].map(function(value){return value.replace(/('([^']|'')+'|'')|./g,function(character,literal){return literal?removeLiteralQuotes(literal):character=character.replace(/[\-+E%\u2030]/,function(symbol){return symbolMap[symbol]})})}))[0],suffix=aux[1],negativePrefix=aux[2],negativeSuffix=aux[3],numberTokenizer=digitsRe+"+",primaryGroupingSize&&(numberTokenizer="("+(aux=secondaryGroupingSize?digitsRe+"{1,"+secondaryGroupingSize+"}(("+groupingSeparatorRe+digitsRe+"{"+secondaryGroupingSize+"})*("+groupingSeparatorRe+digitsRe+"{"+primaryGroupingSize+"}))":digitsRe+"{1,"+primaryGroupingSize+"}("+groupingSeparatorRe+digitsRe+"{"+primaryGroupingSize+"})+")+"|"+numberTokenizer+")"),isNaN(minimumSignificantDigits*maximumSignificantDigits)&&!maximumFractionDigits||(numberTokenizer="("+(numberTokenizer=numberTokenizer+"("+(aux=decimalSymbolRe+digitsRe+"+")+"|"+decimalSymbolRe+")?|("+numberTokenizer+")?"+aux)+")"),[invertedSymbolMap,invertedNuDigitsMap,{infinity:new RegExp("^"+regexpEscape(infinitySymbol)),nan:new RegExp("^"+regexpEscape(nanSymbol)),negativePrefix:new RegExp("^"+regexpEscape(negativePrefix)),negativeSuffix:new RegExp("^"+regexpEscape(negativeSuffix)),number:new RegExp("^"+numberTokenizer),prefix:new RegExp("^"+regexpEscape(prefix)),suffix:new RegExp("^"+regexpEscape(suffix))}]},numberPattern=function(style,cldr){if("decimal"!==style&&"percent"!==style)throw new Error("Invalid style");return cldr.main(["numbers",style+"Formats-numberSystem-"+numberNumberingSystem(cldr),"standard"])};return Globalize.numberFormatter=Globalize.prototype.numberFormatter=function(options){var args,cldr,fnArgs,pattern,properties,returnFn;return validateParameterTypePlainObject(options,"options"),options=options||{},cldr=this.cldr,args=[options],validateDefaultLocale(cldr),cldr.on("get",validateCldr),pattern=options.raw?options.raw:numberPattern(options.style||"decimal",cldr),fnArgs=[properties=numberFormatProperties(pattern,cldr,options)],cldr.off("get",validateCldr),function(properties){var minimumIntegerDigits=properties[2],minimumFractionDigits=properties[3],maximumFractionDigits=properties[4],minimumSignificantDigits=properties[5],maximumSignificantDigits=properties[6];if(isNaN(minimumSignificantDigits*maximumSignificantDigits)){if(!isNaN(minimumSignificantDigits)||!isNaN(maximumSignificantDigits))throw new Error("Neither or both the minimum and maximum significant digits must be present");validateParameterRange(minimumIntegerDigits,"minimumIntegerDigits",1,21),validateParameterRange(minimumFractionDigits,"minimumFractionDigits",0,20),validateParameterRange(maximumFractionDigits,"maximumFractionDigits",minimumFractionDigits,20)}else validateParameterRange(minimumSignificantDigits,"minimumSignificantDigits",1,21),validateParameterRange(maximumSignificantDigits,"maximumSignificantDigits",minimumSignificantDigits,21)}(properties),options.compact&&fnArgs.push(this.pluralGenerator()),returnFn=function(properties,pluralGenerator){return function(value){return validateParameterPresence(value,"value"),validateParameterTypeNumber(value,"value"),numberFormat(value,properties,pluralGenerator)}}.apply(null,fnArgs),runtimeBind(args,cldr,returnFn,fnArgs),returnFn},Globalize.numberParser=Globalize.prototype.numberParser=function(options){var args,cldr,pattern,properties,returnFn;if(validateParameterTypePlainObject(options,"options"),options=options||{},cldr=this.cldr,args=[options],validateDefaultLocale(cldr),options.compact)throw createErrorUnsupportedFeature({feature:"compact number parsing (not implemented)"});return cldr.on("get",validateCldr),pattern=options.raw?options.raw:numberPattern(options.style||"decimal",cldr),properties=numberParseProperties(pattern,cldr,options),cldr.off("get",validateCldr),returnFn=function(properties){return function(value){return validateParameterPresence(value,"value"),validateParameterTypeString(value,"value"),numberParse(value,properties)}}(properties),runtimeBind(args,cldr,returnFn,[properties]),returnFn},Globalize.formatNumber=Globalize.prototype.formatNumber=function(value,options){return validateParameterPresence(value,"value"),validateParameterTypeNumber(value,"value"),this.numberFormatter(options)(value)},Globalize.parseNumber=Globalize.prototype.parseNumber=function(value,options){return validateParameterPresence(value,"value"),validateParameterTypeString(value,"value"),this.numberParser(options)(value)},Globalize._createErrorUnsupportedFeature=createErrorUnsupportedFeature,Globalize._numberNumberingSystem=numberNumberingSystem,Globalize._numberNumberingSystemDigitsMap=numberNumberingSystemDigitsMap,Globalize._numberPattern=numberPattern,Globalize._numberSymbol=numberSymbol,Globalize._looseMatching=looseMatching,Globalize._removeLiteralQuotes=removeLiteralQuotes,Globalize._stringPad=stringPad,Globalize._validateParameterTypeNumber=validateParameterTypeNumber,Globalize._validateParameterTypeString=validateParameterTypeString,Globalize}),function(root,factory){"function"==typeof define&&define.amd?define(["cldr","../globalize","./number","cldr/event","cldr/supplemental"],factory):"object"==typeof exports?module.exports=factory(require("cldrjs"),require("../globalize")):factory(root.Cldr,root.Globalize)}(this,function(Cldr,Globalize){var alwaysArray=Globalize._alwaysArray,formatMessage=Globalize._formatMessage,numberNumberingSystem=Globalize._numberNumberingSystem,numberPattern=Globalize._numberPattern,runtimeBind=Globalize._runtimeBind,stringPad=Globalize._stringPad,validateCldr=Globalize._validateCldr,validateDefaultLocale=Globalize._validateDefaultLocale,validateParameterPresence=Globalize._validateParameterPresence,validateParameterType=Globalize._validateParameterType,validateParameterTypeNumber=Globalize._validateParameterTypeNumber,validateParameterTypePlainObject=Globalize._validateParameterTypePlainObject,currencySupplementalOverride=function(currency,pattern,cldr){var digits,fraction="",fractionData=cldr.supplemental(["currencyData/fractions",currency])||cldr.supplemental("currencyData/fractions/DEFAULT");return(digits=+fractionData._digits)&&(fraction="."+stringPad("0",digits).slice(0,-1)+fractionData._rounding),pattern.replace(/\.(#+|0*[0-9]|0+[0-9]?)/g,fraction)},objectFilter=function(object,testRe){var key,copy={};for(key in object)testRe.test(key)&&(copy[key]=object[key]);return copy},currencyCodeProperties=function(currency,cldr){var pattern=numberPattern("decimal",cldr);return{currency:currency,pattern:pattern=currencySupplementalOverride(currency,pattern,cldr),unitPatterns:function(cldr){return objectFilter(cldr.main(["numbers","currencyFormats-numberSystem-"+numberNumberingSystem(cldr)]),/^unitPattern/)}(cldr)}},currencyFormatterFn=function(numberFormatter,pluralGenerator,properties){return pluralGenerator&&properties?function(value){return validateParameterPresence(value,"value"),validateParameterTypeNumber(value,"value"),function(formattedNumber,pluralForm,properties){var displayName,unitPattern,displayNames=properties.displayNames||{},unitPatterns=properties.unitPatterns;return displayName=displayNames["displayName-count-"+pluralForm]||displayNames["displayName-count-other"]||displayNames.displayName||properties.currency,unitPattern=unitPatterns["unitPattern-count-"+pluralForm]||unitPatterns["unitPattern-count-other"],formatMessage(unitPattern,[formattedNumber,displayName])}(numberFormatter(value),pluralGenerator(value),properties)}:function(value){return numberFormatter(value)}},regexpNotS=/[\0-#%-\*,-;\?-\]_a-\{\}\x7F-\xA1\xA7\xAA\xAB\xAD\xB2\xB3\xB5-\xB7\xB9-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376-\u0383\u0386-\u03F5\u03F7-\u0481\u0483-\u058C\u0590-\u0605\u0609\u060A\u060C\u060D\u0610-\u06DD\u06DF-\u06E8\u06EA-\u06FC\u06FF-\u07F5\u07F7-\u09F1\u09F4-\u09F9\u09FC-\u0AF0\u0AF2-\u0B6F\u0B71-\u0BF2\u0BFB-\u0C7E\u0C80-\u0D78\u0D7A-\u0E3E\u0E40-\u0F00\u0F04-\u0F12\u0F14\u0F18\u0F19\u0F20-\u0F33\u0F35\u0F37\u0F39-\u0FBD\u0FC6\u0FCD\u0FD0-\u0FD4\u0FD9-\u109D\u10A0-\u138F\u139A-\u17DA\u17DC-\u193F\u1941-\u19DD\u1A00-\u1B60\u1B6B-\u1B73\u1B7D-\u1FBC\u1FBE\u1FC2-\u1FCC\u1FD0-\u1FDC\u1FE0-\u1FEC\u1FF0-\u1FFC\u1FFF-\u2043\u2045-\u2051\u2053-\u2079\u207D-\u2089\u208D-\u209F\u20BE-\u20FF\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u218F\u2308-\u230B\u2329\u232A\u23FB-\u23FF\u2427-\u243F\u244B-\u249B\u24EA-\u24FF\u2768-\u2793\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2B74\u2B75\u2B96\u2B97\u2BBA-\u2BBC\u2BC9\u2BD2-\u2CE4\u2CEB-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u3003\u3005-\u3011\u3014-\u301F\u3021-\u3035\u3038-\u303D\u3040-\u309A\u309D-\u318F\u3192-\u3195\u31A0-\u31BF\u31E4-\u31FF\u321F-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u32FF\u3400-\u4DBF\u4E00-\uA48F\uA4C7-\uA6FF\uA717-\uA71F\uA722-\uA788\uA78B-\uA827\uA82C-\uA835\uA83A-\uAA76\uAA7A-\uAB5A\uAB5C-\uD7FF\uDC00-\uFB28\uFB2A-\uFBB1\uFBC2-\uFDFB\uFDFE-\uFE61\uFE63\uFE67\uFE68\uFE6A-\uFF03\uFF05-\uFF0A\uFF0C-\uFF1B\uFF1F-\uFF3D\uFF3F\uFF41-\uFF5B\uFF5D\uFF5F-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF]|\uD800[\uDC00-\uDD36\uDD40-\uDD78\uDD8A\uDD8B\uDD8D-\uDD8F\uDD9C-\uDD9F\uDDA1-\uDDCF\uDDFD-\uDFFF]|[\uD801\uD803-\uD819\uD81B-\uD82E\uD830-\uD833\uD836-\uD83A\uD83F-\uDBFF][\uDC00-\uDFFF]|\uD802[\uDC00-\uDC76\uDC79-\uDEC7\uDEC9-\uDFFF]|\uD81A[\uDC00-\uDF3B\uDF40-\uDF44\uDF46-\uDFFF]|\uD82F[\uDC00-\uDC9B\uDC9D-\uDFFF]|\uD834[\uDCF6-\uDCFF\uDD27\uDD28\uDD65-\uDD69\uDD6D-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDDDE-\uDDFF\uDE42-\uDE44\uDE46-\uDEFF\uDF57-\uDFFF]|\uD835[\uDC00-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFFF]|\uD83B[\uDC00-\uDEEF\uDEF2-\uDFFF]|\uD83C[\uDC2C-\uDC2F\uDC94-\uDC9F\uDCAF\uDCB0\uDCC0\uDCD0\uDCF6-\uDD0F\uDD2F\uDD6C-\uDD6F\uDD9B-\uDDE5\uDE03-\uDE0F\uDE3B-\uDE3F\uDE49-\uDE4F\uDE52-\uDEFF\uDF2D-\uDF2F\uDF7E\uDF7F\uDFCF-\uDFD3\uDFF8-\uDFFF]|\uD83D[\uDCFF\uDD4B-\uDD4F\uDD7A\uDDA4\uDE43\uDE44\uDED0-\uDEDF\uDEED-\uDEEF\uDEF4-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDFFF]|[\uD800-\uDBFF]/,currencySymbolProperties=function(currency,cldr,options){var currencySpacing,pattern,symbol,symbolEntries=["symbol"],regexp={"[:digit:]":/\d/,"[:^S:]":regexpNotS};return"narrow"===options.symbolForm&&symbolEntries.unshift("symbol-alt-narrow"),symbolEntries.some(function(symbolEntry){return symbol=cldr.main(["numbers/currencies",currency,symbolEntry])}),currencySpacing=["beforeCurrency","afterCurrency"].map(function(position){return cldr.main(["numbers","currencyFormats-numberSystem-"+numberNumberingSystem(cldr),"currencySpacing",position])}),pattern=cldr.main(["numbers","currencyFormats-numberSystem-"+numberNumberingSystem(cldr),"accounting"===options.style?"accounting":"standard"]),{pattern:pattern=currencySupplementalOverride(currency,pattern,cldr).split(";").map(function(pattern){return pattern.split("").map(function(part,i){var currencyMatch=regexp[currencySpacing[i].currencyMatch],surroundingMatch=regexp[currencySpacing[i].surroundingMatch],insertBetween="";return currencyMatch=currencyMatch.test(symbol.charAt(i?symbol.length-1:0)),surroundingMatch=surroundingMatch.test(part.charAt(i?0:part.length-1).replace(/[#@,.]/g,"0")),currencyMatch&&part&&surroundingMatch&&(insertBetween=currencySpacing[i].insertBetween),(i?insertBetween:"")+part+(i?"":insertBetween)}).join("'"+symbol+"'")}).join(";")}};function validateRequiredCldr(path,value){validateCldr(path,value,{skip:[/numbers\/currencies\/[^/]+\/symbol-alt-/,/supplemental\/currencyData\/fractions\/[A-Za-z]{3}$/]})}return Globalize.currencyFormatter=Globalize.prototype.currencyFormatter=function(currency,options){var args,cldr,numberFormatter,pluralGenerator,properties,returnFn,style,value;return validateParameterPresence(currency,"currency"),validateParameterType(value=currency,"currency",void 0===value||"string"==typeof value&&/^[A-Za-z]{3}$/.test(value),"3-letter currency code string as defined by ISO 4217"),validateParameterTypePlainObject(options,"options"),cldr=this.cldr,args=[currency,options=options||{}],style=options.style||"symbol",validateDefaultLocale(cldr),cldr.on("get",validateRequiredCldr),properties={accounting:currencySymbolProperties,code:currencyCodeProperties,name:function(currency,cldr){var properties=currencyCodeProperties(currency,cldr);return properties.displayNames=objectFilter(cldr.main(["numbers/currencies",currency]),/^displayName/),properties},symbol:currencySymbolProperties}[style](currency,cldr,options),cldr.off("get",validateRequiredCldr),(options=function(object,keys){var key,copy={};for(key in keys=alwaysArray(keys),object)-1===keys.indexOf(key)&&(copy[key]=object[key]);return copy}(options,"style")).raw=properties.pattern,"symbol"===style||"accounting"===style?(numberFormatter=this.numberFormatter(options),returnFn=currencyFormatterFn(numberFormatter),runtimeBind(args,cldr,returnFn,[numberFormatter])):(numberFormatter=this.numberFormatter(options),pluralGenerator=this.pluralGenerator(),returnFn=currencyFormatterFn(numberFormatter,pluralGenerator,properties),runtimeBind(args,cldr,returnFn,[numberFormatter,pluralGenerator,properties])),returnFn},Globalize.currencyParser=Globalize.prototype.currencyParser=function(){},Globalize.formatCurrency=Globalize.prototype.formatCurrency=function(value,currency,options){return validateParameterPresence(value,"value"),validateParameterTypeNumber(value,"value"),this.currencyFormatter(currency,options)(value)},Globalize.parseCurrency=Globalize.prototype.parseCurrency=function(){},Globalize}),function(a){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?a(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(a){var b=a[0];return 0<b.offsetWidth&&0<b.offsetHeight}function c(b){if(b.minTime&&(b.minTime=t(b.minTime)),b.maxTime&&(b.maxTime=t(b.maxTime)),b.durationTime&&"function"!=typeof b.durationTime&&(b.durationTime=t(b.durationTime)),"now"==b.scrollDefault)b.scrollDefault=function(){return b.roundingFunction(t(new Date),b)};else if(b.scrollDefault&&"function"!=typeof b.scrollDefault){var c=b.scrollDefault;b.scrollDefault=function(){return b.roundingFunction(t(c),b)}}else b.minTime&&(b.scrollDefault=function(){return b.roundingFunction(b.minTime,b)});if("string"===a.type(b.timeFormat)&&b.timeFormat.match(/[gh]/)&&(b._twelveHourTime=!0),!1===b.showOnFocus&&-1!=b.showOn.indexOf("focus")&&b.showOn.splice(b.showOn.indexOf("focus"),1),0<b.disableTimeRanges.length){for(var d in b.disableTimeRanges)b.disableTimeRanges[d]=[t(b.disableTimeRanges[d][0]),t(b.disableTimeRanges[d][1])];b.disableTimeRanges=b.disableTimeRanges.sort(function(a,b){return a[0]-b[0]});for(d=b.disableTimeRanges.length-1;0<d;d--)b.disableTimeRanges[d][0]<=b.disableTimeRanges[d-1][1]&&(b.disableTimeRanges[d-1]=[Math.min(b.disableTimeRanges[d][0],b.disableTimeRanges[d-1][0]),Math.max(b.disableTimeRanges[d][1],b.disableTimeRanges[d-1][1])],b.disableTimeRanges.splice(d,1))}return b}function d(b){var c=b.data("timepicker-settings"),d=b.data("timepicker-list");if(d&&d.length&&(d.remove(),b.data("timepicker-list",!1)),c.useSelect){d=a("<select />",{class:"ui-timepicker-select"}),b.attr("name")&&d.attr("name","ui-timepicker-"+b.attr("name"));var g=d}else{d=a("<ul />",{class:"ui-timepicker-list"}),(g=a("<div />",{class:"ui-timepicker-wrapper",tabindex:-1})).css({display:"none",position:"absolute"}).append(d)}if(c.noneOption)if(!0===c.noneOption&&(c.noneOption=c.useSelect?"Time...":"None"),a.isArray(c.noneOption)){for(var i in c.noneOption)if(parseInt(i,10)==i){var k=e(c.noneOption[i],c.useSelect);d.append(k)}}else{k=e(c.noneOption,c.useSelect);d.append(k)}c.className&&g.addClass(c.className),null===c.minTime&&null===c.durationTime||!c.showDuration||("function"==typeof c.step||c.step,g.addClass("ui-timepicker-with-duration"),g.addClass("ui-timepicker-step-"+c.step));var l=c.minTime;"function"==typeof c.durationTime?l=t(c.durationTime()):null!==c.durationTime&&(l=c.durationTime);var n=null!==c.minTime?c.minTime:0,o=null!==c.maxTime?c.maxTime:n+v-1;o<n&&(o+=v),o===v-1&&"string"===a.type(c.timeFormat)&&c.show2400&&(o=v);var p=c.disableTimeRanges,w=0,y=p.length,z=c.step;"function"!=typeof z&&(z=function(){return c.step});i=n;for(var A=0;i<=o;i+=60*z(++A)){var D,B=i,C=s(B,c);if(c.useSelect)(D=a("<option />",{value:C})).text(C);else(D=a("<li />")).addClass(B%v<v/2?"ui-timepicker-am":"ui-timepicker-pm"),D.data("time",u(B,c)),D.text(C);if((null!==c.minTime||null!==c.durationTime)&&c.showDuration){var E=r(i-l,c.step);if(c.useSelect)D.text(D.text()+" ("+E+")");else{var F=a("<span />",{class:"ui-timepicker-duration"});F.text(" ("+E+")"),D.append(F)}}w<y&&(B>=p[w][1]&&(w+=1),p[w]&&B>=p[w][0]&&B<p[w][1]&&(c.useSelect?D.prop("disabled",!0):D.addClass("ui-timepicker-disabled"))),d.append(D)}if(g.data("timepicker-input",b),b.data("timepicker-list",g),c.useSelect)b.val()&&d.val(f(t(b.val()),c)),d.on("focus",function(){a(this).data("timepicker-input").trigger("showTimepicker")}),d.on("blur",function(){a(this).data("timepicker-input").trigger("hideTimepicker")}),d.on("change",function(){m(b,a(this).val(),"select")}),m(b,d.val(),"initial"),b.hide().after(d);else{var G=c.appendTo;"string"==typeof G?G=a(G):"function"==typeof G&&(G=G(b)),G.append(g),j(b,d),d.on("mousedown click","li",function(c){b.off("focus.timepicker"),b.on("focus.timepicker-ie-hack",function(){b.off("focus.timepicker-ie-hack"),b.on("focus.timepicker",x.show)}),h(b)||b[0].focus(),d.find("li").removeClass("ui-timepicker-selected"),a(this).addClass("ui-timepicker-selected"),q(b)&&(b.trigger("hideTimepicker"),d.on("mouseup.timepicker click.timepicker","li",function(a){d.off("mouseup.timepicker click.timepicker"),g.hide()}))})}}function e(b,c){var d,e,f;return"object"==typeof b?(d=b.label,e=b.className,f=b.value):"string"==typeof b?(d=b,f=""):a.error("Invalid noneOption value"),c?a("<option />",{value:f,class:e,text:d}):a("<li />",{class:e,text:d}).data("time",String(f))}function f(a,b){if(null!==(a=b.roundingFunction(a,b)))return s(a,b)}function g(b){if(b.target!=window){var c=a(b.target);c.closest(".ui-timepicker-input").length||c.closest(".ui-timepicker-wrapper").length||(x.hide(),a(document).unbind(".ui-timepicker"),a(window).unbind(".ui-timepicker"))}}function h(a){var b=a.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&b.disableTouchKeyboard}function i(b,c,d){if(!d&&0!==d)return!1;var e=b.data("timepicker-settings"),f=!1;d=e.roundingFunction(d,e);return c.find("li").each(function(b,c){var e=a(c);if("number"==typeof e.data("time"))return e.data("time")==d?(f=e,!1):void 0}),f}function j(a,b){b.find("li").removeClass("ui-timepicker-selected");var c=a.data("timepicker-settings"),d=t(l(a),c);if(null!==d){var e=i(a,b,d);if(e){var f=e.offset().top-b.offset().top;(f+e.outerHeight()>b.outerHeight()||f<0)&&b.scrollTop(b.scrollTop()+e.position().top-e.outerHeight()),(c.forceRoundTime||e.data("time")===d)&&e.addClass("ui-timepicker-selected")}}}function k(b,c){if("timepicker"!=c){var d=a(this);if(""===this.value)return void m(d,null,c);if(!d.is(":focus")||b&&"change"==b.type){var e=d.data("timepicker-settings"),f=t(this.value,e);if(null===f)return void d.trigger("timeFormatError");var g=!1;if(null!==e.minTime&&null!==e.maxTime&&(f<e.minTime||f>e.maxTime)&&(g=!0),a.each(e.disableTimeRanges,function(){if(f>=this[0]&&f<this[1])return!(g=!0)}),e.forceRoundTime){var h=e.roundingFunction(f,e);h!=f&&(f=h,c=null)}var i=s(f,e);g?(m(d,i,"error")||b&&"change"==b.type)&&d.trigger("timeRangeError"):m(d,i,c)}}}function l(a){return a.is("input")?a.val():a.data("ui-timepicker-value")}function m(a,b,c){if(a.is("input")){null===b&&""==a.val()||a.val(b);var d=a.data("timepicker-settings");d.useSelect&&"select"!=c&&a.data("timepicker-list")&&a.data("timepicker-list").val(f(t(b),d))}return a.data("ui-timepicker-value")!=b?(a.data("ui-timepicker-value",b),"select"==c?a.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):-1==["error","initial"].indexOf(c)&&a.trigger("changeTime"),!0):(-1==["error","initial"].indexOf(c)&&a.trigger("selectTime"),!1)}function n(a){switch(a.keyCode){case 13:case 9:return;default:a.preventDefault()}}function o(c){var d=a(this),e=d.data("timepicker-list");if(!e||!b(e)){if(40!=c.keyCode)return!0;x.show.call(d.get(0)),e=d.data("timepicker-list"),h(d)||d.focus()}switch(c.keyCode){case 13:return q(d)&&(k.call(d.get(0),{type:"change"}),x.hide.apply(this)),c.preventDefault(),!1;case 38:var f=e.find(".ui-timepicker-selected");return f.length?f.is(":first-child")||(f.removeClass("ui-timepicker-selected"),f.prev().addClass("ui-timepicker-selected"),f.prev().position().top<f.outerHeight()&&e.scrollTop(e.scrollTop()-f.outerHeight())):(e.find("li").each(function(b,c){if(0<a(c).position().top)return f=a(c),!1}),f.addClass("ui-timepicker-selected")),!1;case 40:return 0===(f=e.find(".ui-timepicker-selected")).length?(e.find("li").each(function(b,c){if(0<a(c).position().top)return f=a(c),!1}),f.addClass("ui-timepicker-selected")):f.is(":last-child")||(f.removeClass("ui-timepicker-selected"),f.next().addClass("ui-timepicker-selected"),f.next().position().top+2*f.outerHeight()>e.outerHeight()&&e.scrollTop(e.scrollTop()+f.outerHeight())),!1;case 27:e.find("li").removeClass("ui-timepicker-selected"),x.hide();break;case 9:x.hide();break;default:return!0}}function p(c){var d=a(this),e=d.data("timepicker-list"),f=d.data("timepicker-settings");if(!e||!b(e)||f.disableTextInput)return!0;if("paste"!==c.type&&"cut"!==c.type)switch(c.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:f.typeaheadHighlight?j(d,e):e.hide()}else setTimeout(function(){f.typeaheadHighlight?j(d,e):e.hide()},0)}function q(a){var b=a.data("timepicker-settings"),d=null,e=a.data("timepicker-list").find(".ui-timepicker-selected");return!e.hasClass("ui-timepicker-disabled")&&(e.length&&(d=e.data("time")),null!==d&&("string"!=typeof d&&(d=s(d,b)),m(a,d,"select")),!0)}function r(a,b){a=Math.abs(a);var c,d,e=Math.round(a/60),f=[];return e<60?f=[e,w.mins]:(c=Math.floor(e/60),d=e%60,30==b&&30==d&&(c+=w.decimal+5),f.push(c),f.push(1==c?w.hr:w.hrs),30!=b&&d&&(f.push(d),f.push(w.mins))),f.join(" ")}function s(b,c){if("number"!=typeof b)return null;var d=parseInt(b%60),e=parseInt(b/60%60),f=parseInt(b/3600%24),g=new Date(1970,0,2,f,e,d,0);if(isNaN(g.getTime()))return null;if("function"===a.type(c.timeFormat))return c.timeFormat(g);for(var h,i,j="",k=0;k<c.timeFormat.length;k++)switch(i=c.timeFormat.charAt(k)){case"a":j+=11<g.getHours()?w.pm:w.am;break;case"A":j+=11<g.getHours()?w.PM:w.AM;break;case"g":j+=0===(h=g.getHours()%12)?"12":h;break;case"G":h=g.getHours(),b===v&&(h=c.show2400?24:0),j+=h;break;case"h":0!==(h=g.getHours()%12)&&h<10&&(h="0"+h),j+=0===h?"12":h;break;case"H":h=g.getHours(),b===v&&(h=c.show2400?24:0),j+=9<h?h:"0"+h;break;case"i":j+=9<(e=g.getMinutes())?e:"0"+e;break;case"s":j+=9<(d=g.getSeconds())?d:"0"+d;break;case"\\":k++,j+=c.timeFormat.charAt(k);break;default:j+=i}return j}function t(a,b){if(""===a||null===a)return null;if("object"==typeof a)return 3600*a.getHours()+60*a.getMinutes()+a.getSeconds();if("string"!=typeof a)return a;"a"!=(a=a.toLowerCase().replace(/[\s\.]/g,"")).slice(-1)&&"p"!=a.slice(-1)||(a+="m");var c=(w.am.replace(".",""),w.pm.replace(".",""),w.AM.replace(".",""),w.PM.replace(".",""),new RegExp("^(([^0-9]*))?([0-9]?[0-9])(\\W?([0-5][0-9]))?(\\W+([0-5][0-9]))?(([^0-9]*))$","u")),d=a.match(c);if(!d)return null;var e=parseInt(1*d[3],10),f=d[2]||d[9],g=e,h=1*d[5]||0,i=1*d[7]||0;if(e<=12&&f){var j=(f=f.trim())==w.pm||f==w.PM;g=12==e?j?12:0:e+(j?12:0)}else if(b){if(3600*e+60*h+i>=v+(b.show2400?1:0)){if(!1===b.wrapHours)return null;g=e%24}}var l=3600*g+60*h+i;if(e<12&&!f&&b&&b._twelveHourTime&&b.scrollDefault){var m=l-b.scrollDefault();m<0&&v/-2<=m&&(l=(l+v/2)%v)}return l}function u(a,b){return a==v&&b.show2400?a:a%v}var v=86400,w={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},x={init:function(b){return this.each(function(){var e=a(this),f=[];for(var g in a.fn.timepicker.defaults)e.data(g)&&(f[g]=e.data(g));var h=a.extend({},a.fn.timepicker.defaults,b,f);if(h.lang&&(w=a.extend(w,h.lang)),h=c(h),e.data("timepicker-settings",h),e.addClass("ui-timepicker-input"),h.useSelect)d(e);else{if(e.prop("autocomplete","off"),h.showOn)for(var i in h.showOn)e.on(h.showOn[i]+".timepicker",x.show);e.on("change.timepicker",k),e.on("keydown.timepicker",o),e.on("keyup.timepicker",p),h.disableTextInput&&e.on("keydown.timepicker",n),e.on("cut.timepicker",p),e.on("paste.timepicker",p),k.call(e.get(0),null,"initial")}})},show:function(c){var e=a(this),f=e.data("timepicker-settings");if(c&&c.preventDefault(),f.useSelect)e.data("timepicker-list").focus();else{h(e)&&e.blur();var k=e.data("timepicker-list");if(!e.prop("readonly")&&(k&&0!==k.length&&"function"!=typeof f.durationTime||(d(e),k=e.data("timepicker-list")),!b(k))){e.data("ui-timepicker-value",e.val()),j(e,k),x.hide(),"number"==typeof f.listWidth&&(console.log(f.listWidth),k.width(e.outerWidth()*f.listWidth)),k.show();var n,m={};f.orientation.match(/r/)?m.left=e.offset().left+e.outerWidth()-k.outerWidth()+parseInt(k.css("marginLeft").replace("px",""),10):f.orientation.match(/l/)?m.left=e.offset().left+parseInt(k.css("marginLeft").replace("px",""),10):f.orientation.match(/c/)&&(m.left=e.offset().left+(e.outerWidth()-k.outerWidth())/2+parseInt(k.css("marginLeft").replace("px",""),10)),n=f.orientation.match(/t/)?"t":f.orientation.match(/b/)?"b":e.offset().top+e.outerHeight(!0)+k.outerHeight()>a(window).height()+a(window).scrollTop()?"t":"b",m.top="t"==n?(k.addClass("ui-timepicker-positioned-top"),e.offset().top-k.outerHeight()+parseInt(k.css("marginTop").replace("px",""),10)):(k.removeClass("ui-timepicker-positioned-top"),e.offset().top+e.outerHeight()+parseInt(k.css("marginTop").replace("px",""),10)),k.offset(m);var o=k.find(".ui-timepicker-selected");if(!o.length){var p=t(l(e));null!==p?o=i(e,k,p):f.scrollDefault&&(o=i(e,k,f.scrollDefault()))}if(o.length&&!o.hasClass("ui-timepicker-disabled")||(o=k.find("li:not(.ui-timepicker-disabled):first")),o&&o.length){var q=k.scrollTop()+o.position().top-o.outerHeight();k.scrollTop(q)}else k.scrollTop(0);return f.stopScrollPropagation&&a(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(b){b.preventDefault();var c=a(this).scrollTop();a(this).scrollTop(c+b.originalEvent.deltaY)}),a(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",g),a(window).on("resize.ui-timepicker",g),f.closeOnWindowScroll&&a(document).on("scroll.ui-timepicker",g),e.trigger("showTimepicker"),this}}},hide:function(c){var d=a(this),e=d.data("timepicker-settings");return e&&e.useSelect&&d.blur(),a(".ui-timepicker-wrapper").each(function(){var c=a(this);if(b(c)){var d=c.data("timepicker-input"),e=d.data("timepicker-settings");e&&e.selectOnBlur&&q(d),c.hide(),d.trigger("hideTimepicker")}}),this},option:function(b,e){return"string"==typeof b&&void 0===e?a(this).data("timepicker-settings")[b]:this.each(function(){var f=a(this),g=f.data("timepicker-settings"),h=f.data("timepicker-list");"object"==typeof b?g=a.extend(g,b):"string"==typeof b&&(g[b]=e),g=c(g),f.data("timepicker-settings",g),k.call(f.get(0),{type:"change"},"initial"),h&&(h.remove(),f.data("timepicker-list",!1)),g.useSelect&&d(f)})},getSecondsFromMidnight:function(){return t(l(this))},getTime:function(a){var c=l(this);if(!c)return null;var d=t(c);if(null===d)return null;a||(a=new Date);var e=new Date(a);return e.setHours(d/3600),e.setMinutes(d%3600/60),e.setSeconds(d%60),e.setMilliseconds(0),e},isVisible:function(){var c=this.data("timepicker-list");return!(!c||!b(c))},setTime:function(a){var b=this,c=b.data("timepicker-settings");if(c.forceRoundTime)var d=f(t(a),c);else d=s(t(a),c);return a&&null===d&&c.noneOption&&(d=a),m(b,d,"initial"),k.call(b.get(0),{type:"change"},"initial"),b.data("timepicker-list")&&j(b,b.data("timepicker-list")),this},remove:function(){var a=this;if(a.hasClass("ui-timepicker-input")){var b=a.data("timepicker-settings");return a.removeAttr("autocomplete","off"),a.removeClass("ui-timepicker-input"),a.removeData("timepicker-settings"),a.off(".timepicker"),a.data("timepicker-list")&&a.data("timepicker-list").remove(),b.useSelect&&a.show(),a.removeData("timepicker-list"),this}}};a.fn.timepicker=function(b){return this.length?x[b]?this.hasClass("ui-timepicker-input")?x[b].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.timepicker"):x.init.apply(this,arguments):this},a.fn.timepicker.defaults={appendTo:"body",className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,listWidth:null,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(a,b){if(null===a)return null;if("number"!=typeof b.step)return a;var c=a%(60*b.step);return(c-=(b.minTime||0)%(60*b.step))>=30*b.step?a+=60*b.step-c:a-=c,u(a,b)},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}}),window.Globalize2=window.Globalize,delete window.Globalize,function(window,undefined){var Globalize,regexHex,regexInfinity,regexParseFloat,regexTrim,arrayIndexOf,endsWith,extend,isArray,isFunction,isObject,startsWith,trim,truncate,zeroPad,appendPreOrPostMatch,expandFormat,formatDate,formatNumber,getTokenRegExp,getEra,getEraYear,parseExact,parseNegativePattern,expandNumber,expandYear,getDayIndex,getMonthIndex,getParseRegExp,outOfRange,toUpper,toUpperArray;Globalize=function(cultureSelector){return new Globalize.prototype.init(cultureSelector)},"undefined"!=typeof require&&"undefined"!=typeof exports&&"undefined"!=typeof module?module.exports=Globalize:window.Globalize=Globalize,Globalize.cultures={},Globalize.prototype={constructor:Globalize,init:function(cultureSelector){return this.cultures=Globalize.cultures,this.cultureSelector=cultureSelector,this}},Globalize.prototype.init.prototype=Globalize.prototype,Globalize.cultures.default={name:"en",englishName:"English",nativeName:"English",isRTL:!1,language:"en",numberFormat:{pattern:["-n"],decimals:2,",":",",".":".",groupSizes:[3],"+":"+","-":"-",NaN:"NaN",negativeInfinity:"-Infinity",positiveInfinity:"Infinity",percent:{pattern:["-n %","n %"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"%"},currency:{pattern:["($n)","$n"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"$"}},calendars:{standard:{name:"Gregorian_USEnglish","/":"/",":":":",firstDay:0,days:{names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],namesAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],namesShort:["Su","Mo","Tu","We","Th","Fr","Sa"]},months:{names:["January","February","March","April","May","June","July","August","September","October","November","December",""],namesAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""]},AM:["AM","am","AM"],PM:["PM","pm","PM"],eras:[{name:"A.D.",start:null,offset:0}],twoDigitYearMax:2029,patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",t:"h:mm tt",T:"h:mm:ss tt",f:"dddd, MMMM dd, yyyy h:mm tt",F:"dddd, MMMM dd, yyyy h:mm:ss tt",M:"MMMM dd",Y:"yyyy MMMM",S:"yyyy'-'MM'-'dd'T'HH':'mm':'ss"}}},messages:{}},Globalize.cultures.default.calendar=Globalize.cultures.default.calendars.standard,Globalize.cultures.en=Globalize.cultures.default,Globalize.cultureSelector="en",regexHex=/^0x[a-f0-9]+$/i,regexInfinity=/^[+\-]?infinity$/i,regexParseFloat=/^[+\-]?\d*\.?\d*(e[+\-]?\d+)?$/,regexTrim=/^\s+|\s+$/g,arrayIndexOf=function(array,item){if(array.indexOf)return array.indexOf(item);for(var i=0,length=array.length;i<length;i++)if(array[i]===item)return i;return-1},endsWith=function(value,pattern){return value.substr(value.length-pattern.length)===pattern},extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[1]||{},i=2),"object"==typeof target||isFunction(target)||(target={});i<length;i++)if(null!=(options=arguments[i]))for(name in options)src=target[name],target!==(copy=options[name])&&(deep&&copy&&(isObject(copy)||(copyIsArray=isArray(copy)))?(clone=copyIsArray?(copyIsArray=!1,src&&isArray(src)?src:[]):src&&isObject(src)?src:{},target[name]=extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target},isArray=Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},isFunction=function(obj){return"[object Function]"===Object.prototype.toString.call(obj)},isObject=function(obj){return"[object Object]"===Object.prototype.toString.call(obj)},startsWith=function(value,pattern){return 0===value.indexOf(pattern)},trim=function(value){return(value+"").replace(regexTrim,"")},truncate=function(value){return isNaN(value)?NaN:Math[value<0?"ceil":"floor"](value)},zeroPad=function(str,count,left){var l;for(l=str.length;l<count;l+=1)str=left?"0"+str:str+"0";return str},appendPreOrPostMatch=function(preMatch,strings){for(var quoteCount=0,escaped=!1,i=0,il=preMatch.length;i<il;i++){var c=preMatch.charAt(i);switch(c){case"'":escaped?strings.push("'"):quoteCount++,escaped=!1;break;case"\\":escaped&&strings.push("\\"),escaped=!escaped;break;default:strings.push(c),escaped=!1}}return quoteCount},expandFormat=function(cal,format){format=format||"F";var pattern,patterns=cal.patterns,len=format.length;if(1===len){if(!(pattern=patterns[format]))throw"Invalid date format string '"+format+"'.";format=pattern}else 2===len&&"%"===format.charAt(0)&&(format=format.charAt(1));return format},formatDate=function(value,format,culture){var ret,cal=culture.calendar,convert=cal.convert;if(!format||!format.length||"i"===format){if(culture&&culture.name.length)if(convert)ret=formatDate(value,cal.patterns.F,culture);else{var eraDate=new Date(value.getTime()),era=getEra(value,cal.eras);eraDate.setFullYear(getEraYear(value,cal,era)),ret=eraDate.toLocaleString()}else ret=value.toString();return ret}var eras=cal.eras,sortable="s"===format;format=expandFormat(cal,format),ret=[];var hour,foundDay,checkedDay,converted,zeros=["0","00","000"],dayPartRegExp=/([^d]|^)(d|dd)([^d]|$)/g,quoteCount=0,tokenRegExp=getTokenRegExp();function padZeros(num,c){var r,s=num+"";return 1<c&&s.length<c?(r=zeros[c-2]+s).substr(r.length-c,c):r=s}function getPart(date,part){if(converted)return converted[part];switch(part){case 0:return date.getFullYear();case 1:return date.getMonth();case 2:return date.getDate();default:throw"Invalid part value "+part}}for(!sortable&&convert&&(converted=convert.fromGregorian(value));;){var index=tokenRegExp.lastIndex,ar=tokenRegExp.exec(format),preMatch=format.slice(index,ar?ar.index:format.length);if(quoteCount+=appendPreOrPostMatch(preMatch,ret),!ar)break;if(quoteCount%2)ret.push(ar[0]);else{var current=ar[0],clength=current.length;switch(current){case"ddd":case"dddd":var names=3===clength?cal.days.namesAbbr:cal.days.names;ret.push(names[value.getDay()]);break;case"d":case"dd":foundDay=!0,ret.push(padZeros(getPart(value,2),clength));break;case"MMM":case"MMMM":var part=getPart(value,1);ret.push(cal.monthsGenitive&&(foundDay||checkedDay||(foundDay=dayPartRegExp.test(format),checkedDay=!0),foundDay)?cal.monthsGenitive[3===clength?"namesAbbr":"names"][part]:cal.months[3===clength?"namesAbbr":"names"][part]);break;case"M":case"MM":ret.push(padZeros(getPart(value,1)+1,clength));break;case"y":case"yy":case"yyyy":part=converted?converted[0]:getEraYear(value,cal,getEra(value,eras),sortable),clength<4&&(part%=100),ret.push(padZeros(part,clength));break;case"h":case"hh":0===(hour=value.getHours()%12)&&(hour=12),ret.push(padZeros(hour,clength));break;case"H":case"HH":ret.push(padZeros(value.getHours(),clength));break;case"m":case"mm":ret.push(padZeros(value.getMinutes(),clength));break;case"s":case"ss":ret.push(padZeros(value.getSeconds(),clength));break;case"t":case"tt":part=value.getHours()<12?cal.AM?cal.AM[0]:" ":cal.PM?cal.PM[0]:" ",ret.push(1===clength?part.charAt(0):part);break;case"f":case"ff":case"fff":ret.push(padZeros(value.getMilliseconds(),3).substr(0,clength));break;case"z":case"zz":hour=value.getTimezoneOffset()/60,ret.push((hour<=0?"+":"-")+padZeros(Math.floor(Math.abs(hour)),clength));break;case"zzz":hour=value.getTimezoneOffset()/60,ret.push((hour<=0?"+":"-")+padZeros(Math.floor(Math.abs(hour)),2)+":"+padZeros(Math.abs(value.getTimezoneOffset()%60),2));break;case"g":case"gg":cal.eras&&ret.push(cal.eras[getEra(value,eras)].name);break;case"/":ret.push(cal["/"]);break;default:throw"Invalid date format pattern '"+current+"'."}}}return ret.join("")},expandNumber=function(number,precision,formatInfo){var groupSizes=formatInfo.groupSizes,curSize=groupSizes[0],curGroupIndex=1,factor=Math.pow(10,precision),rounded=Math.round(number*factor)/factor;isFinite(rounded)||(rounded=number);var numberString=(number=rounded)+"",right="",split=numberString.split(/e/i),exponent=1<split.length?parseInt(split[1],10):0;numberString=(split=(numberString=split[0]).split("."))[0],right=1<split.length?split[1]:"",0<exponent?(numberString+=(right=zeroPad(right,exponent,!1)).slice(0,exponent),right=right.substr(exponent)):exponent<0&&(right=(numberString=zeroPad(numberString,1+(exponent=-exponent),!0)).slice(-exponent,numberString.length)+right,numberString=numberString.slice(0,-exponent)),right=0<precision?formatInfo["."]+(right.length>precision?right.slice(0,precision):zeroPad(right,precision)):"";for(var stringIndex=numberString.length-1,sep=formatInfo[","],ret="";0<=stringIndex;){if(0===curSize||stringIndex<curSize)return numberString.slice(0,stringIndex+1)+(ret.length?sep+ret+right:right);ret=numberString.slice(stringIndex-curSize+1,stringIndex+1)+(ret.length?sep+ret:""),stringIndex-=curSize,curGroupIndex<groupSizes.length&&(curSize=groupSizes[curGroupIndex],curGroupIndex++)}return numberString.slice(0,stringIndex+1)+sep+ret+right},formatNumber=function(value,format,culture){if(!isFinite(value))return value===1/0?culture.numberFormat.positiveInfinity:value===-1/0?culture.numberFormat.negativeInfinity:culture.numberFormat.NaN;if(!format||"i"===format)return culture.name.length?value.toLocaleString():value.toString();format=format||"D";var pattern,nf=culture.numberFormat,number=Math.abs(value),precision=-1;1<format.length&&(precision=parseInt(format.slice(1),10));var formatInfo,current=format.charAt(0).toUpperCase();switch(current){case"D":pattern="n",number=truncate(number),-1!==precision&&(number=zeroPad(""+number,precision,!0)),value<0&&(number="-"+number);break;case"N":formatInfo=nf;case"C":formatInfo=formatInfo||nf.currency;case"P":formatInfo=formatInfo||nf.percent,pattern=value<0?formatInfo.pattern[0]:formatInfo.pattern[1]||"n",-1===precision&&(precision=formatInfo.decimals),number=expandNumber(number*("P"===current?100:1),precision,formatInfo);break;default:throw"Bad number format specifier: "+current}for(var patternParts=/n|\$|-|%/g,ret="";;){var index=patternParts.lastIndex,ar=patternParts.exec(pattern);if(ret+=pattern.slice(index,ar?ar.index:pattern.length),!ar)break;switch(ar[0]){case"n":ret+=number;break;case"$":ret+=nf.currency.symbol;break;case"-":/[1-9]/.test(number)&&(ret+=nf["-"]);break;case"%":ret+=nf.percent.symbol}}return ret},getTokenRegExp=function(){return/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|gg|g/g},getEra=function(date,eras){if(!eras)return 0;for(var start,ticks=date.getTime(),i=0,l=eras.length;i<l;i++)if(null===(start=eras[i].start)||start<=ticks)return i;return 0},getEraYear=function(date,cal,era,sortable){var year=date.getFullYear();return!sortable&&cal.eras&&(year-=cal.eras[era].offset),year},expandYear=function(cal,year){if(year<100){var now=new Date,era=getEra(now),curr=getEraYear(now,cal,era),twoDigitYearMax=cal.twoDigitYearMax;(twoDigitYearMax="string"==typeof twoDigitYearMax?(new Date).getFullYear()%100+parseInt(twoDigitYearMax,10):twoDigitYearMax)<(year+=curr-curr%100)&&(year-=100)}return year},getDayIndex=function(cal,value,abbr){var ret,days=cal.days,upperDays=cal._upperDays;return upperDays||(cal._upperDays=upperDays=[toUpperArray(days.names),toUpperArray(days.namesAbbr),toUpperArray(days.namesShort)]),value=toUpper(value),abbr?-1===(ret=arrayIndexOf(upperDays[1],value))&&(ret=arrayIndexOf(upperDays[2],value)):ret=arrayIndexOf(upperDays[0],value),ret},getMonthIndex=function(cal,value,abbr){var months=cal.months,monthsGen=cal.monthsGenitive||cal.months,upperMonths=cal._upperMonths,upperMonthsGen=cal._upperMonthsGen;upperMonths||(cal._upperMonths=upperMonths=[toUpperArray(months.names),toUpperArray(months.namesAbbr)],cal._upperMonthsGen=upperMonthsGen=[toUpperArray(monthsGen.names),toUpperArray(monthsGen.namesAbbr)]),value=toUpper(value);var i=arrayIndexOf(abbr?upperMonths[1]:upperMonths[0],value);return i<0&&(i=arrayIndexOf(abbr?upperMonthsGen[1]:upperMonthsGen[0],value)),i},getParseRegExp=function(cal,format){var re=cal._parseRegExp;if(re){var reFormat=re[format];if(reFormat)return reFormat}else cal._parseRegExp=re={};for(var match,expFormat=expandFormat(cal,format).replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1"),regexp=["^"],groups=[],index=0,quoteCount=0,tokenRegExp=getTokenRegExp();null!==(match=tokenRegExp.exec(expFormat));){var preMatch=expFormat.slice(index,match.index);if(index=tokenRegExp.lastIndex,(quoteCount+=appendPreOrPostMatch(preMatch,regexp))%2)regexp.push(match[0]);else{var add,m=match[0],len=m.length;switch(m){case"dddd":case"ddd":case"MMMM":case"MMM":case"gg":case"g":add="(\\D+)";break;case"tt":case"t":add="(\\D*)";break;case"yyyy":case"fff":case"ff":case"f":add="(\\d{"+len+"})";break;case"dd":case"d":case"MM":case"M":case"yy":case"y":case"HH":case"H":case"hh":case"h":case"mm":case"m":case"ss":case"s":add="(\\d\\d?)";break;case"zzz":add="([+-]?\\d\\d?:\\d{2})";break;case"zz":case"z":add="([+-]?\\d\\d?)";break;case"/":add="(\\/)";break;default:throw"Invalid date format pattern '"+m+"'."}add&&regexp.push(add),groups.push(match[0])}}appendPreOrPostMatch(expFormat.slice(index),regexp),regexp.push("$");var parseRegExp={regExp:regexp.join("").replace(/\s+/g,"\\s+"),groups:groups};return re[format]=parseRegExp},outOfRange=function(value,low,high){return value<low||high<value},toUpper=function(value){return value.split("").join(" ").toUpperCase()},toUpperArray=function(arr){for(var results=[],i=0,l=arr.length;i<l;i++)results[i]=toUpper(arr[i]);return results},parseExact=function(value,format,culture){value=trim(value);var cal=culture.calendar,parseInfo=getParseRegExp(cal,format),match=new RegExp(parseInfo.regExp).exec(value);if(null===match)return null;for(var hourOffset,groups=parseInfo.groups,era=null,year=null,month=null,date=null,weekDay=null,hour=0,min=0,sec=0,msec=0,tzMinOffset=null,pmHour=!1,j=0,jl=groups.length;j<jl;j++){var matchGroup=match[j+1];if(matchGroup){var current=groups[j],clength=current.length,matchInt=parseInt(matchGroup,10);switch(current){case"dd":case"d":if(outOfRange(date=matchInt,1,31))return null;break;case"MMM":case"MMMM":if(month=getMonthIndex(cal,matchGroup,3===clength),outOfRange(month,0,11))return null;break;case"M":case"MM":if(outOfRange(month=matchInt-1,0,11))return null;break;case"y":case"yy":case"yyyy":if(year=clength<4?expandYear(cal,matchInt):matchInt,outOfRange(year,0,9999))return null;break;case"h":case"hh":if(12===(hour=matchInt)&&(hour=0),outOfRange(hour,0,11))return null;break;case"H":case"HH":if(outOfRange(hour=matchInt,0,23))return null;break;case"m":case"mm":if(outOfRange(min=matchInt,0,59))return null;break;case"s":case"ss":if(outOfRange(sec=matchInt,0,59))return null;break;case"tt":case"t":if(!(pmHour=cal.PM&&(matchGroup===cal.PM[0]||matchGroup===cal.PM[1]||matchGroup===cal.PM[2]))&&(!cal.AM||matchGroup!==cal.AM[0]&&matchGroup!==cal.AM[1]&&matchGroup!==cal.AM[2]))return null;break;case"f":case"ff":case"fff":if(msec=matchInt*Math.pow(10,3-clength),outOfRange(msec,0,999))return null;break;case"ddd":case"dddd":if(weekDay=getDayIndex(cal,matchGroup,3===clength),outOfRange(weekDay,0,6))return null;break;case"zzz":var offsets=matchGroup.split(/:/);if(2!==offsets.length)return null;if(hourOffset=parseInt(offsets[0],10),outOfRange(hourOffset,-12,13))return null;var minOffset=parseInt(offsets[1],10);if(outOfRange(minOffset,0,59))return null;tzMinOffset=60*hourOffset+(startsWith(matchGroup,"-")?-minOffset:minOffset);break;case"z":case"zz":if(outOfRange(hourOffset=matchInt,-12,13))return null;tzMinOffset=60*hourOffset;break;case"g":case"gg":var eraName=matchGroup;if(!eraName||!cal.eras)return null;eraName=trim(eraName.toLowerCase());for(var i=0,l=cal.eras.length;i<l;i++)if(eraName===cal.eras[i].name.toLowerCase()){era=i;break}if(null===era)return null}}}var defaultYear,result=new Date,convert=cal.convert;if(defaultYear=convert?convert.fromGregorian(result)[0]:result.getFullYear(),null===year?year=defaultYear:cal.eras&&(year+=cal.eras[era||0].offset),null===month&&(month=0),null===date&&(date=1),convert){if(null===(result=convert.toGregorian(year,month,date)))return null}else{if(result.setFullYear(year,month,date),result.getDate()!==date)return null;if(null!==weekDay&&result.getDay()!==weekDay)return null}if(pmHour&&hour<12&&(hour+=12),result.setHours(hour,min,sec,msec),null!==tzMinOffset){var adjustedMin=result.getMinutes()-(tzMinOffset+result.getTimezoneOffset());result.setHours(result.getHours()+parseInt(adjustedMin/60,10),adjustedMin%60)}return result},parseNegativePattern=function(value,nf,negativePattern){var ret,neg=nf["-"],pos=nf["+"];switch(negativePattern){case"n -":neg=" "+neg,pos=" "+pos;case"n-":endsWith(value,neg)?ret=["-",value.substr(0,value.length-neg.length)]:endsWith(value,pos)&&(ret=["+",value.substr(0,value.length-pos.length)]);break;case"- n":neg+=" ",pos+=" ";case"-n":startsWith(value,neg)?ret=["-",value.substr(neg.length)]:startsWith(value,pos)&&(ret=["+",value.substr(pos.length)]);break;case"(n)":startsWith(value,"(")&&endsWith(value,")")&&(ret=["-",value.substr(1,value.length-2)])}return ret||["",value]},Globalize.prototype.findClosestCulture=function(cultureSelector){return Globalize.findClosestCulture.call(this,cultureSelector)},Globalize.prototype.format=function(value,format,cultureSelector){return Globalize.format.call(this,value,format,cultureSelector)},Globalize.prototype.localize=function(key,cultureSelector){return Globalize.localize.call(this,key,cultureSelector)},Globalize.prototype.parseInt=function(value,radix,cultureSelector){return Globalize.parseInt.call(this,value,radix,cultureSelector)},Globalize.prototype.parseFloat=function(value,radix,cultureSelector){return Globalize.parseFloat.call(this,value,radix,cultureSelector)},Globalize.prototype.culture=function(cultureSelector){return Globalize.culture.call(this,cultureSelector)},Globalize.addCultureInfo=function(cultureName,baseCultureName,info){var base={},isNew=!1;base="string"!=typeof cultureName?(info=cultureName,cultureName=this.culture().name,this.cultures[cultureName]):"string"!=typeof baseCultureName?(info=baseCultureName,isNew=null==this.cultures[cultureName],this.cultures[cultureName]||this.cultures.default):(isNew=!0,this.cultures[baseCultureName]),this.cultures[cultureName]=extend(!0,{},base,info),isNew&&(this.cultures[cultureName].calendar=this.cultures[cultureName].calendars.standard)},Globalize.findClosestCulture=function(name){var match;if(!name)return this.findClosestCulture(this.cultureSelector)||this.cultures.default;if("string"==typeof name&&(name=name.split(",")),isArray(name)){var lang,i,cultures=this.cultures,list=name,l=list.length,prioritized=[];for(i=0;i<l;i++){var pri,parts=(name=trim(list[i])).split(";");lang=trim(parts[0]),pri=1===parts.length?1:0===(name=trim(parts[1])).indexOf("q=")?(name=name.substr(2),pri=parseFloat(name),isNaN(pri)?0:pri):1,prioritized.push({lang:lang,pri:pri})}for(prioritized.sort(function(a,b){return a.pri<b.pri?1:a.pri>b.pri?-1:0}),i=0;i<l;i++)if(match=cultures[lang=prioritized[i].lang])return match;for(i=0;i<l;i++)for(lang=prioritized[i].lang;;){var index=lang.lastIndexOf("-");if(-1===index)break;if(match=cultures[lang=lang.substr(0,index)])return match}for(i=0;i<l;i++)for(var cultureKey in lang=prioritized[i].lang,cultures){var culture=cultures[cultureKey];if(culture.language===lang)return culture}}else if("object"==typeof name)return name;return match||null},Globalize.format=function(value,format,cultureSelector){var culture=this.findClosestCulture(cultureSelector);return value instanceof Date?value=formatDate(value,format,culture):"number"==typeof value&&(value=formatNumber(value,format,culture)),value},Globalize.localize=function(key,cultureSelector){return this.findClosestCulture(cultureSelector).messages[key]||this.cultures.default.messages[key]},Globalize.parseDate=function(value,formats,culture){var date,prop,patterns;if(culture=this.findClosestCulture(culture),formats){if("string"==typeof formats&&(formats=[formats]),formats.length)for(var i=0,l=formats.length;i<l;i++){var format=formats[i];if(format&&(date=parseExact(value,format,culture)))break}}else for(prop in patterns=culture.calendar.patterns)if(date=parseExact(value,patterns[prop],culture))break;return date||null},Globalize.parseInt=function(value,radix,cultureSelector){return truncate(Globalize.parseFloat(value,radix,cultureSelector))},Globalize.parseFloat=function(value,radix,cultureSelector){"number"!=typeof radix&&(cultureSelector=radix,radix=10);var culture=this.findClosestCulture(cultureSelector),ret=NaN,nf=culture.numberFormat;if(-1<value.indexOf(culture.numberFormat.currency.symbol)&&(value=(value=value.replace(culture.numberFormat.currency.symbol,"")).replace(culture.numberFormat.currency["."],culture.numberFormat["."])),-1<value.indexOf(culture.numberFormat.percent.symbol)&&(value=value.replace(culture.numberFormat.percent.symbol,"")),value=value.replace(/ /g,""),regexInfinity.test(value))ret=parseFloat(value);else if(!radix&&regexHex.test(value))ret=parseInt(value,16);else{var signInfo=parseNegativePattern(value,nf,nf.pattern[0]),sign=signInfo[0],num=signInfo[1];""===sign&&"(n)"!==nf.pattern[0]&&(sign=(signInfo=parseNegativePattern(value,nf,"(n)"))[0],num=signInfo[1]),""===sign&&"-n"!==nf.pattern[0]&&(sign=(signInfo=parseNegativePattern(value,nf,"-n"))[0],num=signInfo[1]),sign=sign||"+";var exponent,intAndFraction,exponentPos=num.indexOf("e");exponentPos<0&&(exponentPos=num.indexOf("E")),exponent=exponentPos<0?(intAndFraction=num,null):(intAndFraction=num.substr(0,exponentPos),num.substr(exponentPos+1));var integer,fraction,decSep=nf["."],decimalPos=intAndFraction.indexOf(decSep);fraction=decimalPos<0?(integer=intAndFraction,null):(integer=intAndFraction.substr(0,decimalPos),intAndFraction.substr(decimalPos+decSep.length));var groupSep=nf[","];integer=integer.split(groupSep).join("");var altGroupSep=groupSep.replace(/\u00A0/g," ");groupSep!==altGroupSep&&(integer=integer.split(altGroupSep).join(""));var p=sign+integer;if(null!==fraction&&(p+="."+fraction),null!==exponent){var expSignInfo=parseNegativePattern(exponent,nf,"-n");p+="e"+(expSignInfo[0]||"+")+expSignInfo[1]}regexParseFloat.test(p)&&(ret=parseFloat(p))}return ret},Globalize.culture=function(cultureSelector){return void 0!==cultureSelector&&(this.cultureSelector=cultureSelector),this.findClosestCulture(cultureSelector)||this.cultures.default}}(this),function(window,undefined){("undefined"!=typeof require&&"undefined"!=typeof exports&&"undefined"!=typeof module?require("globalize"):window.Globalize).addCultureInfo("en-GB","default",{name:"en-GB",englishName:"English (United Kingdom)",nativeName:"English (United Kingdom)",numberFormat:{currency:{pattern:["-$n","$n"],symbol:""}},calendars:{standard:{firstDay:1,patterns:{d:"dd/MM/yyyy",D:"dd MMMM yyyy",t:"HH:mm",T:"HH:mm:ss",f:"dd MMMM yyyy HH:mm",F:"dd MMMM yyyy HH:mm:ss",M:"dd MMMM",Y:"MMMM yyyy"}}}})}(this),function($){$.extend(window.$fb,{tripAdvisor:{hid:null,enabled:!1,partnerId:null,locationId:null,tripType:null,language:null,frameDiv:null,frameSrc:null,frameUri:"https://www.tripadvisor.com",frameUrlPrefix:"/WidgetEmbed-cdspropertysummary?display=true",langMapping:{de_DE:"de",fr_FR:"fr",it_IT:"it",zh_Hans_CN:"zh_CN",ja_JP:"jp",es_ES:"es",ru_RU:"ru",pt_PT:"pt",nl_NL:"nl",th_TH:"th",zh_Hant_HK:"zh_HK",sv_SE:"sv",fi_FI:"fi",ko_KR:"ko",nn_NO:"no",pl_PL:"pl",cs_CZ:"cs",el_GR:"el",tr_TR:"tr",vi_VN:"vi",he_IL:"iw",hu_HU:"hu",ar_SA:"ar",ca_ES:"es",sk_SK:"sk"},widgetErrorHandler:function(event){event.origin==$fb.tripAdvisor.frameUri&&(event.stopPropagation(),event.data.error&&($("#fb-widget-trip-advisor-container").hide(),"en_US"!==$fb.tripAdvisor.language&&($fb.tripAdvisor.language="en_US",$fb.tripAdvisor.setFrameSrc(),$("#fb-widget-trip-advisor-container iframe").attr("src",$fb.tripAdvisor.frameSrc),$("#fb-widget-trip-advisor-container").show())))},setLang:function(){$fb.tripAdvisor.language="en_US";var locale=$.fb("crs-utils-configure",{k:"locale"});null!=$fb.tripAdvisor.langMapping[locale]&&($fb.tripAdvisor.language=$fb.tripAdvisor.langMapping[locale])},buildFrame:function(){return $fb.tripAdvisor.init(),$fb.tripAdvisor.frameDiv=$('<div id="fb-widget-trip-advisor-container" class="col-xs-12 col-sm-12 col-md-12 fb-warrant fb-container fb-light-bg" ><iframe src="'+$fb.tripAdvisor.frameSrc+'"width="270" height="90" scrolling="no"  frameborder="0" allowtransparency="true" marginheight="0" marginwidth="0" style="vertical-align:top;padding-left:10px;padding-right:10px;"></iframe></div>'),$fb.tripAdvisor.frameDiv},setFrameSrc:function(){$("#fb-widget-trip-advisor-container").show(),$fb.tripAdvisor.frameSrc=$fb.tripAdvisor.frameUri+$fb.tripAdvisor.frameUrlPrefix,$fb.tripAdvisor.frameSrc+="&partnerId="+$fb.tripAdvisor.partnerId,$fb.tripAdvisor.frameSrc+="&lang="+$fb.tripAdvisor.language,$fb.tripAdvisor.frameSrc+="&locationId="+$fb.tripAdvisor.locationId,$fb.tripAdvisor.frameSrc+="&allowMobile=true"},updateFrame:function(){$fb.tripAdvisor.init(),$("#fb-widget-trip-advisor-container iframe").attr("src",$fb.tripAdvisor.frameSrc),$("#trustyou-seal").hide()},isEnabled:function(){if($fb._state.quicksearch.property)$fb.tripAdvisor.hid=$fb._state.quicksearch.property;else{if(!$fb._state.app.booking.confirmation||!$fb._state.app.data.bookings[$fb._state.app.booking.confirmation].property)return!1;$fb.tripAdvisor.hid=$fb._state.app.data.bookings[$fb._state.app.booking.confirmation].property}if(!$fb._state.app.data.properties[$fb.tripAdvisor.hid]||!$fb._state.app.data.properties[$fb.tripAdvisor.hid].configuration.tripAdvisor||!$fb._state.app.data.properties[$fb.tripAdvisor.hid].configuration.tripAdvisor.on)return!1;var tripAdvisor=$fb._state.app.data.properties[$fb.tripAdvisor.hid].configuration.tripAdvisor;return null==tripAdvisor.partnerId||null==tripAdvisor.locationId?($fb.tripAdvisor.enabled=!1,$fb.tripAdvisor.enabled):$fb.tripAdvisor.enabled=!0},init:function(){if(!0===$fb.tripAdvisor.isEnabled()){var tripAdvisor=$fb._state.app.data.properties[$fb.tripAdvisor.hid].configuration.tripAdvisor;if(null==tripAdvisor.partnerId||null==tripAdvisor.locationId)return void($fb.tripAdvisor.enabled=!1);$fb.tripAdvisor.partnerId=tripAdvisor.partnerId,$fb.tripAdvisor.locationId=tripAdvisor.locationId,$fb.tripAdvisor.tripType=tripAdvisor.tripType,$fb.tripAdvisor.setLang(),$fb.tripAdvisor.setFrameSrc(),window.addEventListener?window.addEventListener("message",$fb.tripAdvisor.widgetErrorHandler,!1):window.attachEvent&&window.attachEvent("onmessage",$fb.tripAdvisor.widgetErrorHandler)}}}})}(window.jQuery),function($,_){$.extend(window.$fb,{upsellRoom:{roomNameList:null,upsellableRoom:null,body:null,hid:null,threshold:null,contextQuery:null,rate:null,pack:null,modal:null,room:null,userReactionToPopup:null,popupDisplayTimestamp:null,_carouselEventDispatcher:new window.EventEmitter,init:function(contextQuery,rate,pack){$fb.upsellRoom.popupDisplayTimestamp=moment();var configuration={};if($fb._state.app.data.properties[$fb._state.quicksearch.property]&&(configuration=$fb._state.app.data.properties[$fb._state.quicksearch.property].configuration),!$fb.abTesting.isCurrentSession("fb-upsell-room","variation")||null==configuration.upsellRoom||null==configuration.upsellRoom[rate.accommodation])return null;$fb.upsellRoom.contextQuery=contextQuery,$fb.upsellRoom.rate=rate,$fb.upsellRoom.pack=pack,$fb.upsellRoom.hid=$fb._state.quicksearch.property,$fb.upsellRoom.roomNameList=configuration.upsellRoom[rate.accommodation].list,$fb.upsellRoom.threshold=configuration.upsellRoom[rate.accommodation].threshold,$fb.upsellRoom.threshold=$.fb("crs-helper-price",{originCurrency:configuration.currency,currency:"EUR",price:$fb.upsellRoom.threshold,getOnlyFloatValue:!0}),$fb.upsellRoom.userReactionToPopup=null;var rawData=$fb.results._state.data;if("object"!=typeof rawData||!rawData.accommodations||Object.keys(rawData.accommodations).length<1)return null;var potentialUpsellAccommodations=_.chain(rawData.accommodations).filter(function(potentialUpsellAccommodation,accommodationName){return-1!==$fb.upsellRoom.roomNameList.indexOf(accommodationName)&&potentialUpsellAccommodation.rates&&potentialUpsellAccommodation.rates.length&&_.some(potentialUpsellAccommodation.rates,function(rateData){return rateData.rate===$fb.upsellRoom.rate.rate})}).map(function(potentialUpsellAccommodation){var concernedRate=_.find(potentialUpsellAccommodation.rates,function(rateData){return rateData.rate===$fb.upsellRoom.rate.rate});return{id:potentialUpsellAccommodation.id,rate:concernedRate,pack:potentialUpsellAccommodation.items[concernedRate.packId]}}).sortBy(function(potentialUpsellAccommodation){return potentialUpsellAccommodation.rate.price}).value();if(!potentialUpsellAccommodations.length)return null;var accommodation=JSON.parse(JSON.stringify(potentialUpsellAccommodations[0])),delta=accommodation.rate.price/accommodation.rate.nights-rate.price/rate.nights;return delta<=0||delta>$fb.upsellRoom.threshold?null:(accommodation.priceDelta=delta,accommodation.rate.teasingMemberPrice&&!$fb.upsellRoom.pack[0].pricesLoyalty&&accommodation.pack.forEach(function(item){delete item.loyaltyDiscount,delete item.pricesLoyalty}),$fb._state.app.data.accommodations&&$fb._state.app.data.accommodations[$fb._state.quicksearch.property]&&$fb._state.app.data.accommodations[$fb._state.quicksearch.property][accommodation.id]&&(accommodation.roomData=$fb._state.app.data.accommodations[$fb._state.quicksearch.property][accommodation.id]),$fb.upsellRoom.upsellableRoom=accommodation)},_getTranslation:function(key,fallback){return $.fb("crs-helper-translate",{key:key,fallback:fallback})},_getHeader:function(room){var accommodation=room.roomData,placeHolder='"'+this._getTranslation($fb.upsellRoom.hid+":roomtitle:"+room.id,room.id).text()+'"',elementsInSubdiv=[$.fb("crs-helper-translate",{key:"upsell-upgrade-label",fallback:"Upgrade to %1$s",placeholders:[placeHolder]}).addClass("upsell-price-text")];if(accommodation.features&&accommodation.features.topOrdered&&accommodation.features.topOrdered.length){var topFeaturesLabels=accommodation.features.topOrdered.map(function(topFeature){return $("<div>",{class:"col-xs-4"}).append($fb.upsellRoom._getTranslation("accommodation-feature-"+topFeature))});elementsInSubdiv.push($("<div>",{class:"upsell-top-features"}).append(topFeaturesLabels))}var readMoreText=this._getTranslation("upsell-upgrade-read-more-label","read more"),readLessText=this._getTranslation("upsell-upgrade-read-less-label","read less");return elementsInSubdiv.push($("<div>",{class:"read-less toggle"}).append(readMoreText)),elementsInSubdiv.push($("<div>",{class:"read-more toggle"}).append(readLessText)),$("<div>",{class:"upsell-header-div"}).append($("<div>",{class:"upsell-header-subdiv"}).append(elementsInSubdiv))},_getMiddleMore:function(room){var $globalContainer=$("<div>",{class:"read-more upsell-middle-subdiv"});if(room.roomData.surface&&0<room.roomData.surface){var chosenRoom=$fb._state.app.data.accommodations[$fb.upsellRoom.hid][$fb.upsellRoom.pack[0].product],hasBetterSurface=void 0===chosenRoom.surface||chosenRoom.surface<room.roomData.surface;$globalContainer.append($.fb("crs-helper-translate",{key:"product-surfacearea"}).addClass("fb-font-bold"),":",$("<span>",{class:"upsell-room-feature"+(hasBetterSurface?" upsell-room-feature-advantage":"")}).append(room.roomData.surface+"m").css("margin-left","5px"))}var $featuresContainer=$("<div>",{class:"fb-modal-layer-inner col-xs-12"});return room.roomData&&room.roomData.features&&$featuresContainer.append($fb.upsellRoom._getMiddleAccommodation(room),$fb.upsellRoom._getMiddleEquipments(room),$fb.upsellRoom._getMiddleBedTypes(room),$fb.upsellRoom._getMiddleBathroom(room)),$globalContainer.append($featuresContainer),$("<div>",{class:"read-more upsell-middle-div"}).append($globalContainer)},_getMiddleEquipments:function(room){var result="";if(room.roomData.features.equipments){result='<div class="upsell-middle-detail-div" ><span class="fb-font-bold upsell-room-feature-category">'+$.fb("crs-helper-translate",{key:"room-numeric-equipment"}).html()+'</span><br/><div class="upsell-middle-detail-div" ><ul>';var featuresToDisplay=_.chain(Object.keys(room.roomData.features.equipments)).filter(function(id){return!room.roomData.features.topOrdered||-1===room.roomData.features.topOrdered.indexOf(id)}).sortBy(function(id){return $fb.upsellRoom._isFeatureInPreviousRoom(id,"equipments")}).first(10).value();result+=_.map(featuresToDisplay,function(id){return $fb.upsellRoom._isFeatureInPreviousRoom(id,"equipments")?'<li class="upsell-room-feature">'+$.fb("crs-helper-translate",{key:"accommodation-feature-"+id}).get(0).outerHTML+"</li>":'<li class="upsell-room-feature upsell-room-feature-advantage">'+$.fb("crs-helper-translate",{key:"accommodation-feature-"+id}).get(0).outerHTML+"</li>"}).join(" "),result+="</div> </div>"}return result},_getMiddleAccommodation:function(room){var result="";if(room.roomData.features.accommodation){result='<div class="upsell-middle-detail-div" ><span class="fb-font-bold upsell-room-feature-category">'+$.fb("crs-helper-translate",{key:"room-comfort"}).html()+'</span><br/><div class="upsell-middle-detail-div" ><ul>';var featuresToDisplay=_.chain(Object.keys(room.roomData.features.accommodation)).filter(function(id){return!room.roomData.features.topOrdered||-1===room.roomData.features.topOrdered.indexOf(id)}).sortBy(function(id){return $fb.upsellRoom._isFeatureInPreviousRoom(id,"accommodation")}).first(10).value();result+=_.map(featuresToDisplay,function(id){return $fb.upsellRoom._isFeatureInPreviousRoom(id,"accommodation")?'<li class="upsell-room-feature">'+$.fb("crs-helper-translate",{key:"accommodation-feature-"+id}).get(0).outerHTML+"</li>":'<li class="upsell-room-feature upsell-room-feature-advantage">'+$.fb("crs-helper-translate",{key:"accommodation-feature-"+id}).get(0).outerHTML+"</li>"}).join(" "),result+="</div></div>"}return result},_getMiddleBedTypes:function(room){var result="";if(room.roomData.bedTypes&&0<room.roomData.bedTypes.length){result='<div class="upsell-middle-detail-div" ><span class="fb-font-bold upsell-room-feature-category">'+$.fb("crs-helper-translate",{key:"room-bed-types"}).html()+'</span><br/><div class=" upsell-middle-detail-div" ><ul>';var beddingsToDisplay=_.chain(room.roomData.bedTypes).sortBy(function(bedType){return void 0!==$fb._state.app.data.accommodations[$fb.upsellRoom.hid][$fb.upsellRoom.pack[0].product].bedTypes&&-1!==$fb._state.app.data.accommodations[$fb.upsellRoom.hid][$fb.upsellRoom.pack[0].product].bedTypes.indexOf(bedType)?1:0}).first(10).value();result+=_.map(beddingsToDisplay,function(bedType){return void 0!==$fb._state.app.data.accommodations[$fb.upsellRoom.hid][$fb.upsellRoom.pack[0].product].bedTypes&&-1!==$fb._state.app.data.accommodations[$fb.upsellRoom.hid][$fb.upsellRoom.pack[0].product].bedTypes.indexOf(bedType)?'<li class="upsell-room-feature">'+$.fb("crs-helper-translate",{key:"__TypeOfBeds___"+bedType}).get(0).outerHTML+"</li>":'<li class="upsell-room-feature upsell-room-feature-advantage">'+$.fb("crs-helper-translate",{key:"__TypeOfBeds___"+bedType}).get(0).outerHTML+"</li>"}).join(" "),result+="</ul></div></div>"}return result},_getMiddleBathroom:function(room){var result="";if(room.roomData.features.bathroom){result='<div class="upsell-middle-detail-div" ><span class="fb-font-bold upsell-room-feature-category">'+$.fb("crs-helper-translate",{key:"room-bathroom"}).html()+'</span><br/><div class=" upsell-middle-detail-div" ><ul>';var featuresToDisplay=_.chain(Object.keys(room.roomData.features.bathroom)).filter(function(id){return!room.roomData.features.topOrdered||-1===room.roomData.features.topOrdered.indexOf(id)}).sortBy(function(id){return $fb.upsellRoom._isFeatureInPreviousRoom(id,"bathroom")}).first(10).value();result+=_.map(featuresToDisplay,function(id){return $fb.upsellRoom._isFeatureInPreviousRoom(id,"bathroom")?'<li class="upsell-room-feature">'+$.fb("crs-helper-translate",{key:"accommodation-feature-"+id}).get(0).outerHTML+"</li>":'<li class="upsell-room-feature upsell-room-feature-advantage">'+$.fb("crs-helper-translate",{key:"accommodation-feature-"+id}).get(0).outerHTML+"</li>"}).join(" "),result+="</ul></div></div>"}return result},_getButtons:function(room,transparent){var result="",placeHolder2=$.fb("crs-helper-price",{price:room.priceDelta}).html();result=transparent?'<div class="read-less go">':'<div class="read-more go" >',result+='<div class="go-subdiv" >'+('<span class = "upsell-price-text upsell-price-text-bottom">'+$.fb("crs-helper-translate",{key:"upsell-upgrade-more-label",fallback:"For just %1$s more",placeholders:[placeHolder2]}).text()+"</span>")+"<br/>";var roomAvailabilities=Math.min.apply(Math,room.pack[0].availability);return $fb._state.app.data.stressRoomsLeftDisplay&&$fb._state.app.data.stressRoomsLeftDisplay.enabled&&roomAvailabilities<$fb._state.app.data.stressRoomsLeftThreshold?result+='<span class="only-x-accomodations-left">'+$.fb("crs-helper-translate",{key:"Only-x-accommodations-left",placeholders:[roomAvailabilities]}).text()+'</span><br/><div class="col-xs-12 upgrade upgrade-only-x-accomodations-left">':result+='<div class="col-xs-12 upgrade" >',result+='            <button class="btn fb-action fb-font-bold btn-upgrade">                '+$.fb("crs-helper-translate",{key:"upsell-upgrade-now-label",fallback:"upgrade now"}).text()+"            </button>        </div>    </div></div>"},_getTopRightButton:function(){return'        <div class="col-xs-12 previous">        <button class="btn fb-action fb-font-bold btn-previous">     X        </button>        </div>'},getBody:function(){var carouselTemplate='                <div id="carousel-upsell" class="carousel slide" data-ride="carousel" data-interval="false">                    <ol class="carousel-indicators hidden-xs hidden-sm"></ol>                    <div class="carousel-inner"></div>                ',room=$fb.upsellRoom.upsellableRoom,doesRoomHavePictures=room.roomData.images,doesRoomHaveMoreThan1Picture=doesRoomHavePictures&&1<room.roomData.images.length;doesRoomHaveMoreThan1Picture&&(carouselTemplate+='<a class="left carousel-control" href="#carousel-upsell" data-slide="prev"><span class="fa fa-angle-left"></span></a>                        <a class="right carousel-control" href="#carousel-upsell" data-slide="next"><span class="fa fa-angle-right"></span></a>                    ');var carousel=$(carouselTemplate+="</div>"),carouselContent=carousel.find(".carousel-inner"),bulletsContent=carousel.find(".carousel-indicators");if(doesRoomHaveMoreThan1Picture||carousel.find("ol.carousel-indicators").hide(),doesRoomHavePictures)_.chain(room.roomData.images).filter(function(image){return image&&image.url}).each(function(image,i){var item=$("<div />",{class:"item "+(0===i?"active":"")});item.append($.fb("crs-helper-image",{src:image.url,height:550,width:950,center:!0,stopCrazyMode:!0}).css({width:"auto",height:"auto"})),carouselContent.append(item);var bullet=$("<li />",{"data-target":"#carousel-upsell","data-slide-to":i});bulletsContent.append(bullet)});else{var item=$('<div class="item-active" />');item.append($("<div>",{center:!0}).css({width:"auto","min-height":"550px"})),carouselContent.append(item)}carousel.on("swipeleft",function(){carousel.carousel("next")}),carousel.on("swiperight",function(){carousel.carousel("prev")}),carousel.carousel(0);var $upsell=$("<div />",{css:{position:"relative"}});$upsell.append(carousel);var $upsellContent=$("<div />",{class:"upsell-text-main-div"});return $upsellContent.append($fb.upsellRoom._getHeader(room),$fb.upsellRoom._getTopRightButton(room),$fb.upsellRoom._getMiddleMore(room),$fb.upsellRoom._getButtons(room,!0),$fb.upsellRoom._getButtons(room,!1)),$upsell.append($upsellContent),$fb.upsellRoom.room=room,$fb.upsellRoom.body=$upsell},_getRoomFeatures:function(roomName){return $fb._state.app.data.accommodations[$fb.upsellRoom.hid][roomName].features},_getUpsellRoomFeatures:function(){return $fb.upsellRoom._getRoomFeatures($fb.room.id)},_getPreviousRoomFeatures:function(){return $fb.upsellRoom._getRoomFeatures($fb.upsellRoom.pack[0].product)},_isFeatureInPreviousRoom:function(featureId,featureType){return void 0!==$fb.upsellRoom._getPreviousRoomFeatures()&&void 0!==$fb.upsellRoom._getPreviousRoomFeatures()[featureType]&&void 0!==$fb.upsellRoom._getPreviousRoomFeatures()[featureType][featureId]},upgrade:function(){$fb.upsellRoom.userReactionToPopup="UPGRADE",$fb.upsellRoom.modal.modal("hide")},previous:function(){$fb.upsellRoom.userReactionToPopup="CLOSE",$fb.upsellRoom.modal.modal("hide")},display:function(){var args={position:"center",template:"minimal",header:""};args.body=$fb.upsellRoom.body,$fb.upsellRoom.modal=$.fb("crs-helper-modal-display",args),$fb.upsellRoom.modal.children(".modal-dialog").addClass("fb-results-upsell"),$("div.read-less").show(),$("div.read-more").hide(),$("div.read-more.toggle span").on("click",function(){$("div.upsell-text-main-div").removeClass("white-background"),$("a.carousel-control").removeClass("carousel-disable"),$("ol.carousel-indicators").removeClass("carousel-disable"),$("div.read-more").hide(),$("div.read-less").show()}),$("div.read-less.toggle span").on("click",function(){$("div.upsell-text-main-div").addClass("white-background"),$("a.carousel-control").addClass("carousel-disable"),$("ol.carousel-indicators").addClass("carousel-disable"),$("div.read-less").hide(),$("div.read-more").show()}),$("div.go button.btn-upgrade").on("click",function(){$fb.upsellRoom.upgrade()}),$("div.previous button.btn-previous").on("click",function(){$fb.upsellRoom.previous()}),$fb.upsellRoom.modal.on("shown.bs.modal",function(){$.fb("crs-tracking-datalayer:gtm",{o:{step:["upsell","open"],eventName:"Upsell"}})}),$fb.upsellRoom.modal.on("hide.bs.modal",function(){"UPGRADE"==$fb.upsellRoom.userReactionToPopup?($.fb("crs-tracking-datalayer:gtm",{o:{step:["upsell","upgrade"],eventName:"Upsell"},data:["upsell"]}),$fb.results._onClickSelectBtn($fb.upsellRoom.contextQuery,$fb.upsellRoom.room.rate,$fb.upsellRoom.room.pack,!0)):("CLOSE"==$fb.upsellRoom.userReactionToPopup?($fb.upsellRoom.preventUpsellPopupFromReopening(),$.fb("crs-tracking-datalayer:gtm",{o:{step:["upsell","close-by-button"],eventName:"Upsell"},data:["upsell"]})):($fb.upsellRoom.preventUpsellPopupFromReopening(),$.fb("crs-tracking-datalayer:gtm",{o:{step:["upsell","close-outside-popup"],eventName:"Upsell"},data:["upsell"]})),$fb.results._onClickSelectBtn($fb.upsellRoom.contextQuery,$fb.upsellRoom.rate,$fb.upsellRoom.pack,!0))})},preventUpsellPopupFromReopening:function(){$fb._state.hasUserAlreadyRefusedUpsell=!0}}})}(window.jQuery,window.$fb.underscore),function(isBrowser){var Globalize=isBrowser?window.Globalize2:require("globalize"),fbLocaleMapping={fr_FR:"fr",en_GB:"en-GB",it_IT:"it",de_DE:"de",ja_JP:"ja",es_ES:"es",ru_RU:"ru",pt_PT:"pt",nl_NL:"nl",th_TH:"th",fi_FI:"fi",pl_PL:"pl",tr_TR:"tr",ro_RO:"ro",sk_SK:"sk",id_ID:"id",hr_HR:"hr",bg_BG:"bg",is_IS:"is",vi_VN:"vi",he_IL:"he",hu_HU:"hu",ar_SA:"ar-SA",ca_ES:"ca",sl_SI:"sl",sr_RS:"sr",fa_IR:"fa",sv_SE:"sv",da_DK:"da",ko_KR:"ko",nn_NO:"nn",cs_CZ:"cs",el_GR:"el",et_EE:"et",lt_LT:"lt",lv_LV:"lv",zh_Hans_CN:"zh-Hans",zh_Hant_HK:"zh-Hant-HK"},i18n={_globalize:null,_selectedLocale:null,fbLocaleMapping:fbLocaleMapping,selectLocale:function(locale){var self=this;return this._globalize=null,this._selectedLocale=locale,globalizeLoader.getGlobalize(locale).then(function(globalize){self._globalize=globalize,self._selectedLocale=locale})},selectCurrency:function(){throw new Error("Not implemented yet")},formatCurrency:function(amount,currency,opts){return currency=currency||this.getSelectedCurrency(),this._globalize.formatCurrency(amount,currency,opts)},formatCustomCurrency:function(amount,symbol,opts){return this._globalize.cldr.get("main/"+this._globalize.cldr.attributes.bundle+"/numbers/currencies").CTM={symbol:symbol},this.formatCurrency(amount,"CTM",opts)},getCurrencySymbol:function(currency){return currency=currency||this.getSelectedCurrency(),this._globalize.cldr.get("main/"+this._globalize.cldr.attributes.bundle+"/numbers/currencies/"+currency+"/symbol")},getCurrencyNbDecimals:function(currency){return currency=currency||this.getSelectedCurrency(),parseInt(this._globalize.cldr.get("supplemental/currencyData/fractions/"+currency+"/_digits")||this._globalize.cldr.get("supplemental/currencyData/fractions/DEFAULT/_digits"),10)},formatNumber:function(number,opts){return this._globalize.formatNumber(number,opts)},getSelectedCurrency:function(){return $fb._state.app.currency},getSelectedLocale:function(){return this._selectedLocale}},globalizeLoader={preload:function(localeOrLocales){Array.isArray(localeOrLocales)||(localeOrLocales=[localeOrLocales]);var self=this;localeOrLocales.forEach(function(locale){self._load(self._mapLocale(locale))})},getGlobalize:function(locale){return locale=this._mapLocale(locale),this._load(locale).then(function(){return Globalize(locale)})},_mapLocale:function(fbLocale){if(!fbLocaleMapping[fbLocale])throw new Error("Unknown locale "+fbLocale);return fbLocaleMapping[fbLocale]},_loaded:{},_load:function(locale){return this._loaded.common?this._loaded[locale]?this._loaded[locale]:this._loadLocale(locale):Promise.all([this._loadCommon(),this._loadLocale(locale)])},_loadCommon:function(){return this._loaded.common=this._ajaxLoad("/dist/data/Globalize/common.json"),this._loaded.common},_loadLocale:function(locale){return this._loaded[locale]=this._ajaxLoad("/dist/data/Globalize/"+locale+".json"),this._loaded[locale]},_ajaxLoad:function(url){return $.get(url).then(function(data){Globalize.load(data)})}};isBrowser?window.$fb.i18n=i18n:module.exports=i18n}("undefined"!=typeof window);